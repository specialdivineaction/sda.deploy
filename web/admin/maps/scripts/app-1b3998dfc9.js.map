{"version":3,"sources":["scripts/app.js"],"names":["angular","module","ArticleAuthorEditorController","activate","component","templateUrl","controller","bindings","author","titleEditorDirective","directive","restrict","scope","title","relnEditDialogFactory","$mdDialog","showDialog","$event","dialog","targetEvent","RelationshipEditDialogController","controllerAs","show","$filter","worksRepo","relnRepo","vm","types","getTypes","rawTypes","typesP","$promise","then","forEach","type","push","id","identifier","label","directed","isDirected","reverse","reverseTitle","Object","defineProperty","value","search","query","results","items","selectWork","proxy","anchors","baseLabel","stripTags","baseToken","ref","token","selectedAnchor","createAnchor","work","getWork","editions","edition","editionLabel","editionName","editionId","volumes","volume","volumeLabel","volumeNumber","volumeId","close","hide","typeId","selectedType","target","description","cancel","this","searchText","selectedWork","$inject","factory","RelationshipsController","$scope","$state","$timeout","sdaToast","_","relnEditDialog","openRelationship","reln","anchor","state","params","TypeId","WORK","workId","properties","PERSON","ARTICLE","go","error","addRelationship","relationship","createRelationship","dialogPromise","relnInfo","targets","related","saveP","save","success","loadRelationships","deleteRelationship","confirm","textContent","ok","confirmPromise","deleteP","$watch","newAnchor","loading","relns","typeGroupsP","typeGroups","normalizeRelationships","publicationInfoEditorDirective","pubInfo","copyEditorDirective","copy","CopyEditorController","addHandler","HathiTrustRefHandler","GoogleBooksRefHandler","InternetArchiveRefHandler","handler","refHandlers","parseProperties","url","copyForm","$setValidity","setProperties","handle","parsed","parseUrl","seq","path","substr","pageNo","fragment","match","length","makePropertiesObject","src","display","hostname","lastIndexOf","urlappend","subquery","parseQueryString","htid","section","printsec","page","pg","parser","document","createElement","href","toString","protocol","host","port","pathname","hash","sep","isString","flags","indexOf","kvpairs","split","pair","ix","key","decodeURIComponent","URIError","hasOwnProperty","isArray","copyEditDialogFactory","locals","CopyEditDialogController","workEditorDirective","WorkEditorController","model","focused","createEdition","titles","cloneDeep","authors","deleteEdition","splice","workEditorItemDirective","$log","linkFunc","WorkEditorItemController","loaded","link","authorRefEditorDirective","AuthorRefEditorController","peopleRepo","authorId","get","linkAuthorSearchText","name","setLinkedAuthor","person","getResults","resultSet","authorRoles","editionEditorDirective","EditionEditorController","createVolume","publicationInfo","deleteVolume","nameEditorDirective","volumeEditorDirective","eventEditorDirective","event","eventEditDialogFactory","EventEditDialogController","treeCategorizationEditor","scopeId","scheme","TreeCategorizationController","$q","articlesRepo","categorizationService","info","repo","getScopedRepo","overviews","handleAssociateEntry","node","linkArticle","article","nodes","openEditor","values","create","articlePromise","linkPromise","all","handleRemoveEntry","handleCreateChild","parent","onCreate","newCategoryDialog","prompt","placeholder","handleDeleteNode","msg","removeCatgorizationDialog","htmlContent","remove","ArticleEditorSectionController","createArticle","titlePromise","savePromise","ArticleEditorController","$stateParams","footnoteEditDialog","refsRepoFactory","references","refsRepo","refsPromise","cleanArticleHandler","$watchCollection","cleanRefsHandler","editFootnote","footnote","newFootnote","newReferences","createRefCollection","promise","ckeditor","footnoteEditor","footnotes","updatedReferences","merge","compact","obj","cleanReferences","cleanFootnotes","refsRepoUrl","getReferencesEndpoint","getRepo","abstractEditor","config","extend","CKEDITOR_CONFIG","removeButtons","join","editor","toolbar","format_tags","extraPlugins","mathJaxLib","AboutEditorSectionController","editAboutPage","AboutEditorController","aboutCategorizationEditor","AboutCategorizationEditorController","pageSavePromise","labelPromise","hierarchy","ZoteroTestController","item","summaryEditorDirective","toolbarGroups","groups","summary","summaryEditDialogFactory","SummaryEditDialogController","stripTagsFilter","html","String","replace","filter","slideToggle","beforeAddClass","element","className","done","NG_HIDE_CLASS","slideUp","removeClass","slideDown","animation","SeeAlsoEditorController","seeAlsoRepo","trcSearch","createLink","alreadyLinked","clearLinkForm","sourceToken","source","seeAlso","links","openLink","deleteLink","confirmP","combineSearchResults","newToken","some","existing","selectedItem","flatMap","UNIFIED_SEARCH_KEYS","map","SdaToastProvider","SdaToastFactory","$mdToast","showSuccessToast","message","options","opts","toastClass","makeToast","showInfoToast","showErrorToast","hideDelay","provider","defaultOptions","toast","simple","position","action","$get","NavbarController","$mdSidenav","toggleSidenav","toggle","sidenavId","guessDateFactory","moment","guessDate","str","INFER_FORMATS","emptyFilterFactory","isEmpty","dateEditorDirective","calendarAutoSet","dateDescription","date","calendar","format","DataContainerController","watch","fn","unregister","listeners","set","newValue","footnoteEditDialogFactory","$mdBottomSheet","FootnoteEditDialogController","clickOutsideToClose","ckeditorConfig","ckeditorFootnotesDirective","$document","el","attrs","requires","insertFootnoteCommand","fire","FOOTNOTE_COMMAND_NAME","command","createFootnote","backlinkId","anchorIdPrefix","ckeditorBibliography","$eval","ctrl","insertHtml","ckeditorFootnotesAnchorIdPrefix","instance","scopeValueExpr","ckeditorFootnotes","addCommand","async","allowedContent","requiredContent","exec","ui","addButton","require","CitationEditorController","zotero","refsRenderer","account","getUserAccount","ZOTERO_USER_ACCOUNT_ID","ZOTERO_USER_ACCOUNT_API_KEY","groupP","when","getGroup","ZOTERO_GROUP_ID","groupLibraryP","group","getLibrary","citation","Error","citations","warn","library","resultsP","searchItems","adaptedResultsP","adaptItem","wrapItem","zItem","createBiblioItem","creators","adaptCreator","meta","pick","fields","omit","zCreator","role","creatorType","firstName","lastName","labelP","renderBiblioItem","addCitationItem","citationItem","referencedBibItem","bibliography","renderCitationItemLabel","clearForm","selectBiblioItem","itemContainer","activeCitationItem","editCitationItem","biblioItem","biblioItemContainer","selectedBiblioItem","createCitation","reference","renderedP","render","rendered","createZoteroItem","zoteroItem","cancelZoteroItem","saveZoteroItem","zItemP","saveItem","biblioItemP","itemContainerP","locatorTypes","LOCATOR_TYPES","edit","CitationEditDialogFactory","CitationEditDialogController","ckeditorBibliographyDirective","citationEditDialog","insertCitationCommand","CITATION_COMMAND_NAME","newReference","refs","ZoteroEditorController","getItemTypes","typeFilter","field","selectType","itemType","roles","fieldsP","getFields","creatorRolesP","getCreatorRoles","itemTypeSearchText","ZoteroCreatorFieldController","creator","ZoteroFactory","getDefaultBaseUrl","toJson","ShowWorkController","workEditDialog","copyEditDialog","summaryEditDialog","workPromise","bcTitle","getTitle","getWorkLabel","refsEndpointUrl","editBibInfo","updatedWork","saveWork","showSavedToast","editSummary","updatedSummary","editBibliography","addEdition","saveEdition","addCopy","editCopy","copies","updatedCopy","deleteCopy","deleteWork","workLabel","subtitle","confirmDialog","createBookReviewArticle","articleTitleDialog","initialValue","titleP","articleP","createLinked","relationships","createBookReview","workEditDialogFactory","WorkEditDialogController","addAuthor","authorRef","deleteAuthor","addTitle","deleteTitle","ShowVolumeController","volumeEditDialog","extractTitle","workTitle","getEdition","editionPromise","getVolume","volumePromise","getVolumeLabel","preference","biblioObject","updatedVolume","saveVolume","copyToEdition","origCopy","newCopy","volumeEditDialogFactory","VolumeEditDialogController","ShowEditionController","editionEditDialog","getEditionLabel","updatedEdition","addVolume","copyToWork","editionEditDialogFactory","EditionEditDialogController","tasksRepoProvider","tasksRepoFactory","$resource","getAllTasks","taskResource","getTask","taskId","getWorkflow","workflowResource","getItems","stageId","itemResource","stage","start","max","transition","sourceStage","targetStage","result","itemId","comments","resp","TaskController","tasksRepo","tasks","tasksPromise","openMenu","ShowTaskController","task","taskPromise","makeErrorHandler","workflow","workflowPromise","worklistPromise","loadWorklist","focusItem","stopImmediatePropagation","entityId","transitionItem","updatedItem","refreshPromise","fetchStage","worklistPromises","stages","worklists","stageOrder","ShowPersonController","personEditDialog","eventEditDialog","personId","personRefsUrl","editBioInfo","updatedPerson","editEvent","updatedEvent","deletePerson","nameLabel","createBiographyArticle","createBiography","personEditDialogFactory","PersonEditDialogController","addName","createName","altNames","deleteName","nameRoles","MainController","q","searchQuery","peopleResults","worksResults","createPerson","createWork","debounce","$mdThemingProvider","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","runBlock","trcAuth","isAuthenticated","loginGuest","run","routerConfig","$stateProvider","$urlRouterProvider","views","main","otherwise","constant","$logProvider","$httpProvider","worksRepoProvider","peopleRepoProvider","articlesRepoProvider","relnRepoProvider","categorizationServiceProvider","seeAlsoRepoProvider","trcSearchProvider","trcAuthProvider","trcAuthInterceptorProvider","debugEnabled","API_PREFIX","loginUrl","loginGuestUrl","RegExp","interceptors","cslConfig","citeprocProvider","refsRendererProvider","addLocale","filename","localeId","supplier","$http","res","data","addStyle","styleId","typemapUrl","CSL_LOCALES","CSL_STYLES","en-US","mla","chicago","$templateCache","put"],"mappings":"CAAA,WACE,YAEAA,SACGC,OAAO,YACN,YACA,YACA,aACA,aACA,SACA,aACA,YACA,WACA,aACA,UACA,YACA,WACA,SACA,UACA,UACA,cACA,SACA,WACA,WAKN,WACE,YAaA,SAASC,KASP,QAASC,MANTA,IAdFH,QACGC,OAAO,YACPG,UAAU,uBACTC,YAAa,yFACbC,WAAYJ,EACZK,UACEC,OAAQ,UAmBhB,WACE,YAOA,SAASC,KACP,GAAIC,IACFC,SAAU,IACVN,YAAa,qDACbO,OACEC,MAAO,YAIX,OAAOH,GAdTV,QACGC,OAAO,YACPS,UAAU,cAAeD,MAiB9B,WACE,YAOA,SAASK,GAAsBC,GAK7B,QAASC,GAAWC,GAElB,GAAIC,IACFC,YAAaF,EACbZ,YAAa,6DACbC,WAAYc,EACZC,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAbxB,OACEI,KAAMN,GAkBV,QAASI,GAAiCG,EAASR,EAAWS,EAAWC,GAsBvE,QAAStB,KACPuB,EAAGC,MAAQC,IAGb,QAASA,KACP,GAAIC,GAAWJ,EAASG,WACpBD,KAEAG,EAASD,EAASE,SAASC,KAAK,WAmBlC,MAlBAhC,SAAQiC,QAAQJ,EAAU,SAAUK,GAClCP,EAAMQ,MACJC,GAAIF,EAAKG,WACTC,MAAOJ,EAAKrB,MACZ0B,SAAUL,EAAKM,WACfC,SAAS,IAGPP,EAAKM,YACPb,EAAMQ,MACJC,GAAIF,EAAKG,WACTC,MAAOJ,EAAKQ,aACZH,SAAUL,EAAKM,WACfC,SAAS,MAKRd,GAQT,OAJAgB,QAAOC,eAAejB,EAAO,YAC3BkB,MAAOf,IAGFH,EAGT,QAASmB,GAAOC,GACd,GAAIC,GAAUxB,EAAUsB,OAAOC,EAC/B,OAAOC,GAAQjB,SAASC,KAAK,WAC3B,MAAOgB,GAAQC,QAInB,QAASC,GAAWC,GAGlB,GAFAzB,EAAG0B,WAEED,EAAL,CAIA,GAAIE,GAAYC,EAAUH,EAAMb,OAC5BiB,EAAYJ,EAAMK,IAAIC,KAG1B/B,GAAGgC,eAAiBjC,EAASkC,aAAaN,EAAWE,GACrD7B,EAAG0B,QAAQjB,KAAKT,EAAGgC,eAEnB,IAAIE,GAAOpC,EAAUqC,QAAQV,EAAMf,GACnCwB,GAAK7B,SAASC,KAAK,WACjB4B,EAAKE,SAAS7B,QAAQ,SAAU8B,GAE9B,GAAIC,GAAeX,EAAY,KAAOU,EAAQE,WAC9CvC,GAAG0B,QAAQjB,KAAKV,EAASkC,aAAaK,EAAcT,GAClDW,WAAYH,EAAQ3B,OAGtB2B,EAAQI,QAAQlC,QAAQ,SAAUmC,GAEhC,GAAIC,GAAcL,EAAe,YAAcI,EAAOE,YACtD5C,GAAG0B,QAAQjB,KAAKV,EAASkC,aAAaU,EAAad,GACjDW,WAAYH,EAAQ3B,IACpBmC,UAAWH,EAAOhC,cAO5B,QAASoC,KACPzD,EAAU0D,MACRC,OAAQhD,EAAGiD,aAAavC,GACxBG,SAAUb,EAAGiD,aAAapC,SAC1BE,QAASf,EAAGiD,aAAalC,QACzBmC,OAAQlD,EAAGgC,eACXmB,YAAanD,EAAGmD,cAIpB,QAASC,KACP/D,EAAU+D,SAhHZ,GAAIxB,GAAY/B,EAAQ,aACpBG,EAAKqD,IAETrD,GAAGmD,YAAc,KAEjBnD,EAAGC,MAAQ,KACXD,EAAGiD,aAAe,KAElBjD,EAAGsD,WAAa,KAChBtD,EAAGuD,aAAe,KAElBvD,EAAG0B,QAAU,KACb1B,EAAGgC,eAAiB,KAEpBhC,EAAGoB,OAASA,EACZpB,EAAGwB,WAAaA,EAChBxB,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EAEZ3E,IA7CFW,EAAsBoE,SAAW,aACjC9D,EAAiC8D,SAAW,UAAW,YAAa,YAAa,YADjFlF,QACGC,OAAO,YACPkF,QAAQ,iBAAkBrE,MA8I/B,WACE,YAsBA,SAASsE,GAAwBC,EAAQC,EAAQC,EAAUxE,EAAWyE,EAAUC,EAAGhE,EAAUiE,GAa3F,QAASC,GAAiB1E,EAAQ2E,GAEhC,GAAIC,GAASD,EAAKxC,QAAQ,GAEtB0C,EAAQ,KACRC,IAEJ,QAAOF,EAAOrC,IAAItB,MAChB,IAAK8D,GAAOC,KACVH,EAAQ,cACRC,EAAOG,OAASL,EAAOrC,IAAIpB,GAEvByD,EAAOM,WAAWjC,YACpB4B,EAAQ,iBACRC,EAAO7B,UAAY2B,EAAOM,WAAWjC,WAGnC2B,EAAOM,WAAWjC,WAAa2B,EAAOM,WAAW5B,WACnDuB,EAAQ,gBACRC,EAAOxB,SAAWsB,EAAOM,WAAW5B,SAGtC,MACF,KAAKyB,GAAOI,OACVN,EAAQ,gBACRC,EAAO3D,GAAKyD,EAAOrC,IAAIpB,EACvB,MACF,KAAK4D,GAAOK,QACVP,EAAQ,eACRC,EAAO3D,GAAKyD,EAAOrC,IAAIpB,GAMtB0D,EAGHR,EAAOgB,GAAGR,EAAOC,GAFjBP,EAASe,MAAM,yCAMnB,QAASC,GAAgBvF,GACvB,GAAIwF,GAAehF,EAASiF,qBAExBC,EAAgBjB,EAAepE,KAAKL,EACxC0F,GAAc3E,KAAK,SAAU4E,GAC3BH,EAAa/B,OAASkC,EAASlC,OAC/B+B,EAAa5B,YAAc+B,EAAS/B,YAW/B+B,EAASrE,SAGHqE,EAASnE,SAClBgE,EAAaI,QAAQ1E,KAAKT,EAAGmE,QAC7BY,EAAaK,QAAQ3E,KAAKyE,EAAShC,UAEnC6B,EAAaK,QAAQ3E,KAAKT,EAAGmE,QAC7BY,EAAaI,QAAQ1E,KAAKyE,EAAShC,UAPnC6B,EAAaK,QAAQ3E,KAAKT,EAAGmE,QAC7BY,EAAaK,QAAQ3E,KAAKyE,EAAShC,QASrC,IAAImC,GAAQtF,EAASuF,KAAKP,EAC1BM,GAAM/E,KAAK,WACTwD,EAASyB,QAAQ,UAEjB1B,EAAS2B,EAAmB,MAC3B,WACD1B,EAASe,MAAM,mCAMrB,QAASY,GAAmBlG,EAAQ2E,GAClC,GAAIwB,GAAUrG,EAAUqG,UACrBjG,YAAYF,GACZJ,MAAM,oBACNwG,YAAY,sDACZC,GAAG,OACHxC,OAAO,MAENyC,EAAiBxG,EAAUO,KAAK8F,EACpCG,GAAevF,KAAK,WAClB,GAAIwF,GAAU/F,EAAAA,UAAgBmE,EAAKxD,GAEnCoF,GAAQxF,KAAK,WACXwD,EAASyB,QAAQ,yBAEjB1B,EAAS2B,EAAmB,MAC3B,WACD1B,EAASe,MAAM,qCAOrB,QAASpG,KACPkF,EAAOoC,OAAO,eAAgB,SAAUC,GACjCA,GAILR,MAQJ,QAASA,KACPxF,EAAGiG,SAAU,CACb,IAAIC,GAAQnG,EAASqB,OAAOpB,EAAGmE,OAAOrC,IAAK9B,EAAGmE,OAAOM,YAEjD0B,EAAcD,EAAM7F,SAASC,KAAK,WAEpC,MADAN,GAAGoG,WAAarG,EAASsG,uBAAuBH,EAAOlG,EAAGmE,OAAOrC,KAC1D9B,EAAGoG,WAAW/F,UAUvB,OAPA8F,GAAAA,SAAkB,WAChBrC,EAASe,MAAM,sDACdvE,KAAK,WACNN,EAAGiG,SAAU,IAIRE,EApJT,GAAInG,GAAKqD,IAETrD,GAAGoG,WAAa,KAEhBpG,EAAGiE,iBAAmBA,EACtBjE,EAAG8E,gBAAkBA,EACrB9E,EAAGyF,mBAAqBA,EAExBhH,IA3BFiF,EAAwBF,SAAW,SAAU,SAAU,WAAY,YAAa,WAAY,IAAK,WAAY,kBAF7GlF,QACGC,OAAO,YACPG,UAAU,iBACTC,YAAa,uDACbE,UACEsF,OAAQ,KAEVvF,WAAY8E,GAKhB,IAAIY,IACFC,KAAM,4BACNG,OAAQ,2BACRC,QAAS,0BAiKb,WACE,YAOA,SAAS2B,KACP,GAAItH,IACFC,SAAU,IACVN,YAAa,2EACbO,OACEqH,QAAS,YAIb,OAAOvH,GAdTV,QACGC,OAAO,YACPS,UAAU,wBAAyBsH,MAiBxC,WACE,YAOA,SAASE,KACP,GAAIxH,IACFC,SAAU,IACVN,YAAa,mDACbO,OACEuH,KAAM,YAER7H,WAAY8H,EACZ/G,aAAc,KAGhB,OAAOX,GAIT,QAAS0H,GAAqB/C,GAQ5B,QAASlF,KACPkI,EAAWC,KACXD,EAAWE,KACXF,EAAWG,KAGb,QAASH,GAAWI,GAClB/G,EAAGgH,YAAYD,EAAQrG,IAAMqG,EAG/B,QAASE,GAAgBzG,EAAM0G,GACzBlH,EAAGgH,YAAYxG,KACjBmD,EAAO8C,KAAKhC,WAAazE,EAAGgH,YAAYxG,GAAM0G,IAGhDvD,EAAOwD,SAASD,IAAIE,aAAa5G,EAAgC,MAA1BmD,EAAO8C,KAAKhC,YAtBrD,GAAIzE,GAAKqD,IAETrD,GAAGgH,eACHhH,EAAGqH,cAAgBJ,EAEnBxI,IA8BF,QAASqI,KACP,QAASQ,GAAOJ,GACd,GAAIK,GAASC,EAASN,EACtB,KAAKK,EACH,MAAO,KAGT,IAAI7G,GAAI+G,CAER,IAAiC,aAA7BF,EAAOG,KAAKC,OAAO,EAAG,GAAmB,CAC3CjH,EAAK6G,EAAOG,KAAKC,OAAO,EAExB,IAAIC,GAASL,EAAOM,SAASC,MAAM,iBAC/BF,IAAUA,EAAOG,QAAU,IAC7BN,EAAMG,EAAO,IAIjB,MAAOI,GAAqBd,EAAKxG,EAAI+G,GAkBvC,QAASO,GAAqBC,EAAKvH,EAAI+G,GACrC,MAAK/G,IAKHuH,IAAKA,EACLvH,GAAIA,EACJ+G,IAAKA,GANE,KAUX,MA3BAH,GAAO5G,GAAK,kBACZ4G,EAAOY,QAAU,mBA0BVZ,EAGT,QAASV,KACP,QAASU,GAAOJ,GACd,GAAIK,GAASC,EAASN,EACtB,KAAKK,EACH,MAAO,KAGT,IAAI7G,GAAI+G,CAER,QAAQF,EAAOY,UACb,IAAK,uBACHzH,EAAK6G,EAAOlG,MAAMX,GAClB+G,EAAMF,EAAOlG,MAAMoG,GACnB,MAEF,KAAK,iBAGH,GAFA/G,EAAK6G,EAAOG,KAAKC,OAAOJ,EAAOG,KAAKU,YAAY,KAAO,IAElDb,EAAOlG,MAAMgH,UAChB,KAGF,IAAIC,GAAWC,EAAiBhB,EAAOlG,MAAMgH,UAC7C,KAAKC,EACH,KAEFb,GAAMa,EAASb,IAInB,MAAK/G,IAKHuH,IAAKf,EACLsB,KAAM9H,EACN+G,IAAKA,GANE,KAaX,MAHAH,GAAO5G,GAAK,aACZ4G,EAAOY,QAAU,aAEVZ,EAGT,QAAST,KACP,QAASS,GAAOJ,GACd,GAAIK,GAASC,EAASN,EACtB,KAAKK,EACH,MAAO,KAGT,QAAQA,EAAOY,UACb,IAAK,mBACH,GAAIzH,GAAK6G,EAAOlG,MAAMX,GAClB+H,EAAUlB,EAAOlG,MAAMqH,SACvBC,EAAOpB,EAAOlG,MAAMuH,GAI5B,MAAKlI,IAKHuH,IAAKf,EACLxG,GAAIA,EACJ+H,QAASA,EACTE,KAAMA,GAPC,KAcX,MAHArB,GAAO5G,GAAK,cACZ4G,EAAOY,QAAU,eAEVZ,EAST,QAASE,GAASN,GAChB,IAAKA,EACH,MAAO,KAIT,IAAI2B,GAASC,SAASC,cAAc,IAGpC,OAFAF,GAAOG,KAAO9B,GAGZ+B,SAAU,WACR,MAAO/B,IAETgC,SAAUL,EAAOK,SACjBC,KAAMN,EAAOM,KACbhB,SAAUU,EAAOV,SACjBiB,KAAMP,EAAOO,KACb1B,KAAMmB,EAAOQ,SACbhI,MAAOkH,EAAiBM,EAAOzH,QAC/ByG,SAAUgB,EAAOS,MAUrB,QAASf,GAAiBlH,EAAOkI,GAC/B,IAAKlI,IAAU/C,QAAQkL,SAASnI,GAC9B,QASF,IALiB,MAAbA,EAAM,KACRA,EAAQA,EAAMsG,OAAO,KAIlB4B,EAAK,CAMR,GAAIE,IAASpI,EAAMqI,QAAQ,MAAQ,EAAI,EAAI,IAAMrI,EAAMqI,QAAQ,MAAQ,EAAI,EAAI,EAC/EH,GAAgB,IAAVE,EAAc,IAAM,IAG5B,GAAIlC,MAEAoC,EAAUtI,EAAMuI,MAAML,EAoC1B,OAnCAI,GAAQpJ,QAAQ,SAAUsJ,GACxB,GAAIC,GAAKD,EAAKH,QAAQ,KAClBK,EAAMF,EACN1I,EAAQ,IAEZ,IAAK4I,EAAL,CAIID,GAAM,IACRC,EAAMF,EAAKlC,OAAO,EAAGmC,GACrB3I,EAAQ0I,EAAKlC,OAAOmC,EAAK,GAG3B,KACEC,EAAMC,mBAAmBD,GACzB5I,EAAQ6I,mBAAmB7I,GAC3B,MAAO8I,GACP,OAKE1C,EAAO2C,eAAeH,GAEpBzL,QAAQ6L,QAAQ5C,EAAOwC,IACzBxC,EAAOwC,GAAKtJ,KAAKU,GAEjBoG,EAAOwC,IAAQxC,EAAOwC,GAAM5I,GAG9BoG,EAAOwC,GAAO5I,KAIXoG,EAtRTb,EAAqBlD,SAAW,UAHhClF,QACGC,OAAO,YACPS,UAAU,aAAcwH,MA4R7B,WACE,YAOA,SAAS4D,GAAsB/K,GAK7B,QAASC,GAAWC,EAAQkH,GAC1B,GAAIjH,IACFC,YAAaF,EACbZ,YAAa,6DACb0L,QACE5D,KAAMA,GAER7H,WAAY0L,EACZ3K,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAASgL,GAAyBjL,EAAWoH,GAQ3C,QAAS3D,KACPzD,EAAU0D,KAAK/C,EAAGyG,MAGpB,QAASrD,KACP/D,EAAU+D,SAZZ,GAAIpD,GAAKqD,IAETrD,GAAGyG,KAAOA,EAEVzG,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EA5BdgH,EAAsB5G,SAAW,aACjC8G,EAAyB9G,SAAW,YAAa,QALjDlF,QACGC,OAAO,YACPkF,QAAQ,iBAAkB2G,MA2C/B,WACE,YAaA,SAASG,KAQP,QAASC,GAAqB7G,EAAQ7D,EAAWiE,GAU/C,QAAStF,KACPkF,EAAOzB,KAAKE,SAAS7B,QAAQ,SAAU8B,GACrCrC,EAAGoC,SAAS3B,MACVgK,MAAOpI,EACPqI,SAAS,MAKf,QAASC,KACP,GAAItI,GAAUvC,EAAU6K,eACxBtI,GAAQuI,OAAS7G,EAAE8G,UAAUlH,EAAOzB,KAAK0I,QACzCvI,EAAQyI,QAAU/G,EAAE8G,UAAUlH,EAAOzB,KAAK4I,SAE1CnH,EAAOzB,KAAKE,SAAS3B,KAAK4B,GAC1BrC,EAAGoC,SAAS3B,MACVgK,MAAOpI,EACPqI,SAAS,IAIb,QAASK,GAAcjB,GACrB9J,EAAGoC,SAAS4I,OAAOlB,EAAI,GACvBnG,EAAOzB,KAAKE,SAAS4I,OAAOlB,EAAI,GAhClC,GAAI9J,GAAKqD,IAETrD,GAAGoC,YAEHpC,EAAG2K,cAAgBA,EACnB3K,EAAG+K,cAAgBA,EAEnBtM,IAfF+L,EAAqBhH,SAAW,SAAU,YAAa,IANvD,IAAIxE,IACFC,SAAU,IACVN,YAAa,mDACbO,OACEgD,KAAM,YAERtD,WAAY4L,EACZ7K,aAAc,KAGhB,OAAOX,GAhBTV,QACGC,OAAO,YACPS,UAAU,aAAcuL,MAwD7B,WACE,YAeA,SAASU,GAAwBC,GAM/B,QAASC,GAASxH,GACXA,EAAOjD,IACVwK,EAAKrG,MAAM,mCAKf,QAASuG,GAAyBzH,EAAQ7D,GAOxC,QAASrB,KACHkF,EAAOjD,KACTV,EAAGkC,KAAOpC,EAAUqC,QAAQwB,EAAOjD,IACnCV,EAAGkC,KAAK7B,SAASC,KAAK,WACpBN,EAAGqL,QAAS,KAVlB,GAAIrL,GAAKqD,IAETrD,GAAGqL,QAAS,EAEZ5M,IAjBF2M,EAAyB5H,SAAW,SAAU,YAR9C,IAAIxE,IACFC,SAAU,IACVN,YAAa,6DACb2M,KAAMH,EACNjM,OACEwB,GAAI,OAEN9B,WAAYwM,EACZzL,aAAc,KAGhB,OAAOX,GAVTiM,EAAwBzH,SAAW,QAPnClF,QACGC,OAAO,YACPS,UAAU,iBAAkBiM,MA4CjC,WACE,YAgBA,SAASM,KAKP,QAASC,GAA0B7H,EAAQ8H,GAgBzC,QAAShN,KACP,GAAIkF,EAAO7B,IAAI4J,SAAU,CACvB,GAAI5M,GAAS2M,EAAWE,IAAIhI,EAAO7B,IAAI4J,SACvC5M,GAAOuB,SAASC,KAAK,WACnBN,EAAG4L,qBAAuB9M,EAAO+M,KAAKjL,SAK5C,QAASkL,GAAgBC,GACvBpI,EAAO7B,IAAI4J,SAAWK,EAAOrL,GAG/B,QAASsL,GAAW3K,GAClB,GAAI4K,GAAYR,EAAWrK,OAAOC,EAClC,OAAO4K,GAAU5L,SAASC,KAAK,WAC7B,MAAO2L,GAAU1K,QA/BrB,GAAIvB,GAAKqD,IAETrD,GAAG4L,qBAAuB,GAC1B5L,EAAGkM,aACD,SACA,SACA,aACA,SAGFlM,EAAG8L,gBAAkBA,EACrB9L,EAAGgM,WAAaA,EAEhBvN,IAlBF+M,EAA0BhI,SAAW,SAAU,aAT/C,IAAIxE,IACFC,SAAU,IACVN,YAAa,+DACbO,OACE4C,IAAK,YAEPlD,WAAY4M,EACZ7L,aAAc,KAGhB,OAAOX,GAhBTV,QACGC,OAAO,YACPS,UAAU,kBAAmBuM,MA0DlC,WACE,YAiBA,SAASY,KAIP,QAASC,GAAwBzI,EAAQ7D,EAAWiE,GAUlD,QAAStF,KACPkF,EAAOtB,QAAQI,QAAQlC,QAAQ,SAAUmC,GACvC1C,EAAGyC,QAAQhC,MACTgK,MAAO/H,EACPgI,SAAS,MAKf,QAAS2B,KACP,GAAI3J,GAAS5C,EAAUuM,cACvB3J,GAAOkI,OAAS7G,EAAE8G,UAAUlH,EAAOtB,QAAQuI,QAC3ClI,EAAOoI,QAAU/G,EAAE8G,UAAUlH,EAAOtB,QAAQyI,SAC5CpI,EAAO4J,gBAAkBvI,EAAE8G,UAAUlH,EAAOtB,QAAQiK,iBAEpD3I,EAAOtB,QAAQI,QAAQhC,KAAKiC,GAC5B1C,EAAGyC,QAAQhC,MACTgK,MAAO/H,EACPgI,SAAS,IAIb,QAAS6B,GAAazC,GACpB9J,EAAGyC,QAAQuI,OAAOlB,EAAI,GACtBnG,EAAOtB,QAAQI,QAAQuI,OAAOlB,EAAI,GAjCpC,GAAI9J,GAAKqD,IAETrD,GAAGyC,WAEHzC,EAAGqM,aAAeA,EAClBrM,EAAGuM,aAAeA,EAElB9N,IAXF2N,EAAwB5I,SAAW,SAAU,YAAa,IAV1D,IAAIxE,IACFC,SAAU,IACVN,YAAa,yDACbO,OACEmD,QAAS,YAEXzD,WAAYwN,EACZzM,aAAc,KAGhB,OAAOX,GAhBTV,QACGC,OAAO,YACPS,UAAU,gBAAiBmN,MA0DhC,WACE,YAOA,SAASK,KACP,GAAIxN,IACFC,SAAU,IACVN,YAAa,qDACbO,OACE2M,KAAM,YAIV,OAAO7M,GAdTV,QACGC,OAAO,YACPS,UAAU,aAAcwN,MAiB7B,WACE,YAOA,SAASC,KACP,GAAIzN,IACFC,SAAU,IACVN,YAAa,uDACbO,OACEwD,OAAQ,YAIZ,OAAO1D,GAdTV,QACGC,OAAO,YACPS,UAAU,eAAgByN,MAiB/B,WACE,YAOA,SAASC,KACP,GAAI1N,IACFC,SAAU,IACVN,YAAa,uDACbO,OACEyN,MAAO,YAIX,OAAO3N,GAdTV,QACGC,OAAO,YACPS,UAAU,cAAe0N,MAiB9B,WACE,YAOA,SAASE,GAAuBvN,GAK9B,QAASC,GAAWC,EAAQoN,GAC1B,GAAInN,IACFC,YAAaF,EACbZ,YAAa,iEACb0L,QACEsC,MAAOA,GAET/N,WAAYiO,EACZlN,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAASuN,GAA0BxN,EAAWsN,GAQ5C,QAAS7J,KACPzD,EAAU0D,KAAK/C,EAAG2M,OAGpB,QAASvJ,KACP/D,EAAU+D,SAZZ,GAAIpD,GAAKqD,IAETrD,GAAG2M,MAAQA,EAEX3M,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EArBdwJ,EAAuBpJ,SAAW,aAClCqJ,EAA0BrJ,SAAW,YAAa,SAZlDlF,QACGC,OAAO,YACPkF,QAAQ,kBAAmBmJ,MA2ChC,WACG,YAOA,SAASE,KACN,GAAI9N,IACDC,SAAU,IACVN,YAAa,oDACbO,OACE6N,QAAS,IACTC,OAAQ,KAGVpO,WAAYqO,EACZtN,aAAc,KAGjB,OAAOX,GAMV,QAASiO,GAA6BtJ,EAAQuH,EAAM7L,EAAWyE,EAAUF,EAAQsJ,EAC/EC,EAAcC,GAcd,QAAS3O,KACPyM,EAAKmC,KAAK,yBAA0BF,GACpCG,EAAOF,EAAsBG,cAAc5J,EAAOoJ,SAElD/M,EAAGwN,UAAYF,EAAK3B,IAAIhI,EAAOqJ,QAQhC,QAASS,GAAqBlO,EAAQmO,GAmBpC,QAASC,GAAYC,GACnB,GAAI9L,GAAMwL,EAAKO,MAAMvC,KAAKoC,GACxBhN,GAAIkN,EAAQ9L,IAAIpB,GAChBF,KAAMoN,EAAQ9L,IAAItB,MAEpB,OAAOsB,GAAIzB,SAGb,QAASyN,GAAWC,GAClBnK,EAAOgB,GAAG,gBACRlE,GAAIqN,EAAOH,QAAQlN,KA5BvBwK,EAAKmC,KAAK,mBAIV,IAAI7M,GAAO,WACPrB,EAAQuO,EAAK9M,MAIbgN,EAAUT,EAAaa,OAAOxN,EAAMrB,GACpC8O,EAAiBd,EAAa7H,KAAKsI,GACnCM,EAAcD,EAAe3N,KAAKqN,EAEtCT,GAAGiB,KACDP,QAASK,EACTnM,IAAKoM,IACJ5N,KAAKwN,GAoBV,QAASM,GAAkB7O,EAAQmO,GACjCxC,EAAKmC,KAAK,iBAAkBK,GAkB9B,QAASW,GAAkB9O,EAAQ+O,GAejC,QAASC,GAAS3N,GAChBsK,EAAKmC,KAAK,qBAAuBzM,GAEjC0M,EAAKO,MAAMG,OAAOM,EAAQ1N,GAjB5BsK,EAAKmC,KAAKiB,EAEV,IAAIE,GAAoBnP,EAAUoP,QAChCtP,MAAO,uBAEPuP,YAAa,eACb9I,GAAI,SACJxC,OAAQ,SACR3D,YAAaF,GAGfF,GAAUO,KAAK4O,GACLlO,KAAKiO,GASjB,QAASI,GAAiBpP,EAAQmO,EAAMY,GACtCpD,EAAKmC,KAAKK,EAEV,IAAIvO,GAAQ,oBAAsBuO,EAAK9M,MAAQ,IAC3CgO,EAAM,8CAAgDlB,EAAK9M,MAAQ,sIAInEiO,EAA4BxP,EAAUqG,SACxCvG,MAAOA,EACP2P,YAAaF,EACbhJ,GAAI,SACJxC,OAAQ,SACR3D,YAAaF,GAGfF,GAAUO,KAAKiP,GAA2BvO,KAAK,WAE5CgN,EAAKO,MAAMkB,OAAOrB,GAAM,EAAMY,GAAQhO,KAAK,WACzC,MAAOwD,GAASyB,QAAQ,qBACvB,WACD,MAAOzB,GAASe,MAAM,iCA3H9B,GAAI7E,GAAKqD,KACLiK,EAAO,IAGXtN,GAAGyN,qBAAuBA,EAC1BzN,EAAGoO,kBAAoBA,EACvBpO,EAAGqO,kBAAoBA,EACvBrO,EAAG2O,iBAAmBA,EAEtBlQ,IAvBFwO,EAA6BzJ,SAAW,SAAU,OAAQ,YAAa,WAAY,SAAU,KAAM,eAAgB,yBAbnHlF,QACIC,OAAO,YACPS,UAAU,2BAA4B8N,MAkL7C,WACE,YAQA,SAASkC,GAA+BpL,EAAQvE,EAAWyE,EAAUqJ,GAOnE,QAAS1O,MAeT,QAASwQ,GAAc1P,EAAQiB,GAC7B,GAAIhB,GAASH,EAAUoP,SACpBhP,YAAYF,GACZJ,MAAM,kBACNwG,YAAY,+CACZ+I,YAAY,SACZ9I,GAAG,UACHxC,OAAO,UAEN8L,EAAe7P,EAAUO,KAAKJ,EAElC0P,GAAa5O,KAAK,SAAUnB,GAC1B,GAAIyO,GAAUT,EAAaa,OAAOxN,EAAMrB,GACpCgQ,EAAchC,EAAa7H,KAAKsI,EASpC,OAPAuB,GAAY7O,KAAK,SAAUsN,GACzBhK,EAAOgB,GAAG,gBAAkBlE,GAAIkN,EAAQlN,KACxCoD,EAASyB,QAAQ,iCAChB,WACDzB,EAASe,MAAM,8BAGVsK,IA3CX,GAAInP,GAAKqD,IAETrD,GAAGiP,cAAgBA,EAEnBxQ,IAIFuQ,EAA+BxL,SAAW,SAAU,YAAa,WAAY,gBAd7ElF,QACGC,OAAO,YACPK,WAAW,iCAAkCoQ,MA0DlD,WACE,YA6CA,SAASI,GAAwBlC,EAAIhC,EAAMmE,EAAc1L,EAAQ2L,EAAoBxL,EAAUqJ,EAAcoC,GA0D3G,QAAS9Q,KACPyM,EAAKmC,KAAK,yBAA0BF,GAEpCnN,EAAG4N,QAAUT,EAAaxB,IAAI0D,EAAa3O,GAC3C,IAAIuN,GAAiBjO,EAAG4N,QAAQvN,QAChC4N,GAAe3N,KAAK,SAAUsN,GAEG,IAA3BA,EAAQ9C,QAAQ/C,QAClB6F,EAAQ9C,QAAQrK,WAIpBT,EAAGwP,WAAaC,EAAS9D,KACzB,IAAI+D,GAAc1P,EAAGwP,WAAWnP,QAEhC6M,GAAGiB,KAAKF,EAAgByB,IAAcpP,KAAK,WAEzCqD,EAAOoC,OAAO,kBAAmB4J,GACjChM,EAAOiM,iBAAiB,uBAAwBC,IAC/C,WACD,MAAO/L,GAASe,MAAM,yCASzB,QAASS,KACP,MAAO4H,GAAGiB,KACRhB,EAAa7H,KAAKtF,EAAG4N,SACrB6B,EAASnK,KAAKtF,EAAGwP,cAChBlP,KAAK,WACNwD,EAASyB,QAAQ,UAChB,WACDzB,EAASe,MAAM,6BAUnB,QAASiL,GAAavQ,EAAQwQ,GAC5B,GAAIC,GAAc1R,QAAQmI,KAAKsJ,GAC3BE,EAAgBV,EAAgBW,sBAEhCC,EAAUb,EAAmB1P,KAAKL,EAAQyQ,GAC5CR,WAAYS,EACZG,SAAUpQ,EAAGqQ,gBAGfF,GAAQ7P,KAAK,WACXN,EAAG4N,QAAQ0C,UAAUN,EAAYtP,IAAMsP,CAGvC,IAAIO,GAAoBhB,EAAgBiB,MAAMxQ,EAAGwP,WAAYD,EAAgBkB,QAAQR,GACrF3R,SAAQkS,MAAMxQ,EAAGwP,WAAYe,KAQjC,QAASV,GAAiBa,GACnBA,IAILvD,EAAawD,gBAAgB3Q,EAAG4N,QAAS5N,EAAGwP,YAC5CxP,EAAGwP,WAAaC,EAASgB,QAAQzQ,EAAGwP,aAGtC,QAASG,GAAoBe,GACtBA,IAILvD,EAAayD,eAAe5Q,EAAG4N,QAAS5N,EAAG4N,QAAQ0C,WACnDT,EAAiBa,IA5IpB,GAAIG,GAAc1D,EAAa2D,sBAAsBzB,EAAa3O,IAC9D+O,EAAWF,EAAgBwB,QAAQF,GAEnC7Q,EAAKqD,IAETrD,GAAGsF,KAAOA,EAEVtF,EAAGgR,gBACDC,OAAQ3S,QAAQ4S,UAAWC,GACzBC,eACE,SACA,SACA,YACA,cACA,MACA,OACA,iBACA,WACA,UACAC,KAAK,QAIXrR,EAAGqQ,gBACDY,OAAQ3S,QAAQ4S,UAAWC,GACzBC,eACE,SACA,SACA,YACA,cACA,MACA,OACA,WACA,iBACA,WACA,UACAC,KAAK,QAIXrR,EAAGsR,QACDL,OAAQ3S,QAAQ4S,UAAWC,GACzBC,eACE,SACA,YACA,cACA,MACA,OACA,UACAC,KAAK,QAIXrR,EAAG8P,aAAeA,EAElBrR,IApFF2Q,EAAwB5L,SAAW,KAAM,OAAQ,eAAgB,SAAU,qBAAsB,WAAY,eAAgB,mBAf7HlF,QACGC,OAAO,YACPK,WAAW,0BAA2BwQ,EAEzC,IAAI+B,IAkBFI,UACI1F,KAAM,SAAUtK,OAAS,SAAU,YACnCsK,KAAM,cAAetK,OAAS,OAAQ,SAAU,YAAa,SAAU,IAAK,YAAa,cAAe,IAAK,kBAC7GsK,KAAM,YAAatK,OAAS,eAAgB,eAAgB,IAAK,UAAW,SAAU,IAAK,gBAC3FsK,KAAM,QAAStK,OAAS,OAAQ,SAAU,YAC1CsK,KAAM,SAAUtK,OAAS,WAAY,WAAY,IAAK,QAAS,QAAS,iBAAkB,cAAe,aACzGsK,KAAM,YAAatK,OAAS,MAAO,OAAQ,QAAS,YAAa,gBAAiB,IAAK,OAAQ,UAC/FsK,KAAM,UAAWtK,OAAS,WAC1BsK,KAAM,QAAStK,OAAS,cACxBsK,KAAM,WAAYtK,OAAS,YAI/BiQ,YAAa,kCAEbC,aAAc,UAEdC,WAAY,8EAsJhB,WACE,YAOA,SAASC,GAA6B/N,GAOpC,QAASgO,GAAcjJ,GACrB/E,EAAOgB,GAAG,cAAgBlE,GAAIiI,EAAKjI,KAPrC,GAAIV,GAAKqD,IAETrD,GAAG4R,cAAgBA,EAQrBD,EAA6BnO,SAAW,UAhBxClF,QACGC,OAAO,YACPK,WAAW,+BAAgC+S,MAiBhD,WACE,YAyBA,SAASE,GAAsB3E,EAAIhC,EAAMmE,EAAc1L,EAAQG,EAAUqJ,GAevE,QAAS7H,KACP,GAAI6J,GAAchC,EAAa7H,KAAKtF,EAAG4N,QAQvC,OANAuB,GAAY7O,KAAK,WACfwD,EAASyB,QAAQ,UAChB,WACDzB,EAASe,MAAM,0BAGVsK,EAKT,QAAS1Q,KACPuB,EAAG4N,QAAUT,EAAaxB,IAAI0D,EAAa3O,IAE3CV,EAAG4N,QAAQvN,SAAXL,SAA0B,WACxB,MAAO8D,GAASe,MAAM,yCAhC1B,GAAI7E,GAAKqD,IAETrD,GAAGsF,KAAOA,EAEVtF,EAAGsR,QACDL,OAAQ3S,QAAQ4S,UAAWC,GACzBC,cAAe,kDAInB3S,IAjBFoT,EAAsBrO,SAAW,KAAM,OAAQ,eAAgB,SAAU,WAAY,gBAjBrFlF,QACGC,OAAO,YACPK,WAAW,wBAAyBiT,EAEvC,IAAIV,IAEFI,UACI1F,KAAM,SAAUtK,OAAS,SAAU,YACnCsK,KAAM,cAAetK,OAAS,OAAQ,SAAU,YAAa,SAAU,IAAK,YAAa,cAAe,IAAK,kBAC7GsK,KAAM,YAAatK,OAAS,eAAgB,eAAgB,IAAK,UAAW,SAAU,IAAK,gBAC3FsK,KAAM,QAAStK,OAAS,OAAQ,SAAU,YAC1CsK,KAAM,SAAUtK,OAAS,WAAY,WAAY,IAAK,QAAS,QAAS,iBAAkB,cAAe,aACzGsK,KAAM,YAAatK,OAAS,MAAO,OAAQ,QAAS,YAAa,gBAAiB,IAAK,OAAQ,UAC/FsK,KAAM,UAAWtK,OAAS,WAC1BsK,KAAM,QAAStK,OAAS,cACxBsK,KAAM,WAAYtK,OAAS,YAI/BiQ,YAAa,sCA4CjB,WACE,YAOA,SAASM,KACP,GAAI9S,IACFC,SAAU,IACVN,YAAa,2DACbO,OACE6N,QAAS,IACTC,OAAQ,KAEVpO,WAAYmT,EACZpS,aAAc,KAGhB,OAAOX,GAIT,QAAS+S,GAAoCpO,EAAQtE,EAAWyE,EAAUF,EAAQsJ,EAAIC,EAAcC,GAalG,QAASK,GAAqBlO,EAAQmO,GACpC,GAAIlN,GAAO,QACPrB,EAAQuO,EAAK9M,MAEb+H,EAAOwE,EAAaa,OAAOxN,EAAMrB,GACjC6S,EAAkB7E,EAAa7H,KAAKqD,GAEpCuF,EAAc8D,EAAgB1R,KAAK,SAAUqI,GAC/C,GAAI7G,GAAMwL,EAAKO,MAAMvC,KAAKoC,GACxBhN,GAAIiI,EAAK7G,IAAIpB,GACbF,KAAMmI,EAAK7G,IAAItB,MAEjB,OAAOsB,GAAIzB,UAGb6M,GAAGiB,KACDxF,KAAMqJ,EACNlQ,IAAKoM,IACJ5N,KAAK,SAAU+D,GAChB,GAAIsE,GAAOtE,EAAOsE,IAClB/E,GAAOgB,GAAG,cAAgBlE,GAAIiI,EAAKjI,OAYvC,QAAS2N,GAAkB9O,EAAQ+O,GACjC,GAAIE,GAAoBnP,EAAUoP,QAChChP,YAAaF,EACbJ,MAAO,uBACPuP,YAAa,eACb9I,GAAI,SACJxC,OAAQ,WAGN6O,EAAe5S,EAAUO,KAAK4O,EAElCyD,GAAa3R,KAAK,SAAUM,GAC1B0M,EAAKO,MAAMG,OAAOM,EAAQ1N,KAI9B,QAAS+N,GAAiBpP,EAAQmO,EAAMY,GACtC,GAAInP,GAAQ,oBAAuBuO,EAAK9M,MAAQ,KAE5CgO,EAAM,8CAAgDlB,EAAK9M,MAAQ,sIAKnEiO,EAA4BxP,EAAUqG,SACxCjG,YAAaF,EACbJ,MAAOA,EACP2P,YAAaF,EACbhJ,GAAI,SACJxC,OAAQ,UAGV/D,GAAUO,KAAKiP,GAA2BvO,KAAK,WAC7CgN,EAAKO,MAAMkB,OAAOrB,GAAM,EAAMY,GAAQhO,KAAK,WACzC,MAAOwD,GAASyB,QAAQ,qBACvB,WACD,MAAOzB,GAASe,MAAM,iCAO5B,QAASpG,KACPuB,EAAGkS,UAAY5E,EAAK3B,IAAIhI,EAAOqJ,QAxFjC,GAAIM,GAAOF,EAAsBG,cAAc5J,EAAOoJ,SAElD/M,EAAKqD,IACTrD,GAAGkS,UAAY,KACflS,EAAGyN,qBAAuBA,EAC1BzN,EAAGqO,kBAAoBA,EACvBrO,EAAG2O,iBAAmBA,EAEtBlQ,IAZFsT,EAAoCvO,SAAW,SAAU,YAAa,WAAY,SAAU,KAAM,eAAgB,yBAlBlHlF,QACGC,OAAO,YACPS,UAAU,4BAA6B8S,MAmH5C,WACE,YAEAxT,SACGC,OAAO,UACN,YACA,SACA,aACA,kBAKN,WACE,YAOA,SAAS4T,KACP,GAAInS,GAAKqD,IAETrD,GAAGoS,QAEHpS,EAAGC,SAVL3B,QACGC,OAAO,UACPK,WAAW,uBAAwBuT,MAaxC,WACE,YAOA,SAASE,KAYP,QAASlH,GAASjM,GAChBA,EAAM+R,QAEJqB,gBACIzG,KAAM,cAAe0G,QAAU,cAAe,aAC9C1G,KAAM,YAAa0G,QAAU,OAAQ,SAAU,SAAU,QAAS,OAAQ,eAC1E1G,KAAM,QAAS0G,QAAU,WACzB1G,KAAM,UAAW0G,QAAU,OAAQ,YAAa,eAAgB,aAGpEnB,cAAe,wDArBnB,GAAIpS,IACFC,SAAU,IACVN,YAAa,oDACbO,OACEsT,QAAS,YAEXlH,KAAMH,EAGR,OAAOnM,GAfTV,QACGC,OAAO,YACPS,UAAU,gBAAiBqT,MAgChC,WACE,YAOA,SAASI,GAAyBpT,GAKhC,QAASC,GAAWC,EAAQiT,GAC1B,GAAIhT,IACFC,YAAaF,EACbZ,YAAa,8DACb0L,QACEmI,QAASA,GAEX5T,WAAY8T,EACZ/S,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAASoT,GAA4BrT,EAAWmT,GAQ9C,QAAS1P,KACPzD,EAAU0D,KAAK/C,EAAGwS,SAGpB,QAASpP,KACP/D,EAAU+D,SAZZ,GAAIpD,GAAKqD,IAETrD,GAAGwS,QAAUA,EAEbxS,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EAbdqP,EAAyBjP,SAAW,aACpCkP,EAA4BlP,SAAW,YAAa,WApBpDlF,QACGC,OAAO,YACPkF,QAAQ,oBAAqBgP,MA2ClC,WACE,YAMA,SAASE,KACP,MAAO/Q,GAGT,QAASA,GAAUgR,GACjB,MAAOA,GAAOC,OAAOD,GAAME,QAAQ,YAAa,IAAM,GATxDxU,QACGC,OAAO,YACPwU,OAAO,YAAaJ,MAYzB,WACE,YAMA,SAASK,KAQP,QAASC,GAAeC,EAASC,EAAWC,GACtCD,IAAcE,GAChBH,EAAQI,QAAQF,GAIpB,QAASG,GAAYL,EAASC,EAAWC,GACnCD,IAAcE,GAChBH,EAAQnQ,OAAOyQ,UAAUJ,GAf7B,GAAIC,GAAgB,SAEpB,QACEJ,eAAgBA,EAChBM,YAAaA,GATjBjV,QACGC,OAAO,YACPkV,UAAU,SAAUT,MAyBzB,WACE,YAsBA,SAASU,GAAwB/P,EAAQC,EAAQvE,EAAWyE,EAAUC,EAAG4P,EAAaC,GAuBpF,QAASC,GAAW1P,GAClB,GAAKA,EAAL,CAIA,GAAI2P,EAAc3P,GAGhB,MAFAL,GAASuJ,KAAK,qCACd0G,IAIF,IAAIzI,GAAOqI,EAAY3F,OAAOhO,EAAGgU,YAAa7P,EAAOpC,MAErDuJ,GAAKjL,SAASC,KAAK,WAEjB,GAAI6D,GAASmH,EAAK2I,MACbjU,GAAGkU,QAAQC,MAAMjK,eAAe/F,EAAO3D,QAC1CR,EAAGkU,QAAQC,MAAMhQ,EAAO3D,UAG1BR,EAAGkU,QAAQC,MAAMhQ,EAAO3D,MAAMC,KAAK0D,GAEnC4P,IAEAjQ,EAASyB,QAAQ,iBAChB,WACDzB,EAASe,MAAM,4BASnB,QAASuP,GAAS7U,EAAQ4E,GACxB,OAAOA,EAAO3D,MACZ,IAAK8D,GAAOC,KACVX,EAAOgB,GAAG,eAAiBJ,OAAQL,EAAOzD,IAC1C,MACF,KAAK4D,GAAOI,OACVd,EAAOgB,GAAG,iBAAmBlE,GAAIyD,EAAOzD,IACxC,MACF,KAAK4D,GAAOK,QACVf,EAAOgB,GAAG,gBAAkBlE,GAAIyD,EAAOzD,IACvC,MACF,SACEoD,EAASe,MAAM,0CAUrB,QAASwP,GAAW9U,EAAQ4E,GAC1B,GAAI3E,GAASH,EAAUqG,SACrBjG,YAAaF,EACbJ,MAAO,mBACP2P,YAAa,6CAA+C3K,EAAOvD,MACnEgF,GAAI,MACJxC,OAAQ,OAGNkR,EAAWjV,EAAUO,KAAKJ,EAE9B8U,GAAShU,KAAK,WACZ,GAAIwF,GAAU6N,EAAAA,UAAmB3T,EAAGgU,YAAa7P,EAAOpC,MAExD+D,GAAQxF,KAAK,WACXwD,EAASyB,QAAQ,eACjB,IAAIuE,GAAK9J,EAAGkU,QAAQC,MAAMhQ,EAAO3D,MAAMkJ,QAAQvF,EAC3C2F,IAAM,GACR9J,EAAGkU,QAAQC,MAAMhQ,EAAO3D,MAAMwK,OAAOlB,EAAI,IAE1C,WACDhG,EAASe,MAAM,6BAUrB,QAASzD,GAAOC,GACd,GAAIC,GAAUsS,EAAUxS,OAAOC,EAC/B,OAAOC,GAAQjB,SAASC,KAAKiU,EAAsB,WACjDzQ,EAASe,MAAM,mCASnB,QAASpG,KACPkF,EAAOoC,OAAO,oBAAqB,SAAUyO,GACtCA,IAILxU,EAAGiG,SAAU,EACbjG,EAAGkU,QAAUP,EAAYhI,IAAI6I,GAC7BxU,EAAGkU,QAAQ7T,SAASC,KAAK,WACvBN,EAAGiG,SAAU,OAUnB,QAAS6N,GAAc3P,GACrB,MAAOnE,GAAGkU,QAAQC,MAAMjK,eAAe/F,EAAO3D,OAASR,EAAGkU,QAAQC,MAAMhQ,EAAO3D,MAAMiU,KAAK,SAAUC,GAClG,MAAOA,GAAS3S,QAAUoC,EAAOpC,QAOrC,QAASgS,KACP/T,EAAGsD,WAAa,KAChBtD,EAAG2U,aAAe,KAQpB,QAASJ,GAAqBjT,GAC5B,MAAOyC,GAAE6Q,QAAQC,EAAqB,SAAU9K,GAC9C,MAAOzI,GAAQA,QAAQyI,GAAK+K,IAAI,SAAU1C,GACxC,OACExR,MAAOwR,EAAKxR,OAASwR,EAAKjT,MAC1BqB,KAAM4R,EAAKtQ,IAAItB,KACfuB,MAAOqQ,EAAKtQ,IAAIC,WAtKxB,GAAI/B,GAAKqD,IAETrD,GAAGiG,SAAU,EACbjG,EAAGkU,QAAU,KAEblU,EAAGsD,WAAa,KAChBtD,EAAG2U,aAAe,KAElB3U,EAAG6T,WAAaA,EAChB7T,EAAGoU,SAAWA,EACdpU,EAAGqU,WAAaA,EAChBrU,EAAGoB,OAASA,EAEZ3C,IAbFiV,EAAwBlQ,SAAW,SAAU,SAAU,YAAa,WAAY,IAAK,cAAe,aArBpGlF,QACGC,OAAO,YACPG,UAAU,iBACTC,YAAa,sDACbE,UACEmV,YAAa,KAEfpV,WAAY8U,GAIhB,IAAIpP,IACFC,KAAM,4BACNG,OAAQ,2BACRC,QAAS,uBAGPkQ,GAAuB,SAAU,QAAS,eAmLhD,WACE,YA+BA,SAASE,KATP,QAASC,GAAgBC,GASvB,QAASC,GAAiBC,EAASC,GACjC,GAAIC,GAAO/W,QAAQkS,SAAU4E,GAC3BE,WAAY,qBAAuBF,GAAWA,EAAQE,WAAa,IAAMF,EAAQE,WAAa,KAGhG,OAAOL,GAASrV,KAAK2V,EAAUJ,EAASE,IAG1C,QAASG,GAAcL,EAASC,GAC9B,GAAIC,GAAO/W,QAAQkS,SAAU4E,GAC3BE,WAAY,kBAAoBF,GAAWA,EAAQE,WAAa,IAAMF,EAAQE,WAAa,KAG7F,OAAOL,GAASrV,KAAK2V,EAAUJ,EAASE,IAG1C,QAASI,GAAeN,EAASC,GAC/B,GAAIC,GAAO/W,QAAQkS,SAAU4E,GAC3BE,WAAY,mBAAqBF,GAAWA,EAAQE,WAAa,IAAMF,EAAQE,WAAa,IAC5FI,WAAW,GAGb,OAAOT,GAASrV,KAAK2V,EAAUJ,EAASE,IAG1C,QAASE,GAAUJ,EAASC,GAC1B,GAAIC,GAAO/W,QAAQkS,SAAUmF,EAASC,eAAgBR,GAElDS,EAAQZ,EAASa,SAClBnQ,YAAYwP,GACZG,WAAWD,EAAKC,YAChBS,SAASV,EAAKU,UACdL,UAAUL,EAAKK,UAMlB,SAJKL,EAAKK,WAAaL,EAAKW,SAC1BH,EAAMG,OAAOX,EAAKW,QAAU,WAGvBH,EA9CT,GAAI/R,IACFyB,QAAS2P,EACT7H,KAAMmI,EACN3Q,MAAO4Q,EAGT,OAAO3R,GAGTkR,EAAgBxR,SAAW,WAtB3B,IAAImS,KASJ,OAPAA,GAASC,gBACPG,SAAU,eACVL,UAAW,KAGbC,EAASM,KAAOjB,EAETW,EAjBTrX,QACGC,OAAO,YACPoX,SAAS,WAAYZ,MAwE1B,WACE,YAcA,SAASmB,GAAiBC,GAOxB,QAAS1X,MAIT,QAAS2X,GAAc1V,GACrByV,EAAWzV,GAAI2V,SAXjB,GAAIrW,GAAKqD,IAETrD,GAAGoW,cAAgBA,EAEnB3X,IAMFyX,EAAiB1S,SAAW,cAvB5BlF,QACGC,OAAO,YACPG,UAAU,UACTC,YAAa,oCACbE,UACEM,MAAO,IACPmX,UAAW,MAEb1X,WAAYsX,OAsBlB,WACE,YAwDA,SAASK,GAAiBC,GAWxB,QAASC,GAAUC,GACf,MAAOF,GAAOE,EAAKC,GAXvB,MAAOF,GAvBTF,EAAiB/S,SAAW,SAxB5B,IAAImT,IAEF,OAGA,YACA,WACA,UACA,SAGA,YACA,WACA,UACA,SAGA,eACA,cACA,aACA,YACA,cACA,aACA,YACA,WAGA,eACA,cACA,aACA,YACA,cACA,aACA,YACA,WAGA,aACA,WAGFrY,SACGC,OAAO,YACPkF,QAAQ,YAAa8S,MAqB1B,WACE,YAOA,SAASK,GAAmB7S,GAC1B,MAAOA,GAAE8S,QAmBXD,EAAmBpT,SAAW,KAzB9BlF,QACGC,OAAO,YACPwU,OAAO,QAAS6D,MASrB,WACE,YAOA,SAASE,GAAoBL,GAY3B,QAAStL,GAASjM,GAEhBA,EAAM6X,iBAAkB,EAExB7X,EAAM6G,OAAO,mBAAoB,SAAUiR,IACrCA,GAAqB9X,EAAM+X,KAAKC,WAAYhY,EAAM6X,kBACpD7X,EAAM+X,KAAKC,SAAWT,EAAUO,GAAiBG,OAAO,cACxDjY,EAAM6X,iBAAkB,KAlB9B,GAAI/X,IACFC,SAAU,IACVN,YAAa,8CACbO,OACE+X,KAAM,YAER3L,KAAMH,EAGR,OAAOnM,GAWT8X,EAAoBtT,SAAW,aA1B/BlF,QACGC,OAAO,YACPS,UAAU,aAAc8X,MA8B7B,WACE,YAQA,SAASM,KAaP,QAASC,GAAMC,GAKb,QAASC,KACP,GAAIzN,GAAK0N,EAAU9N,QAAQ4N,EACvBxN,IAAM,GACR0N,EAAUxM,OAAOlB,EAAI,GALzB,MAFA0N,GAAU/W,KAAK6W,GACfA,EAAGtX,EAAGmB,OACCoW,EAcT,QAASE,GAAIC,GACP1X,EAAGmB,QAAUuW,IAIjB1X,EAAGmB,MAAQuW,EAEXF,EAAUjX,QAAQ,SAAU+W,GAC1BA,EAAGI,MArCP,GAAI1X,GAAKqD,KACLmU,IAEJxX,GAAGqX,MAAQA,EACXrX,EAAGyX,IAAMA,EACTzX,EAAGmB,MAAQ,KAZb7C,QACGC,OAAO,YACPK,WAAW,0BAA2BwY,MAiD3C,WACE,YAOA,SAASO,GAA0BC,GAKjC,QAAStY,GAAWC,EAAQwQ,EAAUqF,GACpC,GAAIC,GAAO/W,QAAQkS,SAAU4E,GAEzBnE,GACFtS,YAAa,8DACbC,WAAYiZ,EACZlY,aAAc,KACdmY,qBAAqB,EACrBzN,QACE0F,SAAUA,EACVP,WAAY6F,EAAK7F,WACjBuI,eAAgB1C,EAAKjF,UAIzB,OAAOwH,GAAehY,KAAKqR,GAnB7B,OACErR,KAAMN,GAuBV,QAASuY,GAA6BD,EAAgB7H,EAAUP,EAAYuI,GAU1E,QAAS3E,KACPwE,EAAe7U,OAGjB,QAASK,KACPwU,EAAexU,SAdjB,GAAIpD,GAAKqD,IAETrD,GAAG+P,SAAWA,EACd/P,EAAGwP,WAAaA,EAChBxP,EAAG+X,eAAiBA,EAEpB/X,EAAGoT,KAAOA,EACVpT,EAAGoD,OAASA,EAXduU,EAA0BnU,SAAW,kBACrCqU,EAA6BrU,SAAW,iBAAkB,WAAY,aAAc,kBA5BpFlF,QACGC,OAAO,YACPkF,QAAQ,qBAAsBkU,MAiDnC,WACE,YAOA,SAASK,GAA2BC,EAAW3I,EAAoBnC,EAAcoC,GAU/E,QAASpE,GAASjM,EAAOgZ,EAAIC,EAAOC,GAmClC,QAASC,GAAsB/G,GA8B7B,QAAS8B,KACP9B,EAAOgH,KAAK,oBACVzM,KAAM0M,EACNC,QAASA,IAhCb,GAAIA,GAAUnV,KAGV2M,EAAc7C,EAAasL,gBAC/BzI,GAAY0I,WAAaC,EAAiB3I,EAAYtP,EAEtD,IAAIuP,GAAgB2I,EAAuBrJ,EAAgBW,sBAAwB,KAE/EC,EAAUb,EAAmB1P,KAAK,KAAMoQ,GAC1CR,WAAYS,EAEZG,SAAUlR,EAAM2Z,MAAMV,EAAM/H,WAG9BD,GAAQ7P,KAAK,WAIX,GAHAwY,EAAK3X,MAAM6O,EAAYtP,IAAMsP,EAGzBC,GAAiB2I,EAAsB,CACzC,GAAIrI,GAAoBhB,EAAgBiB,MAAMoI,EAAqBzX,MAAOoO,EAAgBkB,QAAQR,GAClG3R,SAAQkS,MAAMoI,EAAqBzX,MAAOoP,GAG5Ce,EAAOyH,WAAW,qDAAuD/I,EAAY0I,WAAa,oBAAsB1I,EAAYtP,GAAK,aACzI0S,KACC,WACDA,MA7DJ,GAAIuF,GAAiBR,EAAMa,iCAAmC,aAE1D5I,EAAWgI,EAAS,GACpBU,EAAOV,EAAS,GAChBQ,EAAuBR,EAAS,GAEhC9G,EAASlB,EAAS6I,SAElBC,EAAiBf,EAAMgB,iBAG3BL,GAAKrB,IAAIvY,EAAM2Z,MAAMK,IAGrBha,EAAM6G,OAAOmT,EAAgB,SAAU5I,GACjCwI,EAAK3X,QAAUmP,GACjBwI,EAAKrB,IAAInH,IAIb,IAAIiI,GAAwB,gBAC5BjH,GAAO8H,WAAWb,GAChBc,OAAO,EACPC,eAAgB,kDAChBC,gBAAiB,kDACjBC,KAAMnB,IAGR/G,EAAOmI,GAAGC,UAAU,YAClB9Y,MAAO,kBACP4X,QAASD,EACThH,QAAS,WAzCb,GAAIvS,IACFC,SAAU,IACV0a,SAAU,WAAY,oBAAqB,yBAC3CrO,KAAMH,EACNvM,WAAY,0BAGd,OAAOI,GAgBTgZ,EAA2BxU,SAAW,YAAa,qBAAsB,eAAgB,mBA7BzFlF,QACGC,OAAO,YACPS,UAAU,oBAAqBgZ,MAkGpC,WACE,YAuBA,SAAS4B,GAAyB/Z,EAASqN,EAAIhC,EAAM7L,EAAWwa,EAAQ9V,EAAGD,EAAUyL,EAAiBuK,GA2BpG,QAASrb,KACP,GAAIsb,GAAUF,EAAOG,eAAeC,EAAwBC,GAIxDC,EAASjN,EAAGkN,KAAKL,EAAQM,SAASC,GAKtC,IAJAta,EAAGua,cAAgBJ,EAAO7Z,KAAK,SAAUka,GACvC,MAAOtN,GAAGkN,KAAKL,EAAQU,WAAWD,OAG/Bxa,EAAG0a,SACN,KAAM,IAAIC,OAAM,uBAGb3a,GAAGwP,WAAWoL,UAAU5a,EAAG0a,SAASha,IAG9BV,EAAGwP,WAAWoL,UAAU5a,EAAG0a,SAASha,MAAQV,EAAG0a,WACxDxP,EAAK2P,KAAK,oFACV7a,EAAGwP,WAAWoL,UAAU5a,EAAG0a,SAASha,IAAMV,EAAG0a,WAJ7CxP,EAAK2P,KAAK,0FACV7a,EAAGwP,WAAWoL,UAAU5a,EAAG0a,SAASha,IAAMV,EAAG0a,UAYjD,QAAStZ,GAAOC,GACd,MAAOrB,GAAGua,cAAcja,KAAK,SAAUwa,GAGrC,GAAIC,GAAW7N,EAAGkN,KAAKU,EAAQE,YAAY3Z,IAEvC4Z,EAAkBF,EAASza,KAAK,SAAUiB,GAC5C,MAAO2L,GAAGiB,IAAI5M,EAAMuT,IAAIoG,GAAWpG,IAAIqG,KAOzC,OAJAF,GAAAA,SAAsB,WACpBnX,EAASe,MAAM,oCAGVoW,IASX,QAASC,GAAUE,GACjB,GAAI1a,GAAK,UAAY0a,EAAMN,QAAQpa,GAAK,IAAM0a,EAAM1a,GAEhD0R,EAAO7C,EAAgB8L,iBAAiB3a,EAoB5C,OAnBA0R,GAAK5R,KAAO4a,EAAM5a,KAClB4R,EAAKkJ,SAAWF,EAAM3W,WAAW6W,SAASxG,IAAIyG,GAI9CnJ,EAAKoJ,KAAOld,QAAQ4S,OAClBnN,EAAE0X,KAAKL,EAAMI,MAAO,iBAAkB,eACtCzX,EAAE0X,KAAKL,EAAM3W,YAAa,MAAO,YAAa,kBAGhD2N,EAAKsJ,OAAS3X,EAAE4X,KAAKP,EAAM3W,YAEzB,WAAY,WAEZ,MAAO,YAAa,eAEpB,UAAW,cAAe,OAAQ,cAG7B2N,EAQT,QAASmJ,GAAaK,GACpB,OACEC,KAAMD,EAASE,YACfC,UAAWH,EAASG,UACpBC,SAAUJ,EAASI,SACnBnQ,KAAM+P,EAAS/P,MASnB,QAASsP,GAAS/I,GAChB,GAAI6J,GAASnC,EAAaoC,iBAAiB,MAAO9J,EAElD,OAAO6J,GAAO3b,KAAK,SAAUM,GAC3B,OACEF,GAAI0R,EAAK1R,GACTE,MAAOA,EACPwR,KAAMA,KASZ,QAAS+J,GAAgBC,GACnBpc,EAAG0a,SAASnZ,MAAMmI,QAAQ0S,GAAgB,GAE5Cpc,EAAG0a,SAASnZ,MAAMd,KAAK2b,EAMzB,IAAIC,GAAoBrc,EAAGwP,WAAW8M,aAAaF,EAAa1b,GAChE6b,GAAwBH,EAAcC,GAAmB/b,KAAK,SAAUM,GACtEwb,EAAaxb,MAAQA,IAIvB4b,IAQF,QAASC,GAAiBC,GACpBA,GACF1c,EAAG2c,mBAAmBjc,GAAKgc,EAAchc,GACzCV,EAAGwP,WAAW8M,aAAaI,EAAchc,IAAMgc,EAActK,MAE7DpS,EAAG2c,mBAAmBjc,GAAK,KAQ/B,QAASkc,GAAiBR,GACxB,GAAIS,GAAa7c,EAAGwP,WAAW8M,aAAaF,EAAa1b,GACzD,OAAOya,GAAS0B,GAAYvc,KAAK,SAAUwc,GACzC9c,EAAG2c,mBAAqBP,EACxBpc,EAAG+c,mBAAqBD,EACxB9c,EAAGsD,WAAa1B,EAAU5B,EAAG+c,mBAAmBnc,SAOpD,QAAS4b,KACPxc,EAAG2c,sBACH3c,EAAGsD,WAAa,GAChBtD,EAAG+c,mBAAqB,KAS1B,QAASR,GAAwBH,EAAcS,GAE7C,GAAInC,GAAWnL,EAAgByN,gBAC/BtC,GAASnZ,MAAMd,KAAK2b,EAGpB,IAAIa,GAAY1N,EAAgBW,qBAChC+M,GAAUrC,UAAUF,EAASha,IAAMga,EACnCuC,EAAUX,aAAaF,EAAa1b,IAAMmc,CAE1C,IAAIK,GAAYpD,EAAaqD,OAAO,MAAOF,EAE3C,OAAOC,GAAU5c,KAAK,SAAU8c,GAC9B,MAAOA,GAASxC,UAAUF,EAASha,MAIvC,QAAS2c,KACPrd,EAAGsd,cAGL,QAASC,KACPvd,EAAGsd,WAAa,KAGlB,QAASE,GAAeje,EAAQ6S,GAC9B,GAAIqL,GAASzd,EAAGua,cAAcja,KAAK,SAAUwa,GAG3C,MAAO5N,GAAGkN,KAAKU,EAAQ4C,SAAStL,MAG9BuL,EAAcF,EAAOnd,KAAK4a,GAE1B0C,EAAiBD,EAAYrd,KAAK6a,EAEtCyC,GAAetd,KAAK,SAAU8R,GAC5BpS,EAAG+c,mBAAqB3K,EACxBqK,EAAiBrK,GACjBpS,EAAGsD,WAAa1B,EAAUwQ,EAAKxR,OAC/BZ,EAAGsd,WAAa,MACf,WACDxZ,EAASe,MAAM,gCAhPnB,GAAI7E,GAAKqD,IAGTrD,GAAG+c,mBAAqB,KACxB/c,EAAGsD,WAAa,GAEhBtD,EAAG6d,aAAeC,EAElB9d,EAAG2c,sBAEH3c,EAAGua,cAAgB,KAEnBva,EAAGsd,WAAa,KAEhBtd,EAAGoB,OAASA,EACZpB,EAAGmc,gBAAkBA,EACrBnc,EAAGyc,iBAAmBA,EACtBzc,EAAG+d,KAAOnB,EACV5c,EAAGqd,iBAAmBA,EACtBrd,EAAGud,iBAAmBA,EACtBvd,EAAGwd,eAAiBA,CAEpB,IAAI5b,GAAY/B,EAAQ,YAExBpB,KAhBFmb,EAAyBpW,SAAW,UAAW,KAAM,OAAQ,YAAa,SAAU,IAAK,WAAY,kBAAmB,eA9BxH,IAAIsa,IACF,OAAQ,UAAW,SAAU,SAAU,QAAS,QAAS,OAAQ,OAAQ,OAAQ,OACjF,YAAa,OAAQ,UAAW,YAAa,QAAS,UAGpD7D,EAAyB,UACzBC,EAA8B,2BAC9BI,EAAkB,QAEtBhc,SACGC,OAAO,YACPG,UAAU,kBACTC,YAAa,2DACbC,WAAYgb,EACZ/a,UACE2Q,WAAY,IACZkL,SAAU,UA6PlB,WACE,YAOA,SAASsD,GAA0B3e,EAAW0E,EAAGwL,GAY/C,QAAS3P,GAAK4P,EAAYkL,EAAUnb,GAClC,GAAKmb,EASMpc,QAAQkL,SAASkR,KAC1BA,EAAWlL,EAAWoL,UAAUF,QAVnB,CACb,GAAIE,GAAY7W,EAAEgK,OAAOyB,EAAWoL,UAEX,KAArBA,EAAU7S,QACZ2S,EAAWnL,EAAgByN,iBAC3BxN,EAAWoL,UAAUF,EAASha,IAAMga,GAEpCA,EAAWE,EAAU,GAMzB,IAAKF,EACH,KAAM,IAAIC,OAAM,yHAGlB,IAAI1J,IACFxR,YAAaF,EACbZ,YAAa,gEACbC,WAAY,+BACZe,aAAc,KACdmY,qBAAqB,EACrBzN,QACEmF,WAAYA,EACZkL,SAAUA,GAId,OAAOrb,GAAUO,KAAKqR,GAAQ3Q,KAAK,WACjC,MAAOkP,KA1CX,OACE5P,KAAMA,GAwBVoe,EAA0Bxa,SAAW,YAAa,IAAK,mBA/BvDlF,QACGC,OAAO,YACPkF,QAAQ,qBAAsBua,MAqDnC,WACE,YAOA,SAASC,GAA6B5e,EAAWmQ,EAAYkL,GAS3D,QAAStH,KACP/T,EAAU0D,OAGZ,QAASK,KACP/D,EAAU+D,SAbZ,GAAIpD,GAAKqD,IAETrD,GAAGwP,WAAaA,EAChBxP,EAAG0a,SAAWA,EAEd1a,EAAGoT,KAAOA,EACVpT,EAAGoD,OAASA,EAoBd6a,EAA6Bza,SAAW,YAAa,aAAc,YAhCnElF,QACGC,OAAO,YACPK,WAAW,+BAAgCqf,MAuBhD,WACE,YAOA,SAASC,GAA8B7e,EAAW4Y,EAAW1I,EAAiBuK,EAAcqE,GAU1F,QAAShT,GAASjM,EAAOgZ,EAAIC,EAAOC,GAgClC,QAASgG,GAAsB9M,GAqB7B,QAAS8B,KACP9B,EAAOgH,KAAK,oBACVzM,KAAMwS,EACN7F,QAASA,IAvBb,GAAIA,GAAUnV,KAGVib,EAAe/O,EAAgBW,sBAC/BwK,EAAWnL,EAAgByN,gBAC/BsB,GAAa1D,UAAUF,EAASha,IAAMga,EAEtCyD,EAAmBve,KAAK0e,GAAche,KAAK,WACzC,GAAIiQ,GAAoBhB,EAAgBiB,MAAMsI,EAAK3X,MAAOoO,EAAgBkB,QAAQ6N,GAClFhgB,SAAQkS,MAAMsI,EAAK3X,MAAOoP,GAE1BuJ,EAAaqD,OAAO,MAAOmB,GAAche,KAAK,SAAU8c,GACtD,GAAIxc,GAAQwc,EAASxC,UAAUF,EAASha,GACxC4Q,GAAOyH,WAAW,aAAe2B,EAASha,GAAK,6BAA+BE,EAAQ,WACtFwS,OAED,WACDA,MAjDJ,GAAIhD,GAAWgI,EAAS,GACpBU,EAAOV,EAAS,GAEhB9G,EAASlB,EAAS6I,SAElBC,EAAiBf,EAAMS,oBAG3BE,GAAKrB,IAAIvY,EAAM2Z,MAAMK,IAGrBha,EAAM6G,OAAOmT,EAAgB,SAAUqF,GACjCzF,EAAK3X,QAAUod,GACjBzF,EAAKrB,IAAI8G,IAIb,IAAIF,GAAwB,gBAC5B/M,GAAO8H,WAAWiF,GAChBhF,OAAO,EACPC,eAAgB,2BAChBC,gBAAiB,2BACjBC,KAAM4E,IAGR9M,EAAOmI,GAAGC,UAAU,YAClB9Y,MAAO,kBACP4X,QAAS6F,EACT9M,QAAS,WAtCb,GAAIvS,IACFC,SAAU,IACV0a,SAAU,WAAY;AACtBrO,KAAMH,EACNvM,WAAY,0BAGd,OAAOI,GAoBTkf,EAA8B1a,SAAW,YAAa,YAAa,kBAAmB,eAAgB,sBAjCtGlF,QACGC,OAAO,YACPS,UAAU,uBAAwBkf,MA8EvC,WACE,YAcA,SAASM,GAAuBtR,EAAIpJ,EAAU+V,GAc5C,QAASpb,KACPob,EAAO4E,eAAene,KAAK,SAAUL,GACnCD,EAAGC,MAASD,EAAG0e,YAAc1e,EAAG0e,WAAW3W,OAAS,EAChD9H,EAAM8S,OAAO,SAAU4L,GACrB,MAAO3e,GAAG0e,WAAWhV,QAAQiV,EAAMje,KAAO,IAE5CT,GACH,WACD6D,EAASe,MAAM,mCAGZ7E,EAAGoS,KAAKkJ,WACXtb,EAAGoS,KAAKkJ,eAGsB,IAA5Btb,EAAGoS,KAAKkJ,SAASvT,QACnB/H,EAAGoS,KAAKkJ,SAAS7a,SAIrB,QAASme,GAAWC,GAClB,IAAKA,EAIH,MAHA7e,GAAGoS,KAAKyM,SAAW,KACnB7e,EAAG0b,eACH1b,EAAG8e,SAIL9e,GAAGoS,KAAKyM,SAAWA,EAASne,EAE5B,IAAIqe,GAAUF,EAASG,WACvBD,GAAQze,KAAK,SAAUob,GACrB1b,EAAG0b,OAASA,GAGd,IAAIuD,GAAgBJ,EAASK,iBAC7BD,GAAc3e,KAAK,SAAUwe,GAC3B9e,EAAG8e,MAAQA,IAGb5R,EAAGiB,KAAK4Q,EAASE,IAAjB/R,SAAuC,WACrCpJ,EAASe,MAAM,gCAAkCga,EAASje,MAAQ,aAtDtE,GAAIZ,GAAKqD,IAETrD,GAAGmf,mBAAqB,GACxBnf,EAAG6e,SAAW,KAEd7e,EAAGC,SACHD,EAAG0b,UACH1b,EAAG8e,SAEH9e,EAAG4e,WAAaA,EAEhBngB,IAUF+f,EAAuBhb,SAAW,KAAM,WAAY,UAlCpDlF,QACGC,OAAO,UACPG,UAAU,gBACTC,YAAa,yBACbC,WAAY4f,EACZ3f,UACEuT,KAAM,IACNsM,WAAY,eAmEpB,WACE,YAcA,SAASU,MAZT9gB,QACGC,OAAO,UACPG,UAAU,sBACTC,YAAa,gCACbC,WAAYwgB,EACZvgB,UACEwgB,QAAS,IACTP,MAAO,UAWf,WACE,YAOA,SAASQ,KACP,MAAO,IAAIzF,QAAOA,OAAO0F,oBAAqBjhB,QAAQkhB,QANxDlhB,QACGC,OAAO,UACPkF,QAAQ,SAAU6b,MASvB,WACE,YAOA,SAASG,GAAmB7b,EAAQyL,EAAcvP,EAAWC,EAAUwP,EAAiBpC,EAAc9N,EAAWyE,EAAUoJ,EAAIwS,EAAgBC,EAAgBxB,EAAoByB,GAsBjL,QAASnhB,KACP,GAAI+F,GAAS6K,EAAa7K,MAC1BxE,GAAGkC,KAAOpC,EAAUqC,QAAQqC,EAC5B,IAAIqb,GAAc7f,EAAGkC,KAAK7B,QAC1Bwf,GAAYvf,KAAK,WACfN,EAAG8f,QAAUhgB,EAAUigB,SAAS/f,EAAGkC,KAAK0I,QACxC5K,EAAGb,MAAQW,EAAUigB,SAAS/f,EAAGkC,KAAK0I,QAAS,YAAa,gBAAiB,UAC7E5K,EAAGmE,OAASpE,EAASkC,aAAanC,EAAUkgB,aAAahgB,EAAGkC,MAAOlC,EAAGkC,KAAKJ,IAAIC,QAGjF,IAAIke,GAAkBngB,EAAUgR,sBAAsBtM,EACtDiL,GAAWF,EAAgBwB,QAAQkP,GACnCjgB,EAAGwP,WAAaC,EAAS9D,KACzB,IAAI+D,GAAc1P,EAAGwP,WAAWnP,QAEhC6M,GAAGiB,KAAK0R,EAAanQ,IAArBxC,SACS,WACLpJ,EAASe,MAAM,0DAEhBvE,KAAK,WACJN,EAAGiG,SAAU,IAInB,QAASia,GAAY3gB,GACnB,GAAI0F,GAAgBya,EAAe9f,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAGkC,MAEhE+C,GAAc3E,KAAK,SAAU6f,GAE3B7hB,QAAQ4S,OAAOlR,EAAGkC,KAAMie,GAExBrgB,EAAUsgB,SAASpgB,EAAGkC,MAAM5B,KAAK+f,EAAgB5K,KAIrD,QAAS6K,GAAY/gB,GACnB,GAAI0F,GAAgB2a,EAAkBhgB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAGkC,KAAKsQ,SAExEvN,GAAc3E,KAAK,SAAUigB,GAE3BvgB,EAAGkC,KAAKsQ,QAAU+N,EAElBzgB,EAAUsgB,SAASpgB,EAAGkC,MAAM5B,KAAK+f,EAAgB5K,KAIrD,QAAS+K,GAAiBjhB,GACxB4e,EAAmBve,KAAKI,EAAGwP,WAAY,KAAMjQ,GAAQe,KAAK,WACxDmP,EAASnK,KAAKtF,EAAGwP,YAAYlP,KAAK+f,EAAgB5K,KAItD,QAASgL,GAAWlhB,GAClB,GAAIkP,GAASpP,EAAUoP,SACpBhP,YAAYF,GACZJ,MAAM,kBACNwG,YAAY,8CACZ+I,YAAY,gBACZ9I,GAAG,UACHxC,OAAO,UAEN6B,EAAgB5F,EAAUO,KAAK6O,GAE/BU,EAAclK,EAAc3E,KAAK,SAAUiC,GAC7C,GAAIF,GAAUvC,EAAU6K,eAQxB,OAPAtI,GAAQE,YAAcA,EACtBF,EAAQuI,OAAStM,QAAQmI,KAAKzG,EAAGkC,KAAK0I,QACtCvI,EAAQyI,QAAUxM,QAAQmI,KAAKzG,EAAGkC,KAAK4I,SAEvC9K,EAAGkC,KAAKE,SAAS3B,KAAK4B,GAGfvC,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAI2B,IAG3C8M,GAAY7O,KAAK+f,EAAgB5K,GAEjCtG,EAAY7O,KAAK,SAAU+B,GACzBuB,EAAOgB,GAAG,kBAAoBJ,OAAQxE,EAAGkC,KAAKxB,GAAI8B,UAAWH,EAAQ3B,OAIzE,QAASqK,GAAc1I,EAAS9C,GAC9B,GAAImG,GAAUrG,EAAUqG,UACrBjG,YAAYF,GACZJ,MAAM,oBACNwG,YAAY,iDACZC,GAAG,OACHxC,OAAO,KAEV/D,GAAUO,KAAK8F,GACZpF,KAAK,WACJ,GAAIwJ,GAAK9J,EAAGkC,KAAKE,SAASsH,QAAQrH,EAC9ByH,IAAM,IACR9J,EAAGkC,KAAKE,SAAS4I,OAAOlB,EAAI,GAC5BhK,EAAUsgB,SAASpgB,EAAGkC,MAAM5B,KAAK+f,EAAgB5K,MAKzD,QAASkL,GAAQphB,GACf,GAAIkH,KACJma,GAASna,EAAMlH,GAAQe,KAAK,WAC1BN,EAAGkC,KAAK2e,OAAOpgB,KAAKgG,KAIxB,QAASma,GAASna,EAAMlH,GACtB,GAAI0F,GAAgB0a,EAAe/f,KAAKL,EAAQjB,QAAQmI,KAAKA,GAQ7D,OAPAxB,GAAc3E,KAAK,SAAUwgB,GAE3BxiB,QAAQ4S,OAAOzK,EAAMqa,GAErBhhB,EAAUsgB,SAASpgB,EAAGkC,MAAM5B,KAAK+f,EAAgB5K,KAG5CxQ,EAGT,QAAS8b,GAAWta,EAAMlH,GACxB,GAAImG,GAAUrG,EAAUqG,UACrBjG,YAAYF,GACZJ,MAAM,oBACNwG,YAAY,8CACZC,GAAG,OACHxC,OAAO,KAEV/D,GAAUO,KAAK8F,GACZpF,KAAK,WACJ,GAAIwJ,GAAK9J,EAAGkC,KAAK2e,OAAOnX,QAAQjD,EAC5BqD,IAAM,IACR9J,EAAGkC,KAAK2e,OAAO7V,OAAOlB,EAAI,GAC1BhK,EAAUsgB,SAASpgB,EAAGkC,MAAM5B,KAAK+f,EAAgB5K,MAKzD,QAASuL,GAAWzhB,EAAQ2C,GAmB1B,QAASgT,KAEP,MADAtR,GAAOgB,GAAG,UACHd,EAASyB,QAAQ0b,EAAY,sBAGtC,QAASxL,KACP,MAAO3R,GAASe,MAAM,oBAAsBoc,GAxB9C,GAAI9hB,GAAQW,EAAUigB,SAAS/f,EAAGkC,KAAK0I,QACnCqW,EAAY9hB,EAAQ,IAAMA,EAAMA,OAASA,EAAM+hB,SAAW,KAAO/hB,EAAM+hB,SAAW,IAAM,IAAM,YAE9FC,EAAgB9hB,EAAUqG,SAC5BjG,YAAaF,EACbJ,MAAO,mBACPwG,YAAa,mCAAqCsb,EAAY,IAC9Drb,GAAI,MACJxC,OAAQ,OAGNyC,EAAiBxG,EAAUO,KAAKuhB,EAEpC,OAAOtb,GAAevF,KAAK,WACzB,MAAOR,GAAAA,UAAiBoC,GACrB5B,KAAK4U,EAAkBO,KAa9B,QAAS2L,GAAwB7hB,EAAQ2C,GACvC,GAAI/C,GAAQW,EAAUigB,SAAS7d,EAAK0I,QAGhCyW,EAAqBhiB,EAAUoP,QACjChP,YAAaF,EACbJ,MAAO,qBACPwG,YAAa,+FACb2b,aAAcniB,EAAQA,EAAMA,OAASA,EAAM+hB,SAAW,KAAO/hB,EAAM+hB,SAAW,IAAM,kBACpFtb,GAAI,SACJxC,OAAQ,WAGNme,EAASliB,EAAUO,KAAKyhB,EAE5BE,GAAOjhB,KAAK,SAAUnB,GACpB,GAAIqiB,GAAWrU,EAAasU,aAAa,cAAetiB,EAAO+C,EAAKJ,IAAIC,MAGxEyf,GAASlhB,KAAK,SAAUsN,GACtBhK,EAAOgB,GAAG,gBACRlE,GAAIkN,EAAQlN,MAEb,WACD,MAAOoD,GAASe,MAAM,iCAK5B,QAASwb,KACP,MAAOvc,GAASyB,QAAQ,SAG1B,QAASkQ,KACP,MAAO3R,GAASe,MAAM,wBA7NxB,GAAI4K,GAAW,KACXzP,EAAKqD,IAETrD,GAAGiG,SAAU,EACbjG,EAAGkC,KAAO,KACVlC,EAAGb,MAAQ,KACXa,EAAG0hB,cAAgB,KAEnB1hB,EAAGkgB,YAAcA,EACjBlgB,EAAGsgB,YAAcA,EACjBtgB,EAAGwgB,iBAAmBA,EACtBxgB,EAAGygB,WAAaA,EAChBzgB,EAAG+K,cAAgBA,EACnB/K,EAAG2gB,QAAUA,EACb3gB,EAAG4gB,SAAWA,EACd5gB,EAAG+gB,WAAaA,EAChB/gB,EAAG2hB,iBAAmBP,EACtBphB,EAAGghB,WAAaA,EAEhBviB,IAUFghB,EAAmBjc,SAAW,SAAU,eAAgB,YAAa,WAAY,kBAAmB,eAAgB,YAAa,WAAY,KAAM,iBAAkB,iBAAkB,qBAAsB,qBAnC7MlF,QACGC,OAAO,YACPK,WAAW,qBAAsB6gB,MAuOtC,WACE,YAOA,SAASmC,GAAsBviB,GAK7B,QAASC,GAAWC,EAAQ2C,GAC1B,GAAI1C,IACFC,YAAaF,EACbZ,YAAa,iCACb0L,QACEnI,KAAMA,GAERtD,WAAYijB,EACZliB,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAASuiB,GAAyBxiB,EAAW6C,GAY3C,QAASY,KACPzD,EAAU0D,KAAK/C,EAAGkC,MAGpB,QAASkB,KACP/D,EAAU+D,SAGZ,QAAS0e,GAAUnD,GAEjB,GAAIoD,KACJ/hB,GAAGkC,KAAKyc,GAAOle,KAAKshB,GAGtB,QAASC,GAAarD,EAAOoD,GAC3B,GAAIjY,GAAK9J,EAAGkC,KAAKyc,GAAOjV,QAAQqY,EAC5BjY,IAAM,GACR9J,EAAGkC,KAAKyc,GAAO3T,OAAOlB,EAAI,GAI9B,QAASmY,KAEP,GAAI9iB,KACJa,GAAGkC,KAAK0I,OAAOnK,KAAKtB,GAGtB,QAAS+iB,GAAY/iB,GACnB,GAAI2K,GAAK9J,EAAGkC,KAAK0I,OAAOlB,QAAQvK,EAC5B2K,IAAM,GACR9J,EAAGkC,KAAK0I,OAAOI,OAAOlB,EAAI,GAzC9B,GAAI9J,GAAKqD,IAETrD,GAAGkC,KAAOA,EAEVlC,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EACZpD,EAAG8hB,UAAYA,EACf9hB,EAAGgiB,aAAeA,EAClBhiB,EAAGiiB,SAAWA,EACdjiB,EAAGkiB,YAAcA,EAAnBN,EAAsBpe,SAAW,aACjCqe,EAAyBre,SAAW,YAAa,QArCjDlF,QACGC,OAAO,YACPkF,QAAQ,iBAAkBme,MAyE/B,WACE,YAOA,SAASO,GAAqB9S,EAAcvP,EAAWC,EAAUV,EAAWyE,EAAUoJ,EAAIkV,EAAkBzC,EAAgBC,GAmB1H,QAASnhB,KAEP,GAAI+F,GAAS6K,EAAa7K,MAC1BxE,GAAGkC,KAAOpC,EAAUqC,QAAQqC,EAC5B,IAAIqb,GAAc7f,EAAGkC,KAAK7B,QAC1Bwf,GACGvf,KAAK+hB,GAAc,QAAS,YAAa,mBACzC/hB,KAAK,SAAUnB,GAASa,EAAGsiB,UAAYnjB,GAE1C,IAAIqD,GAAY6M,EAAa7M,SAC7BxC,GAAGqC,QAAUvC,EAAUyiB,WAAW/d,EAAQhC,EAC1C,IAAIggB,GAAiBxiB,EAAGqC,QAAQhC,SAE5BwC,EAAWwM,EAAaxM,QAC5B7C,GAAG0C,OAAS5C,EAAU2iB,UAAUje,EAAQhC,EAAWK,EACnD,IAAI6f,GAAgB1iB,EAAG0C,OAAOrC,QAC9BqiB,GACGpiB,KAAK+hB,GAAc,YAAa,gBAAiB,WACjD/hB,KAAK,SAAUnB,GAASa,EAAGb,MAAQA,IAEtC+N,EAAGiB,KAAK0R,EAAa2C,EAAgBE,IAClCpiB,KAAK,WACJN,EAAGmE,OAASpE,EAASkC,aAAanC,EAAU6iB,eAAe3iB,EAAG0C,OAAQ1C,EAAGqC,QAAQE,aAAcvC,EAAGkC,KAAKJ,IAAIC,OACzGS,WAAYxC,EAAGqC,QAAQ3B,IACvBmC,UAAW7C,EAAG0C,OAAOhC,OAEtB,WACDoD,EAASe,MAAM,0DAEhBvE,KAAK,WACJN,EAAGiG,SAAU,IAInB,QAASoc,GAAaO,GACpB,MAAO,UAAUC,GACf,MAAO/iB,GAAUigB,SAAS8C,EAAajY,OAAQgY,IAInD,QAAS1C,GAAY3gB,GACnB,GAAI0F,GAAgBmd,EAAiBxiB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAG0C,QASlE,OAPAuC,GAAc3E,KAAK,SAAUwiB,GAE3BxkB,QAAQ4S,OAAOlR,EAAG0C,OAAQogB,GAE1BhjB,EAAUijB,WAAW/iB,EAAGkC,KAAKxB,GAAIV,EAAGqC,QAAQ3B,GAAIV,EAAG0C,QAAQpC,KAAK+f,EAAgB5K,KAG3ExQ,EAGT,QAASqb,GAAY/gB,GACnB,GAAI0F,GAAgB2a,EAAkBhgB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAG0C,OAAO8P,SAE1EvN,GAAc3E,KAAK,SAAUigB,GAE3BvgB,EAAG0C,OAAO8P,QAAU+N,EAEpBzgB,EAAUijB,WAAW/iB,EAAGkC,KAAKxB,GAAIV,EAAGqC,QAAQ3B,GAAIV,EAAG0C,QAAQpC,KAAK+f,EAAgB5K,KAIpF,QAASkL,GAAQphB,GACf,GAAIkH,KACJma,GAASna,EAAMlH,GAAQe,KAAK,WAC1BN,EAAG0C,OAAOme,OAAOpgB,KAAKgG,KAI1B,QAASma,GAASna,EAAMlH,GACtB,GAAI0F,GAAgB0a,EAAe/f,KAAKL,EAAQjB,QAAQmI,KAAKA,GAQ7D,OAPAxB,GAAc3E,KAAK,SAAUwgB,GAE3BxiB,QAAQ4S,OAAOzK,EAAMqa,GAErBhhB,EAAUijB,WAAW/iB,EAAGkC,KAAKxB,GAAIV,EAAGqC,QAAQ3B,GAAIV,EAAG0C,QAAQpC,KAAK+f,EAAgB5K,KAG3ExQ,EAGT,QAAS8b,GAAWta,EAAMlH,GACxB,GAAImG,GAAUrG,EAAUqG,UACrBjG,YAAYF,GACZJ,MAAM,oBACNwG,YAAY,8CACZC,GAAG,OACHxC,OAAO,KAEV/D,GAAUO,KAAK8F,GACZpF,KAAK,WACJ,GAAIwJ,GAAK9J,EAAG0C,OAAOme,OAAOnX,QAAQjD,EAC9BqD,IAAM,IACR9J,EAAG0C,OAAOme,OAAO7V,OAAOlB,EAAI,GAC5BhK,EAAUijB,WAAW/iB,EAAGkC,KAAKxB,GAAIV,EAAGqC,QAAQ3B,GAAIV,EAAG0C,QAAQpC,KAAK+f,EAAgB5K,MAKxF,QAASuN,GAAcC,GACrB,GAAIC,GAAU5kB,QAAQmI,KAAKwc,EAC3BC,GAAQxiB,GAAK,IAGb,IAAI2B,GAAUvC,EAAUyiB,WAAWviB,EAAGkC,KAAKxB,GAAIV,EAAGqC,QAAQ3B,GAC1D2B,GAAQhC,SAASC,KAAK,WAEpB,MADA+B,GAAQwe,OAAOpgB,KAAKyiB,GACbpjB,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAI2B,KACxC/B,KAAK+f,EAAgB5K,GAG1B,QAAS4K,KACP,MAAOvc,GAASyB,QAAQ,SAG1B,QAASkQ,KACP,MAAO3R,GAASe,MAAM,wBAxIxB,GAAI7E,GAAKqD,IAETrD,GAAGiG,SAAU,EACbjG,EAAGkC,KAAO,KACVlC,EAAGsiB,UAAY,KACftiB,EAAGqC,QAAU,KACbrC,EAAG0C,OAAS,KACZ1C,EAAGb,MAAQ,KAEXa,EAAGkgB,YAAcA,EACjBlgB,EAAGsgB,YAAcA,EACjBtgB,EAAG2gB,QAAUA,EACb3gB,EAAG4gB,SAAWA,EACd5gB,EAAG+gB,WAAaA,EAChB/gB,EAAGgjB,cAAgBA,EAEnBvkB,IAgBF0jB,EAAqB3e,SAAW,eAAgB,YAAa,WAAY,YAAa,WAAY,KAAM,mBAAoB,iBAAkB,qBAtC9IlF,QACGC,OAAO,YACPK,WAAW,uBAAwBujB,MAkJxC,WACE,YAOA,SAASgB,GAAwB9jB,GAK/B,QAASC,GAAWC,EAAQmD,GAC1B,GAAIlD,IACFC,YAAaF,EACbZ,YAAa,mCACb0L,QACE3H,OAAQA,GAEV9D,WAAYwkB,EACZzjB,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAAS8jB,GAA2B/jB,EAAWqD,GAY7C,QAASI,KACPzD,EAAU0D,KAAK/C,EAAG0C,QAGpB,QAASU,KACP/D,EAAU+D,SAGZ,QAAS0e,GAAUnD,GAEjB,GAAIoD,KACJ/hB,GAAG0C,OAAOic,GAAOle,KAAKshB,GAGxB,QAASC,GAAarD,EAAOoD,GAC3B,GAAIjY,GAAK9J,EAAG0C,OAAOic,GAAOjV,QAAQqY,EAC9BjY,IAAM,GACR9J,EAAG0C,OAAOic,GAAO3T,OAAOlB,EAAI,GAIhC,QAASmY,KAEP,GAAI9iB,KACJa,GAAG0C,OAAOkI,OAAOnK,KAAKtB,GAGxB,QAAS+iB,GAAY/iB,GACnB,GAAI2K,GAAK9J,EAAG0C,OAAOkI,OAAOlB,QAAQvK,EAC9B2K,IAAM,GACR9J,EAAG0C,OAAOkI,OAAOI,OAAOlB,EAAI,GAzChC,GAAI9J,GAAKqD,IAETrD,GAAG0C,OAASA,EAEZ1C,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EACZpD,EAAG8hB,UAAYA,EACf9hB,EAAGgiB,aAAeA,EAClBhiB,EAAGiiB,SAAWA,EACdjiB,EAAGkiB,YAAcA,EAGnBiB,EAAwB3f,SAAW,aACnC4f,EAA2B5f,SAAW,YAAa,UAxCnDlF,QACGC,OAAO,YACPkF,QAAQ,mBAAoB0f,MAyEjC,WACE,YAOA,SAASE,GAAsBzf,EAAQyL,EAAcvP,EAAWC,EAAUV,EAAWyE,EAAUoJ,EAAIoW,EAAmB3D,EAAgBC,GAoBpI,QAASnhB,KACP,GAAI+F,GAAS6K,EAAa7K,MAC1BxE,GAAGkC,KAAOpC,EAAUqC,QAAQqC,EAC5B,IAAIqb,GAAc7f,EAAGkC,KAAK7B,QAC1Bwf,GACGvf,KAAK+hB,GAAc,QAAS,YAAa,mBACzC/hB,KAAK,SAAUnB,GAASa,EAAGsiB,UAAYnjB,GAE1C,IAAIqD,GAAY6M,EAAa7M,SAC7BxC,GAAGqC,QAAUvC,EAAUyiB,WAAW/d,EAAQhC,EAC1C,IAAIggB,GAAiBxiB,EAAGqC,QAAQhC,QAChCmiB,GACGliB,KAAK+hB,GAAc,YAAa,gBAAiB,WACjD/hB,KAAK,SAAUnB,GAASa,EAAGb,MAAQA,IAEtC+N,EAAGiB,KAAK0R,EAAa2C,IAClBliB,KAAK,WACJN,EAAGmE,OAASpE,EAASkC,aAAanC,EAAUyjB,gBAAgBvjB,EAAGqC,SAAUrC,EAAGkC,KAAKJ,IAAIC,OACnFS,WAAYxC,EAAGqC,QAAQ3B,OAExB,WACDoD,EAASe,MAAM,0DAEhBvE,KAAK,WACJN,EAAGiG,SAAU,IAKnB,QAASoc,GAAaO,GACpB,MAAO,UAAUC,GACf,MAAO/iB,GAAUigB,SAAS8C,EAAajY,OAAQgY,IAInD,QAAS1C,GAAY3gB,GACnB,GAAI0F,GAAgBqe,EAAkB1jB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAGqC,SASnE,OAPA4C,GAAc3E,KAAK,SAAUkjB,GAE3BllB,QAAQ4S,OAAOlR,EAAGqC,QAASmhB,GAE3B1jB,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAIV,EAAGqC,SAAS/B,KAAK+f,EAAgB5K,KAG9DxQ,EAGT,QAASqb,GAAY/gB,GACnB,GAAI0F,GAAgB2a,EAAkBhgB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAGqC,QAAQmQ,SAE3EvN,GAAc3E,KAAK,SAAUigB,GAE3BvgB,EAAGqC,QAAQmQ,QAAU+N,EAErBzgB,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAIV,EAAGqC,SAAS/B,KAAK+f,EAAgB5K,KAIvE,QAASgO,GAAUlkB,GACjB,GAAIkP,GAASpP,EAAUoP,SACpBhP,YAAYF,GACZJ,MAAM,iBACNwG,YAAY,+CACZ+I,YAAY,iBACZ9I,GAAG,UACHxC,OAAO,UAEN6B,EAAgB5F,EAAUO,KAAK6O,GAE/BU,EAAclK,EAAc3E,KAAK,SAAUsC,GAC7C,GAAIF,GAAS5C,EAAUuM,cAQvB,OAPA3J,GAAOE,aAAeA,EACtBF,EAAOkI,OAAStM,QAAQmI,KAAKzG,EAAGqC,QAAQuI,QACxClI,EAAOoI,QAAUxM,QAAQmI,KAAKzG,EAAGqC,QAAQyI,SACzCpI,EAAO4J,gBAAkBhO,QAAQmI,KAAKzG,EAAGqC,QAAQiK,iBAEjDtM,EAAGqC,QAAQI,QAAQhC,KAAKiC,GAEjB5C,EAAUijB,WAAW/iB,EAAGkC,KAAKxB,GAAIV,EAAGqC,QAAQ3B,GAAIgC,IAGzDyM,GAAY7O,KAAK+f,EAAgB5K,GAEjCtG,EAAY7O,KAAK,SAAUoC,GACzBkB,EAAOgB,GAAG,iBAAmBJ,OAAQxE,EAAGkC,KAAKxB,GAAI8B,UAAWxC,EAAGqC,QAAQ3B,GAAImC,SAAUH,EAAOhC,OAIhG,QAAS6L,GAAa7J,EAAQnD,GAC5B,GAAImG,GAAUrG,EAAUqG,UACrBjG,YAAYF,GACZJ,MAAM,oBACNwG,YAAY,gDACZC,GAAG,OACHxC,OAAO,KAEV/D,GAAUO,KAAK8F,GACZpF,KAAK,WACJ,GAAIwJ,GAAK9J,EAAGqC,QAAQI,QAAQiH,QAAQhH,EAChCoH,IAAM,IACR9J,EAAGqC,QAAQI,QAAQuI,OAAOlB,EAAI,GAC9BhK,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAIV,EAAGqC,SAAS/B,KAAK+f,EAAgB5K,MAK3E,QAASkL,GAAQphB,GACf,GAAIkH,KACJma,GAASna,EAAMlH,GAAQe,KAAK,WAC1BN,EAAGqC,QAAQwe,OAAOpgB,KAAKgG,KAI3B,QAASma,GAASna,EAAMlH,GACtB,GAAI0F,GAAgB0a,EAAe/f,KAAKL,EAAQjB,QAAQmI,KAAKA,GAQ7D,OAPAxB,GAAc3E,KAAK,SAAUwgB,GAE3BxiB,QAAQ4S,OAAOzK,EAAMqa,GAErBhhB,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAIV,EAAGqC,SAAS/B,KAAK+f,EAAgB5K,KAG9DxQ,EAGT,QAAS8b,GAAWta,EAAMlH,GACxB,GAAImG,GAAUrG,EAAUqG,UACrBjG,YAAYF,GACZJ,MAAM,oBACNwG,YAAY,8CACZC,GAAG,OACHxC,OAAO,KAEV/D,GAAUO,KAAK8F,GACZpF,KAAK,WACJ,GAAIwJ,GAAK9J,EAAGqC,QAAQwe,OAAOnX,QAAQjD,EAC/BqD,IAAM,IACR9J,EAAGqC,QAAQwe,OAAO7V,OAAOlB,EAAI,GAC7BhK,EAAU4gB,YAAY1gB,EAAGkC,KAAKxB,GAAIV,EAAGqC,SAAS/B,KAAK+f,EAAgB5K,MAK3E,QAASiO,GAAWT,GAClB,GAAIC,GAAU5kB,QAAQmI,KAAKwc,EAC3BC,GAAQxiB,GAAK,IAGb,IAAIwB,GAAOpC,EAAUqC,QAAQnC,EAAGkC,KAAKxB,GACrCwB,GAAK7B,SAASC,KAAK,WAEjB,MADA4B,GAAK2e,OAAOpgB,KAAKyiB,GACVpjB,EAAUsgB,SAASle,KACzB5B,KAAK+f,EAAgB5K,GAG1B,QAAS4K,KACP,MAAOvc,GAASyB,QAAQ,SAG1B,QAASkQ,KACP,MAAO3R,GAASe,MAAM,wBApLxB,GAAI7E,GAAKqD,IAETrD,GAAGiG,SAAU,EACbjG,EAAGkC,KAAO,KACVlC,EAAGsiB,UAAY,KACftiB,EAAGqC,QAAU,KACbrC,EAAGb,MAAQ,KAEXa,EAAGkgB,YAAcA,EACjBlgB,EAAGsgB,YAAcA,EACjBtgB,EAAGyjB,UAAYA,EACfzjB,EAAGuM,aAAeA,EAClBvM,EAAG2gB,QAAUA,EACb3gB,EAAG4gB,SAAWA,EACd5gB,EAAG+gB,WAAaA,EAChB/gB,EAAG0jB,WAAaA,EAEhBjlB,IAkBF4kB,EAAsB7f,SAAW,SAAU,eAAgB,YAAa,WAAY,YAAa,WAAY,KAAM,oBAAqB,iBAAkB,qBAzC1JlF,QACGC,OAAO,YACPK,WAAW,wBAAyBykB,MA8LzC,WACE,YAOA,SAASM,GAAyBtkB,GAKhC,QAASC,GAAWC,EAAQ8C,GAC1B,GAAI7C,IACFC,YAAaF,EACbZ,YAAa,oCACb0L,QACEhI,QAASA,GAEXzD,WAAYglB,EACZjkB,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAASskB,GAA4BvkB,EAAWgD,GAY9C,QAASS,KACPzD,EAAU0D,KAAK/C,EAAGqC,SAGpB,QAASe,KACP/D,EAAU+D,SAGZ,QAAS0e,GAAUnD,GAEjB,GAAIoD,KACJ/hB,GAAGqC,QAAQsc,GAAOle,KAAKshB,GAGzB,QAASC,GAAarD,EAAOoD,GAC3B,GAAIjY,GAAK9J,EAAGqC,QAAQsc,GAAOjV,QAAQqY,EAC/BjY,IAAM,GACR9J,EAAGqC,QAAQsc,GAAO3T,OAAOlB,EAAI,GAIjC,QAASmY,KAEP,GAAI9iB,KACJa,GAAGqC,QAAQuI,OAAOnK,KAAKtB,GAGzB,QAAS+iB,GAAY/iB,GACnB,GAAI2K,GAAK9J,EAAGqC,QAAQuI,OAAOlB,QAAQvK,EAC/B2K,IAAM,GACR9J,EAAGqC,QAAQuI,OAAOI,OAAOlB,EAAI,GAzCjC,GAAI9J,GAAKqD,IAETrD,GAAGqC,QAAUA,EAEbrC,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EACZpD,EAAG8hB,UAAYA,EACf9hB,EAAGgiB,aAAeA,EAClBhiB,EAAGiiB,SAAWA,EACdjiB,EAAGkiB,YAAcA,EAMnByB,EAAyBngB,SAAW,aACpCogB,EAA4BpgB,SAAW,YAAa,WA3CpDlF,QACGC,OAAO,YACPkF,QAAQ,oBAAqBkgB,MAyElC,WACE,YAEArlB,SACGC,OAAO,YACN,kBAmDN,WACE,YAqDA,SAASslB,KArCP,QAASC,GAAiBC,GAkBxB,QAASC,KACP,MAAOC,GAAa5iB,QAStB,QAAS6iB,GAAQC,GACf,MAAOF,GAAatY,KAAMwY,OAAQA,IAQpC,QAASC,GAAYD,GACnB,MAAOE,GAAiB1Y,KAAMwY,OAAQA,IAaxC,QAASG,GAASH,EAAQI,EAASnP,GAEjC,MADAA,GAAUA,MACHoP,EAAa7Y,KAClBwY,OAAQA,EACRM,MAAOF,EACPG,MAAOtP,EAAQsP,MACfC,IAAKvP,EAAQuP,MAWjB,QAASC,GAAWT,EAAQ/R,EAAMwS,GAChC,GAAIxS,EAAKqS,QAAUG,EAAWC,YAC5B,KAAM,IAAIlK,OAAM,eAAiBiK,EAAWC,YAAc,OAASD,EAAWE,YAAc,8CAAgD1S,EAAKqS,MAGnJ,IAAIM,GAASP,EAAalf,MACxB6e,OAAQA,EACRa,OAAQ5S,EAAK4S,SAEbP,MAAOG,EAAWE,YAElBG,SAAU,MAQZ,OAJAF,GAAO1kB,SAASC,KAAK,SAAU4kB,GAC7B5mB,QAAQ4S,OAAOkB,EAAM8S,KAGhBH,EAtFT,GAAId,GAAeF,EAAUpO,EAASzO,IAAM,YAAcid,OAAQ,QAC9DE,EAAmBN,EAAUpO,EAASzO,IAAM,qBAC5Csd,EAAeT,EAAUpO,EAASzO,IAAM,0BAA4B8d,OAAQ,YAE5E1X,IAMJ,OALAA,GAAK4W,QAAUA,EACf5W,EAAK8W,YAAcA,EACnB9W,EAAKa,IAAM6V,EACX1W,EAAKgX,SAAWA,EAChBhX,EAAKsX,WAAaA,EACXtX,EA2BTwW,EAAiBtgB,SAAW,YA5C5B,IAAImS,KAGJ,OAFAA,GAASzO,IAAM,aACfyO,EAASM,KAAO6N,EACTnO,EAXTrX,QACGC,OAAO,YACPoX,SAAS,YAAakO,MA0G3B,WACE,YAOA,SAASsB,GAAehP,EAAYrS,EAAUshB,GAS5C,QAAS3mB,KACPuB,EAAGiG,SAAU,EACbjG,EAAGqlB,MAAQD,EAAUjX,KACrB,IAAImX,GAAetlB,EAAGqlB,MAAMhlB,QAE5BilB,GAAAA,SAAmB,WACjBxhB,EAASe,MAAM,sCACdvE,KAAK,WACNN,EAAGiG,SAAU,IAIjB,QAASsf,KACPpP,EAAW,QAAQE,SArBrB,GAAIrW,GAAKqD,IAETrD,GAAGiG,SAAU,EAEbjG,EAAGulB,SAAWA,EAEd9mB,IAiCF0mB,EAAe3hB,SAAW,aAAc,WAAY,aA7CpDlF,QACGC,OAAO,YACPK,WAAW,iBAAkBumB,MA+BlC,WACE,YAOA,SAASK,GAAmB5hB,EAAQyL,EAAc8G,EAAYiP,EAAWlY,EAAIpJ,GAqB3E,QAASrF,KACPuB,EAAGmkB,OAAS9U,EAAa8U,OAEzBnkB,EAAGylB,KAAOL,EAAUlB,QAAQlkB,EAAGmkB,OAC/B,IAAIuB,GAAc1lB,EAAGylB,KAAKplB,QAC1BqlB,GAAAA,SAAkBC,EAAiB,8CAEnC3lB,EAAG4lB,SAAWR,EAAUhB,YAAYpkB,EAAGmkB,OACvC,IAAI0B,GAAkB7lB,EAAG4lB,SAASvlB,QAClCwlB,GAAAA,SAAsBF,EAAiB,iDAEvC,IAAIG,GAAkBD,EAAgBvlB,KAAKylB,EAC3CD,GAAAA,SAAsBH,EAAiB,kDAEvCG,EAAgBxlB,KAAK,WACnBN,EAAGiG,SAAU,IAUjB,QAAS+f,GAAU5T,EAAM7S,GACvBA,EAAO0mB,2BAGPriB,EAAOgB,GAAG,eAAiBJ,OAAQ4N,EAAK8T,WAW1C,QAASC,GAAe/T,EAAMwS,EAAYrlB,GACxCA,EAAO0mB,0BAEP,IAAIG,GAAchB,EAAUR,WAAW5kB,EAAGmkB,OAAQ/R,EAAMwS,EAExDwB,GAAY/lB,SAASC,KAAK,WACxB,GAAI+lB,GAAiBnZ,EAAGiB,KACtBmY,EAAW1B,EAAWC,aACtByB,EAAW1B,EAAWE,cASxB,OANAuB,GAAe/lB,KAAK,WAClBwD,EAASyB,QAAQ,IAAMqf,EAAWhkB,MAAQ,2BACzC,WACDkD,EAASe,MAAM,iDAGVwhB,GACN,WACDviB,EAASe,MAAM,cAAgB+f,EAAWhkB,MAAQ,YAUtD,QAASmlB,GAAaH,GACpB,GAAIW,KAOJ,OALAjoB,SAAQiC,QAAQqlB,EAASY,OAAQ,SAAU/B,GACzC,GAAIqB,GAAkBQ,EAAW7B,EAAM/jB,GACvC6lB,GAAiB9lB,KAAKqlB,KAGjB5Y,EAAGiB,IAAIoY,GAShB,QAASD,GAAW/B,GAClB,GAAI/J,GAAQ4K,EAAUd,SAAStkB,EAAGmkB,OAAQI,GAAWI,IAAK,MAM1D,OAJAnK,GAAMna,SAASC,KAAK,WAClBN,EAAGymB,UAAUlC,GAAW/J,EAAMjZ,MAAMwG,OAAS,EAAIyS,EAAQ,OAGpDA,EAAMna,SASf,QAASslB,GAAiBxQ,GAQxB,QAASM,KACP,MAAO3R,GAASe,MAAMsQ,GARxB,MAAOM,GA3HT,GAAIzV,GAAKqD,IAGTrD,GAAG0mB,YACD,SACA,aACA,SACA,UACA,YAGF1mB,EAAGiG,SAAU,EACbjG,EAAGymB,aACHzmB,EAAGylB,KAAO,KAEVzlB,EAAGgmB,UAAYA,EACfhmB,EAAG4kB,WAAauB,EAEhB1nB,IAsBF+mB,EAAmBhiB,SAAW,SAAU,eAAgB,aAAc,YAAa,KAAM,YA9CzFlF,QACGC,OAAO,YACPK,WAAW,qBAAsB4mB,MA8ItC,WACE,YAOA,SAASmB,GAAqBlb,EAAY8D,EAAiBpC,EAAcjC,EAAMtH,EAAQyL,EAAchQ,EAAWyE,EAAUC,EAAG6iB,EAAkBC,EAAiB1I,EAAoByB,GAgBlL,QAASnhB,KACP,GAAIqoB,GAAWzX,EAAa3O,GAExBqmB,EAAgBtb,EAAWqF,sBAAsBgW,EACrDrX,GAAWF,EAAgBwB,QAAQgW,GAEnC/mB,EAAG+L,OAASN,EAAWE,IAAImb,GAC3B9mB,EAAGwP,WAAaC,EAAS9D,MAEzB3L,EAAGwP,WAAWnP,SAASC,KAAK,WAC1B,GAAIsa,GAAY7W,EAAEgK,OAAO/N,EAAGwP,WAAWoL,UAEd,KAArBA,EAAU7S,QACZ/H,EAAG0a,SAAWjL,EAASuN,iBACvBhd,EAAGwP,WAAWoL,UAAU5a,EAAG0a,SAASha,IAAMV,EAAG0a,WAEzCE,EAAU7S,OAAS,GACrBmD,EAAK2P,KAAK,iCAAmCD,EAAU7S,OAAS,cAElE/H,EAAG0a,SAAWE,EAAU,MAK9B,QAASoM,GAAYznB,GACnB,GAAI0F,GAAgB2hB,EAAiBhnB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAG+L,QAElE9G,GAAc3E,KAAK,SAAU2mB,GAE3B3oB,QAAQ4S,OAAOlR,EAAG+L,OAAQkb,EAE1B,IAAI9X,GAAc1D,EAAWnG,KAAKtF,EAAG+L,OAErC,OADAoD,GAAY7O,KAAK+f,EAAgB5K,GAC1BtG,IAIX,QAAS+X,GAAUvI,EAAOpf,GACxB,GAAI0F,GAAgB4hB,EAAgBjnB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAG+L,OAAO4S,IAExE1Z,GAAc3E,KAAK,SAAU6mB,GAE3B7oB,QAAQ4S,OAAOlR,EAAG+L,OAAO4S,GAAQwI,EAEjC,IAAIhY,GAAc1D,EAAWnG,KAAKtF,EAAG+L,OAErC,OADAoD,GAAY7O,KAAK+f,EAAgB5K,GAC1BtG,IAIX,QAASmR,GAAY/gB,GACnB,GAAI0F,GAAgB2a,EAAkBhgB,KAAKL,EAAQjB,QAAQmI,KAAKzG,EAAG+L,OAAOyG,SAE1EvN,GAAc3E,KAAK,SAAUigB,GAE3BvgB,EAAG+L,OAAOyG,QAAU+N,CAEpB,IAAIpR,GAAc1D,EAAWnG,KAAKtF,EAAG+L,OAErC,OADAoD,GAAY7O,KAAK+f,EAAgB5K,GAC1BtG,IAIX,QAASqR,GAAiBjhB,GACxB4e,EAAmBve,KAAKI,EAAGwP,WAAY,KAAMjQ,GAAQe,KAAK,WACxD,GAAI6O,GAAcM,EAASnK,KAAKtF,EAAGwP,WAEnC,OADAL,GAAY7O,KAAK+f,EAAgB5K,GAC1BtG,IAIX,QAASiY,GAAa7nB,EAAQwM,GAkB5B,QAASmJ,KAEP,MADAtR,GAAOgB,GAAG,UACHd,EAASyB,QAAQ8hB,EAAY,sBAGtC,QAAS5R,KACP,MAAO3R,GAASe,MAAM,oBAAsBwiB,GAvB9C,GAAIA,GAAYtb,EAAOF,KAAKjL,MAAQ,IAAMmL,EAAOF,KAAKjL,MAAQ,IAAM,cAEhEugB,EAAgB9hB,EAAUqG,SAC5BjG,YAAaF,EACbJ,MAAO,mBACPwG,YAAa,mCAAqC0hB,EAAY,IAC9DzhB,GAAI,MACJxC,OAAQ,OAGNyC,EAAiBxG,EAAUO,KAAKuhB,EAEpC,OAAOtb,GAAevF,KAAK,WACzB,MAAOmL,GAAAA,UAAkBM,GACtBzL,KAAK4U,EAAkBO,KAa9B,QAAS6R,GAAuB/nB,EAAQwM,GAEtC,GAAIsV,GAAqBhiB,EAAUoP,QACjChP,YAAaF,EACbJ,MAAO,mBACPwG,YAAa,iGACb2b,aAAcvV,EAAOF,KAAKjL,MAC1BgF,GAAI,SACJxC,OAAQ,WAGNme,EAASliB,EAAUO,KAAKyhB,EAE5BE,GAAOjhB,KAAK,SAAUnB,GACpB,GAAIqiB,GAAWrU,EAAasU,aAAa,YAAatiB,EAAO4M,EAAOjK,IAAIC,MAGxEyf,GAASlhB,KAAK,SAAUsN,GACtBhK,EAAOgB,GAAG,gBACRlE,GAAIkN,EAAQlN,MAEb,WACD,MAAOoD,GAASe,MAAM,iCAK5B,QAASwb,KACP,MAAOvc,GAASyB,QAAQ,SAG1B,QAASkQ,KACP,MAAO3R,GAASe,MAAM,wBAlJxB,GAAI4K,GAAW,KACXzP,EAAKqD,IAETrD,GAAGiG,SAAU,EACbjG,EAAG+L,OAAS,KAEZ/L,EAAGgnB,YAAcA,EACjBhnB,EAAGknB,UAAYA,EACflnB,EAAGsgB,YAAcA,EACjBtgB,EAAGwgB,iBAAmBA,EACtBxgB,EAAGunB,gBAAkBD,EACrBtnB,EAAGonB,aAAeA,EAElB3oB,IA4BFkoB,EAAqBnjB,SAAW,aAAc,kBAAmB,eAAgB,OAAQ,SAAU,eAAgB,YAAa,WAAY,IAAK,mBAAoB,kBAAmB,qBAAsB,qBA/C9MlF,QACGC,OAAO,YACPK,WAAW,uBAAwB+nB,MA4JxC,WACE,YAOA,SAASa,GAAwBnoB,GAK/B,QAASC,GAAWC,EAAQwM,GAC1B,GAAIvM,IACFC,YAAaF,EACbZ,YAAa,qCACb0L,QACE0B,OAAQA,GAEVnN,WAAY6oB,EACZ9nB,aAAc,KAGhB,OAAON,GAAUO,KAAKJ,GAfxB,OACEI,KAAMN,GAmBV,QAASmoB,GAA2Bhc,EAAYpM,EAAW0M,GAkBzD,QAASjJ,KACPzD,EAAU0D,KAAK/C,EAAG+L,QAGpB,QAAS3I,KACP/D,EAAU+D,SAGZ,QAASskB,KACP,GAAI7b,GAAOJ,EAAWkc,YACtB3nB,GAAG+L,OAAO6b,SAASnnB,KAAKoL,GAG1B,QAASgc,GAAWhc,GAClB,GAAI/B,GAAK9J,EAAG+L,OAAO6b,SAASle,QAAQmC,EAChC/B,IAAM,GACR9J,EAAG+L,OAAO6b,SAAS5c,OAAOlB,EAAI,GAjClC,GAAI9J,GAAKqD,IAETrD,GAAG+L,OAASA,EACZ/L,EAAG8nB,YAEG3mB,MAAO,YAAaP,MAAO,cAC3BO,MAAO,SAAUP,MAAO,gBACxBO,MAAO,cAAeP,MAAO,yBAC7BO,MAAO,WAAYP,MAAO,aAC1BO,MAAO,WAAYP,MAAO,kBAGhCZ,EAAG8C,MAAQA,EACX9C,EAAGoD,OAASA,EACZpD,EAAG0nB,QAAUA,EACb1nB,EAAG6nB,WAAaA,EAMlBL,EAAwBhkB,SAAW,aACnCikB,EAA2BjkB,SAAW,aAAc,YAAa,UAjDjElF,QACGC,OAAO,YACPkF,QAAQ,mBAAoB+jB,MAiEjC,WACE,YAOA,SAASO,GAAejoB,EAAW2L,EAAY7H,EAAQyL,EAAc8G,EAAYpS,EAAGmJ,EAAI0Z,EAAkBlH,EAAgB5b,GAaxH,QAASrF,KACH4Q,EAAa2Y,IACfhoB,EAAGioB,YAAc5Y,EAAa2Y,EAC9B5mB,EAAOpB,EAAGioB,cAId,QAAS1C,KACPpP,EAAW,QAAQE,SAGrB,QAASjV,GAAOC,GACdrB,EAAGiG,SAAU,EAEbjG,EAAGkoB,cAAgBzc,EAAWrK,OAAOC,GACrCrB,EAAGmoB,aAAeroB,EAAUsB,OAAOC,GAEnC6L,EAAGiB,KACDnO,EAAGkoB,cAAc7nB,SACjBL,EAAGmoB,aAAa9nB,WAEfC,KAAK,WACJN,EAAGiG,SAAU,GACZ,WACDnC,EAASe,MAAM,yCAIrB,QAASujB,GAAa7oB,GACpB,GAAIwM,GAASN,EAAWuC,SACpB/I,EAAgB2hB,EAAiBhnB,KAAKL,EAAQwM,EAElD9G,GAAc3E,KAAK,SAAUyL,GAC3B,GAAIoD,GAAc1D,EAAWnG,KAAKyG,EAQlC,OANAoD,GAAY7O,KAAK+f,EAAgB5K,GAEjCtG,EAAY7O,KAAK,SAAUyL,GACzBnI,EAAOgB,GAAG,iBAAmBlE,GAAIqL,EAAOrL,OAGnCyO,IAKX,QAASkZ,GAAW9oB,GAClB,GAAI2C,GAAOpC,EAAUuoB,aACjBpjB,EAAgBya,EAAe9f,KAAKL,EAAQ2C,EAEhD+C,GAAc3E,KAAK,SAAU4B,GAC3B,GAAIiN,GAAcrP,EAAUsgB,SAASle,EAQrC,OANAiN,GAAY7O,KAAK+f,EAAgB5K,GAEjCtG,EAAY7O,KAAK,SAAU4B,GACzB0B,EAAOgB,GAAG,eAAiBJ,OAAQtC,EAAKxB,OAGnCyO,IAIX,QAASkR,KACP,MAAOvc,GAASyB,QAAQ,UAG1B,QAASkQ,KACP,MAAO3R,GAASe,MAAM,mBAhFxB,GAAI7E,GAAKqD,IAETrD,GAAGiG,SAAU,EACbjG,EAAGioB,YAAc,GAEjBjoB,EAAGulB,SAAWA,EACdvlB,EAAGooB,aAAeA,EAClBpoB,EAAGqoB,WAAaA,EAChBroB,EAAGoB,OAAS2C,EAAEukB,SAASlnB,EAAQ,KAE/B3C,IAkCFspB,EAAevkB,SAAW,YAAa,aAAc,SAAU,eAAgB,aAAc,IAAK,KAAM,mBAAoB,iBAAkB,YAlD9IlF,QACGC,OAAO,YACPK,WAAW,iBAAkBmpB,MAyFlC,WACE,YAOA,SAAS9W,GAAOsX,GACdA,EAAmBC,cAAc,aAC/BC,GAAM,UACNC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UAERC,qBAAsB,QACtBC,oBAAqB,UAGvBjB,EAAmBC,cAAc,UAC/BC,GAAM,UACNC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UAERC,qBAAsB,QACtBC,oBAAqB,KAAM,MAAO,MAAO,UAG3CjB,EAAmBkB,MAAM,WACtBC,eAAe,aACfC,cAAc,UAGnB1Y,EAAOzN,SAAW,sBAnDlBlF,QACGC,OAAO,YACP0S,OAAOA,MAmDZ,WACE,YAOA,SAAS2Y,GAASC,GACXA,EAAQC,mBACXD,EAAQE,aA6CZH,EAASpmB,SAAW,WApDpBlF,QACGC,OAAO,YACPyrB,IAAIJ,MAWT,WACE,YAOA,SAASK,GAAaC,EAAgBC,GACpCD,EACG9lB,MAAM,UACL8C,IAAK,MACLvI,YAAa,qBACbC,WAAY,iBACZe,aAAc,OAGfyE,MAAM,iBACL8C,IAAK,aACLkjB,OACEC,MACE1rB,YAAa,yBACbC,WAAY,uBACZe,aAAc,SAKnByE,MAAM,eACL8C,IAAK,gBACLkjB,OACEC,MACE1rB,YAAa,qBACbC,WAAY,qBACZe,aAAc,SAInByE,MAAM,kBACL8C,IAAK,oCACLkjB,OACEC,MACE1rB,YAAa,wBACbC,WAAY,wBACZe,aAAc,SAInByE,MAAM,iBACL8C,IAAK,sDACLkjB,OACEC,MACE1rB,YAAa,uBACbC,WAAY,uBACZe,aAAc,SAKnByE,MAAM,WACL8C,IAAK,YACLvI,YAAa,0CACbC,WAAY,iCACZe,aAAc,OAGfyE,MAAM,gBACL8C,IAAK,OACLvI,YAAa,iDACbC,WAAY,0BACZe,aAAc,OAGfyE,MAAM,SACL8C,IAAK,SACLvI,YAAa,qCACbC,WAAY,+BACZe,aAAc,OAGfyE,MAAM,cACL8C,IAAK,OACLvI,YAAa,4CACbC,WAAY,wBACZe,aAAc,OAGfyE,MAAM,QACL8C,IAAK,QACLvI,YAAa,qBACbC,WAAY,iBACZe,aAAc,OAGfyE,MAAM,aACL8C,IAAK,WACLvI,YAAa,qBACbC,WAAY,qBACZe,aAAc,OAGfyE,MAAM,SACL8C,IAAK,sBACLvI,YAAa,2BACbC,WAAY,sBACZe,aAAc,OAGfyE,MAAM,UACL8C,IAAK,UACLvI,YAAa,4BACbC,WAAY,uBACZe,aAAc,OAKlBwqB,EAAmBG,UAAU,KA7D/BL,EAAazmB,SAAW,iBAAkB,sBArD1ClF,QACGC,OAAO,YACP0S,OAAOgZ,MAsHZ,WACE,YAEA3rB,SACGC,OAAO,YACPgsB,SAAS,IAAKxmB,GACdwmB,SAAS,SAAU/T,WAIxB,WACE,YAOA,SAASvF,GAAOuZ,EAAcC,EACd5G,EACA6G,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEdV,EAAaW,cAAa,EAG1B,IAAIC,GAAa,cAEjBvH,GAAkB3c,IAAMkkB,EAAa,YACrCV,EAAkBxjB,IAAMkkB,EAAa,SACrCT,EAAmBzjB,IAAMkkB,EAAa,UACtCR,EAAqB1jB,IAAMkkB,EAAa,oBACxCP,EAAiB3jB,IAAMkkB,EAAa,iBACpCN,EAA8B5jB,IAAMkkB,EAAa,mBACjDL,EAAoB7jB,IAAMkkB,EAAa,WACvCJ,EAAkB9jB,IAAMkkB,EAAa,UAGrCH,EAAgBI,SAAWD,EAAa,iBACxCH,EAAgBK,cAAgBF,EAAa,sBAC7CF,EAA2BhkB,IAAM,GAAIqkB,QAAO,IAAMH,EAAY,KAC9DX,EAAce,aAAa/qB,KAAK,sBAmBlCwQ,EAAOzN,SAAW,eAAgB,gBAAiB,oBAAqB,oBAAqB,qBAAsB,uBAAwB,mBAAoB,gCAAiC,sBAAuB,oBAAqB,kBAAmB,8BAtD/PlF,QACGC,OAAO,YACP0S,OAAOA,MAsCZ,WACE,YAgBA,SAASwa,GAAUC,EAAkBC,GA6DnC,QAASC,GAAUC,EAAUC,GApD3B,QAASC,GAASC,GAChB,MAAOA,GAAMrgB,IAAI,+BAAiCkgB,EAAW,QAAQvrB,KAAK,SAAU2rB,GAClF,MAAOA,GAAIC,OAmDfH,EAASvoB,SAAW,SAxDpBkoB,EAAiBE,UAAUE,EAAUC,GAmEvC,QAASI,GAASN,EAAUO,GArD1B,QAASL,GAASC,GAChB,MAAOA,GAAMrgB,IAAI,sBAAwBkgB,EAAW,QAAQvrB,KAAK,SAAU2rB,GACzE,MAAOA,GAAIC,OAoDfH,EAASvoB,SAAW,SAzDpBkoB,EAAiBS,SAASC,EAASL,GAhBrCJ,EAAqBU,WAAa,kCAClC/tB,QAAQiC,QAAQ+rB,EAAaV,GAC7BttB,QAAQiC,QAAQgsB,EAAYJ,GAsC9BV,EAAUjoB,SAAW,mBAAoB,wBAvDzClF,QACGC,OAAO,YACP0S,OAAOwa,EAEV,IAAIa,IACFE,QAAS,SAGPD,GACFE,IAAK,8BACLC,QAAS,0BAkCbpuB,QAAQC,OAAO,YAAYyrB,KAAK,iBAAkB,SAAS2C,GAAiBA,EAAeC,IAAI,qBAAqB,qgEACpHD,EAAeC,IAAI,qBAAqB,goCACxCD,EAAeC,IAAI,qBAAqB,8vBACxCD,EAAeC,IAAI,qCAAqC,y8CACxDD,EAAeC,IAAI,yBAAyB;AAC5CD,EAAeC,IAAI,oCAAoC,8hEACvDD,EAAeC,IAAI,wBAAwB,ihHAC3CD,EAAeC,IAAI,mCAAmC,uhEACtDD,EAAeC,IAAI,uBAAuB,2gGAC1CD,EAAeC,IAAI,iCAAiC,wnDACpDD,EAAeC,IAAI,qBAAqB,6yHACxCD,EAAeC,IAAI,gCAAgC,mnCACnDD,EAAeC,IAAI,yBAAyB,i4CAC5CD,EAAeC,IAAI,gEAAgE,snBACnFD,EAAeC,IAAI,2DAA2D,87EAC9ED,EAAeC,IAAI,8DAA8D,yfACjFD,EAAeC,IAAI,8CAA8C,ySACjED,EAAeC,IAAI,oCAAoC,ilBACvDD,EAAeC,IAAI,sDAAsD,o4DACzED,EAAeC,IAAI,8DAA8D,olBACjFD,EAAeC,IAAI,oDAAoD,yCACvED,EAAeC,IAAI,4BAA4B,0HAC/CD,EAAeC,IAAI,2DAA2D,85DAC9ED,EAAeC,IAAI,4CAA4C,wdAC/DD,EAAeC,IAAI,qCAAqC,u0BACxDD,EAAeC,IAAI,iDAAiD;AACpED,EAAeC,IAAI,0CAA0C,wxEAC7DD,EAAeC,IAAI,oDAAoD,qqFACvED,EAAeC,IAAI,yDAAyD,2iGAC5ED,EAAeC,IAAI,uDAAuD,q6DAC1ED,EAAeC,IAAI,mDAAmD,uvFACtED,EAAeC,IAAI,6DAA6D,uNAChFD,EAAeC,IAAI,iEAAiE,oiBACpFD,EAAeC,IAAI,uDAAuD,gWAC1ED,EAAeC,IAAI,qDAAqD,quBACxED,EAAeC,IAAI,+DAA+D,4hCAClFD,EAAeC,IAAI,6DAA6D,miBAChFD,EAAeC,IAAI,mDAAmD,0jCACtED,EAAeC,IAAI,2EAA2E,yTAC9FD,EAAeC,IAAI,uDAAuD,i2CAC1ED,EAAeC,IAAI,6DAA6D,mzDAChFD,EAAeC,IAAI,qDAAqD,2zBACxED,EAAeC,IAAI,yFAAyF","file":"scripts/app-1b3998dfc9.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ckeditor',\n      'ngMaterial',\n      'trcCore',\n      'trcBiblio',\n      'trcTasks',\n      'trcBio',\n      'trcReln',\n      'trcRefs',\n      'trcArticles',\n      'zotero',\n      'accounts',\n      'sda'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('articleAuthorEditor', {\n      templateUrl: 'app/admin/editors/articles/components/article-author-editor/article-author-editor.html',\n      controller: ArticleAuthorEditorController,\n      bindings: {\n        author: '='\n      }\n    });\n\n  /** @ngInject */\n  function ArticleAuthorEditorController() {\n    var vm = this;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    // PRIVATE METHODS\n\n    function activate() {}\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('titleEditor', titleEditorDirective);\n\n  /** @ngInject */\n  function titleEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/title-editor/title-editor.html',\n      scope: {\n        title: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('relnEditDialog', relnEditDialogFactory);\n\n  /** @ngInject */\n  function relnEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event) {\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/reln-edit-dialog/reln-edit-dialog.html',\n        controller: RelationshipEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n\n    }\n  }\n\n  /** @ngInject */\n  function RelationshipEditDialogController($filter, $mdDialog, worksRepo, relnRepo) {\n    var stripTags = $filter('stripTags');\n    var vm = this;\n\n    vm.description = null;\n\n    vm.types = null;\n    vm.selectedType = null;\n\n    vm.searchText = null;\n    vm.selectedWork = null;\n\n    vm.anchors = null;\n    vm.selectedAnchor = null;\n\n    vm.search = search;\n    vm.selectWork = selectWork;\n    vm.close = close;\n    vm.cancel = cancel;\n\n    activate();\n\n    function activate() {\n      vm.types = getTypes();\n    }\n\n    function getTypes() {\n      var rawTypes = relnRepo.getTypes();\n      var types = [];\n\n      var typesP = rawTypes.$promise.then(function () {\n        angular.forEach(rawTypes, function (type) {\n          types.push({\n            id: type.identifier,\n            label: type.title,\n            directed: type.isDirected,\n            reverse: false\n          });\n\n          if (type.isDirected) {\n            types.push({\n              id: type.identifier,\n              label: type.reverseTitle,\n              directed: type.isDirected,\n              reverse: true\n            });\n          }\n        });\n\n        return types;\n      });\n\n\n      Object.defineProperty(types, '$promise', {\n        value: typesP\n      });\n\n      return types;\n    }\n\n    function search(query) {\n      var results = worksRepo.search(query);\n      return results.$promise.then(function () {\n        return results.items;\n      });\n    }\n\n    function selectWork(proxy) {\n      vm.anchors = [];\n\n      if (!proxy) {\n        return;\n      }\n\n      var baseLabel = stripTags(proxy.label);\n      var baseToken = proxy.ref.token;\n\n      // create default anchor for top-level work\n      vm.selectedAnchor = relnRepo.createAnchor(baseLabel, baseToken);\n      vm.anchors.push(vm.selectedAnchor);\n\n      var work = worksRepo.getWork(proxy.id);\n      work.$promise.then(function () {\n        work.editions.forEach(function (edition) {\n          // create anchor for each edition\n          var editionLabel = baseLabel + '. ' + edition.editionName;\n          vm.anchors.push(relnRepo.createAnchor(editionLabel, baseToken, {\n            editionId: [edition.id]\n          }));\n\n          edition.volumes.forEach(function (volume) {\n            // create anchor for each volume\n            var volumeLabel = editionLabel + '. Volume ' + volume.volumeNumber;\n            vm.anchors.push(relnRepo.createAnchor(volumeLabel, baseToken, {\n              editionId: [edition.id],\n              volumeId: [volume.id]\n            }));\n          });\n        });\n      });\n    }\n\n    function close() {\n      $mdDialog.hide({\n        typeId: vm.selectedType.id,\n        directed: vm.selectedType.directed,\n        reverse: vm.selectedType.reverse,\n        target: vm.selectedAnchor,\n        description: vm.description\n      });\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('relationships', {\n      templateUrl: 'app/work/components/relationships/relationships.html',\n      bindings: {\n        anchor: '<'\n      },\n      controller: RelationshipsController\n    });\n\n  // emulation of an enum\n  // HACK: this code is copied from the see-also-editor component\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n\n  /** @ngInject */\n  function RelationshipsController($scope, $state, $timeout, $mdDialog, sdaToast, _, relnRepo, relnEditDialog) {\n    var vm = this;\n\n    vm.typeGroups = null;\n\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    function openRelationship($event, reln) {\n      // HACK: only using first anchor\n      var anchor = reln.anchors[0];\n\n      var state = null;\n      var params = {};\n\n      switch(anchor.ref.type) {\n        case TypeId.WORK:\n          state = 'editor.work';\n          params.workId = anchor.ref.id;\n\n          if (anchor.properties.editionId) {\n            state = 'editor.edition';\n            params.editionId = anchor.properties.editionId;\n          }\n\n          if (anchor.properties.editionId && anchor.properties.volumeId) {\n            state = 'editor.volume';\n            params.volumeId = anchor.properties.volumeId;\n          }\n\n          break;\n        case TypeId.PERSON:\n          state = 'editor.person';\n          params.id = anchor.ref.id;\n          break;\n        case TypeId.ARTICLE:\n          state = 'article.edit';\n          params.id = anchor.ref.id;\n          break;\n        default:\n          break;\n      }\n\n      if (!state) {\n        sdaToast.error('I don\\'t know how to follow that link.');\n      } else {\n        $state.go(state, params);\n      }\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialogPromise = relnEditDialog.show($event);\n      dialogPromise.then(function (relnInfo) {\n        relationship.typeId = relnInfo.typeId;\n        relationship.description = relnInfo.description;\n\n        /*\n        determine fields in which to place anchors...\n\n        directed | reverse || destination for self anchor | destination for selected anchor\n        ---------|---------||-----------------------------|--------------------------------\n        NO       | *       || \"related\"                   | \"related\"\n        YES      | YES     || \"targets\"                   | \"related\"\n        YES      | NO      || \"related\"                   | \"targets\"\n         */\n        if (!relnInfo.directed) {\n          relationship.related.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else if (relnInfo.reverse) {\n          relationship.targets.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else {\n          relationship.related.push(vm.anchor);\n          relationship.targets.push(relnInfo.target);\n        }\n\n        var saveP = relnRepo.save(relationship);\n        saveP.then(function () {\n          sdaToast.success('Saved.');\n          // HACK give relationship a chance to save on the server\n          $timeout(loadRelationships, 1000);\n        }, function () {\n          sdaToast.error('Unable to save relationship');\n        });\n      });\n\n    }\n\n    function deleteRelationship($event, reln) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      confirmPromise.then(function () {\n        var deleteP = relnRepo.delete(reln.id);\n\n        deleteP.then(function () {\n          sdaToast.success('Relationship deleted.');\n          // HACK give relationship a chance to be deleted from the server\n          $timeout(loadRelationships, 1000);\n        }, function () {\n          sdaToast.error('Unable to delete relationship');\n        });\n      });\n    }\n\n    // PRIVATE METHODS\n\n    function activate() {\n      $scope.$watch('$ctrl.anchor', function (newAnchor) {\n        if (!newAnchor) {\n          return;\n        }\n\n        loadRelationships();\n      });\n    }\n\n    /**\n     * Loads relationships from the repository using the currently bound anchor.\n     * @return {Promise.<TypeGroup[]>}\n     */\n    function loadRelationships() {\n      vm.loading = true;\n      var relns = relnRepo.search(vm.anchor.ref, vm.anchor.properties);\n\n      var typeGroupsP = relns.$promise.then(function () {\n        vm.typeGroups = relnRepo.normalizeRelationships(relns, vm.anchor.ref);\n        return vm.typeGroups.$promise;\n      })\n\n      typeGroupsP.catch(function () {\n        sdaToast.error('Unable to load relationship data from the server');\n      }).then(function () {\n        vm.loading = false;\n      });\n\n\n      return typeGroupsP;\n    }\n  }\n\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('publicationInfoEditor', publicationInfoEditorDirective);\n\n  /** @ngInject */\n  function publicationInfoEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/publication-info-editor/publication-info-editor.html',\n      scope: {\n        pubInfo: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('copyEditor', copyEditorDirective);\n\n  /** @ngInject */\n  function copyEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/copy-editor/copy-editor.html',\n      scope: {\n        copy: '=ngModel'\n      },\n      controller: CopyEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function CopyEditorController($scope) {\n    var vm = this;\n\n    vm.refHandlers = {};\n    vm.setProperties = parseProperties;\n\n    activate();\n\n    function activate() {\n      addHandler(HathiTrustRefHandler());\n      addHandler(GoogleBooksRefHandler());\n      addHandler(InternetArchiveRefHandler());\n    }\n\n    function addHandler(handler) {\n      vm.refHandlers[handler.id] = handler;\n    }\n\n    function parseProperties(type, url) {\n      if (vm.refHandlers[type]) {\n        $scope.copy.properties = vm.refHandlers[type](url);\n      }\n\n      $scope.copyForm.url.$setValidity(type, $scope.copy.properties != null);\n    }\n  }\n\n  // https://archive.org/details/essayinanswertom00adamiala\n  // <iframe src='https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n7/mode/1up' width='480px' height='430px' frameborder='0' ></iframe>\n  // TODO add support for resources from OpenLibrary\n  // https://openlibrary.org/books/OL7186607M/An_essay_in_answer_to_Mr._Hume's_Essay_on_miracles.\n\n  /**\n   * A reference parse handler to support digital copies from the Internet\n   * Archive.\n   */\n  function InternetArchiveRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      if (parsed.path.substr(0, 8) === '/stream/') {\n        id = parsed.path.substr(8);\n\n        var pageNo = parsed.fragment.match(/page\\/([^\\/]+)/);\n        if (pageNo && pageNo.length >= 2) {\n          seq = pageNo[1];\n        }\n      }\n\n      return makePropertiesObject(url, id, seq);\n    }\n\n    handle.id = 'internetarchive';\n    handle.display = 'Internet Archive';\n\n    /**\n     * Constructs an object literal that represents the stored-properties\n     * to associate with an InternetArchive digital copy.\n     *\n     * @param  {string} src The source URL from which the properties were parsed.\n     * @param  {string} id  The identifier used to uniquely reference a\n     *                      particular digial copy at the Internet Archive.\n     * @param  {string} seq The sequence number that identifies the page to be\n     *                      used as the initial page of this digital copy.\n     * @return {object}     The object literal of properties to be associated\n     *                      with this digital copy.\n     */\n    function makePropertiesObject(src, id, seq) {\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: src,\n        id: id,\n        seq: seq\n      };\n    }\n\n    return handle;\n  }\n\n  function HathiTrustRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      switch (parsed.hostname) {\n        case 'babel.hathitrust.org':\n          id = parsed.query.id;\n          seq = parsed.query.seq;\n          break;\n\n        case 'hdl.handle.net':\n          id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1);\n\n          if (!parsed.query.urlappend) {\n            break;\n          }\n\n          var subquery = parseQueryString(parsed.query.urlappend);\n          if (!subquery) {\n            break;\n          }\n          seq = subquery.seq;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        htid: id,\n        seq: seq\n      };\n    }\n\n    handle.id = 'hathitrust';\n    handle.display = 'HathiTrust';\n\n    return handle;\n  }\n\n  function GoogleBooksRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      switch (parsed.hostname) {\n        case 'books.google.com':\n          var id = parsed.query.id;\n          var section = parsed.query.printsec;\n          var page = parsed.query.pg;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        id: id,\n        section: section,\n        page: page\n      };\n    }\n\n    handle.id = 'googlebooks';\n    handle.display = 'Google Books';\n\n    return handle;\n  }\n\n  /**\n   * Parses a URL string into its components\n   *\n   * @param  {string} url\n   * @return {URL}\n   */\n  function parseUrl(url) {\n    if (!url) {\n      return null;\n    }\n\n    // eslint-disable-next-line angular/document-service\n    var parser = document.createElement('a');\n    parser.href = url;\n\n    return {\n      toString: function() {\n        return url;\n      },\n      protocol: parser.protocol,\n      host: parser.host,\n      hostname: parser.hostname,\n      port: parser.port,\n      path: parser.pathname,\n      query: parseQueryString(parser.search),\n      fragment: parser.hash\n    };\n  }\n\n  /**\n   * Parses a query string into key/value pairs\n   *\n   * @param {string} query\n   * @return {object.<string,any>}\n   */\n  function parseQueryString(query, sep) {\n    if (!query || !angular.isString(query)) {\n      return {};\n    }\n\n    // remove leading '?'\n    if (query[0] === '?') {\n      query = query.substr(1);\n    }\n\n    // attempt to auto-detect separator\n    if (!sep) {\n      // auto-detection \"bitmask\"\n      // 0 = none detected -- prefer '&'\n      // 1 = only ';' detected -- use it\n      // 2 = only '&' detected -- use it\n      // 3 = both detected -- prefer '&'\n      var flags = (query.indexOf(';') >= 0 ? 1 : 0) + (query.indexOf('&') >= 0 ? 2 : 0);\n      sep = flags === 1 ? ';' : '&';\n    }\n\n    var parsed = {};\n\n    var kvpairs = query.split(sep);\n    kvpairs.forEach(function (pair) {\n      var ix = pair.indexOf('=');\n      var key = pair;\n      var value = null;\n\n      if (!key) {\n        return;\n      }\n\n      if (ix >= 0) {\n        key = pair.substr(0, ix);\n        value = pair.substr(ix + 1);\n      }\n\n      try {\n        key = decodeURIComponent(key);\n        value = decodeURIComponent(value);\n      } catch (URIError) {\n        return;\n      }\n\n      // TODO: handle key array/map notation\n\n      if (parsed.hasOwnProperty(key)) {\n        // convert repeated keys into an array\n        if (angular.isArray(parsed[key])) {\n          parsed[key].push(value);\n        } else {\n          parsed[key] = [parsed[key], value];\n        }\n      } else {\n        parsed[key] = value;\n      }\n    });\n\n    return parsed;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('copyEditDialog', copyEditDialogFactory);\n\n  /** @ngInject */\n  function copyEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, copy) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/copy-edit-dialog/copy-edit-dialog.html',\n        locals: {\n          copy: copy\n        },\n        controller: CopyEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function CopyEditDialogController($mdDialog, copy) {\n    var vm = this;\n\n    vm.copy = copy;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.copy);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditor', workEditorDirective);\n\n  /** @ngInject */\n  function workEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/work-editor/work-editor.html',\n      scope: {\n        work: '=ngModel'\n      },\n      controller: WorkEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function WorkEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.editions = [];\n\n      vm.createEdition = createEdition;\n      vm.deleteEdition = deleteEdition;\n\n      activate();\n\n      function activate() {\n        $scope.work.editions.forEach(function (edition) {\n          vm.editions.push({\n            model: edition,\n            focused: false\n          });\n        });\n      }\n\n      function createEdition() {\n        var edition = worksRepo.createEdition();\n        edition.titles = _.cloneDeep($scope.work.titles);\n        edition.authors = _.cloneDeep($scope.work.authors);\n\n        $scope.work.editions.push(edition);\n        vm.editions.push({\n          model: edition,\n          focused: true\n        });\n      }\n\n      function deleteEdition(ix) {\n        vm.editions.splice(ix, 1);\n        $scope.work.editions.splice(ix, 1);\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditorItem', workEditorItemDirective);\n\n  /** @ngInject */\n  function workEditorItemDirective($log) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/task/components/work-editor-item/work-editor-item.html',\n      link: linkFunc,\n      scope: {\n        id: '=id'\n      },\n      controller: WorkEditorItemController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc($scope) {\n      if (!$scope.id) {\n        $log.error('missing required attribute \"id\"');\n      }\n    }\n\n    /** @ngInject */\n    function WorkEditorItemController($scope, worksRepo) {\n      var vm = this;\n\n      vm.loaded = false;\n\n      activate();\n\n      function activate() {\n        if ($scope.id) {\n          vm.work = worksRepo.getWork($scope.id);\n          vm.work.$promise.then(function () {\n            vm.loaded = true;\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('authorRefEditor', authorRefEditorDirective);\n\n  /** @ngInject */\n  function authorRefEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/author-ref-editor/author-ref-editor.html',\n      scope: {\n        ref: '=ngModel'\n      },\n      controller: AuthorRefEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function AuthorRefEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.linkAuthorSearchText = '';\n      vm.authorRoles = [\n        'author',\n        'editor',\n        'translator',\n        'other'\n      ];\n\n      vm.setLinkedAuthor = setLinkedAuthor;\n      vm.getResults = getResults;\n\n      activate();\n\n      function activate() {\n        if ($scope.ref.authorId) {\n          var author = peopleRepo.get($scope.ref.authorId);\n          author.$promise.then(function () {\n            vm.linkAuthorSearchText = author.name.label;\n          })\n        }\n      }\n\n      function setLinkedAuthor(person) {\n        $scope.ref.authorId = person.id;\n      }\n\n      function getResults(query) {\n        var resultSet = peopleRepo.search(query);\n        return resultSet.$promise.then(function () {\n          return resultSet.items;\n        });\n      }\n\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('editionEditor', editionEditorDirective);\n\n  /** @ngInject */\n  function editionEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/edition-editor/edition-editor.html',\n      scope: {\n        edition: '=ngModel'\n      },\n      controller: EditionEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function EditionEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.volumes = [];\n\n      vm.createVolume = createVolume;\n      vm.deleteVolume = deleteVolume;\n\n      activate();\n\n      function activate() {\n        $scope.edition.volumes.forEach(function (volume) {\n          vm.volumes.push({\n            model: volume,\n            focused: false\n          });\n        });\n      }\n\n      function createVolume() {\n        var volume = worksRepo.createVolume();\n        volume.titles = _.cloneDeep($scope.edition.titles);\n        volume.authors = _.cloneDeep($scope.edition.authors);\n        volume.publicationInfo = _.cloneDeep($scope.edition.publicationInfo);\n\n        $scope.edition.volumes.push(volume);\n        vm.volumes.push({\n          model: volume,\n          focused: true\n        });\n      }\n\n      function deleteVolume(ix) {\n        vm.volumes.splice(ix, 1);\n        $scope.edition.volumes.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('nameEditor', nameEditorDirective);\n\n  /** @ngInject */\n  function nameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/name-editor/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('volumeEditor', volumeEditorDirective);\n\n  /** @ngInject */\n  function volumeEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/volume-editor/volume-editor.html',\n      scope: {\n        volume: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('eventEditor', eventEditorDirective);\n\n  /** @ngInject */\n  function eventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/event-editor/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('eventEditDialog', eventEditDialogFactory);\n\n  /** @ngInject */\n  function eventEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/components/event-edit-dialog/event-edit-dialog.html',\n        locals: {\n          event: event\n        },\n        controller: EventEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EventEditDialogController($mdDialog, event) {\n    var vm = this;\n\n    vm.event = event;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.event);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('sdaAdmin')\n      .directive('treeCategorizationEditor', treeCategorizationEditor);\n\n   /** @ngInject */\n   function treeCategorizationEditor() {\n      var directive = {\n         restrict: 'E',\n         templateUrl: 'app/admin/editors/articles/thematic-overview.html',\n         scope: {\n           scopeId: \"@\",\n           scheme: \"@\"\n          //  need param to indicate whether this categorization owns related entrties\n         },\n         controller: TreeCategorizationController,\n         controllerAs: 'vm'\n      };\n\n      return directive;\n   }\n\n   // NOTE this needs to move toward being a more general puropose control\n\n   /** @ngInject */\n   function TreeCategorizationController($scope, $log, $mdDialog, sdaToast, $state, $q,\n     articlesRepo, categorizationService) {\n\n     var vm = this;\n     var repo = null;\n\n     // TODO need to allow actions to be pluggable\n     vm.handleAssociateEntry = handleAssociateEntry;\n     vm.handleRemoveEntry = handleRemoveEntry;\n     vm.handleCreateChild = handleCreateChild;\n     vm.handleDeleteNode = handleDeleteNode;\n\n     activate();\n\n     //'overviews'\n     function activate() {\n       $log.info(\"Loading article editor\", articlesRepo);\n       repo = categorizationService.getScopedRepo($scope.scopeId);\n       // TODO need to handle case when this fails to load. Display throbber pending load\n       vm.overviews = repo.get($scope.scheme);\n     }\n\n     // TODO allow edit labels\n\n     /* ================================\n      * API METHODS\n      * ================================ */\n      function handleAssociateEntry($event, node) {\n        $log.info(\"creating article\");\n        // TODO need to offer option of create or link\n        // TODO magic string\n\n        var type = 'thematic';\n        var title = node.label;\n\n        // TODO  display prompt dialog, allow entry of title, selection of type (but not)\n        // TODO error handling!!\n        var article = articlesRepo.create(type, title);\n        var articlePromise = articlesRepo.save(article);\n        var linkPromise = articlePromise.then(linkArticle);\n\n        $q.all({\n          article: articlePromise,\n          ref: linkPromise\n        }).then(openEditor);\n\n        function linkArticle(article) {\n          var ref = repo.nodes.link(node, {\n            id: article.ref.id,\n            type: article.ref.type\n          });\n          return ref.$promise;\n        }\n\n        function openEditor(values) {\n          $state.go(\"article.edit\", {\n            id: values.article.id\n          });\n        }\n        // TODO creates article and (once created) associates\n        //      that article with this node in the hierarchy.\n        //      On completion, opens that article in the editor.\n      }\n\n      function handleRemoveEntry($event, node) {\n        $log.info(\"Removing entry\", node);\n\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      If OK, removes the associated entry from this node\n        //      and then deletes the article.\n\n      }\n\n      /**\n       * Handler to be invoked to create a new category with an hierarchical\n       * categorization.\n       *\n       * @param  {event} $event  The event that triggered this request.\n       * @param  {object} parent The parent node on which the child should be created.\n       * @return {[type]}        [description]\n       */\n      function handleCreateChild($event, parent) {\n        $log.info(parent);\n\n        var newCategoryDialog = $mdDialog.prompt({\n          title: \"Enter Category Label\",\n          // TODO add description\n          placeholder: 'new category',\n          ok: \"Create\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(newCategoryDialog)\n                 .then(onCreate);\n\n        function onCreate(label) {\n          $log.info(\"Creating category \" + label);\n\n          repo.nodes.create(parent, label);\n        }\n      }\n\n      function handleDeleteNode($event, node, parent) {\n        $log.info(node);\n\n        var title = \"Delete category '\" + node.label + \"'\";\n        var msg = \"<p>This will delete the selected category, \" + node.label + \", \" +\n                  \"its sub-categories and all associated articles.\" +\n                  \"<em>This action cannot be undone.</em></p>\" +\n                  \"<p>Permanently delete this category?</p>\";\n        var removeCatgorizationDialog = $mdDialog.confirm({\n          title: title,\n          htmlContent: msg,\n          ok: \"Delete\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(removeCatgorizationDialog).then(function() {\n           // TODO dispaly success/failure toasts\n           repo.nodes.remove(node, true, parent).then(function () {\n             return sdaToast.success('category deleted');\n           }, function () {\n             return sdaToast.error('unable to delete category');\n           });\n         });\n\n\n        function deleteNode() {\n        }\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      Recursively removes all articles associated with descendants\n        //      Removes this categorization entry (and children)\n      }\n\n      /* ================================\n       * PRIVATE METHODS\n       * ================================ */\n\n       function getChildren(node) {\n         if (node.childIds.length != node.chilren.length) {\n           throw new Error(\"Lazy loading of children not yet supported.\");\n         }\n\n         return $q.when(node.chilren);\n       }\n\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n// TODO admin-page-articles\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorSectionController', ArticleEditorSectionController);\n\n  /** @ngInject */\n  function ArticleEditorSectionController($state, $mdDialog, sdaToast, articlesRepo) {\n    var vm = this;\n\n    vm.createArticle = createArticle;\n\n    activate();\n\n    function activate() {\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n\n    /**\n     * Creates a new article of the given type and opens that article in the editor\n     *\n     * @param {Event} $event\n     * @param {string} type\n     * @return {Promise.<Article>} Resolves after the article has been created and saved on the server\n     */\n    function createArticle($event, type) {\n      var dialog = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Article')\n        .textContent('Please provide a title for the new article.')\n        .placeholder('title')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var titlePromise = $mdDialog.show(dialog);\n\n      titlePromise.then(function (title) {\n        var article = articlesRepo.create(type, title);\n        var savePromise = articlesRepo.save(article);\n\n        savePromise.then(function (article) {\n          $state.go('article.edit', { id: article.id });\n          sdaToast.success('Article created successfully');\n        }, function () {\n          sdaToast.error('Unable to create article');\n        });\n\n        return savePromise;\n      });\n\n    }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorController', ArticleEditorController);\n\n  var CKEDITOR_CONFIG = {\n    /*\n    toolbarGroups: [\n      { name: 'styles', groups: [ 'styles' ] },\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n      { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n      { name: 'colors', groups: [ 'colors' ] },\n      { name: 'links', groups: [ 'links' ] },\n      { name: 'insert', groups: [ 'insert' ] },\n      { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },\n      { name: 'forms', groups: [ 'forms' ] },\n      { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },\n      { name: 'tools', groups: [ 'tools' ] },\n      { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },\n      { name: 'others', groups: [ 'others' ] },\n    ],\n    */\n\n    toolbar: [\n      { name: 'styles', items: [ 'Styles', 'Format' ] },\n      { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike', '-', 'Subscript', 'Superscript', '-', 'RemoveFormat' ] },\n      { name: 'paragraph', items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote' ] },\n      { name: 'links', items: [ 'Link', 'Unlink', 'Anchor' ] },\n      { name: 'insert', items: [ 'Citation', 'Footnote', '-', 'Image', 'Table', 'HorizontalRule', 'SpecialChar', 'Mathjax' ] },\n      { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ] },\n      { name: 'editing', items: [ 'Scayt' ] },\n      { name: 'tools', items: [ 'Maximize' ] },\n      { name: 'document', items: [ 'Source' ] }\n    ],\n\n    // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n    format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address',\n\n    extraPlugins: 'mathjax',\n\n    mathJaxLib: '//cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-MML-AM_CHTML'\n  };\n\n  /** @ngInject */\n  function ArticleEditorController($q, $log, $stateParams, $scope, footnoteEditDialog, sdaToast, articlesRepo, refsRepoFactory) {\n    var refsRepoUrl = articlesRepo.getReferencesEndpoint($stateParams.id);\n    var refsRepo = refsRepoFactory.getRepo(refsRepoUrl);\n\n    var vm = this;\n\n    vm.save = save;\n\n    vm.abstractEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'HorizontalRule',\n          'Maximize',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.footnoteEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Footnote',\n          'HorizontalRule',\n          'Maximize',\n          'Source',\n        ].join(',')\n      })\n    };\n\n    vm.editor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editFootnote = editFootnote;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo)\n\n      vm.article = articlesRepo.get($stateParams.id);\n      var articlePromise = vm.article.$promise;\n      articlePromise.then(function (article) {\n        // ensure article has at least 1 author\n        if (article.authors.length === 0) {\n          article.authors.push({});\n        }\n      });\n\n      vm.references = refsRepo.get();\n      var refsPromise = vm.references.$promise;\n\n      $q.all([articlePromise, refsPromise]).then(function () {\n        // start watching for opportunities to remove unused citations and footnotes\n        $scope.$watch('vm.article.body', cleanArticleHandler);\n        $scope.$watchCollection('vm.article.footnotes', cleanRefsHandler);\n      }, function () {\n        return sdaToast.error('Failed to load data from the server');\n      });\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n     function save() {\n       return $q.all([\n         articlesRepo.save(vm.article),\n         refsRepo.save(vm.references)\n       ]).then(function () {\n         sdaToast.success('Saved');\n       }, function () {\n         sdaToast.error('Unable to save article.');\n       });\n     }\n\n     /**\n      * Displays a bottom sheet to edit an existing footnote.\n      * Delegates to the edit dialog in ckeditor-footnotes component, which should probably be refactored elsewhere.\n      * @param  {MouseEvent} $event\n      * @param  {Footnote} footnote\n      */\n     function editFootnote($event, footnote) {\n       var newFootnote = angular.copy(footnote);\n       var newReferences = refsRepoFactory.createRefCollection();\n\n       var promise = footnoteEditDialog.show($event, newFootnote, {\n         references: newReferences,\n         ckeditor: vm.footnoteEditor\n       });\n\n       promise.then(function () {\n         vm.article.footnotes[newFootnote.id] = newFootnote;\n\n         // update bibliography\n         var updatedReferences = refsRepoFactory.merge(vm.references, refsRepoFactory.compact(newReferences));\n         angular.merge(vm.references, updatedReferences);\n       });\n     }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n\n     function cleanRefsHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanReferences(vm.article, vm.references);\n       vm.references = refsRepo.compact(vm.references);\n     }\n\n     function cleanArticleHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanFootnotes(vm.article, vm.article.footnotes);\n       cleanRefsHandler(obj);\n     }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('AboutEditorSectionController', AboutEditorSectionController);\n\n  /** @ngInject */\n  function AboutEditorSectionController($state) {\n    var vm = this;\n\n    vm.editAboutPage = editAboutPage;\n\n    // PUBLIC METHODS\n\n    function editAboutPage(page) {\n      $state.go('about.edit', { id: page.id });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('AboutEditorController', AboutEditorController);\n\n  var CKEDITOR_CONFIG = {\n\n    toolbar: [\n      { name: 'styles', items: [ 'Styles', 'Format' ] },\n      { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike', '-', 'Subscript', 'Superscript', '-', 'RemoveFormat' ] },\n      { name: 'paragraph', items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote' ] },\n      { name: 'links', items: [ 'Link', 'Unlink', 'Anchor' ] },\n      { name: 'insert', items: [ 'Citation', 'Footnote', '-', 'Image', 'Table', 'HorizontalRule', 'SpecialChar', 'Mathjax' ] },\n      { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ] },\n      { name: 'editing', items: [ 'Scayt' ] },\n      { name: 'tools', items: [ 'Maximize' ] },\n      { name: 'document', items: [ 'Source' ] }\n    ],\n\n    // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n    format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address'\n  };\n\n  /** @ngInject */\n  function AboutEditorController($q, $log, $stateParams, $scope, sdaToast, articlesRepo) {\n    var vm = this;\n\n    vm.save = save;\n\n    vm.editor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: 'Styles,Subscript,Superscript,Cut,Copy,Source'\n      })\n    };\n\n    activate();\n\n    // PUBLIC METHODS\n\n    function save() {\n      var savePromise = articlesRepo.save(vm.article);\n\n      savePromise.then(function () {\n        sdaToast.success('Saved');\n      }, function () {\n        sdaToast.error('Unable to save page.');\n      });\n\n      return savePromise;\n    }\n\n    // PRIVATE METHODS\n\n    function activate() {\n      vm.article = articlesRepo.get($stateParams.id);\n\n      vm.article.$promise.catch(function () {\n        return sdaToast.error('Failed to load data from the server');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('aboutCategorizationEditor', aboutCategorizationEditor);\n\n  /** @ngInject */\n  function aboutCategorizationEditor() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/admin/editors/about/about-categorization-editor.html',\n      scope: {\n        scopeId: \"@\",\n        scheme: \"@\"\n      },\n      controller: AboutCategorizationEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function AboutCategorizationEditorController($scope, $mdDialog, sdaToast, $state, $q, articlesRepo, categorizationService) {\n    var repo = categorizationService.getScopedRepo($scope.scopeId);\n\n    var vm = this;\n    vm.hierarchy = null;\n    vm.handleAssociateEntry = handleAssociateEntry;\n    vm.handleCreateChild = handleCreateChild;\n    vm.handleDeleteNode = handleDeleteNode;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    function handleAssociateEntry($event, node) {\n      var type = 'about';\n      var title = node.label;\n\n      var page = articlesRepo.create(type, title);\n      var pageSavePromise = articlesRepo.save(page);\n\n      var linkPromise = pageSavePromise.then(function (page) {\n        var ref = repo.nodes.link(node, {\n          id: page.ref.id,\n          type: page.ref.type\n        });\n        return ref.$promise;\n      });\n\n      $q.all({\n        page: pageSavePromise,\n        ref: linkPromise\n      }).then(function (params) {\n        var page = params.page;\n        $state.go('about.edit', { id: page.id });\n      });\n    }\n\n    /**\n     * Handler to be invoked to create a new category with an hierarchical\n     * categorization.\n     *\n     * @param  {event} $event  The event that triggered this request.\n     * @param  {object} parent The parent node on which the child should be created.\n     * @return {[type]}        [description]\n     */\n    function handleCreateChild($event, parent) {\n      var newCategoryDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: \"Enter Category Label\",\n        placeholder: 'new category',\n        ok: \"Create\",\n        cancel: \"Cancel\"\n      });\n\n      var labelPromise = $mdDialog.show(newCategoryDialog)\n\n      labelPromise.then(function (label) {\n        repo.nodes.create(parent, label);\n      });\n    }\n\n    function handleDeleteNode($event, node, parent) {\n      var title = 'Delete category \\'' + node.label + '\\'?';\n\n      var msg = '<p>This will delete the selected category, ' + node.label + ', ' +\n        'its sub-categories and all associated articles.' +\n        '<em>This action cannot be undone.</em></p>' +\n        '<p>Permanently delete this category?</p>';\n\n      var removeCatgorizationDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: title,\n        htmlContent: msg,\n        ok: \"Delete\",\n        cancel: \"Cancel\"\n      });\n\n      $mdDialog.show(removeCatgorizationDialog).then(function () {\n        repo.nodes.remove(node, true, parent).then(function () {\n          return sdaToast.success('category deleted');\n        }, function () {\n          return sdaToast.error('unable to delete category');\n        });\n      });\n    }\n\n    // PRIVATE METHODS\n\n    function activate() {\n      vm.hierarchy = repo.get($scope.scheme);\n    }\n\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero', [\n      'ngAnimate',\n      'ngAria',\n      'ngMaterial',\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .controller('ZoteroTestController', ZoteroTestController);\n\n  /** @ngInject */\n  function ZoteroTestController() {\n    var vm = this;\n\n    vm.item = {};\n\n    vm.types = [];\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('summaryEditor', summaryEditorDirective);\n\n  /** @ngInject */\n  function summaryEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/summary-editor/summary-editor.html',\n      scope: {\n        summary: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.config = {\n        // FIXME set up minimal toolbar and restrict HTML content\n        toolbarGroups: [\n          { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n          { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n          { name: 'links', groups: [ 'links' ] },\n          { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n        ],\n\n        removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles'\n      };\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('summaryEditDialog', summaryEditDialogFactory);\n\n  /** @ngInject */\n  function summaryEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, summary) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          summary: summary\n        },\n        controller: SummaryEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function SummaryEditDialogController($mdDialog, summary) {\n    var vm = this;\n\n    vm.summary = summary;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.summary);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('stripTags', stripTagsFilter);\n\n  function stripTagsFilter() {\n    return stripTags;\n  }\n\n  function stripTags(html) {\n    return html ? String(html).replace(/<[^>]+>/gm, '') : '';\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .animation('.slide', slideToggle);\n\n  function slideToggle() {\n    var NG_HIDE_CLASS = 'ng-hide';\n\n    return {\n      beforeAddClass: beforeAddClass,\n      removeClass: removeClass\n    };\n\n    function beforeAddClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.slideUp(done);\n      }\n    }\n\n    function removeClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.hide().slideDown(done);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('seeAlsoEditor', {\n      templateUrl: 'app/components/see-also-editor/see-also-editor.html',\n      bindings: {\n        sourceToken: '<'\n      },\n      controller: SeeAlsoEditorController\n    });\n\n  // emulation of an enum\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n  var UNIFIED_SEARCH_KEYS = ['people', 'works', 'articles'];\n\n  /** @ngInject */\n  function SeeAlsoEditorController($scope, $state, $mdDialog, sdaToast, _, seeAlsoRepo, trcSearch) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.seeAlso = null;\n\n    vm.searchText = null;\n    vm.selectedItem = null;\n\n    vm.createLink = createLink;\n    vm.openLink = openLink;\n    vm.deleteLink = deleteLink;\n    vm.search = search;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    /**\n     * Creates a new see-also link with the current token as the source\n     * and the given anchor as the target.\n     * @param {Anchor} anchor\n     */\n    function createLink(anchor) {\n      if (!anchor) {\n        return;\n      }\n\n      if (alreadyLinked(anchor)) {\n        sdaToast.info('Item has already been linked.');\n        clearLinkForm();\n        return;\n      }\n\n      var link = seeAlsoRepo.create(vm.sourceToken, anchor.token);\n\n      link.$promise.then(function () {\n        // HACK: link to target comes back as source field\n        var anchor = link.source;\n        if (!vm.seeAlso.links.hasOwnProperty(anchor.type)) {\n          vm.seeAlso.links[anchor.type] = [];\n        }\n\n        vm.seeAlso.links[anchor.type].push(anchor);\n\n        clearLinkForm();\n\n        sdaToast.success('Link created');\n      }, function () {\n        sdaToast.error('Unable to create link');\n      });\n    }\n\n    /**\n     * Redirects the browser to the editor page for the item referenced by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function openLink($event, anchor) {\n      switch(anchor.type) {\n        case TypeId.WORK:\n          $state.go('editor.work', { workId: anchor.id });\n          break;\n        case TypeId.PERSON:\n          $state.go('editor.person', { id: anchor.id });\n          break;\n        case TypeId.ARTICLE:\n          $state.go('article.edit', { id: anchor.id });\n          break;\n        default:\n          sdaToast.error('I don\\'t know how to follow that link.');\n          break;\n      }\n    }\n\n    /**\n     * Reoves the see-also link targeted by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function deleteLink($event, anchor) {\n      var dialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        htmlContent: 'Are you sure you want to delete this link?' + anchor.label,\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmP = $mdDialog.show(dialog);\n\n      confirmP.then(function () {\n        var deleteP = seeAlsoRepo.delete(vm.sourceToken, anchor.token);\n\n        deleteP.then(function () {\n          sdaToast.success('Link deleted');\n          var ix = vm.seeAlso.links[anchor.type].indexOf(anchor);\n          if (ix >= 0) {\n            vm.seeAlso.links[anchor.type].splice(ix, 1);\n          }\n        }, function () {\n          sdaToast.error('Unable to delete link');\n        })\n      });\n    }\n\n    /**\n     * Searches all entries matching the provided query.\n     * @param  {string} query\n     * @return {Promise.<Anchor[]>}\n     */\n    function search(query) {\n      var results = trcSearch.search(query);\n      return results.$promise.then(combineSearchResults, function () {\n        sdaToast.error('Unable to load search results');\n      });\n    }\n\n    // PRIVATE METHODS\n\n    /**\n     * Initializes controller state\n     */\n    function activate() {\n      $scope.$watch('$ctrl.sourceToken', function (newToken) {\n        if (!newToken) {\n          return;\n        }\n\n        vm.loading = true;\n        vm.seeAlso = seeAlsoRepo.get(newToken);\n        vm.seeAlso.$promise.then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    /**\n     * Determines whether the proided anchor has already been linked with the current token.\n     * @param {Anchor} anchor\n     * @return {boolean}\n     */\n    function alreadyLinked(anchor) {\n      return vm.seeAlso.links.hasOwnProperty(anchor.type) && vm.seeAlso.links[anchor.type].some(function (existing) {\n        return existing.token === anchor.token;\n      });\n    }\n\n    /**\n     * Clears the new link input form.\n     */\n    function clearLinkForm() {\n      vm.searchText = null;\n      vm.selectedItem = null;\n    }\n\n    /**\n     * Combines unified search results into a homogeneous list of anchors.\n     * @param {UnifiedSearchResult} results\n     * @return {Anchor[]}\n     */\n    function combineSearchResults(results) {\n      return _.flatMap(UNIFIED_SEARCH_KEYS, function (key) {\n        return results.results[key].map(function (item) {\n          return {\n            label: item.label || item.title,  // article search results don't have a 'label' attribute\n            type: item.ref.type,\n            token: item.ref.token\n          };\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .provider('sdaToast', SdaToastProvider);\n\n  // TODO: this service appears to accomplish the same goal as $mdToast.addPreset\n  //       perhaps this service should be replaced with custom $mdToast presets\n\n  function SdaToastProvider() {\n    var provider = {};\n\n    provider.defaultOptions = {\n      position: 'bottom right',\n      hideDelay: 3000\n    };\n\n    provider.$get = SdaToastFactory\n\n    return provider;\n\n    /** @ngInject */\n    function SdaToastFactory($mdToast) {\n      var sdaToast = {\n        success: showSuccessToast,\n        info: showInfoToast,\n        error: showErrorToast\n      }\n\n      return sdaToast;\n\n      function showSuccessToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-success' + (options && options.toastClass ? ' ' + options.toastClass : '')\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function showInfoToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-info' + (options && options.toastClass ? ' ' + options.toastClass : '')\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function showErrorToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-error' + (options && options.toastClass ? ' ' + options.toastClass : ''),\n          hideDelay: false\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function makeToast(message, options) {\n        var opts = angular.merge({}, provider.defaultOptions, options);\n\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .toastClass(opts.toastClass)\n          .position(opts.position)\n          .hideDelay(opts.hideDelay);\n\n        if (!opts.hideDelay || opts.action) {\n          toast.action(opts.action || 'Dismiss')\n        }\n\n        return toast;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('navbar', {\n      templateUrl: 'app/components/navbar/navbar.html',\n      bindings: {\n        title: '@',\n        sidenavId: '@?'\n      },\n      controller: NavbarController\n    });\n\n  /** @ngInject */\n  function NavbarController($mdSidenav) {\n    var vm = this;\n\n    vm.toggleSidenav = toggleSidenav;\n\n    activate();\n\n    function activate() {\n\n    }\n\n    function toggleSidenav(id) {\n      $mdSidenav(id).toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  /**\n  * Formats ranked by precedence to check for when parsing date strings.\n  *\n  * NOTE: dashes can be any number of non-alphanumeric characters, so 'DD-MM-YYYY' parses\n  *       '02/02/2015', '02.02.2015', '02:02,2015', and '02*#!02   ^^^2015' into '02-02-2015'\n  *\n  * @type {Array}\n  */\n  var INFER_FORMATS = [\n    // year\n    'YYYY',             // e.g. 2015\n\n    // month year\n    'MMMM-YYYY',        // e.g. February 2015\n    'MMM-YYYY',         // e.g. Feb. 2015\n    'MM-YYYY',          // e.g. 02/2015\n    'M-YYYY',           // e.g. 2/2015\n\n    // year month\n    'YYYY-MMMM',        // e.g. 2015 February\n    'YYYY-MMM',         // e.g. 2015 Feb.\n    'YYYY-MM',          // e.g. 2015-02\n    'YYYY-M',           // e.g. 2015-2\n\n    // month day year\n    'MMMM-DD-YYYY',     // e.g. February 02, 2015\n    'MMM-DD-YYYY',      // e.g. Feb. 02, 2015\n    'MM-DD-YYYY',       // e.g. 02/02/2015\n    'M-DD-YYYY',        // e.g. 2/02/2015\n    'MMMM-D-YYYY',      // e.g. February 2, 2015\n    'MMM-D-YYYY',       // e.g. Feb. 2, 2015\n    'MM-D-YYYY',        // e.g. 02-2-2015\n    'M-D-YYYY',         // e.g. 2/2/2015\n\n    // day month year\n    'DD-MMMM-YYYY',     // e.g. 02 February 2015\n    'DD-MMM-YYYY',      // e.g. 02 Feb. 2015\n    'DD-MM-YYYY',       // e.g. 02/02/2015\n    'DD-M-YYYY',        // e.g. 02/2/2015\n    'D-MMMM-YYYY',      // e.g. 2 February 2015\n    'D-MMM-YYYY',       // e.g. 2 Feb. 2015\n    'D-MM-YYYY',        // e.g. 2/02/2015\n    'D-M-YYYY',         // e.g. 2/2/2015\n\n    // year month day\n    'YYYY-MM-DD',       // e.g. 2015-02-02\n    'YYYY-M-D'          // e.g. 2015-2-2\n  ];\n\n  angular\n    .module('sdaAdmin')\n    .factory('guessDate', guessDateFactory);\n\n  /** @ngInject */\n  function guessDateFactory(moment) {\n    return guessDate;\n\n    /**\n     * Parse a date string into a Moment.\n     *\n     * See moment.js\n     *\n     * @param  {string} str Date string to parse\n     * @return {Moment}     Parsed moment\n     */\n    function guessDate(str) {\n        return moment(str, INFER_FORMATS);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('empty', emptyFilterFactory);\n\n  /** @ngInject */\n  function emptyFilterFactory(_) {\n    return _.isEmpty;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('dateEditor', dateEditorDirective);\n\n  /** @ngInject */\n  function dateEditorDirective(guessDate) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/date-editor/date-editor.html',\n      scope: {\n        date: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      // indicates whether the current value in the date.calendar field was automatically set\n      scope.calendarAutoSet = false;\n\n      scope.$watch('date.description', function (dateDescription) {\n        if (dateDescription && (!scope.date.calendar || scope.calendarAutoSet)) {\n          scope.date.calendar = guessDate(dateDescription).format('YYYY-MM-DD');\n          scope.calendarAutoSet = true;\n        }\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('DataContainerController', DataContainerController);\n\n\n  /** @ngInject */\n  function DataContainerController() {\n    var vm = this;\n    var listeners = [];\n\n    vm.watch = watch;\n    vm.set = set;\n    vm.value = null;\n\n    /**\n     * Attach a listener to watch for value changes\n     * @param  {Function} fn listener callback\n     * @return {Function} unregister function\n     */\n    function watch(fn) {\n      listeners.push(fn);\n      fn(vm.value);\n      return unregister;\n\n      function unregister() {\n        var ix = listeners.indexOf(fn);\n        if (ix >= 0) {\n          listeners.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Updates internal value\n     * @param {*} newValue\n     */\n    function set(newValue) {\n      if (vm.value === newValue) {\n        return;\n      }\n\n      vm.value = newValue;\n\n      listeners.forEach(function (fn) {\n        fn(newValue);\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('footnoteEditDialog', footnoteEditDialogFactory);\n\n  /** @ngInject */\n  function footnoteEditDialogFactory($mdBottomSheet) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, footnote, options) {\n      var opts = angular.merge({}, options);\n\n      var config = {\n        templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n        controller: FootnoteEditDialogController,\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          footnote: footnote,\n          references: opts.references,\n          ckeditorConfig: opts.ckeditor\n        }\n      };\n\n      return $mdBottomSheet.show(config);\n    }\n  }\n\n  /** @ngInject */\n  function FootnoteEditDialogController($mdBottomSheet, footnote, references, ckeditorConfig) {\n    var vm = this;\n\n    vm.footnote = footnote;\n    vm.references = references;\n    vm.ckeditorConfig = ckeditorConfig;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdBottomSheet.hide();\n    }\n\n    function cancel() {\n      $mdBottomSheet.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorFootnotes', ckeditorFootnotesDirective);\n\n  /** @ngInject */\n  function ckeditorFootnotesDirective($document, footnoteEditDialog, articlesRepo, refsRepoFactory) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorFootnotes', '?ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var anchorIdPrefix = attrs.ckeditorFootnotesAnchorIdPrefix || 'fn_anchor_';\n\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n      var ckeditorBibliography = requires[2];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorFootnotes;\n\n      // capture footnotes reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (footnotes) {\n        if (ctrl.value !== footnotes) {\n          ctrl.set(footnotes);\n        }\n      });\n\n      var FOOTNOTE_COMMAND_NAME = 'insertFootnote';\n      editor.addCommand(FOOTNOTE_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        requiredContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        exec: insertFootnoteCommand\n      });\n\n      editor.ui.addButton('Footnote', {\n        label: 'Insert Footnote',\n        command: FOOTNOTE_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertFootnoteCommand(editor) {\n        var command = this;\n\n        // create a new footnote object to edit.\n        var newFootnote = articlesRepo.createFootnote();\n        newFootnote.backlinkId = anchorIdPrefix + newFootnote.id;\n\n        var newReferences = ckeditorBibliography ? refsRepoFactory.createRefCollection() : null;\n\n        var promise = footnoteEditDialog.show(null, newFootnote, {\n          references: newReferences,\n          // TODO: allow footnote ckeditor to be configured\n          ckeditor: scope.$eval(attrs.ckeditor)\n        });\n\n        promise.then(function () {\n          ctrl.value[newFootnote.id] = newFootnote;\n\n          // update bibliography if provided\n          if (newReferences && ckeditorBibliography) {\n            var updatedReferences = refsRepoFactory.merge(ckeditorBibliography.value, refsRepoFactory.compact(newReferences));\n            angular.merge(ckeditorBibliography.value, updatedReferences);\n          }\n\n          editor.insertHtml('<sup contenteditable=\"false\" class=\"footnote\" id=\"' + newFootnote.backlinkId + '\" data-footnote=\"' + newFootnote.id + '\">#</sup>');\n          done();\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: FOOTNOTE_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n/**\n * @typedef ItemContainer\n * @type {object}\n * @property {string} id\n * @property {string} label\n * @property {BiblioItem} item\n */\n\n(function () {\n  'use strict';\n\n  var LOCATOR_TYPES = [\n    'book', 'chapter', 'column', 'figure', 'folio', 'issue', 'line', 'note', 'opus', 'page',\n    'paragraph', 'part', 'section', 'sub verbo', 'verse', 'volume'\n  ];\n\n  var ZOTERO_USER_ACCOUNT_ID = '2536190';\n  var ZOTERO_USER_ACCOUNT_API_KEY = '3A4q05BNg0h0bHKJkpoCi1Oa';\n  var ZOTERO_GROUP_ID = '381134';\n\n  angular\n    .module('sdaAdmin')\n    .component('citationEditor', {\n      templateUrl: 'app/components/citation-edit-dialog/citation-editor.html',\n      controller: CitationEditorController,\n      bindings: {\n        references: '=',\n        citation: '='\n      }\n    });\n\n  /** @ngInject */\n  function CitationEditorController($filter, $q, $log, $mdDialog, zotero, _, sdaToast, refsRepoFactory, refsRenderer) {\n    var vm = this;\n\n    // referenced item autocomplete models\n    vm.selectedBiblioItem = null;\n    vm.searchText = '';\n\n    vm.locatorTypes = LOCATOR_TYPES;\n\n    vm.activeCitationItem = {};\n\n    vm.groupLibraryP = null;\n\n    vm.zoteroItem = null\n\n    vm.search = search;\n    vm.addCitationItem = addCitationItem;\n    vm.selectBiblioItem = selectBiblioItem;\n    vm.edit = editCitationItem;\n    vm.createZoteroItem = createZoteroItem;\n    vm.cancelZoteroItem = cancelZoteroItem;\n    vm.saveZoteroItem = saveZoteroItem;\n\n    var stripTags = $filter('stripTags');\n\n    activate();\n\n    function activate() {\n      var account = zotero.getUserAccount(ZOTERO_USER_ACCOUNT_ID, ZOTERO_USER_ACCOUNT_API_KEY);\n\n      // account.getGroup and account.getLibrary return native Promises.\n      // we wrap them in $q promises for consistency\n      var groupP = $q.when(account.getGroup(ZOTERO_GROUP_ID));\n      vm.groupLibraryP = groupP.then(function (group) {\n        return $q.when(account.getLibrary(group));\n      });\n\n      if (!vm.citation) {\n        throw new Error('no citation provided');\n      }\n\n      if (!vm.references.citations[vm.citation.id]) {\n        $log.warn('Citation is not a member of the provided reference collection. Adding to collection...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      } else if (vm.references.citations[vm.citation.id] !== vm.citation) {\n        $log.warn('provided citation does not match citation in reference collection. Overriding...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      }\n    }\n\n    /**\n     * Provides autocomplete items\n     * @param  {string} query\n     * @return {Promise.<ItemContainer[]>}\n     */\n    function search(query) {\n      return vm.groupLibraryP.then(function (library) {\n        // library.searchItems returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        var resultsP = $q.when(library.searchItems(query))\n\n        var adaptedResultsP = resultsP.then(function (items) {\n          return $q.all(items.map(adaptItem).map(wrapItem));\n        });\n\n        adaptedResultsP.catch(function () {\n          sdaToast.error('Unable to load search results.');\n        });\n\n        return adaptedResultsP;\n      });\n    }\n\n    /**\n     * Adapts a ZoteroItem for use in the autocomplete field and citation metadata\n     * @param  {ZoteroItem} zItem\n     * @return {BiblioItem}\n     */\n    function adaptItem(zItem) {\n      var id = 'zotero/' + zItem.library.id + '/' + zItem.id;\n\n      var item = refsRepoFactory.createBiblioItem(id);\n      item.type = zItem.type;\n      item.creators = zItem.properties.creators.map(adaptCreator);\n\n      // NOTE: this omits a lot of metadata fields... need to decide what other metadata (if any) to keep.\n\n      item.meta = angular.extend(\n        _.pick(zItem.meta, ['creatorSummary', 'parsedDate']),\n        _.pick(zItem.properties, ['key', 'dateAdded', 'dateModified'])\n      );\n\n      item.fields = _.omit(zItem.properties, [\n        // these properties are extracted to the top-level item\n        'creators', 'itemType',\n        // these properties are extracted to metadata\n        'key', 'dateAdded', 'dateModified',\n        // these properties are just forgotten\n        'version', 'collections', 'tags', 'relations'\n      ]);\n\n      return item;\n    }\n\n    /**\n     * Adapts a Zotero creator for use in the BiblioItem TRC-local type\n     * @param  {ZoteraCreator}\n     * @return {Creator}\n     */\n    function adaptCreator(zCreator) {\n      return {\n        role: zCreator.creatorType,\n        firstName: zCreator.firstName,\n        lastName: zCreator.lastName,\n        name: zCreator.name\n      };\n    }\n\n    /**\n     * Wraps a BiblioItem for use in the autocomplete field and citation metadata\n     * @param  {BiblioItem} item\n     * @return {Promise.<ItemContainer>}\n     */\n    function wrapItem(item) {\n      var labelP = refsRenderer.renderBiblioItem('mla', item);\n\n      return labelP.then(function (label) {\n        return {\n          id: item.id,\n          label: label,\n          item: item\n        };\n      });\n    }\n\n    /**\n     * Appends the given citation item to the citation\n     * @return {CitationItem}\n     */\n    function addCitationItem(citationItem) {\n      if (vm.citation.items.indexOf(citationItem) < 0) {\n        // new item\n        vm.citation.items.push(citationItem);\n      } else {\n        // edited existing item in-place\n      }\n\n      // set/update label\n      var referencedBibItem = vm.references.bibliography[citationItem.id];\n      renderCitationItemLabel(citationItem, referencedBibItem).then(function (label) {\n        citationItem.label = label;\n      });\n\n      // clear active item and start editing a new one\n      clearForm();\n    }\n\n    /**\n     * Sets the current citation item's referent id to the given item's id and\n     * adds the given item to the bibliography\n     * @param {ItemContainer} itemContainer\n     */\n    function selectBiblioItem(itemContainer) {\n      if (itemContainer) {\n        vm.activeCitationItem.id = itemContainer.id;\n        vm.references.bibliography[itemContainer.id] = itemContainer.item;\n      } else {\n        vm.activeCitationItem.id = null;\n      }\n    }\n\n    /**\n     * Sets the given citation item as the item being actively edited\n     * @param {CitationItem} item\n     */\n    function editCitationItem(citationItem) {\n      var biblioItem = vm.references.bibliography[citationItem.id];\n      return wrapItem(biblioItem).then(function (biblioItemContainer) {\n        vm.activeCitationItem = citationItem;\n        vm.selectedBiblioItem = biblioItemContainer;\n        vm.searchText = stripTags(vm.selectedBiblioItem.label);\n      });\n    }\n\n    /**\n     * Resets the model behind the citation item form\n     */\n    function clearForm() {\n      vm.activeCitationItem = {};\n      vm.searchText = '';\n      vm.selectedBiblioItem = null;\n    }\n\n    /**\n     * Renders a label for a single citation item\n     * @praam {CitationItem} citationItem\n     * @param {ZoteroItem} biblioItem Corresponding bibliographic item\n     * @return {Promise.<string>}\n     */\n    function renderCitationItemLabel(citationItem, biblioItem) {\n      // create a singleton citation for the citation item\n      var citation = refsRepoFactory.createCitation();\n      citation.items.push(citationItem);\n\n      // create a singleton reference for the singleton citation\n      var reference = refsRepoFactory.createRefCollection();\n      reference.citations[citation.id] = citation;\n      reference.bibliography[citationItem.id] = biblioItem;\n\n      var renderedP = refsRenderer.render('mla', reference);\n\n      return renderedP.then(function (rendered) {\n        return rendered.citations[citation.id];\n      });\n    }\n\n    function createZoteroItem() {\n      vm.zoteroItem = {};\n    }\n\n    function cancelZoteroItem() {\n      vm.zoteroItem = null;\n    }\n\n    function saveZoteroItem($event, item) {\n      var zItemP = vm.groupLibraryP.then(function (library) {\n        // library.saveItem returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        return $q.when(library.saveItem(item));\n      });\n\n      var biblioItemP = zItemP.then(adaptItem);\n\n      var itemContainerP = biblioItemP.then(wrapItem);\n\n      itemContainerP.then(function (item) {\n        vm.selectedBiblioItem = item;\n        selectBiblioItem(item);\n        vm.searchText = stripTags(item.label);\n        vm.zoteroItem = null;\n      }, function () {\n        sdaToast.error('Unable to save zotero data');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('citationEditDialog', CitationEditDialogFactory);\n\n  /** @ngInject */\n  function CitationEditDialogFactory($mdDialog, _, refsRepoFactory) {\n    return {\n      show: show\n    };\n\n    /**\n     * Displays the edit dialog.\n     * @param  {ReferenceCollection} references\n     * @param  {Citation} [citation]\n     * @param  {MouseEvent} [$event]\n     * @return {Promise.<ReferenceCollection>}\n     */\n    function show(references, citation, $event) {\n      if (!citation) {\n        var citations = _.values(references.citations);\n\n        if (citations.length === 0) {\n          citation = refsRepoFactory.createCitation();\n          references.citations[citation.id] = citation;\n        } else {\n          citation = citations[0];\n        }\n      } else if (angular.isString(citation)) {\n        citation = references.citations[citation];\n      }\n\n      if (!citation) {\n        throw new Error('Unable to find a suitable citation. Please pass one explicitly or check that the reference collection is not malformed');\n      }\n\n      var config = {\n        targetEvent: $event,\n        templateUrl: 'app/components/citation-edit-dialog/citation-edit-dialog.html',\n        controller: 'CitationEditDialogController',\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          references: references,\n          citation: citation\n        }\n      };\n\n      return $mdDialog.show(config).then(function () {\n        return references;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('CitationEditDialogController', CitationEditDialogController);\n\n  /** @ngInject */\n  function CitationEditDialogController($mdDialog, references, citation) {\n    var vm = this;\n\n    vm.references = references;\n    vm.citation = citation;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdDialog.hide();\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorBibliography', ckeditorBibliographyDirective);\n\n  /** @ngInject */\n  function ckeditorBibliographyDirective($mdDialog, $document, refsRepoFactory, refsRenderer, citationEditDialog) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorBibliography;\n\n      // capture bibliography reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (refs) {\n        if (ctrl.value !== refs) {\n          ctrl.set(refs);\n        }\n      });\n\n      var CITATION_COMMAND_NAME = 'insertCitation';\n      editor.addCommand(CITATION_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'cite[id,contenteditable]',\n        requiredContent: 'cite[id,contenteditable]',\n        exec: insertCitationCommand\n      });\n\n      editor.ui.addButton('Citation', {\n        label: 'Insert Citation',\n        command: CITATION_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertCitationCommand(editor) {\n        var command = this;\n\n        // create citation object with its own ref collection for editing\n        var newReference = refsRepoFactory.createRefCollection();\n        var citation = refsRepoFactory.createCitation();\n        newReference.citations[citation.id] = citation;\n\n        citationEditDialog.show(newReference).then(function () {\n          var updatedReferences = refsRepoFactory.merge(ctrl.value, refsRepoFactory.compact(newReference));\n          angular.merge(ctrl.value, updatedReferences);\n\n          refsRenderer.render('mla', newReference).then(function (rendered) {\n            var label = rendered.citations[citation.id];\n            editor.insertHtml('<cite id=\"' + citation.id + '\" contenteditable=\"false\">' + label + '</cite>')\n            done();\n          });\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: CITATION_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroEditor', {\n      templateUrl: 'app/zotero/editor.html',\n      controller: ZoteroEditorController,\n      bindings: {\n        item: '=',\n        typeFilter: '<types'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroEditorController($q, sdaToast, zotero) {\n    var vm = this;\n\n    vm.itemTypeSearchText = '';\n    vm.itemType = null;\n\n    vm.types = [];\n    vm.fields = [];\n    vm.roles = [];\n\n    vm.selectType = selectType;\n\n    activate();\n\n    function activate() {\n      zotero.getItemTypes().then(function (types) {\n        vm.types = (vm.typeFilter && vm.typeFilter.length > 0)\n          ? types.filter(function (field) {\n              return vm.typeFilter.indexOf(field.id) >= 0;\n            })\n          : types;\n      }, function () {\n        sdaToast.error('Unable to load item type info');\n      });\n\n      if (!vm.item.creators) {\n        vm.item.creators = [{}];\n      }\n\n      if (vm.item.creators.length === 0) {\n        vm.item.creators.push({});\n      }\n    }\n\n    function selectType(itemType) {\n      if (!itemType) {\n        vm.item.itemType = null;\n        vm.fields = [];\n        vm.roles = [];\n        return;\n      }\n\n      vm.item.itemType = itemType.id;\n\n      var fieldsP = itemType.getFields()\n      fieldsP.then(function (fields) {\n        vm.fields = fields;\n      });\n\n      var creatorRolesP = itemType.getCreatorRoles();\n      creatorRolesP.then(function (roles) {\n        vm.roles = roles;\n      });\n\n      $q.all([fieldsP, creatorRolesP]).catch(function () {\n        sdaToast.error('Unable to load data for the \"' + itemType.label + '\" type.');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroCreatorField', {\n      templateUrl: 'app/zotero/creator-field.html',\n      controller: ZoteroCreatorFieldController,\n      bindings: {\n        creator: '=',\n        roles: '<'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroCreatorFieldController() {\n  }\n\n})();\n\n/*global zotero:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .factory('zotero', ZoteroFactory);\n\n  /** @ngInject */\n  function ZoteroFactory() {\n    return new zotero(zotero.getDefaultBaseUrl(), angular.toJson);\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowWorkController', ShowWorkController);\n\n  /** @ngInject */\n  function ShowWorkController($state, $stateParams, worksRepo, relnRepo, refsRepoFactory, articlesRepo, $mdDialog, sdaToast, $q, workEditDialog, copyEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.title = null;\n    vm.relationships = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.addEdition = addEdition;\n    vm.deleteEdition = deleteEdition;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.createBookReview = createBookReviewArticle;\n    vm.deleteWork = deleteWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise.then(function () {\n        vm.bcTitle = worksRepo.getTitle(vm.work.titles);\n        vm.title = worksRepo.getTitle(vm.work.titles, ['canonical', 'bibliographic', 'short']);\n        vm.anchor = relnRepo.createAnchor(worksRepo.getWorkLabel(vm.work), vm.work.ref.token);\n      });\n\n      var refsEndpointUrl = worksRepo.getReferencesEndpoint(workId);\n      refsRepo = refsRepoFactory.getRepo(refsEndpointUrl);\n      vm.references = refsRepo.get();\n      var refsPromise = vm.references.$promise;\n\n      $q.all([workPromise, refsPromise])\n        .catch(function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = workEditDialog.show($event, angular.copy(vm.work));\n\n      dialogPromise.then(function (updatedWork) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.work, updatedWork);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.work.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.work.summary = updatedSummary;\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addEdition($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Edition')\n        .textContent('Please provide a name for the new edition.')\n        .placeholder('edition name')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (editionName) {\n        var edition = worksRepo.createEdition();\n        edition.editionName = editionName;\n        edition.titles = angular.copy(vm.work.titles);\n        edition.authors = angular.copy(vm.work.authors);\n\n        vm.work.editions.push(edition);\n\n        // resolve to the created edition when save is successful\n        return worksRepo.saveEdition(vm.work.id, edition);\n      });\n\n      savePromise.then(showSavedToast, showErrorToast);\n\n      savePromise.then(function (edition) {\n        $state.go('editor.edition', { workId: vm.work.id, editionId: edition.id });\n      });\n    }\n\n    function deleteEdition(edition, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this edition?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.editions.indexOf(edition);\n          if (ix >= 0) {\n            vm.work.editions.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.work.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.work.copies.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function deleteWork($event, work) {\n      var title = worksRepo.getTitle(vm.work.titles);\n      var workLabel = title ? '\"' + title.title + (title.subtitle ? ': ' + title.subtitle : '') + '\"' : 'this work';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + workLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return worksRepo.delete(work)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        $state.go('editor');\n        return sdaToast.success(workLabel + ' has been deleted.');\n      }\n\n      function showErrorToast() {\n        return sdaToast.error('Unable to delete ' + workLabel);\n      }\n    }\n\n    function createBookReviewArticle($event, work) {\n      var title = worksRepo.getTitle(work.titles);\n\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Book Review',\n        textContent: 'You are creating a new article attached to this work. Please enter a title for this article.',\n        initialValue: title ? title.title + (title.subtitle ? ': ' + title.subtitle : '') : '[untitled work]',\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('book-review', title, work.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          return sdaToast.error('Unable to create article.');\n        });\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('workEditDialog', workEditDialogFactory);\n\n  /** @ngInject */\n  function workEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, work) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: work\n        },\n        controller: WorkEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function WorkEditDialogController($mdDialog, work) {\n    var vm = this;\n\n    vm.work = work;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.work);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.work[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.work[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.work[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.work.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.work.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.work.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowVolumeController', ShowVolumeController);\n\n  /** @ngInject */\n  function ShowVolumeController($stateParams, worksRepo, relnRepo, $mdDialog, sdaToast, $q, volumeEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.volume = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToEdition = copyToEdition;\n\n    activate();\n\n    function activate() {\n\n      var workId = $stateParams.workId\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise\n        .then(extractTitle(['short', 'canonical', 'bibliographic']))\n        .then(function (title) { vm.workTitle = title; });\n\n      var editionId = $stateParams.editionId;\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      var editionPromise = vm.edition.$promise;\n\n      var volumeId = $stateParams.volumeId;\n      vm.volume = worksRepo.getVolume(workId, editionId, volumeId);\n      var volumePromise = vm.volume.$promise;\n      volumePromise\n        .then(extractTitle(['canonical', 'bibliographic', 'short']))\n        .then(function (title) { vm.title = title; });\n\n      $q.all([workPromise, editionPromise, volumePromise])\n        .then(function () {\n          vm.anchor = relnRepo.createAnchor(worksRepo.getVolumeLabel(vm.volume, vm.edition.editionName), vm.work.ref.token, {\n            editionId: [vm.edition.id],\n            volumeId: [vm.volume.id]\n          });\n        }, function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function extractTitle(preference) {\n      return function (biblioObject) {\n        return worksRepo.getTitle(biblioObject.titles, preference);\n      };\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = volumeEditDialog.show($event, angular.copy(vm.volume));\n\n      dialogPromise.then(function (updatedVolume) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.volume, updatedVolume);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.volume.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.volume.summary = updatedSummary;\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.volume.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.volume.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.volume.copies.splice(ix, 1);\n            worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function copyToEdition(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var edition = worksRepo.getEdition(vm.work.id, vm.edition.id);\n      edition.$promise.then(function () {\n        edition.copies.push(newCopy);\n        return worksRepo.saveEdition(vm.work.id, edition);\n      }).then(showSavedToast, showErrorToast);\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('volumeEditDialog', volumeEditDialogFactory);\n\n  /** @ngInject */\n  function volumeEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, volume) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/volume-edit-dialog.html',\n        locals: {\n          volume: volume\n        },\n        controller: VolumeEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function VolumeEditDialogController($mdDialog, volume) {\n    var vm = this;\n\n    vm.volume = volume;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.volume);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.volume[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.volume[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.volume[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.volume.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.volume.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.volume.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowEditionController', ShowEditionController);\n\n  /** @ngInject */\n  function ShowEditionController($state, $stateParams, worksRepo, relnRepo, $mdDialog, sdaToast, $q, editionEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addVolume = addVolume;\n    vm.deleteVolume = deleteVolume;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToWork = copyToWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise\n        .then(extractTitle(['short', 'canonical', 'bibliographic']))\n        .then(function (title) { vm.workTitle = title; });\n\n      var editionId = $stateParams.editionId;\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      var editionPromise = vm.edition.$promise;\n      editionPromise\n        .then(extractTitle(['canonical', 'bibliographic', 'short']))\n        .then(function (title) { vm.title = title; });\n\n      $q.all([workPromise, editionPromise])\n        .then(function (){\n          vm.anchor = relnRepo.createAnchor(worksRepo.getEditionLabel(vm.edition), vm.work.ref.token, {\n            editionId: [vm.edition.id]\n          });\n        }, function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n\n    }\n\n    function extractTitle(preference) {\n      return function (biblioObject) {\n        return worksRepo.getTitle(biblioObject.titles, preference);\n      };\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = editionEditDialog.show($event, angular.copy(vm.edition));\n\n      dialogPromise.then(function (updatedEdition) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.edition, updatedEdition);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.edition.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.edition.summary = updatedSummary;\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addVolume($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Volume')\n        .textContent('Please provide a number for the new volume.')\n        .placeholder('volume number')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (volumeNumber) {\n        var volume = worksRepo.createVolume();\n        volume.volumeNumber = volumeNumber;\n        volume.titles = angular.copy(vm.edition.titles);\n        volume.authors = angular.copy(vm.edition.authors);\n        volume.publicationInfo = angular.copy(vm.edition.publicationInfo);\n\n        vm.edition.volumes.push(volume);\n\n        return worksRepo.saveVolume(vm.work.id, vm.edition.id, volume);\n      });\n\n      savePromise.then(showSavedToast, showErrorToast);\n\n      savePromise.then(function (volume) {\n        $state.go('editor.volume', { workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id });\n      });\n    }\n\n    function deleteVolume(volume, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this volume?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.volumes.indexOf(volume);\n          if (ix >= 0) {\n            vm.edition.volumes.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.edition.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.edition.copies.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function copyToWork(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var work = worksRepo.getWork(vm.work.id);\n      work.$promise.then(function () {\n        work.copies.push(newCopy);\n        return worksRepo.saveWork(work);\n      }).then(showSavedToast, showErrorToast);\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('editionEditDialog', editionEditDialogFactory);\n\n  /** @ngInject */\n  function editionEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, edition) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/edition-edit-dialog.html',\n        locals: {\n          edition: edition\n        },\n        controller: EditionEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EditionEditDialogController($mdDialog, edition) {\n    var vm = this;\n\n    vm.edition = edition;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.edition);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.edition[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.edition[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.edition[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.edition.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.edition.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.edition.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * @typedef {object} Workflow\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {object.<string, WorkflowStage>} stages\n * @property {string} status\n */\n\n/**\n * @typedef {object} WorkflowStage\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {boolean} isFinal\n * @property {WorkflowStageTransition[]} transitions\n */\n\n/**\n * @typedef {object} WorkflowStageTransition\n * @property {string} sourceStage\n * @property {string} targetStage\n * @property {string} label\n */\n\n/**\n * @typedef {object} Worklist\n * @property {string} groupId\n * @property {string} label\n * @property {integer} itemCount\n * @property {integer} start\n * @property {integer} max\n * @property {WorkItem[]} items\n */\n\n/**\n * @typedef {object} WorkItem\n * @property {string} itemId\n * @property {string} type\n * @property {string} entityId\n * @property {string} label\n * @property {object.<string,string>} properties\n * @property {string} stage\n * @property {string} task\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks')\n    .provider('tasksRepo', tasksRepoProvider);\n\n  /**\n   * @return {angular.provider}\n   */\n  function tasksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/tasks';\n    provider.$get = tasksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function tasksRepoFactory($resource) {\n      var taskResource = $resource(provider.url + '/:taskId', { taskId: '@id' });\n      var workflowResource = $resource(provider.url + '/:taskId/workflow');\n      var itemResource = $resource(provider.url + '/:taskId/items/:itemId', { itemId: '@itemId' });\n\n      var repo = {};\n      repo.getTask = getTask;\n      repo.getWorkflow = getWorkflow;\n      repo.all = getAllTasks;\n      repo.getItems = getItems;\n      repo.transition = transition;\n      return repo;\n\n      /**\n       * Retrieves a listing of all tasks\n       *\n       * @return {Task[]}\n       */\n      function getAllTasks() {\n        return taskResource.query();\n      }\n\n      /**\n       * Retrieves a task by id\n       *\n       * @param  {string} taskId\n       * @return {GroupedTaskList}\n       */\n      function getTask(taskId) {\n        return taskResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Retrieves a workflow by task id\n       * @param  {string} taskId\n       * @return {Workflow}\n       */\n      function getWorkflow(taskId) {\n        return workflowResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Gets items from the task endpoint for a given stage\n       *\n       * @param  {string}  [taskId]  Task ID\n       * @param  {string}  stageId          Workflow stage for which to get items\n       * @param  {object}  options\n       * @param  {integer} [options.start]  Starting index\n       * @param  {integer} [options.max]    Maximum number of items to fetch per page\n       * @return {Worklist}\n       */\n      function getItems(taskId, stageId, options) {\n        options = options || {};\n        return itemResource.get({\n          taskId: taskId,\n          stage: stageId,\n          start: options.start,\n          max: options.max\n        });\n      }\n\n      /**\n       * Transition an item from its current stage to a target stage\n       *\n       * @param  {WorkItem}                item   Work item instance\n       * @param  {WorkflowStageTransition} transition Target workflow stage\n       * @return {WorkItem}                       Updated work item instance\n       */\n      function transition(taskId, item, transition) {\n        if (item.stage !== transition.sourceStage) {\n          throw new Error('Transition (' + transition.sourceStage + ' -> ' + transition.targetStage + ') is not valid for item currently in stage ' + item.stage);\n        }\n\n        var result = itemResource.save({\n          taskId: taskId,\n          itemId: item.itemId\n        }, {\n          stage: transition.targetStage,\n          // NOTE comments are not saved yet\n          comments: null\n        });\n\n        // propagate updates to the original item\n        result.$promise.then(function (resp) {\n          angular.extend(item, resp);\n        });\n\n        return result;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('TaskController', TaskController);\n\n  /** @ngInject */\n  function TaskController($mdSidenav, sdaToast, tasksRepo) {\n    var vm = this;\n\n    vm.loading = false;\n\n    vm.openMenu = openMenu;\n\n    activate();\n\n    function activate() {\n      vm.loading = true;\n      vm.tasks = tasksRepo.all();\n      var tasksPromise = vm.tasks.$promise;\n\n      tasksPromise.catch(function () {\n        sdaToast.error('Unable to load tasks from server');\n      }).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowTaskController', ShowTaskController);\n\n  /** @ngInject */\n  function ShowTaskController($state, $stateParams, $mdSidenav, tasksRepo, $q, sdaToast) {\n    var vm = this;\n\n    // HACK this will eventually be made available on the workflow data model itself.\n    vm.stageOrder = [\n      'pinned',\n      'inprogress',\n      'review',\n      'pending',\n      'deferred'\n    ];\n\n    vm.loading = true;\n    vm.worklists = {};\n    vm.task = null;\n\n    vm.focusItem = focusItem;\n    vm.transition = transitionItem;\n\n    activate();\n\n    function activate() {\n      vm.taskId = $stateParams.taskId;\n\n      vm.task = tasksRepo.getTask(vm.taskId);\n      var taskPromise = vm.task.$promise;\n      taskPromise.catch(makeErrorHandler('Unable to load task data from the server.'));\n\n      vm.workflow = tasksRepo.getWorkflow(vm.taskId);\n      var workflowPromise = vm.workflow.$promise;\n      workflowPromise.catch(makeErrorHandler('Unable to load workflow data from the server.'));\n\n      var worklistPromise = workflowPromise.then(loadWorklist);\n      worklistPromise.catch(makeErrorHandler('Unable to load worklist data from the server.'));\n\n      worklistPromise.then(function () {\n        vm.loading = false;\n      });\n    }\n\n    /**\n     * Opens the given item in the work editor\n     *\n     * @param {WorkItem} item\n     * @param {Event} $event\n     */\n    function focusItem(item, $event) {\n      $event.stopImmediatePropagation();\n\n      // TODO resolve handler based on item.type\n      $state.go('editor.work', { workId: item.entityId });\n    }\n\n    /**\n     * Applies the given transition to the given item, moving it from its current stage (presumably transition.sourceStage)\n     * to the stage identified by transition.targetStage\n     *\n     * @param {WorkItem} item\n     * @param {WorkflowStageTransition} transition\n     * @param {Event} $event\n     */\n    function transitionItem(item, transition, $event) {\n      $event.stopImmediatePropagation();\n\n      var updatedItem = tasksRepo.transition(vm.taskId, item, transition);\n\n      updatedItem.$promise.then(function () {\n        var refreshPromise = $q.all([\n          fetchStage(transition.sourceStage),\n          fetchStage(transition.targetStage)\n        ]);\n\n        refreshPromise.then(function () {\n          sdaToast.success('\"' + transition.label + '\" applied successfully');\n        }, function () {\n          sdaToast.error('Unable to refresh worklist after transition');\n        });\n\n        return refreshPromise;\n      }, function () {\n        sdaToast.error('Unable to \"' + transition.label + '\" item');\n      });\n    }\n\n    /**\n     * Populates all stages of the given workflow\n     *\n     * @param {Workflow} workflow\n     * @return Promise.<Worklist[]>\n     */\n    function loadWorklist(workflow) {\n      var worklistPromises = [];\n\n      angular.forEach(workflow.stages, function (stage) {\n        var worklistPromise = fetchStage(stage.id);\n        worklistPromises.push(worklistPromise);\n      });\n\n      return $q.all(worklistPromises);\n    }\n\n    /**\n     * Fetches the worklist items for the workflow stage with the given id\n     *\n     * @param {string} id\n     * @return {Promise.<Worklist>}\n     */\n    function fetchStage(stageId) {\n      var group = tasksRepo.getItems(vm.taskId, stageId, { max: 9999 });\n\n      group.$promise.then(function () {\n        vm.worklists[stageId] = group.items.length > 0 ? group : null;\n      });\n\n      return group.$promise;\n    }\n\n    /**\n     * Makes an error handler to display the given message in an error toast\n     *\n     * @param {string} message\n     * @return {makeErrorHandler~showErrorToast}\n     */\n    function makeErrorHandler(message) {\n      return showErrorToast;\n\n      /**\n       * Shows an error toast, returning a promise that resolves when the toast is dismissed\n       *\n       * @return {Promise}\n       */\n      function showErrorToast() {\n        return sdaToast.error(message);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowPersonController', ShowPersonController);\n\n  /** @ngInject */\n  function ShowPersonController(peopleRepo, refsRepoFactory, articlesRepo, $log, $state, $stateParams, $mdDialog, sdaToast, _, personEditDialog, eventEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.person = null;\n\n    vm.editBioInfo = editBioInfo;\n    vm.editEvent = editEvent;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.createBiography = createBiographyArticle;\n    vm.deletePerson = deletePerson;\n\n    activate();\n\n    function activate() {\n      var personId = $stateParams.id;\n\n      var personRefsUrl = peopleRepo.getReferencesEndpoint(personId);\n      refsRepo = refsRepoFactory.getRepo(personRefsUrl);\n\n      vm.person = peopleRepo.get(personId);\n      vm.references = refsRepo.get();\n\n      vm.references.$promise.then(function () {\n        var citations = _.values(vm.references.citations);\n\n        if (citations.length === 0) {\n          vm.citation = refsRepo.createCitation();\n          vm.references.citations[vm.citation.id] = vm.citation;\n        } else {\n          if (citations.length > 1) {\n            $log.warn('reference collection contains ' + citations.length + ' citations');\n          }\n          vm.citation = citations[0];\n        }\n      })\n    }\n\n    function editBioInfo($event) {\n      var dialogPromise = personEditDialog.show($event, angular.copy(vm.person));\n\n      dialogPromise.then(function (updatedPerson) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person, updatedPerson);\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editEvent(field, $event) {\n      var dialogPromise = eventEditDialog.show($event, angular.copy(vm.person[field]));\n\n      dialogPromise.then(function (updatedEvent) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person[field], updatedEvent);\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.person.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.person.summary = updatedSummary;\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        var savePromise = refsRepo.save(vm.references);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function deletePerson($event, person) {\n      var nameLabel = person.name.label ? '\"' + person.name.label + '\"' : 'this person';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + nameLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return peopleRepo.delete(person)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        $state.go('editor');\n        return sdaToast.success(nameLabel + ' has been deleted.');\n      }\n\n      function showErrorToast() {\n        return sdaToast.error('Unable to delete ' + nameLabel);\n      }\n    }\n\n    function createBiographyArticle($event, person) {\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Biography',\n        textContent: 'You are creating a new article attached to this person. Please enter a title for this article.',\n        initialValue: person.name.label,\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('biography', title, person.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          return sdaToast.error('Unable to create article.');\n        });\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('personEditDialog', personEditDialogFactory);\n\n  /** @ngInject */\n  function personEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, person) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: person\n        },\n        controller: PersonEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function PersonEditDialogController(peopleRepo, $mdDialog, person) {\n    var vm = this;\n\n    vm.person = person;\n    vm.nameRoles = [\n        // { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n    ]\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addName = addName;\n    vm.deleteName = deleteName;\n\n    function close() {\n      $mdDialog.hide(vm.person);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addName() {\n      var name = peopleRepo.createName();\n      vm.person.altNames.push(name);\n    }\n\n    function deleteName(name) {\n      var ix = vm.person.altNames.indexOf(name);\n      if (ix >= 0) {\n        vm.person.altNames.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController(worksRepo, peopleRepo, $state, $stateParams, $mdSidenav, _, $q, personEditDialog, workEditDialog, sdaToast) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.searchQuery = '';\n\n    vm.openMenu = openMenu;\n    vm.createPerson = createPerson;\n    vm.createWork = createWork;\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      if ($stateParams.q) {\n        vm.searchQuery = $stateParams.q;\n        search(vm.searchQuery);\n      }\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      $q.all([\n        vm.peopleResults.$promise,\n        vm.worksResults.$promise\n      ])\n        .then(function () {\n          vm.loading = false;\n        }, function () {\n          sdaToast.error('Unable to load data from the server');\n        });\n    }\n\n    function createPerson($event) {\n      var person = peopleRepo.create();\n      var dialogPromise = personEditDialog.show($event, person)\n\n      dialogPromise.then(function (person) {\n        var savePromise = peopleRepo.save(person);\n\n        savePromise.then(showSavedToast, showErrorToast);\n\n        savePromise.then(function (person) {\n          $state.go('editor.person', { id: person.id });\n        });\n\n        return savePromise;\n      });\n\n    }\n\n    function createWork($event) {\n      var work = worksRepo.createWork();\n      var dialogPromise = workEditDialog.show($event, work);\n\n      dialogPromise.then(function (work) {\n        var savePromise = worksRepo.saveWork(work);\n\n        savePromise.then(showSavedToast, showErrorToast);\n\n        savePromise.then(function (work) {\n          $state.go('editor.work', { workId: work.id });\n        });\n\n        return savePromise;\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved.');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save.')\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($mdThemingProvider) {\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock(trcAuth) {\n    if (!trcAuth.isAuthenticated()) {\n      trcAuth.loginGuest();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('editor', {\n        url: '/?q',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'vm'\n      })\n\n      .state('editor.person', {\n        url: 'people/:id',\n        views: {\n          main: {\n            templateUrl: 'app/person/person.html',\n            controller: 'ShowPersonController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('editor.work', {\n        url: 'works/:workId',\n        views: {\n          main: {\n            templateUrl: 'app/work/work.html',\n            controller: 'ShowWorkController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.edition', {\n        url: 'works/:workId/editions/:editionId',\n        views: {\n          main: {\n            templateUrl: 'app/work/edition.html',\n            controller: 'ShowEditionController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.volume', {\n        url: 'works/:workId/editions/:editionId/volumes/:volumeId',\n        views: {\n          main: {\n            templateUrl: 'app/work/volume.html',\n            controller: 'ShowVolumeController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('article', {\n        url: '/articles',\n        templateUrl: 'app/admin/editors/articles/article.html',\n        controller: 'ArticleEditorSectionController',\n        controllerAs: 'vm'\n      })\n\n      .state('article.edit', {\n        url: '/:id',\n        templateUrl: 'app/admin/editors/articles/article-editor.html',\n        controller: 'ArticleEditorController',\n        controllerAs: 'vm'\n      })\n\n      .state('about', {\n        url: '/about',\n        templateUrl: 'app/admin/editors/about/about.html',\n        controller: 'AboutEditorSectionController',\n        controllerAs: 'vm'\n      })\n\n      .state('about.edit', {\n        url: '/:id',\n        templateUrl: 'app/admin/editors/about/about-editor.html',\n        controller: 'AboutEditorController',\n        controllerAs: 'vm'\n      })\n\n      .state('task', {\n        url: '/task',\n        templateUrl: 'app/task/task.html',\n        controller: 'TaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('task.show', {\n        url: '/:taskId',\n        templateUrl: 'app/task/show.html',\n        controller: 'ShowTaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('vwise', {\n        url: '/vwise/:workspaceId',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      })\n\n      .state('zotero', {\n        url: '/zotero',\n        templateUrl: 'app/zotero/test/test.html',\n        controller: 'ZoteroTestController',\n        controllerAs: 'vm'\n      });\n\n\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, $httpProvider,\n                  tasksRepoProvider,\n                  worksRepoProvider,\n                  peopleRepoProvider,\n                  articlesRepoProvider,\n                  relnRepoProvider,\n                  categorizationServiceProvider,\n                  seeAlsoRepoProvider,\n                  trcSearchProvider,\n                  trcAuthProvider,\n                  trcAuthInterceptorProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // API endpoints\n    var API_PREFIX = '/api/catalog';\n\n    tasksRepoProvider.url = API_PREFIX + '/v1/tasks';\n    worksRepoProvider.url = API_PREFIX + '/works';\n    peopleRepoProvider.url = API_PREFIX + '/people';\n    articlesRepoProvider.url = API_PREFIX + '/entries/articles';\n    relnRepoProvider.url = API_PREFIX + '/relationships';\n    categorizationServiceProvider.url = API_PREFIX + '/categorizations';\n    seeAlsoRepoProvider.url = API_PREFIX + '/seealso';\n    trcSearchProvider.url = API_PREFIX + '/search';\n\n    // authentication\n    trcAuthProvider.loginUrl = API_PREFIX + '/accounts/auth';\n    trcAuthProvider.loginGuestUrl = API_PREFIX + '/accounts/authguest';\n    trcAuthInterceptorProvider.url = new RegExp('^' + API_PREFIX, 'i');\n    $httpProvider.interceptors.push('trcAuthInterceptor');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(cslConfig);\n\n  var CSL_LOCALES = {\n    'en-US': 'en-US'\n  };\n\n  var CSL_STYLES = {\n    mla: 'modern-language-association',\n    chicago: 'chicago-author-date'\n  };\n\n  /** @ngInject */\n  function cslConfig(citeprocProvider, refsRendererProvider) {\n    refsRendererProvider.typemapUrl = '/assets/typemap/zotero-csl.json';\n    angular.forEach(CSL_LOCALES, addLocale);\n    angular.forEach(CSL_STYLES, addStyle);\n\n    function addLocale(filename, localeId) {\n      citeprocProvider.addLocale(localeId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/locales/locales-' + filename + '.xml').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n\n    function addStyle(filename, styleId) {\n      citeprocProvider.addStyle(styleId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/styles/' + filename + '.csl').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n  }\n\n})();\n\nangular.module(\"sdaAdmin\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<md-content flex layout=column> <navbar title=\\\"Editorial Tools\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" ui-view=sidebar layout=column> <form layout=row flex=none> <md-input-container flex> <label for=searchQuery>Search</label> <md-icon>search</md-icon> <input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required> </md-input-container> </form> <md-content flex> <div ng-if=vm.loading layout=row layout-align=center> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"> <md-subheader>People</md-subheader> <md-list> <md-list-item ng-repeat=\\\"person in vm.peopleResults.items\\\" ui-sref=\\\"editor.person({id: person.id})\\\"> <div class=md-list-item-text ng-bind-html=person.label></div> </md-list-item> </md-list> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"> <md-subheader>Works</md-subheader> <md-list> <md-list-item ng-repeat=\\\"work in vm.worksResults.items\\\" ui-sref=\\\"editor.work({workId: work.id})\\\"> <div class=md-list-item-text ng-bind-html=work.label></div> </md-list-item> </md-list> </div> </md-content> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Person\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createPerson($event)> <md-tooltip md-direction=left>New Person</md-tooltip> <md-icon>person</md-icon> </md-button> <md-button aria-label=\\\"New Work\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createWork($event)> <md-tooltip md-direction=left>New Book</md-tooltip> <md-icon>book</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view=main></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/task/show.html\",\"<md-content flex layout=column> <div class=task-info> <span class=label>{{vm.task.label}}</span> <span class=description>{{vm.task.description}}</span> </div> <md-input-container> <label>Search</label> <md-icon>search</md-icon> <input type=search ng-model=filter ng-change=vm.search(filter)> </md-input-container> <md-content flex> <div layout=row layout-align=\\\"center center\\\" ng-if=vm.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-repeat=\\\"stageId in vm.stageOrder\\\" ng-if=vm.worklists[stageId]> <md-subheader>{{vm.workflow.stages[stageId].label}}</md-subheader> <md-list> <md-list-item ng-repeat=\\\"item in vm.worklists[stageId].items | filter : filter | limitTo : 20\\\" ng-mouseover=\\\"item.hover = true\\\" ng-mouseout=\\\"item.hover = false\\\" ng-click=\\\"vm.focusItem(item, $event)\\\"> <span ng-bind-html=item.label></span> <span flex></span> <md-button class=md-exclude ng-repeat=\\\"transition in vm.workflow.stages[stageId].transitions\\\" ng-click=\\\"vm.transition(item, transition, $event)\\\" ng-show=item.hover> <span>{{transition.label}}</span> </md-button> </md-list-item> </md-list> </div> </md-content> </md-content>\");\n$templateCache.put(\"app/task/task.html\",\"<md-content flex layout=column> <navbar title=\\\"Task Management Dashboard\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <div ng-if=vm.loading flex layout=row layout-align=\\\"center center\\\"> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <md-list ng-if=!vm.loading> <md-list-item ng-repeat=\\\"task in vm.tasks\\\" ui-sref=\\\"task.show({ taskId: task.id })\\\"> {{ task.label }} </md-list-item> </md-list> </md-sidenav> <md-content flex layout=column ui-view> <div layout=row layout-padding layout-margin layout-align=\\\"center center\\\"> <div class=md-headline>Please select a task from the sidebar.</div> </div> </md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/person/person-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Biographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=name layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Canonical Name</h2> </div> </md-toolbar> <div class=name> <name-editor ng-model=vm.person.name flex></name-editor> </div> </section> <section class=alt-names layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Alternate Names</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addName()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=name layout=row ng-repeat=\\\"name in vm.person.altNames\\\"> <md-input-container> <label>role</label> <md-select ng-model=name.role> <md-option ng-repeat=\\\"role in vm.nameRoles\\\" value={{role.value}}> {{role.label}} </md-option> </md-select> </md-input-container> <name-editor ng-model=name flex></name-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteName(name)> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/person/person.html\",\"<div layout=row layout-padding flex=noshrink> <div flex=60> <section class=\\\"content names\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h1 class=content-heading>{{vm.person.name.label}}</h1> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBioInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <div ng-if=\\\"vm.person.altNames && vm.person.altNames.length > 0\\\"> <p>Other names:</p> <ul> <li ng-repeat=\\\"name in vm.person.altNames\\\">{{name.label}}</li> </ul> </div> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.person.summary ng-bind-html=vm.person.summary></p> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div flex=40> <section class=\\\"content birth\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Birth</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'birth\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.birth.date.description>{{vm.person.birth.date.description}}</span> <span class=location ng-if=vm.person.birth.location>in {{vm.person.birth.location}}</span> </p> <p ng-bind-html=vm.person.birth.description ng-if=vm.person.birth.description></p> </section> <section class=\\\"content death\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Death</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'death\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.death.date.description>{{vm.person.death.date.description}}</span> <span class=location ng-if=vm.person.death.location>in {{vm.person.death.location}}</span> </p> <p ng-bind-html=vm.person.death.description ng-if=vm.person.death.description></p> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.person.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button aria-label=\\\"Create Biography\\\" class=md-icon-button ng-click=\\\"vm.createBiography($event, vm.person)\\\"> <md-icon>assignment_ind</md-icon> <md-tooltip md-direction=top>Create Biography</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this person\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deletePerson($event, vm.person)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/work/edition-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=vm.edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/edition.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li>{{vm.edition.editionName}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.edition.authors && vm.edition.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.edition.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.edition.publicationInfo> <span ng-if=vm.edition.publicationInfo.place> <span class=place>{{vm.edition.publicationInfo.place}}</span>: </span> <span ng-if=vm.edition.publicationInfo.publisher> <span class=publisher>{{vm.edition.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.edition.publicationInfo.date> <time class=date datetime={{vm.edition.publicationInfo.date.calendar}}>{{vm.edition.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.edition.summary ng-bind-html=vm.edition.summary></p> </section> <section class=\\\"content volumes\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addVolume($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"volume in vm.edition.volumes\\\" ui-sref=\\\"editor.volume({workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id})\\\"> <span>Volume {{volume.volumeNumber}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteVolume(volume, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.edition.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToWork(copy) aria-label=\\\"copy to parent work\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Work</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/volume-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=vm.volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/volume.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li><a ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: vm.edition.id})\\\">{{vm.edition.editionName}}</a></li> <li>Volume {{vm.volume.volumeNumber}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.volume.authors && vm.volume.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.volume.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.volume.publicationInfo> <span ng-if=vm.volume.publicationInfo.place> <span class=place>{{vm.volume.publicationInfo.place}}</span>: </span> <span ng-if=vm.volume.publicationInfo.publisher> <span class=publisher>{{vm.volume.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.volume.publicationInfo.date> <time class=date datetime={{vm.volume.publicationInfo.date.calendar}}>{{vm.volume.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.volume.summary ng-bind-html=vm.volume.summary></p> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.volume.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToEdition(copy) aria-label=\\\"copy to parent edition\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Edition</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/work-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/work.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li>{{vm.bcTitle.title}}{{vm.bcTitle && vm.bcTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.bcTitle.subtitle}}</li> </ol> </nav> <div layout=row layout-padding flex=noshrink> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.work.authors && vm.work.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.work.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.work.summary ng-bind-html=vm.work.summary></p> </section> <section class=\\\"content editions\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addEdition($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"edition in vm.work.editions | orderBy:\\'publicationInfo.date.calendar\\'\\\" ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: edition.id})\\\"> <span>{{edition.editionName}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteEdition(edition, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.work.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.work.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button class=md-icon-button aria-label=\\\"Create Book Review\\\" ng-click=\\\"vm.createBookReview($event, vm.work)\\\"> <md-icon>assignment</md-icon> <md-tooltip md-direction=top>Create Book Review</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this work\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deleteWork($event, vm.work)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/creator-field.html\",\"<div layout=row layout-margin> <md-input-container> <label>Role</label> <md-select ng-model=$ctrl.creator.creatorType ng-disabled=\\\"!$ctrl.roles || $ctrl.roles.length == 0\\\"> <md-option ng-value=role.role ng-repeat=\\\"role in $ctrl.roles\\\">{{role.label}}</md-option> </md-select> </md-input-container> <md-input-container ng-if=verbatim flex> <label>Name</label> <input type=text ng-model=$ctrl.creator.name> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>First Name</label> <input type=text ng-model=$ctrl.creator.firstName> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>Last Name</label> <input type=text ng-model=$ctrl.creator.lastName> </md-input-container> <div layout=column layout-align=\\\"center center\\\"> <md-button ng-show=verbatim ng-click=\\\"verbatim = false\\\" class=md-icon-button aria-label=\\\"First/Last Names\\\"> <md-icon>people</md-icon> <md-tooltip>First/Last Names</md-tooltip> </md-button> <md-button ng-hide=verbatim ng-click=\\\"verbatim = true\\\" class=md-icon-button aria-label=\\\"Single Name\\\"> <md-icon>domain</md-icon> <md-tooltip>Single Name</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/editor.html\",\"<div layout=column flex> <div layout=row layout-margin> <md-autocomplete md-search-text=$ctrl.itemTypeSearchText md-items=\\\"type in $ctrl.types | filter: {label: $ctrl.itemTypeSearchText}\\\" md-item-text=type.label md-selected-item=$ctrl.itemType md-selected-item-change=$ctrl.selectType($ctrl.itemType) md-min-length=0 md-floating-label=\\\"Item Type\\\" required> <md-item-template> <span md-highlight-text=$ctrl.itemTypeSearchText md-highlight-flags=^i>{{type.label}}</span> </md-item-template> </md-autocomplete> </div> <div layout=row ng-repeat=\\\"creator in $ctrl.item.creators\\\" layout-align=\\\"start center\\\"> <zotero-creator-field creator=creator roles=$ctrl.roles flex></zotero-creator-field> <md-button ng-click=\\\"$ctrl.item.creators.splice($index+1, 0, {})\\\" class=md-icon-button aria-label=\\\"New Creator\\\"> <md-icon>add</md-icon> <md-tooltip>New</md-tooltip> </md-button> <md-button ng-disabled=\\\"$ctrl.item.creators.length <= 1\\\" ng-click=\\\"$ctrl.item.creators.splice($index, 1)\\\" class=\\\"md-icon-button md-warn\\\" aria-label=\\\"Delete Creator\\\"> <md-icon>remove</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </div> <div layout=row layout-margin ng-repeat=\\\"field in $ctrl.fields\\\"> <md-input-container flex> <label>{{field.label}}</label> <input type=text ng-model=$ctrl.item[field.id]> </md-input-container> </div> <div ng-if=!$ctrl.itemType layout-margin> <p>Please select an item type first.</p> </div> </div>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-edit-dialog.html\",\"<md-dialog aria-label=\\\"Edit Citation\\\" flex=50 layout=column> <form ng-cloak> <md-toolbar> <div class=md-toolbar-tools> <h2>Edit Citation</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon aria-label=Cancel>close</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class=md-dialog-content> <citation-editor references=vm.references citation=vm.citation></citation-editor> </div> </md-dialog-content> <md-dialog-actions layout=row> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-editor.html\",\"<div class=citation-editor-layout layout=column flex> <div class=citation-editor-container ng-hide=$ctrl.zoteroItem layout=column flex> <div layout=row layout-wrap> <div layout=row layout-align=\\\"start center\\\" layout-margin class=md-whiteframe-2dp ng-repeat=\\\"item in $ctrl.citation.items\\\"> <span ng-bind-html=item.label></span> <md-button class=md-icon-button aria-label=Edit ng-click=$ctrl.edit(item)> <md-icon>edit</md-icon> <md-tooltip>Edit Item</md-tooltip> </md-button> <md-button class=\\\"md-icon-button md-warn\\\" aria-label=Remove ng-click=\\\"$ctrl.citation.items.splice($index, 1)\\\"> <md-icon>remove</md-icon> <md-tooltip>Remove Item</md-tooltip> </md-button> </div> </div> <div layout=column> <md-autocomplete md-autoselect md-floating-label=\\\"Referenced Item\\\" md-selected-item=$ctrl.selectedBiblioItem md-selected-item-change=$ctrl.selectBiblioItem($ctrl.selectedBiblioItem) md-search-text=$ctrl.searchText md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-delay=200 md-require-match required> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found> No matches found. <md-button ng-click=$ctrl.createZoteroItem($event)>Create</md-button> </md-not-found> </md-autocomplete> <div layout=row> <md-input-container> <label>Locator Type</label> <md-select ng-model=$ctrl.activeCitationItem.locatorType> <md-option></md-option> <md-option ng-repeat=\\\"type in $ctrl.locatorTypes\\\" ng-value=type>{{type}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label>Locator</label> <input type=text ng-model=$ctrl.activeCitationItem.locator> </md-input-container> </div> <md-checkbox ng-model=$ctrl.activeCitationItem.suppressAuthor> Suppress Author Name in In-Text Citation </md-checkbox> </div> <div layout=row layout-align=end> <md-button class=md-raised ng-click=$ctrl.addCitationItem($ctrl.activeCitationItem)> Save Item </md-button> </div> </div> <div class=zotero-item-editor-container ng-if=$ctrl.zoteroItem layout=row flex> <div layout=column> <md-button class=md-icon-button ng-click=$ctrl.cancelZoteroItem($event)> <md-icon>cancel</md-icon> <md-tooltip md-direction=right>Cancel New Item</md-tooltip> </md-button> <md-button class=md-icon-button ng-click=\\\"$ctrl.saveZoteroItem($event, $ctrl.zoteroItem)\\\"> <md-icon>check_circle</md-icon> <md-tooltip md-direction=right>Save and Cite Item</md-tooltip> </md-button> </div> <zotero-editor item=$ctrl.zoteroItem flex></zotero-editor> </div> </div>\");\n$templateCache.put(\"app/components/ckeditor-footnotes/footnote-edit-dialog.html\",\"<md-bottom-sheet aria-label=\\\"Insert Footnote\\\" layout=column> <md-toolbar> <div class=md-toolbar-tools> <h2>Insert Footnote</h2> <span flex></span> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </div> </md-toolbar> <div ng-if=vm.references ng-model=vm.footnote.content ckeditor=vm.ckeditorConfig ckeditor-bibliography=vm.references></div> <div ng-if=!vm.references ng-model=vm.footnote.content ckeditor=vm.ckeditorConfig></div> </md-bottom-sheet>\");\n$templateCache.put(\"app/components/date-editor/date-editor.html\",\"<div layout=row> <md-input-container flex> <label>date</label> <input type=text ng-model=date.description> </md-input-container> <md-input-container flex> <label>calendar date</label> <input type=datetime ng-model=date.calendar ng-change=\\\"calendarAutoSet = false\\\"> </md-input-container> </div>\");\n$templateCache.put(\"app/components/navbar/navbar.html\",\"<md-toolbar> <div class=md-toolbar-tools> <md-button ng-if=$ctrl.sidenavId class=\\\"md-accent md-icon-button\\\" ng-click=$ctrl.toggleSidenav($ctrl.sidenavId) title=\\\"toggle menu\\\" hide-gt-sm> <md-icon>menu</md-icon> </md-button> <img class=logo src=assets/images/sda-logo-light.png> <h2> <span>{{$ctrl.title}}</span><!-- make this change based on page --> </h2> <span flex></span> <md-button ui-sref=editor>People and Works</md-button> <md-button ui-sref=article>Articles</md-button> <md-button ui-sref=about>About Pages</md-button> <md-button ui-sref=task>Tasks</md-button> </div> </md-toolbar>\");\n$templateCache.put(\"app/components/see-also-editor/see-also-editor.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.seeAlso\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load links from the server. </div> </div> <div layout=column ng-if=\\\"!$ctrl.loading && $ctrl.seeAlso\\\"> <md-list ng-if=\\\"!($ctrl.seeAlso.links | empty)\\\"> <div ng-repeat=\\\"(type, targets) in $ctrl.seeAlso.links\\\"><!-- The type key is a machine identifier (e.g. \\'trc.entries.bibliographic\\')\\n      <md-subheader>{{type}}</md-subheader> --> <md-list-item ng-repeat=\\\"target in targets\\\" ng-click=\\\"$ctrl.openLink($event, target)\\\"> <span ng-bind-html=target.label></span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" aria-label=\\\"delete link\\\" ng-click=\\\"$ctrl.deleteLink($event, target)\\\"> <md-icon>delete</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </md-list-item> </div> </md-list> <div ng-if=\\\"$ctrl.seeAlso.links | empty\\\"> No links added. Add one below. </div> <form layout=row novalidate name=newLink ng-submit=$ctrl.createLink($ctrl.selectedItem)> <md-autocomplete md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-search-text=$ctrl.searchText md-selected-item=$ctrl.selectedItem md-selected-item-change=$ctrl.createLink($ctrl.selectedItem) md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"add link\\\" md-select-on-match md-match-case-insensitive flex> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete><!-- link creation occurs on autocomplete selected item change\\n    <md-button type=\\\"submit\\\" class=\\\"md-icon-button\\\" ng-disabled=\\\"!$ctrl.selectedItem\\\">\\n      <md-icon>add</md-icon>\\n      <md-tooltip>Add Link</md-tooltip>\\n    </md-button>\\n    --> </form> </div>\");\n$templateCache.put(\"app/components/summary-edit-dialog/summary-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Summary Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content><!-- material-compliant padding not used since WYSIWYG text editor *is* the UI --> <summary-editor ng-model=vm.summary></summary-editor> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/summary-editor/summary-editor.html\",\"<div ckeditor ng-model=summary></div>\");\n$templateCache.put(\"app/zotero/test/test.html\",\"<div layout=column flex> <md-content> <zotero-editor item=vm.item types=vm.types></zotero-editor> </md-content> </div>\");\n$templateCache.put(\"app/admin/editors/about/about-categorization-editor.html\",\"<div id=about_hierarchy> <script type=text/ng-template id=aboutHierarchyItem.html><div class=\\\"category-node\\\" layout=\\\"row\\\" layout-align=\\\"start center\\\">\\n     <span ng-if=\\\"node.entryRef == null\\\" class=\\\"node-label\\\">{{ node.label }}</span>\\n     <a ui-sref=\\\"about.edit({id:node.entryRef.id})\\\" ng-if=\\\"node.entryRef != null\\\" class=\\\"node-label\\\">{{ node.label }}</a>\\n\\n     <span flex></span>\\n\\n     <md-menu class=\\\"action\\\">\\n       <md-button ng-click=\\\"$mdOpenMenu($event)\\\" class=\\\"md-icon-button\\\">\\n         <md-icon>arrow_drop_down</md-icon>\\n       </md-button>\\n\\n       <md-menu-content>\\n         <md-menu-item ng-if=\\\"!node.entryRef.id\\\">\\n           <md-button ng-click=\\\"vm.handleAssociateEntry($event, node)\\\">\\n             <md-icon>add_circle_outline</md-icon>\\n             Create Page\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleCreateChild($event, node)\\\">\\n             <md-icon>create_new_folder</md-icon>\\n             Create Sub-Category\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleDeleteNode($event, node, parent)\\\">\\n             <md-icon>delete{{ node.children.length == 0 ? \\'\\' : \\'_sweep\\' }}</md-icon>\\n             Remove Category\\n           </md-button>\\n         </md-menu-item>\\n       </md-menu-content>\\n     </md-menu>\\n   </div>\\n\\n   <ol ng-if=\\\"node.children.length > 0\\\">\\n     <li ng-repeat=\\\"node in node.children\\\" ng-include=\\\"\\'aboutHierarchyItem.html\\'\\\" ng-init=\\\"parent = $parent.$parent.node\\\"></li>\\n   </ol></script> <ol> <li ng-repeat=\\\"node in vm.hierarchy.root.children\\\" ng-include=\\\"\\'aboutHierarchyItem.html\\'\\\" ng-init=\\\"parent = vm.hierarchy.root\\\"></li> </ol> <div layout=row layout-align=\\\"center center\\\"> <md-button ng-click=\\\"vm.handleCreateChild($event, vm.hierarchy.root)\\\" class=md-raised aria-label=\\\"create category\\\">Create Category</md-button> </div> </div>\");\n$templateCache.put(\"app/admin/editors/about/about-editor.html\",\"<div flex layout=column layout-padding><!-- title editor bar --> <md-content layout=row flex=none> <md-input-container class=no-space flex> <label>Title</label> <input type=text ng-model=vm.article.title> </md-input-container> <div flex=none> <md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button> </div> </md-content> <div id=article_editor flex=noshrink layout=column> <div ng-model=vm.article.body ckeditor=vm.editor.config></div> </div> </div>\");\n$templateCache.put(\"app/admin/editors/about/about.html\",\"<md-content flex layout=column> <navbar title=About sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <md-tabs flex> <md-tab> <md-tab-label> <md-icon>format_list_bulleted</md-icon> <md-tooltip md-direction=bottom>Page Hierarchy</md-tooltip> </md-tab-label> <md-tab-body> <about-categorization-editor scope-id=sda scheme=about></about-categorization-editor> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>search</md-icon> <md-tooltip md-direction=bottom>Search</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=about on-click-article=vm.editAboutPage(article)></article-type-search> </md-tab-body> </md-tab> </md-tabs> </md-sidenav> <md-content flex layout=column ui-view></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/admin/editors/articles/article-editor.html\",\"<div flex layout=column layout-padding><!-- title editor bar --> <md-content layout=row flex=none> <md-input-container class=no-space flex> <label>Title</label> <input type=text ng-model=vm.article.title> </md-input-container> <div flex=none> <md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button> </div> </md-content> <div layout=column flex=none class=authors> <h3 layout=row> <span>Authors</span> <span flex></span> <span> <md-button class=md-icon-button aria-label=\\\"add author\\\" ng-click=vm.article.authors.push({})> <md-icon>add</md-icon> <md-tooltip>Add Author</md-tooltip> </md-button> </span> </h3> <div layout=row ng-repeat=\\\"author in vm.article.authors\\\"> <article-author-editor author=author flex></article-author-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.article.authors.splice($index, 1)\\\" ng-if=\\\"vm.article.authors.length > 1\\\"> <md-icon>delete</md-icon> <md-tooltip>Remove Author</md-tooltip> </md-button> </div> </div><!-- TODO add save button and auto-save --><!-- TODO add sidebar for notes, biblio, links, etc --> <div id=article_editor flex=noshrink layout=column> <div ng-model=vm.article.body ckeditor=vm.editor.config ckeditor-bibliography=vm.references ckeditor-footnotes=vm.article.footnotes> </div> <md-tabs flex=noshrink> <md-tab label=Abstract> <div ckeditor=vm.abstractEditor.config ng-model=vm.article.abstract></div> </md-tab> <md-tab label=Bibliography> <bibliography refs=vm.references style-id=mla></bibliography> </md-tab> <md-tab label=Footnotes> <div class=footnotes ng-repeat=\\\"footnote in vm.article.footnotes\\\" layout=row> <div class=footnote ng-bind-html=footnote.content flex></div> <md-button class=md-icon-button aria-label=\\\"edit footnote\\\" ng-click=\\\"vm.editFootnote($event, footnote)\\\"> <md-icon>edit</md-icon> <md-tooltip>Edit Footnote</md-tooltip> </md-button> </div> </md-tab> <md-tab label=\\\"See Also\\\"> <see-also-editor source-token=vm.article.ref.token></see-also-editor> </md-tab> </md-tabs> </div><!-- TODO how to make this fill all available space --> </div>\");\n$templateCache.put(\"app/admin/editors/articles/article.html\",\"<md-content flex layout=column> <navbar title=Articles sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <md-tabs flex> <md-tab> <md-tab-label> <md-icon>format_list_bulleted</md-icon> <md-tooltip md-direction=bottom>Thematic Overviews</md-tooltip> </md-tab-label> <md-tab-body> <tree-categorization-editor scope-id=sda scheme=overviews> </tree-categorization-editor> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>school</md-icon> <md-tooltip md-direction=bottom>Research Articles</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=research on-click-article=vm.editArticle(article)></article-type-search> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>book</md-icon> <md-tooltip md-direction=bottom>Book Reviews</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=book-review on-click-article=vm.editArticle(article)></article-type-search> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>person</md-icon> <md-tooltip md-direction=bottom>Biographies</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=biography on-click-article=vm.editArticle(article)></article-type-search> </md-tab-body> </md-tab> </md-tabs> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Research Article\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'research\\')\\\"> <md-tooltip md-direction=left>New Research Article</md-tooltip><!-- <md-icon>description</md-icon> --> <md-icon>school</md-icon> </md-button> <md-button aria-label=\\\"New Book Review\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'book-review\\')\\\"> <md-tooltip md-direction=left>New Book Review</md-tooltip> <md-icon>book</md-icon> </md-button> <md-button aria-label=\\\"New Biography\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'biography\\')\\\"> <md-tooltip md-direction=left>New Biography</md-tooltip> <md-icon>person</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/admin/editors/articles/thematic-overview.html\",\"<div id=thematic_overviews> <script type=text/ng-template id=treeCategoryEntry.html><div class=\\\"category-node\\\" layout=\\\"row\\\" layout-align=\\\"start center\\\">\\n     <!--  Display label for the category node-->\\n     <span ng-if=\\\"node.entryRef == null\\\" class=\\\"node-label\\\">{{ node.label }}</span>\\n     <a ui-sref=\\\"article.edit({id:node.entryRef.id})\\\" ng-if=\\\"node.entryRef != null\\\" class=\\\"node-label\\\">{{ node.label }}</a>\\n\\n     <!-- push buttons to edge -->\\n     <span flex></span>\\n\\n     <!-- node action menu -->\\n     <md-menu class=\\\"action\\\">\\n       <!-- activate handle -->\\n       <md-button ng-click=\\\"$mdOpenMenu($event)\\\" class=\\\"md-icon-button\\\">\\n         <md-icon>arrow_drop_down</md-icon>\\n       </md-button>\\n\\n       <md-menu-content>\\n         <!-- Associate/Remove  -->\\n         <md-menu-item>\\n           <md-button ng-if=\\\"node.entryRef.id == null\\\"\\n                      ng-click=\\\"vm.handleAssociateEntry($event, node)\\\">\\n             <md-icon>add_circle_outline</md-icon>\\n             Create Article\\n           </md-button>\\n           <md-button ng-if=\\\"node.entryRef.id != null\\\"\\n                      ng-click=\\\"vm.handleRemoveEntry($event, node)\\\">\\n             <md-icon>remove_circle_outline</md-icon>\\n             Remove Article\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleCreateChild($event, node)\\\">\\n             <!-- Will create a child node at the end of this list. User can drag to re-arrange -->\\n             <md-icon>create_new_folder</md-icon>\\n             Create Sub-Category\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleDeleteNode($event, node, parent)\\\">\\n             <!-- Will delete this node, all children and associated articles. If leaf node,\\n             displays delete instead of delete sweep. Prompts user to confirm. -->\\n             <md-icon>delete{{ node.children.length == 0 ? \\'\\' : \\'_sweep\\' }}</md-icon>\\n             Remove Category\\n           </md-button>\\n         </md-menu-item>\\n       </md-menu-content>\\n     </md-menu>\\n   </div>\\n\\n   <ol ng-if=\\\"node.children.length > 0\\\">\\n     <li ng-repeat=\\\"node in node.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = $parent.$parent.node\\\"></li>\\n   </ol></script> <ol> <li ng-repeat=\\\"node in vm.overviews.root.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = vm.overviews.root\\\"></li> </ol> <div layout=row layout-align=\\\"center center\\\"><!-- TODO need additional styling --> <md-button ng-click=\\\"vm.handleCreateChild($event, vm.overviews.root)\\\" class=md-raised aria-label=\\\"create category\\\">Create Category</md-button> </div> </div>\");\n$templateCache.put(\"app/task/components/edition-editor/edition-editor.html\",\"<div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.titles.push({})> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=edition.summary flex></summary-editor> </section> <section class=volumes> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createVolume()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=volume layout=column layout-margin ng-repeat=\\\"volume in vm.volumes\\\" ng-class=\\\"{\\'md-whiteframe-2dp\\': !volume.focused, \\'md-whiteframe-8dp\\': volume.focused}\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"volume.focused = !volume.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>Volume {{volume.model.volumeNumber}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteVolume($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=volume.focused> <volume-editor ng-model=volume.model flex></volume-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in edition.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/volume-editor/volume-editor.html\",\"<div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <h2>Publication Information</h2> <publication-info-editor ng-model=volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <h2 layout=row> <span flex>Titles</span> <md-button class=md-icon-button ng-click=volume.titles.push({})> <md-icon>add</md-icon>  </md-button></h2> <div class=title layout=row ng-repeat=\\\"title in volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <h2 layout=row> <span flex>Authors</span> <md-button class=md-icon-button ng-click=volume.authors.push({})> <md-icon>add</md-icon> </md-button> </h2> <div class=author layout=row ng-repeat=\\\"author in volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=volume.summary flex></summary-editor> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=volume.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in volume.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor/work-editor.html\",\"<section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.titles.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Summary</h2> </div> </md-toolbar> <summary-editor ng-model=work.summary flex></summary-editor> </section> <section class=editions> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createEdition()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=edition layout=column layout-margin ng-repeat=\\\"edition in vm.editions | orderBy:\\'publicationInfo.date.calendar\\'\\\" ng-class=\\\"{ \\'md-whiteframe-2dp\\': !edition.focused, \\'md-whiteframe-8dp\\': edition.focused }\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"edition.focused = !edition.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>{{edition.model.editionName}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteEdition($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=edition.focused> <edition-editor ng-model=edition.model flex></edition-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in work.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor-item/work-editor-item.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=!vm.loaded> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=vm.loaded> <work-editor ng-model=vm.work></work-editor> </div>\");\n$templateCache.put(\"app/person/components/event-edit-dialog/event-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Event Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <event-editor ng-model=vm.event flex></event-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/person/components/event-editor/event-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex> <label>location</label> <input type=text ng-model=event.location> </md-input-container> <date-editor ng-model=event.date flex></date-editor> </div> <div layout=row layout-padding> <div flex> <h2>Description</h2> <div flex ckeditor ng-model=event.description></div> </div> </div> </div>\");\n$templateCache.put(\"app/person/components/name-editor/name-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex=10> <label>title</label> <input type=text ng-model=name.title> </md-input-container> <md-input-container flex=30> <label>given</label> <input type=text ng-model=name.givenName> </md-input-container> <md-input-container flex=20> <label>middle</label> <input type=text ng-model=name.middleName> </md-input-container> <md-input-container flex=30> <label>family</label> <input type=text ng-model=name.familyName> </md-input-container> <md-input-container flex=10> <label>suffix</label> <input type=text ng-model=name.suffix> </md-input-container> </div> <md-input-container> <label>display label</label> <input type=text ng-model=name.label required> </md-input-container> </div>\");\n$templateCache.put(\"app/work/components/author-ref-editor/author-ref-editor.html\",\"<div layout=column> <div layout=row> <md-autocomplete required md-items=\\\"item in vm.authorRoles\\\" md-item-text=role md-min-length=0 md-search-text=ref.role md-selected-item-change=\\\"ref.role = item\\\" md-floating-label=role> <md-item-template> <span md-highlight-text=ref.role>{{item}}</span> </md-item-template> </md-autocomplete> <md-input-container flex> <label>first name</label> <input type=text ng-model=ref.firstName> </md-input-container> <md-input-container flex> <label>last name</label> <input type=text ng-model=ref.lastName> </md-input-container> </div> <div layout=row> <md-autocomplete flex md-items=\\\"person in vm.getResults(vm.linkAuthorSearchText)\\\" md-item-text=\\\"person.label | stripTags\\\" md-search-text=vm.linkAuthorSearchText md-search-text-change=vm.searchPeople(vm.linkAuthorSearchText) md-selected-item-change=vm.setLinkedAuthor(person) md-floating-label=\\\"linked author\\\"> <md-item-template> <span ng-bind-html=person.label></span> </md-item-template> <md-not-found>No matches found.</md-not-found> </md-autocomplete> </div> </div>\");\n$templateCache.put(\"app/work/components/copy-edit-dialog/copy-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Digital Copy Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <copy-editor ng-model=vm.copy></copy-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/copy-editor/copy-editor.html\",\"<ng-form name=copyForm layout=column flex> <md-input-container> <label for=title>Title</label> <input type=text name=title id=title ng-model=copy.title> </md-input-container> <div layout=row> <md-input-container> <label for=type>Type</label> <md-select name=type id=type ng-model=copy.type required ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> <md-option ng-repeat=\\\"handler in vm.refHandlers\\\" value={{handler.id}}>{{handler.display}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label for=url>URL</label> <input type=url name=url id=url ng-model=copyUrl ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> </md-input-container> </div> <ul class=\\\"properties properties-inline\\\"> <li ng-repeat=\\\"(key, value) in copy.properties\\\"> <span class=label>{{key}}</span> <span class=value>{{value}}</span> </li> </ul> <md-input-container> <label for=rights>Description of Rights</label> <input type=text name=rights id=rights ng-model=copy.rights> </md-input-container> <h3>Summary</h3> <summary-editor ng-model=copy.summary flex></summary-editor> </ng-form>\");\n$templateCache.put(\"app/work/components/publication-info-editor/publication-info-editor.html\",\"<div layout=row> <md-input-container flex> <label>publisher</label> <input type=text ng-model=pubInfo.publisher> </md-input-container> <md-input-container flex> <label>location</label> <input type=text ng-model=pubInfo.place> </md-input-container> <date-editor ng-model=pubInfo.date flex></date-editor> </div>\");\n$templateCache.put(\"app/work/components/relationships/relationships.html\",\"<div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Relationships</h2> <span flex></span> <md-button class=md-icon-button ng-click=$ctrl.addRelationship($event) ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups\\\"> <md-icon>add</md-icon> </md-button> </div> <div ng-repeat=\\\"type in $ctrl.typeGroups\\\" ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups.length > 0\\\"> <h3 class=content-heading>{{type.label}}</h3> <md-list><!-- TODO: clicking on relationship should open that relationship in an editor; clicking on an anchor should go to the linked item --> <md-list-item ng-repeat=\\\"reln in type.relationships\\\" ng-click=\\\"$ctrl.openRelationship($event, reln)\\\"> <span ng-repeat=\\\"anchor in reln.anchors\\\" ng-bind-html=anchor.label></span> <md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"$ctrl.deleteRelationship($event, reln)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </div> <div ng-if=\\\"$ctrl.typeGroups && $ctrl.typeGroups.length == 0\\\"> No relationships to display. </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.typeGroups\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load relationships from the server. </div> </div> <div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div>\");\n$templateCache.put(\"app/work/components/reln-edit-dialog/reln-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Relationship Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form name=relationship ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content layout=column> <md-input-container> <label>type</label> <md-select name=type ng-model=vm.selectedType required> <md-option ng-repeat=\\\"type in vm.types\\\" ng-value=type> {{type.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.type.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <md-autocomplete md-items=\\\"work in vm.search(vm.searchText)\\\" md-search-text=vm.searchText md-selected-item=vm.selectedWork md-selected-item-change=vm.selectWork(work) md-item-text=\\\"work.label | stripTags\\\" md-require-match md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"search works\\\" md-select-on-match md-match-case-insensitive> <md-item-template> <span ng-bind-html=work.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete> <md-input-container ng-if=\\\"vm.anchors.length > 1\\\"> <label>target</label> <md-select name=target ng-model=vm.selectedAnchor required> <md-option ng-repeat=\\\"anchor in vm.anchors\\\" ng-value=anchor> {{anchor.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.target.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <div class=summary> <h2>Summary</h2> <div ckeditor ng-model=vm.description></div> </div> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/title-editor/title-editor.html\",\"<div layout=row> <md-input-container> <label>type</label> <md-select ng-model=title.type required> <md-option value=bibliographic>bibliographic</md-option> <md-option value=canonical>canonical</md-option> <md-option value=short>short</md-option> </md-select> </md-input-container> <md-input-container flex> <label>title</label> <input type=text ng-model=title.title required> <div ng-switch=title.type> <small ng-switch-when=bibliographic>the full title as published on the work</small> <small ng-switch-when=canonical>title by which the work is commonly known in the academic realm</small> <small ng-switch-when=short>shortened title coloquially used by the public</small> </div> </md-input-container> <md-input-container flex> <label>subtitle</label> <input type=text ng-model=title.subtitle> </md-input-container> </div>\");\n$templateCache.put(\"app/admin/editors/articles/components/article-author-editor/article-author-editor.html\",\"<div layout=column layout-gt-sm=row layout-align-gt-sm=\\\"start center\\\"> <div layout=row layout-align=\\\"start center\\\" flex-gt-sm> <md-button class=md-icon-button ng-click=\\\"$ctrl.institution = !$ctrl.institution\\\"> <md-icon>{{$ctrl.institution ? \\'person\\' : \\'domain\\'}}</md-icon> </md-button> <div layout=row flex ng-show=$ctrl.institution> <md-input-container class=no-space flex> <label>name</label> <input type=text ng-model=$ctrl.author.name> </md-input-container> </div> <div layout=row flex ng-hide=$ctrl.institution> <md-input-container class=no-space flex> <label>first name</label> <input type=text ng-model=$ctrl.author.firstname> </md-input-container> <md-input-container class=no-space flex> <label>last name</label> <input type=text ng-model=$ctrl.author.lastname> </md-input-container> </div> </div> <div layout=row flex-gt-sm> <md-input-container class=no-space flex> <label>affiliation</label> <input type=text ng-model=$ctrl.author.properties.affiliation> </md-input-container> <md-input-container class=no-space flex> <label>email</label> <input type=text ng-model=$ctrl.author.properties.email> </md-input-container> </div> </div>\");}]);"],"sourceRoot":"/source/"}