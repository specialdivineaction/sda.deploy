{"version":3,"sources":["scripts/app.js"],"names":["angular","module","workspaceRepositoryProvider","vwise","workspaceRepositoryFactory","panelContentMediatorRegistry","$http","$q","NgWorkspaceRepository","provider","url","$inject","declare","$get","mediatorRegistry","WorkspaceRepository","call","this","workspaces","Cache","panels","prototype","Object","create","createWorkspace","title","id","UUID","uuid4","workspace","Workspace","when","saveWorkspace","TypeError","getWorkspace","reject","Error","createPanel","mediator","content","repo","panel","Panel","p","savePanel","getPanel","workspaceId","panelId","workPanelDirective","worksRepo","linkFunc","scope","getTitle","work","titles","editions","forEach","edition","type","workId","directive","restrict","templateUrl","relationships","link","volumePanelDirective","volume","getEdition","editionId","editionPanelDirective","volumes","personPanelDirective","_","name","person","label","at","NAME_KEYS","map","n","trim","filter","identity","join","worksContentMediatorFactory","relationshipsRepo","Mediator","PanelContentMediator","loadWork","get","$promise","loadRelationships","currentUri","results","search","then","normalizeRelationships","group","reln","entities","entity","refParams","volumeId","matches","obj","initPanelData","all","unmarshall","dto","marshall","panelData","getTemplate","factory","volumesContentMediatorFactory","loadVolume","getVolume","peopleContentMediatorFactory","peopleRepo","loadPerson","passthruContentMediatorFactory","panelContentMediatorRegistryFactory","PanelContentMediatorRegistry","noteContentMediatorFactory","hasOwnProperty","editionsContentMediatorFactory","loadEdition","internetArchiveContentMediatorFactory","hathitrustContentMediatorFactory","googleBooksContentMediatorFactory","vwisePanel","$compile","$scope","$el","attrs","$eval","panelScope","$new","vprops","$watch","color","match","r","parseInt","g","b","foreground","calculateForeground","template","contentMediator","contentArea","find","html","contents","Math","pow","lum","iaReader","$sce","properties","src","trustAsResourceUrl","replace","hathitrustReader","params","htid","ui","seq","queryString","value","key","READER_URL","WorkspaceController","workspaceRepository","$log","$timeout","$mdSidenav","hotkeys","activate","vm","items","push","text","bindTo","add","combo","description","callback","sidebarFocused","searchQuery","element","focus","toggle","createNotePanel","query","tagAll","arr","loading","peopleResults","worksResults","property","panelDragged","evt","xPosition","position","left","yPosition","max","top","savePanelPosition","debug","setPosition","activatePanel","resizePanel","width","helper","height","$apply","savePanelSize","setSize","stopPropagation","closePanel","remove","thingDropped","itemScope","draggable","item","offsetX","context","contentMediators","findContentMediators","length","contentP","panelP","set","x","y","note","workspaceClicked","ctrlKey","clientX","clientY","activeItems","debounce","controller","runBlock","peopleContentMediator","worksContentMediator","editionsContentMediator","volumesContentMediator","googleBooksContentMediator","hathitrustContentMediator","internetArchiveContentMediator","noteContentMediator","passthruContentMediator","register","run","constant","config","googleBooksApiProvider","configure","preventLoad","relationshipsRepoProvider","relationshipsRepoFactory","$resource","getTypes","options","typesCache","force","types","typeResource","tcPromise","identifier","defineProperty","getType","createRelationship","relnResource","adaptRelationship","createProvenance","provenance","adaptProvenance","createAnchor","anchor","adaptAnchor","findById","isString","uri","queryOpts","typeId","direction","start","off","saveRelationship","$update","$save","deleteRelationship","response","relatedEntities","targetEntities","creatorUris","entryUris","normalizedRelationships","relationship","isReverse","some","targetField","reduce","flattened","concat","resolveEntityUri","reverse","relnsByTypeDir","fwd","rev","typeGroups","typeGroupPs","dirs","promise","isDirected","reverseTitle","ENTITY_URI","exec","makeVolumeEntity","makeEditionEntity","makeWorkEntity","update","method","save","subtitle","editionName","volumeNumber","getWork","worksRepoProvider","worksRepoFactory","findAll","restResource","q","isUndefined","adaptWork","editionResource","adaptEdition","volumeResource","adaptVolume","createWork","authors","createEdition","createVolume","arguments","saveWork","apply","saveEdition","saveVolume","deleteWork","dataItem","adaptCommon","toLowerCase","author","role","otherAuthors","copies","getTitleByTypePreference","isArray","found","getAll","peopleRepoProvider","peopleRepoFactory","createPerson","adaptPerson","createMeta","meta","adaptMeta","createName","adaptName","createEvent","adaptEvent","createDateDescription","dateDescription","savePerson","personId","deletePerson","altNames","birth","death","links","date","trcPersonEditorDirective","PersonEditorController","addName","newName","removeName","ix","splice","addEvent","newEvent","removeEvent","controllerAs","trcNameEditorDirective","NameEditorController","roles","trcEventEditorDirective","event","extend","API","loadGoogleBooks","googleBooksScriptLoader","load","transport","v","language","$window","$document","getScriptUrl","includeScript","omitOptions","omit","k","scriptId","scriptElem","getElementById","parentNode","removeChild","round","random","appendTo","isGoogleBooksLoaded","isDefined","google","books","deferred","defer","resolve","randomizedFunctionName","usedConfiguration","manualLoad","undefined","googleBookReader","googleBooksApi","googleBooksApiManualLoader","el","viewer","DefaultViewer","$on","resize","service","routerConfig","$stateProvider","$urlRouterProvider","state","otherwise","moment","$logProvider","$mdThemingProvider","debugEnabled","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","$templateCache","put"],"mappings":"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","file":"scripts/app-318d982c73.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('vwise', [\n      'google.books',\n      'cfp.hotkeys',\n      'trcWorks',\n      'trcBio'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .provider('workspaceRepository', workspaceRepositoryProvider);\n\n  /** @ngInject */\n  function workspaceRepositoryProvider(vwise) {\n    var NgWorkspaceRepository = declare(vwise);\n\n    var provider = {\n      url: '/api/vwise',\n      $get: workspaceRepositoryFactory\n    };\n\n    return provider;\n\n    /** @ngInject */\n    function workspaceRepositoryFactory(panelContentMediatorRegistry, $http, $q) {\n      return new NgWorkspaceRepository(panelContentMediatorRegistry, provider.url, $http, $q);\n    }\n  }\n\n  /**\n   * Declares and returns the NgWorkspaceRepository class.\n   * Required protoypical inheritance of vwise.WorkspaceRepository makes this class definition verbose but necessary.\n   * Ideally (and eventually) this should be done as an ES6 class in a separate file and loaded via an import statement.\n   * @param  {vwise} vwise\n   * @return {Class.<NgWorkspaceRepository>}\n   */\n  function declare(vwise) {\n    /**\n     * Angularized Workspace Repository; makes use of $http, and $q services (must be injected at construction)\n     * @class\n     * @extends {vwise.WorkspaceRepository}\n     */\n    function NgWorkspaceRepository(mediatorRegistry, url, $http, $q) {\n      vwise.WorkspaceRepository.call(this, mediatorRegistry);\n\n      // injected services and configuration options\n      this.$http = $http;\n      this.$q = $q;\n      this.url = url;\n\n      /**\n       * A cache for storing loaded workspace instances\n       * @type {vwis.Cache.<Promise.<Workspace>}\n       */\n      this.workspaces = new vwise.Cache;\n\n      /**\n      * A cache for storing loaded panel instances\n      * @type {vwis.Cache.<Promise.<Panel>}\n      */\n      this.panels = new vwise.Cache;\n    }\n\n    NgWorkspaceRepository.prototype = Object.create(vwise.WorkspaceRepository.prototype);\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.createWorkspace = function createWorkspace(title) {\n      var id = vwise.UUID.uuid4();\n      var workspace = new vwise.Workspace(id, this);\n\n      if (title) {\n        workspace.title = title;\n      }\n\n      this.workspaces[workspace.id] = workspace;\n      return this.$q.when(workspace);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.saveWorkspace = function saveWorkspace(workspace) {\n      if (!(workspace instanceof vwise.Workspace)) {\n        throw new TypeError('expected instance of Workspace');\n      }\n\n      this.workspaces[workspace.id] = workspace;\n      return this.$q.when(workspace);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.getWorkspace = function getWorkspace(id) {\n      return this.workspaces[id] ? this.$q.when(this.workspaces[id]) : this.$q.reject(new Error('workspace not found'));\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.createPanel = function createPanel(mediator, workspace, content) {\n      var id = vwise.UUID.uuid4();\n      var repo = this;\n      var panel = new vwise.Panel(id, mediator, workspace, content, function (p) {\n        repo.savePanel(p);\n      });\n\n      this.panels[panel.id] = panel;\n      return this.$q.when(panel);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.savePanel = function savePanel(panel) {\n      if (!(panel instanceof vwise.Panel)) {\n        throw new TypeError('expected instance of Panel');\n      }\n\n      this.panels[panel.id] = panel;\n      return this.$q.when(panel);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.getPanel = function getPanel(workspaceId, panelId) {\n      return this.panels[panelId] ? this.$q.when(this.panels[panelId]) : this.$q.reject(new Error('panel not found'));\n    };\n\n    return NgWorkspaceRepository;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('workPanel', workPanelDirective);\n\n  /** @ngInject */\n  function workPanelDirective(worksRepo) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/work-panel/work-panel.html',\n      scope: {\n        work: '=',\n        relationships: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.title = worksRepo.getTitle(scope.work.titles);\n\n      scope.work.editions.forEach(function (edition) {\n        edition.type = 'edition';\n        edition.workId = scope.work.id;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('volumePanel', volumePanelDirective);\n\n  /** @ngInject */\n  function volumePanelDirective(worksRepo) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/work-panel/volume-panel.html',\n      scope: {\n        volume: '=',\n        workId: '@',\n        editionId: '@'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.title = worksRepo.getTitle(scope.volume.titles);\n\n      scope.edition = worksRepo.getEdition(scope.workId, scope.editionId);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('editionPanel', editionPanelDirective);\n\n  /** @ngInject */\n  function editionPanelDirective(worksRepo) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/work-panel/edition-panel.html',\n      scope: {\n        edition: '=',\n        workId: '@'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.title = worksRepo.getTitle(scope.edition.titles);\n\n      scope.edition.volumes.forEach(function (volume) {\n        volume.type = 'volume';\n        volume.workId = scope.workId;\n        volume.editionId = scope.edition.id;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('personPanel', personPanelDirective);\n\n  var NAME_KEYS = ['title', 'givenName', 'middleName', 'familyName', 'suffix'];\n\n  /** @ngInject */\n  function personPanelDirective(_) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/person-panel/person-panel.html',\n      scope: {\n        person: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      var name = scope.person.name;\n\n      scope.name = name.label || _.at(name, NAME_KEYS)\n        .map(function (n) { return n.trim(); })\n        .filter(_.identity)\n        .join(' ');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('worksContentMediator', worksContentMediatorFactory);\n\n  /** @ngInject */\n  function worksContentMediatorFactory($q, vwise, worksRepo, relationshipsRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'works', 'Works Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'work' && obj.id;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return $q.all({\n        work: loadWork(obj.id),\n        relationships: loadRelationships(obj.id)\n      });\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return $q.all({\n        work: loadWork(dto.id),\n        relationships: loadRelationships(dto.id)\n      });\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'work',\n        id: panelData.id\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<work-panel work=\"content.work\" relationships=\"content.relationships\" flex layout=\"column\"></work-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadWork(id) {\n      var work = worksRepo.get(id);\n      return work.$promise;\n    }\n\n    function loadRelationships(workId) {\n      var currentUri = 'works/' + workId;\n      var results = relationshipsRepo.search(currentUri);\n      return results.$promise.then(function () {\n        var relationships = relationshipsRepo.normalizeRelationships(results, currentUri, worksRepo);\n        return relationships.$promise.then(function () {\n\n          relationships.forEach(function (group) {\n            group.relationships.forEach(function (reln) {\n              reln.entities.forEach(function (entity) {\n\n                entity.entity.$promise.then(function () {\n                  entity.title = worksRepo.getTitle(entity.entity.titles);\n                });\n\n                switch(entity.type) {\n                  case 'work':\n                    entity.id = entity.refParams.workId;\n                    break;\n                  case 'edition':\n                    entity.workId = entity.refParams.workId;\n                    entity.id = entity.refParams.editionId;\n                    break;\n                  case 'volume':\n                    entity.workId = entity.refParams.workId;\n                    entity.editionId = entity.refParams.editionId;\n                    entity.id = entity.refParams.volumeId;\n                    break;\n                }\n              });\n            });\n          });\n\n          return relationships;\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('volumesContentMediator', volumesContentMediatorFactory);\n\n  /** @ngInject */\n  function volumesContentMediatorFactory(vwise, worksRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'volumes', 'Volumes Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'volume' && obj.id && obj.workId && obj.editionId;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadVolume(obj.workId, obj.editionId, obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadVolume(dto.workId, dto.editionId, dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'volume',\n        id: panelData.id,\n        workId: panelData.workId,\n        editionId: panelData.editionId\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<volume-panel volume=\"content\" edition-id=\"{{content.editionId}}\" work-id=\"{{content.workId}}\" flex layout=\"column\"></volume-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadVolume(workId, editionId, volumeId) {\n      var volume = worksRepo.getVolume(workId, editionId, volumeId);\n      return volume.$promise.then(function () {\n        volume.workId = workId;\n        volume.editionId = editionId;\n        return volume;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('peopleContentMediator', peopleContentMediatorFactory);\n\n  /** @ngInject */\n  function peopleContentMediatorFactory(vwise, peopleRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'people', 'People Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'person' && obj.id;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadPerson(obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadPerson(dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'person',\n        id: panelData.id\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<person-panel person=\"content\" flex layout=\"column\"></person-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadPerson(id) {\n      var person = peopleRepo.get(id);\n      return person.$promise;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('passthruContentMediator', passthruContentMediatorFactory);\n\n  /** @ngInject */\n  function passthruContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'passthru', 'Pass-Through Debug Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches() {\n      return true;\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('panelContentMediatorRegistry', panelContentMediatorRegistryFactory);\n\n  /** @ngInject */\n  function panelContentMediatorRegistryFactory(vwise) {\n    return new vwise.PanelContentMediatorRegistry();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('noteContentMediator', noteContentMediatorFactory);\n\n  /** @ngInject */\n  function noteContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'notes', 'Note Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.hasOwnProperty('note');\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<div ng-model=\"content.note\" contenteditable flex></div>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('editionsContentMediator', editionsContentMediatorFactory);\n\n  /** @ngInject */\n  function editionsContentMediatorFactory(vwise, worksRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'editions', 'Editions Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'edition' && obj.id && obj.workId;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadEdition(obj.workId, obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadEdition(dto.workId, dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'edition',\n        id: panelData.id,\n        workId: panelData.workId\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<edition-panel edition=\"content\" work-id=\"{{content.workId}}\" flex layout=\"column\"></edition-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadEdition(workId, editionId) {\n      var edition = worksRepo.getEdition(workId, editionId);\n      return edition.$promise.then(function () {\n        edition.workId = workId;\n        return edition;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('internetArchiveContentMediator', internetArchiveContentMediatorFactory);\n\n  /** @ngInject */\n  function internetArchiveContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'ia-reader', 'Internet Archive Digital Copy mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'internetarchive';\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<ia-reader properties=\"content.properties\" flex></ia-reader>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('hathitrustContentMediator', hathitrustContentMediatorFactory);\n\n  /** @ngInject */\n  function hathitrustContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'ht-reader', 'HathiTrust Digital Copy mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'hathitrust';\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<hathitrust-reader properties=\"content.properties\" flex></hathitrust-reader>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('googleBooksContentMediator', googleBooksContentMediatorFactory);\n\n  /** @ngInject */\n  function googleBooksContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'gb-reader', 'Google Books Digital Copy mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'googlebooks';\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<google-book-reader properties=\"content.properties\" flex></google-book-reader>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('vwisePanel', vwisePanel);\n\n  /** @ngInject */\n  function vwisePanel ($compile) {\n    var directive = {\n      restrict: 'A',\n      templateUrl: 'app/vwise/components/panel/panel.html',\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc($scope, $el, attrs) {\n      var panel = $scope.$eval(attrs.vwisePanel);\n      if (!panel) {\n        throw new Error('no panel provided');\n      }\n\n      var panelScope = $scope.$new(true);\n      panelScope.content = panel.content;\n      panelScope.vprops = panel.vprops;\n\n      panelScope.$watch('vprops.background', function (color) {\n        var match = color.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);\n\n        if (!match) {\n          return;\n        }\n\n        // Foreground calculation from http://stackoverflow.com/a/3943023\n\n        // calculate luminance coefficient\n        // see https://en.wikipedia.org/wiki/Luma_(video)#Rec._601_luma_versus_Rec._709_luma_coefficients\n        var r = parseInt(match[1], 16) / 255;\n        var g = parseInt(match[2], 16) / 255;\n        var b = parseInt(match[3], 16) / 255;\n\n        panel.vprops.foreground = calculateForeground(r, g, b);\n      });\n\n      var template = panel.contentMediator.getTemplate();\n\n      var contentArea = $el.find('.content');\n      contentArea.html(template);\n      $compile(contentArea.contents())(panelScope);\n    }\n  }\n\n  function calculateForeground(r, g, b) {\n    r = (r <= 0.03928) ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);\n    g = (g <= 0.03928) ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);\n    b = (b <= 0.03928) ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);\n\n    var lum = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n\n    // set contrast color based on W3C recommendations\n    // see https://www.w3.org/TR/WCAG20/\n\n    // panel.vprops.foreground = (lum > 0.179) ? '#000000' : '#ffffff';\n    // adjusted so that #808080 is the transition point between FG colors\n    return (lum > 0.215) ? 'rgba(0,0,0,0.87)' : 'rgba(255,255,255,0.87)';\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('vwise')\n      .directive('iaReader', iaReader);\n\n   /** @ngInject */\n   function iaReader($sce) {\n      var directive = {\n         restrict: 'E',\n         template: '<iframe ng-src=\"{{src}}\">',\n         replace: true,\n         link: linkFunc,\n         scope: {\n            properties: '='\n         }\n      };\n\n      return directive;\n\n      function linkFunc(scope) {\n        scope.$watch('properties', function(properties) {\n           // TODO add page link\n            //  <iframe class=\"reader flex\" src=\"https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n5/mode/2up\" frameborder=\"0\"></iframe>\n           scope.src = $sce.trustAsResourceUrl('https://archive.org/stream/' + properties.id + '?ui=embed#mode/2up');\n        });\n      }\n   }\n\n})();\n\n(function () {\n   'use strict';\n\n   var READER_URL = 'https://babel.hathitrust.org/cgi/pt';\n\n   angular\n      .module('vwise')\n      .directive('hathitrustReader', hathitrustReader);\n\n   /** @ngInject */\n   function hathitrustReader($sce, _) {\n      var directive = {\n         restrict: 'E',\n         template: '<iframe ng-src=\"{{src}}\">',\n         replace: true,\n         link: linkFunc,\n         scope: {\n            properties: '='\n         }\n      };\n\n      return directive;\n\n      function linkFunc(scope) {\n         scope.$watch('properties', function (properties) {\n            var params = {\n               id: properties.htid,\n               ui: 'embed'\n            };\n\n            if (properties.seq) {\n               params.seq = properties.seq;\n            }\n\n            var queryString = _.map(params, function (value, key) {\n               return key + '=' + value;\n            }).join(';');\n\n            var url = READER_URL + '?' + queryString;\n\n            scope.src = $sce.trustAsResourceUrl(url);\n         });\n      }\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .controller('WorkspaceController', WorkspaceController);\n\n  /** @ngInject */\n  function WorkspaceController(vwise, panelContentMediatorRegistry, workspaceRepository, $log, $scope, $timeout, $mdSidenav, hotkeys, _, $q, peopleRepo, worksRepo) {\n    var vm = this;\n\n    vm.workspace = new vwise.Workspace('test', workspaceRepository);\n\n    vm.items = [];\n    vm.activeItems = [];\n    vm.searchQuery = '';\n    vm.sidebarFocused = true;\n\n    vm.panelDragged = panelDragged;\n    vm.savePanelPosition = savePanelPosition;\n    vm.thingDropped = thingDropped;\n    vm.workspaceClicked = workspaceClicked;\n    vm.resizePanel = resizePanel;\n    vm.savePanelSize = savePanelSize;\n    vm.activatePanel = activatePanel;\n    vm.closePanel = closePanel;\n\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      [1,2,3,4].forEach(function (n) {\n        vm.items.push({\n          id: 'panel' + n,\n          label: 'Item ' + n,\n          text: 'This is the text content for item #' + n\n        });\n      });\n\n      hotkeys.bindTo($scope)\n        .add({\n          combo: 'ctrl+\\\\',\n          description: 'Toggle Sidebar',\n          callback: function () {\n            vm.sidebarFocused = !vm.sidebarFocused;\n          }\n        })\n        .add({\n          combo: '/',\n          description: 'Search',\n          callback: function () {\n            vm.searchQuery = '';\n            if (vm.sidebarFocused) {\n              $timeout(function () {\n                // prevent key event from typing in field\n                angular.element('#searchQuery').focus();\n              });\n            } else {\n              $mdSidenav('left').toggle();\n            }\n          }\n        })\n        .add({\n          combo: 'n',\n          description: 'Create a new note panel',\n          callback: function () {\n            createNotePanel(100, 100);\n          }\n        });\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      // TODO delegate to registered external search/content providers\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      function tagAll(key, value) {\n        return function (arr) {\n          arr.forEach(function (obj) {\n            obj[key] = value;\n          });\n          return arr;\n        };\n      }\n\n      $q.all([\n        vm.peopleResults.$promise.then(_.property('items')).then(tagAll('type', 'person')),\n        vm.worksResults.$promise.then(_.property('items')).then(tagAll('type', 'work'))\n      ])\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    /**\n     * Drag callback for when a panel is moved\n     * @param {Event}  evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel}  panel VWISE Panel instance being moved\n     */\n    function panelDragged(evt, ui, panel) {\n      panel.vprops.xPosition = ui.position.left;\n      panel.vprops.yPosition = Math.max(0, ui.position.top);\n    }\n\n    /**\n     * Drag callback for when a panel has been dropped after moving\n     * @param {Event} evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel} panel VWISE Panel instance being moved\n     */\n    function savePanelPosition(evt, ui, panel) {\n      // TODO: jQuery UI supports 'containment' option...\n      var top = Math.max(0, ui.position.top);\n\n      $log.debug('saving panel position at', [ui.position.left, top]);\n\n      panel.setPosition(ui.position.left, top);\n      activatePanel(panel);\n    }\n\n    /**\n     * Drag callback for when a panel's resize handle is moved\n     * @param {Event}  evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel}  panel VWISE Panel instance being resized\n     */\n    function resizePanel(evt, ui, panel) {\n      var width = ui.position.left + ui.helper.width();\n      var height = ui.position.top + ui.helper.height();\n\n      $scope.$apply(function () {\n        panel.vprops.width = Math.max(0, width);\n        panel.vprops.height = Math.max(0, height);\n      });\n    }\n\n    /**\n     * Drag callback for when a panel's resize handle has been dropped\n     * @param {Event}  evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel}  panel VWISE Panel instance being resized\n     */\n    function savePanelSize(evt, ui, panel) {\n      var width = ui.position.left + ui.helper.width();\n      var height = ui.position.top + ui.helper.height();\n\n      $log.debug('saving panel size at', [width, height]);\n\n      $scope.$apply(function () {\n        panel.setSize(Math.max(0, width), Math.max(0, height));\n      })\n    }\n\n    /**\n     * Raises a panel to the top of the workspace stack\n     * @param {Panel} panel\n     * @param {Event} evt\n     */\n    function activatePanel(panel, evt) {\n      panel.activate();\n\n      if (evt && evt.stopPropagation) {\n        evt.stopPropagation();\n      }\n    }\n\n    /**\n     * Removes a panel from the workspace\n     * @param {Panel} panel\n     */\n    function closePanel(panel) {\n      panel.remove();\n    }\n\n    /**\n     * Drop callback for when something is droppen on the workspace content ariea\n     * @param  {Event}  evt DOM Event\n     * @param  {Object} ui  jQuery UI draggable callback data\n     */\n    function thingDropped(evt, ui) {\n      // get scope of object that was dropped\n      var itemScope = ui.draggable.scope();\n\n      // here's the data object of the panel we want to create\n      // scope variable is bound by ng-repeat on md-list in md-sidenav (see workspace.html)\n      var item = itemScope.item;\n\n      // if no item is available (e.g. if a panel was dropped)\n      if (!item) {\n        return;\n      }\n\n      var offsetX = angular.element('.md-sidenav-left').width();\n\n      var context = {\n        xPosition: ui.position.left - offsetX,\n        yPosition: ui.position.top\n      };\n\n      // who is capable of handling the dropped item\n      var contentMediators = panelContentMediatorRegistry.findContentMediators(item, context);\n      $log.debug('found ' + contentMediators.length + ' matching content mediator(s).');\n      var mediator = contentMediators.length > 0 ? contentMediators[0] : null;\n\n      if (!mediator) {\n        return;\n      }\n\n      var contentP = mediator.initPanelData(item, context);\n      var panelP = contentP.then(function (content) {\n        return vm.workspace.createPanel(mediator, content);\n      });\n\n      // set initial panel attributes\n      panelP.then(function (panel) {\n        $log.debug('created new panel');\n        panel.setPosition(context.xPosition, context.yPosition);\n        panel.setSize(600, 400);\n        panel.set('background', '#ffffff');\n      });\n    }\n\n    /**\n     * Creates a new note panel at the desired position\n     * @param {integer} x\n     * @param {integer} y\n     */\n    function createNotePanel(x, y) {\n      var note = {\n        note: ''\n      };\n\n      var context = {\n        xPosition: x,\n        yPosition: y\n      };\n\n      var contentMediators = panelContentMediatorRegistry.findContentMediators(note, context);\n      var mediator = contentMediators.length > 0 ? contentMediators[0] : null;\n      vm.workspace.createPanel(mediator, note).then(function (panel) {\n        panel.setPosition(context.xPosition, context.yPosition);\n      });\n    }\n\n    function workspaceClicked(evt) {\n      var offsetX = angular.element('.md-sidenav-left').width();\n\n      if (evt.ctrlKey) {\n        createNotePanel(evt.clientX - offsetX, evt.clientY);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock(panelContentMediatorRegistry, peopleContentMediator, worksContentMediator, editionsContentMediator, volumesContentMediator, googleBooksContentMediator, hathitrustContentMediator, internetArchiveContentMediator, noteContentMediator, passthruContentMediator) {\n    panelContentMediatorRegistry.register(peopleContentMediator);\n    panelContentMediatorRegistry.register(worksContentMediator);\n    panelContentMediatorRegistry.register(editionsContentMediator);\n    panelContentMediatorRegistry.register(volumesContentMediator);\n    panelContentMediatorRegistry.register(googleBooksContentMediator);\n    panelContentMediatorRegistry.register(hathitrustContentMediator);\n    panelContentMediatorRegistry.register(internetArchiveContentMediator);\n    panelContentMediatorRegistry.register(noteContentMediator);\n    panelContentMediatorRegistry.register(passthruContentMediator);\n  }\n\n})();\n\n/*global vwise:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .constant('vwise', vwise);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .config(config);\n\n  /** @ngInject */\n  function config(googleBooksApiProvider) {\n    googleBooksApiProvider.configure({ preventLoad: true });\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcReln', [\n      'ngResource'\n    ]);\n\n})();\n\n// NOTE: this entire API model *WILL* eventually change\n\n/**\n * @typedef Relationship\n * @type {object}\n * @property {string}     id                  - A unique identifier for this relationship\n * @property {string}     typeId              - The ID of the RelationshipType of this relationship\n * @property {string}     description         - A detailed description of this relationship\n * @property {string}     descriptionMimeType - MIME type string of the description\n * @property {Provenance} provenance          - Metadata about the relationship record\n * @property {Anchor[]}   relatedEntities     - A set of \"source\" anchors\n * @property {Anchor[]}   targetEntities      - A set of \"target\" anchors\n */\n\n/**\n * @typedef RelationshipType\n * @type {object}\n * @property {string}  identifier   - A unique identifier for this type\n * @property {string}  title        - A label to display for this type\n * @property {string}  reverseTitle - If this type is directed, the label to display for reverse relationships\n * @property {string}  description  - A more detailed description of this type\n * @property {boolean} isDirected   - Whether this type is directed (true) or undirected (false)\n */\n\n/**\n * @typedef Provenance\n * @type {object}\n * @property {string[]} creatorUris  - URIs to people/authors of this relationship\n * @property {string}   dateCreated  - an ISO 8601 date representation of when the record was created\n * @property {string}   dateModified - an ISO 8601 date representation of when the record was last modified\n */\n\n/**\n * @typedef Anchor\n * @type {object}\n * @property {string[]} entryUris[] - URIs to work/edition/volume\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcReln')\n    .provider('relationshipsRepo', relationshipsRepoProvider);\n\n  function relationshipsRepoProvider() {\n    var provider = {};\n    provider.url = '/api/relationships';\n    provider.$get = relationshipsRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function relationshipsRepoFactory($q, $resource) {\n      var typeResource = $resource(provider.url + '/types/:id', { id: '@identifier' });\n      var relnResource = $resource(provider.url + '/:id', { id: '@id' }, {\n        update: { method: 'PUT' }\n      });\n\n      var typesCache = null;\n\n      var repo = {};\n      repo.getTypes = getTypes;\n      repo.getType = getType;\n      repo.createRelationship = createRelationship;\n      repo.createProvenance = createProvenance;\n      repo.createAnchor = createAnchor;\n      repo.get = findById;\n      repo.search = search;\n      repo.save = saveRelationship;\n      repo.delete = deleteRelationship;\n      repo.normalizeRelationships = normalizeRelationships;\n      return repo;\n\n      /**\n       * Fetches relationship types from the server, caching them in the process.\n       * The returned array will be populated when the request resolves.\n       * The underlying promise is available on the $promise property.\n       *\n       * @param  {object} options\n       * @param  {boolean} options.force Discard cache (if set) and refetch\n       * @return {object.<string,RelationshipType>}\n       */\n      function getTypes(options) {\n        options = options || {};\n\n        if (!typesCache || options.force) {\n          var types = typeResource.query();\n\n          typesCache = {};\n\n          var tcPromise = types.$promise.then(function () {\n            types.forEach(function (type) {\n              typesCache[type.identifier] = type;\n            });\n            return typesCache;\n          });\n\n          // add $promise as a non-enumerable property\n          Object.defineProperty(typesCache, '$promise', {\n            value: tcPromise\n          });\n        }\n\n        return typesCache;\n      }\n\n      /**\n       * Fetches a type by ID\n       *\n       * @param  {string} id\n       * @return {Promise.<RelationshipType>}\n       */\n      function getType(id) {\n        var types = getTypes();\n\n        return types.$promise.then(function (types) {\n          return types[id];\n        });\n      }\n\n      /**\n       * Creates a new empty relationship instance\n       *\n       * @return {Relationship}\n       */\n      function createRelationship() {\n        var reln = new relnResource();\n        return adaptRelationship(reln);\n      }\n\n      /**\n       * Creates a new empty provenance model\n       *\n       * @return {Provenance}\n       */\n      function createProvenance() {\n        var provenance = {};\n        return adaptProvenance(provenance);\n      }\n\n      /**\n       * Creates a new empty anchor model\n       *\n       * @return {Anchor}\n       */\n      function createAnchor() {\n        var anchor = {};\n        return adaptAnchor(anchor);\n      }\n\n      /**\n       * Retrieves a relationship from the server by ID.\n       * The returned model will be populated once the request succeeds.\n       * The underlying promise can be accessed via the $promise property.\n       *\n       * @param  {string} id\n       * @return {Relationship}\n       */\n      function findById(id) {\n        return relnResource.get({ id: id });\n      }\n\n      /**\n       * Find all relationships matching the given criteria.\n       * @param  {object|string} options\n       * @property {string} options.uri (default if options is a string)\n       * @property {string} options.typeId\n       * @property {string} options.direction \"from\" (out-relationships), \"to\" (in-relationships), or \"any\"\n       * @property {integer} options.start\n       * @property {integer} options.max\n       * @return {Relationship[]}\n       */\n      function search(options) {\n        if (!options) {\n          throw new Error('no options provided')\n        }\n\n        if (angular.isString(options)) {\n          // treat single string as an entity URL\n          options = { uri: options };\n        }\n\n        var queryOpts = {};\n\n        if (options.uri) {\n          queryOpts.entity = options.uri;\n        }\n\n        if (options.typeId) {\n          queryOpts.type = options.typeId;\n        }\n\n        if (options.direction) {\n          queryOpts.direction = options.direction;\n        }\n\n        if (options.start) {\n          queryOpts.off = options.start;\n        }\n\n        if (options.max) {\n          queryOpts.max = options.max;\n        }\n\n        return relnResource.query(queryOpts);\n      }\n\n      /**\n       * Saves a relationship back to the server.\n       *\n       * @param  {Relationship} reln\n       * @return {Promise} resolves on successful save\n       */\n      function saveRelationship(reln) {\n        if (!(reln instanceof relnResource)) {\n          throw new Error('Relationship was not created by this repo');\n        }\n\n        return reln.id\n          ? reln.$update()\n          : reln.$save();\n      }\n\n      /**\n       * Deletes a relationship from the server via the REST API.\n       *\n       * @param  {string} id\n       * @return {Promise} resolves on success\n       */\n      function deleteRelationship(id) {\n        var response = relnResource.delete({ id: id });\n        return response.$promise\n      }\n\n      /**\n       * Ensures aggregate fields on a relationship are set appropriately\n       *\n       * @param  {Relationship} reln\n       * @return {Relationship}\n       */\n      function adaptRelationship(reln) {\n        if (!reln.provenance) {\n          reln.provenance = createProvenance();\n        }\n\n        if (!reln.relatedEntities) {\n          reln.relatedEntities = [];\n        }\n\n        if (!reln.targetEntities) {\n          reln.targetEntities = [];\n        }\n\n        return reln;\n      }\n\n      /**\n       * Ensures aggregate fields on a provenance model are set appropriately\n       *\n       * @param  {Provenance} provenance\n       * @return {Provenance}\n       */\n      function adaptProvenance(provenance) {\n        if (!provenance.creatorUris) {\n          provenance.creatorUris = [];\n        }\n\n        return provenance;\n      }\n\n      /**\n       * Ensures aggregate fields on an anchor model are set appropriately\n       *\n       * @param  {Anchor} anchor\n       * @return {Anchor}\n       */\n      function adaptAnchor(anchor) {\n        if (!anchor.entryUris) {\n          anchor.entryUris = [];\n        }\n\n        return anchor;\n      }\n\n      /**\n       * Normalizes relationships into type groups that are more suitable for display in the UI\n       *\n       * @param  {Relationship[]} relationships\n       * @return {TypeGroup[]}\n       */\n      function normalizeRelationships(relationships, currentUri, worksRepo) {\n        var normalizedRelationships = relationships.map(function (relationship) {\n          var typeId = relationship.typeId;\n\n          var isReverse = relationship.targetEntities.some(function (anchor) {\n            return anchor.entryUris.some(function (uri) {\n              return uri === currentUri;\n            });\n          });\n\n          var targetField = isReverse ? 'relatedEntities' : 'targetEntities';\n\n          var entities = relationship[targetField]\n          .map(function (anchor) {\n            return anchor.entryUris;\n          })\n          .reduce(function (flattened, arr) {\n            return flattened.concat(arr);\n          }, [])\n          .map(function (uri) {\n            return resolveEntityUri(uri, worksRepo);\n          });\n\n          return {\n            id: relationship.id,\n            typeId: typeId,\n            reverse: isReverse,\n            description: relationship.description,\n            entities: entities\n          };\n        });\n\n        var relnsByTypeDir = {};\n\n        normalizedRelationships.forEach(function (relationship) {\n          var typeId = relationship.typeId;\n\n          if (!relnsByTypeDir.hasOwnProperty(typeId)) {\n            relnsByTypeDir[typeId] = {\n              fwd: [],\n              rev: []\n            };\n          }\n\n          relnsByTypeDir[typeId][relationship.reverse ? 'rev' : 'fwd'].push(relationship);\n        });\n\n        var typeGroups = [];\n        var typeGroupPs = [];\n\n        angular.forEach(relnsByTypeDir, function (dirs, typeId) {\n          var promise = getType(typeId);\n          typeGroupPs.push(promise);\n\n          promise.then(function (type) {\n            if (type.isDirected) {\n              // add forward group\n              if (dirs.fwd.length > 0) {\n                typeGroups.push({\n                  label: type.title,\n                  relationships: dirs.fwd\n                });\n              }\n\n              // add reverse group\n              if (dirs.rev.length > 0) {\n                typeGroups.push({\n                  label: type.reverseTitle,\n                  relationships: dirs.rev\n                });\n              }\n            } else {\n              // combine forward/reverse and add as a single group\n              var group = dirs.fwd.concat(dirs.rev);\n              if (group.length > 0) {\n                typeGroups.push({\n                  label: type.title,\n                  relationships: group\n                });\n              }\n            }\n          });\n        });\n\n        Object.defineProperty(typeGroups, '$promise', {\n          value: $q.all(typeGroupPs).then(function () {\n            return typeGroups;\n          })\n        });\n\n        return typeGroups;\n      }\n\n      function resolveEntityUri(uri, worksRepo) {\n        var ENTITY_URI = /^works\\/([^\\/]+)(?:\\/editions\\/([^\\/]+)(?:\\/volumes\\/([^\\/]+))?)?$/i;\n        var match = ENTITY_URI.exec(uri);\n\n        if (!match) {\n          return null;\n        }\n\n        if (match[1] && match[2] && match[3]) {\n          return makeVolumeEntity(match[1], match[2], match[3], worksRepo);\n        } else if (match[1] && match[2]) {\n          return makeEditionEntity(match[1], match[2], worksRepo);\n        } else if (match[1]) {\n          return makeWorkEntity(match[1], worksRepo);\n        }\n\n        return null;\n      }\n    }\n\n    function makeVolumeEntity(workId, editionId, volumeId, worksRepo) {\n      var edition = worksRepo.getEdition(workId, editionId);\n      var volume = worksRepo.getVolume(workId, editionId, volumeId);\n\n      var entity = {\n        type: 'volume',\n        refParams: {\n          workId: workId,\n          editionId: editionId,\n          volumeId: volumeId\n        },\n        entity: volume\n      };\n\n      volume.$promise.then(function () {\n        var title = worksRepo.getTitle(volume.titles, ['short', 'canonical', 'bibliographic']);\n        if (title) {\n          entity.label = title.title + (title.subtitle ? ': ' + title.subtitle : '');\n        }\n\n        edition.$promise.then(function () {\n          entity.label += ' ' + edition.editionName + ' Volume ' + volume.volumeNumber;\n        }, function () {\n          entity.label += ' [Unknown edition] ' + volume.volumeNumber;\n        });\n      });\n\n      return entity;\n    }\n\n    function makeEditionEntity(workId, editionId, worksRepo) {\n      var edition = worksRepo.getEdition(workId, editionId);\n\n      var entity = {\n        type: 'edition',\n        refParams: {\n          workId: workId,\n          editionId: editionId\n        },\n        entity: edition\n      };\n\n      edition.$promise.then(function () {\n        var title = worksRepo.getTitle(edition.titles, ['short', 'canonical', 'bibliographic']);\n        if (title) {\n          entity.label = title.title + (title.subtitle ? ': ' + title.subtitle : '') + ' ' + edition.editionName;\n        }\n      });\n\n      return entity;\n    }\n\n    function makeWorkEntity(workId, worksRepo) {\n      var work = worksRepo.getWork(workId);\n\n      var entity = {\n        type: 'work',\n        refParams: {\n          workId: workId\n        },\n        entity: work\n      };\n\n      work.$promise.then(function () {\n        var title = worksRepo.getTitle(work.titles, ['short', 'canonical', 'bibliographic']);\n        if (title) {\n          entity.label = title.title + (title.subtitle ? ': ' + title.subtitle : '');\n        }\n      });\n\n      return entity;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcWorks', [\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcWorks')\n    .provider('worksRepo', worksRepoProvider);\n\n  /**\n   * This functionality is already being implemented as a standalone trc-biblio module. The code is\n   * used here as an interim until the Bower build/dependency workflow has been finalized.\n   *\n   * @return {angular.provider}\n   */\n  function worksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/works';\n    provider.$get = worksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function worksRepoFactory($resource, _) {\n      var restResource = $resource(provider.url + '/:workId', { workId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var editionResource = $resource(provider.url + '/:workId/editions/:editionId', { editionId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var volumeResource = $resource(provider.url + '/:workId/editions/:editionId/volumes/:volumeId', { volumeId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var repo = {};\n      repo.getAll = findAll;\n      repo.search = search;\n      repo.get = getWork;\n      repo.getWork = getWork;\n      repo.getEdition = getEdition;\n      repo.getVolume = getVolume;\n      repo.create = createWork;\n      repo.createWork = createWork;\n      repo.createEdition = createEdition;\n      repo.createVolume = createVolume;\n      repo.save = save;\n      repo.saveWork = saveWork;\n      repo.saveEdition = saveEdition;\n      repo.saveVolume = saveVolume;\n      repo.delete = deleteWork;\n      repo.getTitle = getTitleByTypePreference;\n      return repo;\n\n      /**\n       * Retrieves a listing of all works\n       *\n       * @return {WorkProxy[]}\n       */\n      function findAll() {\n        return search('');\n      }\n\n      /**\n       * Search for works by query\n       *\n       * @return {SearchResultSet}\n       */\n      function search(query) {\n        return restResource.get({ q: query, max: 50 });\n      }\n\n      /**\n       * Retrieves a work object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Work.$promise.\n       *\n       * @param {string} workId\n       * @return {Work}\n       */\n      function getWork(workId) {\n        if (angular.isUndefined(workId)) {\n          throw new TypeError('Invalid ID provided to getWork');\n        }\n\n        var work = restResource.get({ workId: workId });\n\n        work.$promise.then(adaptWork);\n\n        return work;\n      }\n\n      /**\n       * Retrieves an edition object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Edition.$promise.\n       *\n       * @param {string} workId\n       * @param {string} editionId\n       * @return {Edition}\n       */\n      function getEdition(workId, editionId) {\n        if (angular.isUndefined(workId) || angular.isUndefined(editionId)) {\n          throw new TypeError('Invalid IDs provided to getEdition');\n        }\n\n        var edition = editionResource.get({ workId: workId, editionId: editionId });\n\n        edition.$promise.then(adaptEdition);\n\n        return edition;\n      }\n\n      /**\n       * Retrieves a volume object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Volume.$promise.\n       *\n       * @param {string} workId\n       * @param {string} editionId\n       * @param {string} volumeId\n       * @return {Volume}\n       */\n      function getVolume(workId, editionId, volumeId) {\n        if (angular.isUndefined(workId) || angular.isUndefined(editionId) || angular.isUndefined(volumeId)) {\n          throw new TypeError('Invalid IDs provided to getVolume');\n        }\n\n        var volume = volumeResource.get({ workId: workId, editionId: editionId, volumeId: volumeId });\n\n        volume.$promise.then(adaptVolume);\n\n        return volume;\n      }\n\n      /**\n       * Creates a new work instance\n       *\n       * @return {Work}\n       */\n      function createWork() {\n        var work = new restResource();\n        adaptWork(work);\n        work.titles.push({});\n        work.authors.push({});\n        return work;\n      }\n\n      /**\n       * Creates a new edition instance\n       *\n       * @return {Edition}\n       */\n      function createEdition() {\n        var edition = new editionResource();\n        return adaptEdition(edition);\n      }\n\n      /**\n       * Creates a new volume instance\n       *\n       * @return {Volume}\n       */\n      function createVolume() {\n        var volume = new volumeResource();\n        return adaptVolume(volume);\n      }\n\n      /**\n       * Dispatch method for saving works, editions, and volumes\n       *\n       * @deprecated use saveWork, saveEdition, or saveVolume directly\n       * @return {Promise}\n       */\n      function save() {\n        switch (arguments.length) {\n          case 1: return saveWork.apply(null, arguments);\n          case 2: return saveEdition.apply(null, arguments);\n          case 3: return saveVolume.apply(null, arguments);\n        }\n        throw new TypeError('Unexpected arguments to worksRepo#save');\n      }\n\n      /**\n       * Saves a work instance back to the server\n       *\n       * @param {Work} work\n       * @return {Promise.<Work>}\n       */\n      function saveWork(work) {\n        if (!(work instanceof restResource)) {\n          throw new Error('work was not created by this repo');\n        }\n\n        // ngResource automatically updates the model to reflect any server changes (e.g. setting IDs for the work/edtions/volumes/copies).\n        return work.id\n          ? work.$update()\n          : work.$save();\n      }\n\n      /**\n       * Saves an edition instance back to the server\n       *\n       * @param  {string} workId\n       * @param  {Edition} edition\n       * @return {Promise.<Edition>}\n       */\n      function saveEdition(workId, edition) {\n        if (!workId) {\n          throw new Error('no work id provided');\n        }\n\n        if (!(edition instanceof editionResource)) {\n          throw new Error('edition was not created by this repo');\n        }\n\n        return edition.id\n          ? edition.$update({ workId: workId })\n          : edition.$save({ workId: workId });\n      }\n\n      /**\n       * Saves a volume instance back to the server\n       *\n       * @param  {string} workId\n       * @param  {string} editionId\n       * @param  {Volume} volume\n       * @return {Promise.<Volume>}\n       */\n      function saveVolume(workId, editionId, volume) {\n        if (!workId) {\n          throw new Error('no work id provided');\n        }\n\n        if (!editionId) {\n          throw new Error('no edition id provided');\n        }\n\n        if (!(volume instanceof volumeResource)) {\n          throw new Error('volume was not created by this repo');\n        }\n\n        return volume.id\n          ? volume.$update({ workId: workId, editionId: editionId })\n          : volume.$save({ workId: workId, editionId: editionId });\n      }\n\n      /**\n       * Deletes a work instance from the server\n       *\n       * @param  {string} id\n       */\n      function deleteWork(workId) {\n        var dataItem = restResource.delete({ id: workId });\n        return dataItem.$promise;\n      }\n\n      /**\n       * Ensure that aggregate fields common to all work/edition/volume entities exist and are formatted correctly\n       *\n       * @param  {Work|Edition|Volume} entity\n       * @return {Work|Edition|Volume}\n       */\n      function adaptCommon(entity) {\n        if (!entity.titles) {\n          entity.titles = [];\n        } else {\n          entity.titles.forEach(function (title) {\n            title.type = title.type.toLowerCase();\n          });\n        }\n\n        if (!entity.authors) {\n          entity.authors = [];\n        } else {\n          entity.authors.forEach(function (author) {\n            author.role = author.role.toLowerCase();\n          });\n        }\n\n        if (!entity.otherAuthors) {\n          entity.otherAuthors = [];\n        } else {\n          entity.otherAuthors.forEach(function (author) {\n            author.role = author.role.toLowerCase();\n          });\n        }\n\n        if (!entity.copies) {\n          entity.copies = [];\n        }\n\n        return entity;\n      }\n\n      /**\n       * Ensure that work aggregate fields exist and are formatted correctly\n       *\n       * @param  {Work} work\n       * @return {Work}\n       */\n      function adaptWork(work) {\n        adaptCommon(work);\n\n        if (!work.editions) {\n          work.editions = [];\n        } else {\n          work.editions.forEach(adaptEdition);\n        }\n\n        return work;\n      }\n\n      /**\n       * Ensure that edition aggregate fields exist and are formatted correctly\n       *\n       * @param  {Edition} edition\n       * @return {Edition}\n       */\n      function adaptEdition(edition) {\n        adaptCommon(edition);\n\n        if (!edition.volumes) {\n          edition.volumes = [];\n        } else {\n          edition.volumes.forEach(adaptVolume);\n        }\n\n        return edition;\n      }\n\n      /**\n       * Ensure that volume aggregate fields exist and are formatted correctly\n       *\n       * @param  {Volume} volume\n       * @return {Volume}\n       */\n      function adaptVolume(volume) {\n        adaptCommon(volume);\n\n        return volume;\n      }\n\n      /**\n       * Retrieves the first available title of the given type or falsey if no title can be found.\n       * If multiple types are given, returns the title corresponding to the first type for which a title is found.\n       *\n       * @param  {Title[]}         titles\n       * @param  {string|string[]} types\n       * @return {Title}\n       */\n      function getTitleByTypePreference(titles, types) {\n        if (angular.isUndefined(types)) {\n          types = ['short', 'canonical', 'bibliographic'];\n        } else if (!angular.isArray(types)) {\n          types = [types];\n        }\n\n        return types.reduce(function (found, type) {\n          return found || _.find(titles, { type: type });\n        }, null);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * Data model representing a person returned by the TRC REST API\n * @typedef Person\n * @type {object}\n * @property {string}           id       - a unique identifier for this person; assigned upon creation\n * @property {EntryMeta}        meta     - metadata about the record and its history in the system\n * @property {PersonName}       name     - primary name used to identify this person\n * @property {PersonName[]}     altNames - other names by which this person is known\n * @property {?HistoricalEvent} birth    - the date and location this person was born; may be null if unknown\n * @property {?HistoricalEvent} death    - the date and location this person was born; may be null if unknown or still alive\n * @property {string}           summary  - an HTML summary of the person and his or her significance\n */\n\n/**\n * Simplified, lightweight representation of a person for use in search results\n * @typedef Person\n * @type {object}\n * @property {string}     id             - a unique identifier for the person\n * @property {EntryMeta}  meta           - metadata about the record and its history in the system\n * @property {PersonName} name           - structured name representation\n * @property {string}     label          - formatted name to display\n * @property {string}     summaryExcerpt - a leading excerpt from the full summary\n */\n\n/**\n * Metadata about a TRC entry\n * @typedef EntryMeta\n * @type {object}\n * @property {string}                      slug         - a short, unique identifier intended to be more human-readable than the id\n * @property {integer}                     version      - a monotonically increasing version number incremented on each change\n * @property {object.<string, SimpleLink>} links        - links to related resources; keyed by link role\n * @property {string}                      lastModified - ISO 8601 timestamp of the last modification date\n */\n\n/**\n * Container for linking to related entities\n * @typedef SimpleLink\n * @type {object}\n * @property {string} uri  - a URI representing the linked item\n * @property {string} type - MIME type of the related linked item\n */\n\n/**\n * Structured form of a person's name\n * @typedef PersonName\n * @type {object}\n * @property {string} role        - clarifies the use of this name\n * @property {string} label       - a simple representation of this name for display purposes\n * @property {?string} title      - title of address\n * @property {?string} givenName  - given or first name\n * @property {?string} middleName - middle name\n * @property {?string} familyName - family or last name\n * @property {?string} suffix     - a suffix (e.g. 'Jr' or 'III')\n */\n\n/**\n * Event with a date/time, location, and descriptive information\n * @typedef HistoricalEvent\n * @type {object}\n * @property {string}          id          - a unique identifier for this event\n * @property {string}          title       - a brief title of the event for display purposes\n * @property {string}          description - a detailed summary of the event\n * @property {string}          location    - the location in which the event took place\n * @property {DateDescription} date        - the date the event took place\n */\n\n/**\n * Container for encapsulating human-readable and machine-readable forms of a date.\n * @typedef DateDescription\n * @type {object}\n * @property {string} calendar    - machine-readable ISO 8601 timestamp\n * @property {string} description - human-readable description of this date\n */\n\n/**\n * Container for search results\n * @typedef PersonSearchResultSet\n * @type {object}\n * @property {SimplePerson[]} items  - search results\n * @property {string}         qs     - query string that gives the current set of search results\n * @property {?string}        qsNext - query string that gives next set of search results or null if this is the last set\n * @property {?string}        qsPrev - query string that gives preceding set of search results or null if this is the first set\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .provider('peopleRepo', peopleRepoProvider);\n\n\n  function peopleRepoProvider() {\n    var provider = {};\n    provider.url = '/api/people';\n    provider.$get = peopleRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function peopleRepoFactory($q, $resource) {\n      var restResource = $resource(provider.url + '/:id', null, {\n        'update': { method: 'PUT' }\n      });\n\n      var repo = {};\n      repo.create = createPerson;\n      repo.createName = createName;\n      repo.createEvent = createEvent;\n      repo.get = findById;\n      repo.search = search;\n      repo.save = savePerson;\n      repo.delete = deletePerson;\n      return repo;\n\n      /**\n       * Creates a new empty person instance.\n       *\n       * @return {Person}\n       */\n      function createPerson() {\n        var person = new restResource();\n        return adaptPerson(person);\n      }\n\n      /**\n       * Creates a new empty entry metadata instance\n       *\n       * @return {EntryMeta}\n       */\n      function createMeta() {\n        var meta = {};\n        return adaptMeta(meta);\n      }\n\n      /**\n       * Creates a new empty name instance\n       *\n       * @return {PersonName}\n       */\n      function createName() {\n        var name = {};\n        return adaptName(name);\n      }\n\n      /**\n       * Creates a new historical event instance\n       *\n       * @return {HistoricalEvent}\n       */\n      function createEvent() {\n        var evt = {};\n        return adaptEvent(evt);\n      }\n\n      /**\n       * Creates a date/description instance\n       *\n       * @return {DateDescription}\n       */\n      function createDateDescription() {\n        var dateDescription = {};\n        return dateDescription;\n      }\n\n      /**\n       * Retrieves a person object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promise is available on Person.$promise.\n       *\n       * @param  {string} id\n       * @return {Person}\n       */\n      function findById(id) {\n        return restResource.get({ id: id });\n      }\n\n      /**\n       * Retrieves a serch result set of people who match the given query.\n       *\n       * @param {string} query\n       * @return {PersonSearchResultSet}\n       */\n      function search(query) {\n        return restResource.get({ q: query });\n      }\n\n      /**\n       * Saves a person model to the REST API.\n       *\n       * If no ID is provided on the person model, the API will create save the model as a new\n       * person. Otherwise, the API will attempt to update the existing person model with that ID.\n       *\n       * @param {Person} person\n       * @return {Promise.<Person>} - resolves to the saved person on success\n       */\n      function savePerson(person) {\n        var response;\n        if (person.id) {\n          response = restResource.update({ id: person.id }, person);\n        } else {\n          response = restResource.save(null, person);\n        }\n\n        return response.$promise.then(function (personId) {\n          person.id = personId.id;\n          return person;\n        });\n      }\n\n      /**\n       * Deletes a person on the server via the REST API.\n       *\n       * @param {Person|string} idOrPerson\n       * @return {Promise} - resolves on success\n       */\n      function deletePerson(id) {\n        var response = restResource.delete({ id: id });\n        return response.$promise;\n      }\n\n      /**\n       * Populates a person with aggregate fields\n       *\n       * @param  {Person} person\n       * @return {Person}\n       */\n      function adaptPerson(person) {\n        if (!person.meta) {\n          person.meta = createMeta();\n        } else {\n          adaptMeta(person.meta);\n        }\n\n        if (!person.name) {\n          person.name = createName();\n        } else {\n          adaptName(person.name);\n        }\n\n        if (!person.altNames) {\n          person.altNames = [];\n        } else {\n          person.altNames.forEach(adaptName);\n        }\n\n        if (!person.birth) {\n          person.birth = createEvent();\n        } else {\n          adaptEvent(person.birth);\n        }\n\n        if (!person.death) {\n          person.death = createEvent();\n        } else {\n          adaptEvent(person.death);\n        }\n\n        return person\n      }\n\n      /**\n       * Ensure that entry metadata aggregate fields exist and are formatted correctly.\n       *\n       * @param  {EntryMeta} meta\n       * @return {EntryMeta}\n       */\n      function adaptMeta(meta) {\n        if (!meta.links) {\n          meta.links = {};\n        }\n\n        return meta;\n      }\n\n      /**\n       * Ensure that name aggregate fields exist and are formatted correctly\n       * @param  {PersonName} name\n       * @return {PersonName}\n       */\n      function adaptName(name) {\n        // no aggregate fields yet...\n        return name;\n      }\n\n      /**\n       * Ensure that event aggregate fields exist and are formatted correctly.\n       *\n       * @param  {HistoricalEvent} evt\n       * @return {HistoricalEvent}\n       */\n      function adaptEvent(evt) {\n        if (!evt.date) {\n          evt.date = createDateDescription();\n        }\n\n        return evt;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcPersonEditor', trcPersonEditorDirective);\n\n  /** @ngInject */\n  function trcPersonEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/person-editor.html',\n      scope: {\n        person: '=ngModel'\n      },\n      controller: PersonEditorController,\n      controllerAs: 'personEditor'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function PersonEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.addName = addName;\n      vm.removeName = removeName;\n      vm.addEvent = addEvent;\n      vm.removeEvent = removeEvent;\n\n      /**\n       * Adds a name to the current person model.\n       */\n      function addName() {\n        var newName = peopleRepo.createName();\n        $scope.person.altNames.push(newName);\n      }\n\n      /**\n       * Removes the name at the specified index from the current person model.\n       *\n       * @param {integer} ix\n       */\n      function removeName(ix) {\n        $scope.person.altNames.splice(ix, 1);\n      }\n\n      /**\n       * Adds an event to the current person model.\n       *\n       * @param {string} key - 'birth' or 'death'\n       */\n      function addEvent(key) {\n        var newEvent = peopleRepo.createEvent();\n        $scope.person[key] = newEvent;\n      }\n\n      /**\n       * Removes the event from the current person model.\n       *\n       * @param {string} key - 'birth' or 'death'\n       */\n      function removeEvent(key) {\n        $scope.person[key] = null;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcNameEditor', trcNameEditorDirective);\n\n  /** @ngInject */\n  function trcNameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      },\n      controller: NameEditorController,\n      controllerAs: 'nameEditor'\n    };\n\n    return directive;\n\n    function NameEditorController() {\n      var vm = this;\n\n      vm.roles = [\n        { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n      ];\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcEventEditor', trcEventEditorDirective);\n\n  /** @ngInject */\n  function trcEventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books', []);\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .provider('googleBooksApi', googleBooksApiProvider);\n\n   function googleBooksApiProvider() {\n      var API = {};\n\n      API.options = {\n         transport: 'https',\n         v: 0,\n         language: 'en',\n         preventLoad: false\n      };\n\n      API.configure = configure;\n      API.$get = loadGoogleBooks;\n\n      return API;\n\n      function configure(options) {\n         angular.extend(API.options, options);\n      }\n\n      /** @ngInject */\n      function loadGoogleBooks(googleBooksScriptLoader) {\n         return googleBooksScriptLoader.load(API.options);\n      }\n   }\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .factory('googleBooksScriptLoader', googleBooksScriptLoader);\n\n   /** @ngInject */\n   function googleBooksScriptLoader($window, $document, $q, _) {\n      var scriptId = undefined;\n      var usedConfiguration = undefined;\n\n      return {\n         load: load,\n         manualLoad: manualLoad\n      };\n\n      /**\n       * Get script URL for loading Google Books API\n       *\n       * @param {object} options\n       * @return {string}\n       */\n      function getScriptUrl(options) {\n         if (options.transport === 'auto') {\n            return '//www.google.com/books/api.js?';\n         } else {\n            return options.transport + '://www.google.com/books/api.js?';\n         }\n      }\n\n      function includeScript(options) {\n         var omitOptions = ['transport', 'preventLoad', 'randomizedFunctionName'];\n\n         var query = _.map(_.omit(options, omitOptions), function (v, k) { return k + '=' + v });\n\n         if (scriptId) {\n            var scriptElem = $document.getElementById(scriptId)\n            scriptElem.parentNode.removeChild(scriptElem);\n         } else {\n            scriptId = 'gbooks_load_' + Math.round(Math.random() * 1000);\n         }\n\n         query = query.join('&');\n         angular.element('<script>', {\n            id: scriptId,\n            type: 'text/javascript',\n            src: getScriptUrl(options) + query\n         }).appendTo(angular.element('body'));\n      }\n\n      function isGoogleBooksLoaded() {\n         return angular.isDefined($window.google) && angular.isDefined($window.google.books);\n      }\n\n      function load(options) {\n         var deferred = $q.defer();\n\n         if (isGoogleBooksLoaded()) {\n            deferred.resolve($window.google.books);\n            return deferred.promise;\n         }\n\n         var randomizedFunctionName = 'onGoogleBooksReady' + Math.round(Math.random() * 1000);\n         options.callback = randomizedFunctionName;\n\n         $window[randomizedFunctionName] = function () {\n            $window[randomizedFunctionName] = null;\n            deferred.resolve($window.google.books);\n         }\n\n         if (!options.preventLoad) {\n            includeScript(options);\n         }\n\n         usedConfiguration = options;\n         usedConfiguration.randomizedFunctionName = randomizedFunctionName;\n\n         return deferred.promise;\n      }\n\n      function manualLoad() {\n         var config = usedConfiguration;\n\n         if (!isGoogleBooksLoaded()) {\n            includeScript(config);\n         } else if ($window[config.randomizedFunctionName]) {\n            $window[config.randomizedFunctionName]();\n         }\n      }\n   }\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .directive('googleBookReader', googleBookReader);\n\n   /** @ngInject */\n   function googleBookReader(googleBooksApi, googleBooksApiManualLoader) {\n      var directive = {\n         restrict: 'E',\n         link: linkFunc,\n         scope: {\n            properties: '='\n         }\n      };\n\n      return directive;\n\n      function linkFunc(scope, el) {\n         googleBooksApiManualLoader.load();\n         googleBooksApi.then(function (books) {\n            var viewer = new books.DefaultViewer(el.get(0));\n\n            scope.$watch('properties', function (properties) {\n               viewer.load(properties.id);\n            });\n\n            scope.$on('resize', function () {\n               viewer.resize();\n            });\n         });\n      }\n   }\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .service('googleBooksApiManualLoader', googleBooksApiManualLoader);\n\n   /** @ngInject */\n   function googleBooksApiManualLoader(googleBooksScriptLoader) {\n      var API = {};\n\n      API.load = load;\n\n      return API;\n\n      function load() {\n         googleBooksScriptLoader.manualLoad();\n      }\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ngMaterial',\n      'trcBio',\n      'trcReln',\n      'trcWorks',\n      'ngDragDrop',\n      'vwise'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('vwise', {\n        url: '/',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, /* toastrConfig, */ $mdThemingProvider, worksRepoProvider, peopleRepoProvider, relationshipsRepoProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n\n\n    worksRepoProvider.url = '/api/catalog/works';\n    peopleRepoProvider.url = '/api/catalog/people';\n    relationshipsRepoProvider.url = '/api/catalog/relationships';\n  }\n\n})();\n\nangular.module(\"sdaAdminWeb\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/trc-bio/event-editor.html\",\"<div class=form-group><label class=control-label for=event-title>Title</label><input type=text id=event-title name=event-title class=\\\"form-control event-title\\\" ng-model=event.title></div><div class=form-group><label class=control-label for=event-description>Description</label><textarea id=event-description name=event-description class=\\\"form-control event-description\\\" ng-model=event.description></textarea></div><div class=form-group><label class=control-label for=event-location>Location</label><input type=text id=event-location name=event-location class=\\\"form-control event-location\\\" ng-model=event.location></div><div class=form-group><label class=control-label for=event-date>Date</label><input type=text id=event-date name=event-date class=\\\"form-control event-date\\\" ng-model=event.date.description><!-- TODO add datepicker --></div>\");\n$templateCache.put(\"app/trc-bio/name-editor.html\",\"<div class=form-group class=name-role><label class=control-label for=name-role>Role</label><select id=name-role name=name-role class=\\\"form-control name-role\\\" ng-model=name.role><option ng-repeat=\\\"role in nameEditor.roles\\\" value={{role.value}}>{{role.label}}</option></select></div><div class=form-group class=name-structure><label class=control-label>Structured Name</label><input type=text class=name-title placeholder=title ng-model=name.title> <input type=text class=name-given placeholder=given ng-model=name.givenName> <input type=text class=name-middle placeholder=middle ng-model=name.middleName> <input type=text class=name-family placeholder=family ng-model=name.familyName> <input type=text class=name-suffix placeholder=suffix ng-model=name.suffix></div><div class=form-group class=name-label><label for=label>Display Label</label><input type=text placeholder=label ng-model=name.label></div>\");\n$templateCache.put(\"app/trc-bio/person-editor.html\",\"<div class=form-group><label for=person-name>Primary Name</label><trc-name-editor id=person-name ng-model=person.name></trc-name-editor></div><div class=form-group><label for=person-altnames>Alternate Names</label><div ng-repeat=\\\"name in person.altNames\\\"><trc-name-editor id=person-altnames ng-model=name></trc-name-editor><button ng-click=personEditor.removeName($index)>&minus;</button></div><button ng-click=personEditor.addName()>+</button></div><div class=form-group><label for=person-birth>Birth</label><div ng-if=person.birth><trc-event-editor id=person-birth ng-model=person.birth></trc-event-editor><button ng-click=\\\"personEditor.removeEvent(\\'birth\\')\\\">&minus;</button></div><div ng-if=!person.birth><button ng-click=\\\"personEditor.addEvent(\\'birth\\')\\\">+</button></div></div><div class=form-group><label for=person-death>Death</label><div ng-if=person.death><trc-event-editor id=person-death ng-model=person.death></trc-event-editor><button ng-click=\\\"personEditor.removeEvent(\\'death\\')\\\">&minus;</button></div><div ng-if=!person.death><button ng-click=\\\"personEditor.addEvent(\\'death\\')\\\">+</button></div></div><div class=form-group><label class=control-label for=person-summary>Summary</label><textarea id=person-summary name=person-summary class=\\\"form-control person-summary\\\" ng-model=person.summary></textarea></div>\");\n$templateCache.put(\"app/vwise/workspace.html\",\"<div layout=row flex><md-sidenav md-component-id=left class=md-sidenav-left layout=column md-is-locked-open=vm.sidebarFocused><form layout=row flex=none><md-input-container flex><label for=searchQuery>Search</label><md-icon>search</md-icon><input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required md-sidenav-focus></md-input-container></form><md-content flex><div ng-if=vm.loading layout=row layout-align=center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"><md-subheader>People</md-subheader><md-list><md-list-item ng-repeat=\\\"item in vm.peopleResults.items\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text><span>{{item.label}}</span></div></md-list-item></md-list></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"><md-subheader>Works</md-subheader><md-list><md-list-item ng-repeat=\\\"item in vm.worksResults.items\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text><span>{{item.label}}</span></div></md-list-item></md-list></div></md-content></md-sidenav><div flex jqyoui-droppable=\\\"{stack: true, onDrop:\\'vm.thingDropped()\\'}\\\" data-drop=true class=workspace ng-click=vm.workspaceClicked($event)><div ng-repeat=\\\"panel in vm.workspace.panelStack track by panel.id\\\" class=panel ng-style={left:panel.vprops.xPosition,top:panel.vprops.yPosition,width:panel.vprops.width,height:panel.vprops.height,background:panel.vprops.background,color:panel.vprops.foreground} jqyoui-draggable=\\\"{onDrag:\\'vm.panelDragged(panel)\\',onStop:\\'vm.savePanelPosition(panel)\\'}\\\" ng-click=\\\"vm.activatePanel(panel, $event)\\\" data-jqyoui-options=\\\"{handle:\\'.drag-handle\\'}\\\" data-drag=true vwise-panel=panel layout=column></div></div></div>\");\n$templateCache.put(\"app/vwise/components/panel/panel.html\",\"<div class=drag-handle ng-style=\\\"{background: panel.vprops.background}\\\" layout=row><span flex></span> <input type=color ng-model=panel.vprops.background> <button class=close ng-click=vm.closePanel(panel)>&times;</button></div><div class=content flex layout=column></div><div class=resize-handle jqyoui-draggable=\\\"{onDrag:\\'vm.resizePanel(panel)\\',onStop:\\'vm.savePanelSize(panel)\\'}\\\" data-drag=true></div>\");\n$templateCache.put(\"app/vwise/components/person-panel/person-panel.html\",\"<div class=panel-person flex layout=column><h1><span class=name>{{name}}</span></h1><md-tabs flex><md-tab ng-if=person.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=person.summary></div></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/vwise/components/work-panel/edition-panel.html\",\"<div class=panel-edition flex layout=column><h1><span class=authors><span class=author ng-repeat=\\\"author in edition.authors\\\">{{author.lastName}}. </span></span><span class=title>{{title.title}}<span ng-if=title.subtitle>: {{title.subtitle}}</span>.</span> <span class=edition-name>{{edition.editionName}}.</span></h1><md-tabs flex><md-tab ng-if=edition.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=edition.summary></div></md-tab-body></md-tab><md-tab ng-if=\\\"edition.volumes.length > 0\\\"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in edition.volumes\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>Volume {{item.volumeNumber}} ({{item.publicationInfo.date.description}})</div></md-list-item></md-list></md-tab-body></md-tab><md-tab ng-if=\\\"edition.copies.length > 0\\\"><md-tab-label><md-icon>book</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in edition.copies\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.title}}</div></md-list-item></md-list></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/vwise/components/work-panel/volume-panel.html\",\"<div class=panel-volume flex layout=column><h1><span class=authors><span class=author ng-repeat=\\\"author in volume.authors\\\">{{author.lastName}}. </span></span><span class=title>{{title.title}}<span ng-if=title.subtitle>: {{title.subtitle}}</span>.</span> <span class=edition-name>{{edition.editionName}}.</span> <span class=volume-name>Volume {{volume.volumeNumber}}.</span></h1><md-tabs flex><md-tab ng-if=volume.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=volume.summary></div></md-tab-body></md-tab><md-tab ng-if=\\\"volume.copies.length > 0\\\"><md-tab-label><md-icon>book</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in volume.copies\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.title}}</div></md-list-item></md-list></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/vwise/components/work-panel/work-panel.html\",\"<div class=panel-work flex layout=column><h1><span class=authors><span class=author ng-repeat=\\\"author in work.authors\\\">{{author.lastName}}. </span></span><span class=title>{{title.title}}<span ng-if=title.subtitle>: {{title.subtitle}}</span>.</span></h1><md-tabs flex><md-tab ng-if=work.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=work.summary></div></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body><div ng-repeat=\\\"group in relationships\\\"><h3>{{group.label}}</h3><md-list><div ng-repeat=\\\"relationship in group.relationships\\\"><md-list-item ng-repeat=\\\"item in relationship.entities\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text><span class=authors><span class=author ng-repeat=\\\"author in item.entity.authors\\\">{{author.lastName}}.</span></span> <span class=title>{{item.title.title}}{{item.title.subtitle ? \\': \\' : \\'\\'}}<span ng-if=item.title.subtitle class=subtitle>{{item.title.subtitle}}</span></span></div></md-list-item></div></md-list></div></md-tab-body></md-tab><md-tab ng-if=\\\"work.editions.length > 0\\\"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in work.editions\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.editionName}} ({{item.publicationInfo.date.description}})</div></md-list-item></md-list></md-tab-body></md-tab><md-tab ng-if=\\\"work.copies.length > 0\\\"><md-tab-label><md-icon>book</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in work.copies\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.title}}</div></md-list-item></md-list></md-tab-body></md-tab></md-tabs></div>\");}]);"],"sourceRoot":"/source/"}