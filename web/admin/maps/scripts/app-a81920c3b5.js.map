{"version":3,"sources":["scripts/app.js"],"names":["angular","module","titleEditorDirective","directive","restrict","templateUrl","scope","title","publicationInfoEditorDirective","pubInfo","copyEditorDirective","copy","controller","CopyEditorController","controllerAs","$scope","activate","addHandler","HathiTrustRefHandler","GoogleBooksRefHandler","InternetArchiveRefHandler","handler","vm","refHandlers","id","parseProperties","type","url","properties","copyForm","$setValidity","this","setProperties","handle","parsed","parseUrl","seq","path","substr","pageNo","fragment","match","length","makePropertiesObject","src","display","hostname","query","lastIndexOf","urlappend","subquery","parseQueryString","htid","section","printsec","page","pg","parser","document","createElement","href","toString","protocol","host","port","pathname","search","hash","sep","isString","flags","indexOf","kvpairs","split","forEach","pair","ix","key","value","decodeURIComponent","URIError","hasOwnProperty","isArray","push","$inject","authorRefEditorDirective","AuthorRefEditorController","peopleRepo","ref","authorId","author","get","$promise","then","linkAuthorSearchText","name","label","setLinkedAuthor","person","getResults","resultSet","items","authorRoles","workEditorItemDirective","$log","linkFunc","error","WorkEditorItemController","worksRepo","work","loaded","link","workEditorDirective","WorkEditorController","_","editions","edition","model","focused","createEdition","titles","cloneDeep","authors","deleteEdition","splice","volumeEditorDirective","volume","editionEditorDirective","EditionEditorController","volumes","createVolume","publicationInfo","deleteVolume","nameEditorDirective","eventEditorDirective","event","treeCategorizationEditor","scopeId","scheme","TreeCategorizationController","$mdDialog","$mdToast","$state","$q","articlesRepo","categorizationService","info","repo","getScopedRepo","overviews","handleAssociateEntry","$event","node","linkArticle","article","nodes","reference","openEditor","values","go","create","articlePromise","save","linkPromise","all","handleRemoveEntry","handleCreateChild","parent","onCreate","newCategoryDialog","prompt","placeholder","ok","cancel","targetEvent","show","handleDeleteNode","msg","removeCatgorizationDialog","confirm","htmlContent","remove","showSimple","ArticleEditorSectionController","ArticleEditorController","$stateParams","$mdBottomSheet","refsRepoFactory","references","refsRepo","$watch","cleanArticleHandler","$watchCollection","cleanRefsHandler","alert","editFootnote","footnote","newFootnote","newReferences","createRefCollection","config","clickOutsideToClose","locals","promise","footnotes","updatedReferences","merge","compact","obj","cleanReferences","cleanFootnotes","refsRepoUrl","getReferencesEndpoint","getRepo","body","abstractEditor","extend","CKEDITOR_CONFIG","removeButtons","join","editor","toolbarGroups","groups","format_tags","extraPlugins","mathJaxLib","ZoteroTestController","item","types","categorizationRepoProvider","categorizationRepoFactory","$resource","$http","ScopedRepository","getCategorization","schemesResource","createCategorization","description","removeCategorization","getNode","schemeId","nodeId","getNodeChildren","createNode","options","data","result","nodeChilrenResource","childIds","children","removeNode","removeRefs","nodeResource","remove_refs","moveNode","updateNode","linkEntry","entryRef","params","associatedEntryResource","update","unlinkEntry","getChildren","move","unlink","provider","method","$get","SummaryEditDialogController","summary","close","hide","summaryEditorDirective","stripTagsFilter","stripTags","html","String","replace","filter","slideToggle","beforeAddClass","element","className","done","NG_HIDE_CLASS","slideUp","removeClass","slideDown","animation","NavbarController","$mdSidenav","toggleSidenav","toggle","component","bindings","sidenavId","guessDateFactory","moment","guessDate","str","INFER_FORMATS","factory","dateEditorDirective","calendarAutoSet","dateDescription","date","calendar","format","DataContainerController","watch","fn","unregister","listeners","set","newValue","FootnoteEditDialogController","ckeditorFootnotesDirective","$document","el","attrs","requires","insertFootnoteCommand","fire","FOOTNOTE_COMMAND_NAME","command","createFootnote","backlinkId","anchorIdPrefix","ckeditorBibliography","ctrl","insertHtml","ckeditorFootnotesAnchorIdPrefix","ckeditor","instance","scopeValueExpr","ckeditorFootnotes","$eval","addCommand","async","allowedContent","requiredContent","exec","ui","addButton","toolbar","require","ckeditorBibliographyDirective","refsRenderer","citationEditDialog","insertCitationCommand","CITATION_COMMAND_NAME","newReference","citation","createCitation","citations","render","rendered","refs","CitationEditorController","$filter","zotero","account","getUserAccount","ZOTERO_USER_ACCOUNT_ID","ZOTERO_USER_ACCOUNT_API_KEY","groupP","when","getGroup","ZOTERO_GROUP_ID","groupLibraryP","group","getLibrary","Error","warn","library","resultsP","searchItems","map","adaptItem","wrapItem","zItem","createBiblioItem","creators","adaptCreator","meta","pick","fields","omit","zCreator","role","creatorType","firstName","lastName","labelP","renderBiblioItem","addCitationItem","citationItem","referencedBibItem","bibliography","renderCitationItemLabel","clearForm","selectBiblioItem","itemContainer","activeCitationItem","editCitationItem","biblioItem","biblioItemContainer","selectedBiblioItem","searchText","renderedP","createZoteroItem","zoteroItem","cancelZoteroItem","saveZoteroItem","zItemP","saveItem","biblioItemP","itemContainerP","locatorTypes","LOCATOR_TYPES","edit","CitationEditDialogFactory","CitationEditDialogController","bibliographyDirective","watcher","collection","ZoteroEditorController","getItemTypes","typeFilter","field","selectType","itemType","getFields","getCreatorRoles","roles","itemTypeSearchText","ZoteroCreatorFieldController","creator","ZoteroFactory","getDefaultBaseUrl","toJson","ShowWorkController","relnRepo","$timeout","workId","bcTitle","getTitle","relationshipsPromise","loadRelationships","refsEndpointUrl","loading","getCurrentUri","relationships","currentUri","normalizeRelationships","editBibInfo","dialog","dialogPromise","updatedWork","saveWork","showSavedToast","editSummary","updatedSummary","editBibliography","addEdition","textContent","savePromise","editionName","saveEdition","editionId","addCopy","editCopy","copies","updatedCopy","deleteCopy","openRelationship","relationship","entity","entities","refParams","addRelationship","createRelationship","updatedRelationship","deleteRelationship","confirmPromise","deletePromise","deleteWork","showSuccessToast","message","workLabel","toast","simple","position","showErrorToast","subtitle","confirmDialog","WorkEditDialogController","addAuthor","authorRef","deleteAuthor","addTitle","deleteTitle","ShowVolumeController","volumeId","getWork","getEdition","getVolume","workTitle","updatedVolume","saveVolume","copyToEdition","origCopy","newCopy","VolumeEditDialogController","RelationshipEditDialogController","getTypes","target","createAnchor","targetEntities","self","entryUris","relatedEntities","descriptionMimeType","rawTypes","Object","defineProperty","identifier","reverse","isDirected","reverseTitle","results","setType","typeId","isReverse","swap","selectWork","workProxy","targets","workUri","uri","editionUri","editionTitle","volumeUri","volumeTitle","volumeNumber","selectedTarget","setTarget","selectedType","ShowEditionController","updatedEdition","addVolume","copyToWork","EditionEditDialogController","CopyEditDialogController","tasksRepoProvider","tasksRepoFactory","getAllTasks","taskResource","getTask","taskId","getWorkflow","workflowResource","getItems","stageId","itemResource","stage","start","max","transition","sourceStage","targetStage","itemId","comments","resp","TaskController","tasksRepo","tasks","openMenu","ShowTaskController","task","workflow","worklistPromises","stages","worklistPromise","fetchStage","focusItem","stopImmediatePropagation","entityId","transitionItem","updatedItem","worklists","stageOrder","ShowPersonController","personId","personRefsUrl","editBioInfo","updatedPerson","editEvent","updatedEvent","deletePerson","nameLabel","PersonEditDialogController","addName","createName","altNames","deleteName","nameRoles","EventEditDialogController","MainController","q","searchQuery","peopleResults","worksResults","createPerson","createWork","debounce","runBlock","debug","run","routerConfig","$stateProvider","$urlRouterProvider","state","views","main","otherwise","constant","$logProvider","$mdThemingProvider","worksRepoProvider","peopleRepoProvider","articlesRepoProvider","relnRepoProvider","categorizationServiceProvider","debugEnabled","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","citeprocProvider","addLocale","localeId","supplier","res","addStyle","styleId","$templateCache","put"],"mappings":"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","file":"scripts/app-a81920c3b5.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ckeditor',\n      'ngMaterial',\n      'trcCore',\n      'trcBiblio',\n      'trcTasks',\n      'trcBio',\n      'trcReln',\n      'trcRefs',\n      'trcArticles',\n      'zotero'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('titleEditor', titleEditorDirective);\n\n  /** @ngInject */\n  function titleEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/title-editor/title-editor.html',\n      scope: {\n        title: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('publicationInfoEditor', publicationInfoEditorDirective);\n\n  /** @ngInject */\n  function publicationInfoEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/publication-info-editor/publication-info-editor.html',\n      scope: {\n        pubInfo: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('copyEditor', copyEditorDirective);\n\n  /** @ngInject */\n  function copyEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/copy-editor/copy-editor.html',\n      scope: {\n        copy: '=ngModel'\n      },\n      controller: CopyEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function CopyEditorController($scope) {\n    var vm = this;\n\n    vm.refHandlers = {};\n    vm.setProperties = parseProperties;\n\n    activate();\n\n    function activate() {\n      addHandler(HathiTrustRefHandler());\n      addHandler(GoogleBooksRefHandler());\n      addHandler(InternetArchiveRefHandler());\n    }\n\n    function addHandler(handler) {\n      vm.refHandlers[handler.id] = handler;\n    }\n\n    function parseProperties(type, url) {\n      if (vm.refHandlers[type]) {\n        $scope.copy.properties = vm.refHandlers[type](url);\n      }\n\n      $scope.copyForm.url.$setValidity(type, $scope.copy.properties != null);\n    }\n  }\n\n  // https://archive.org/details/essayinanswertom00adamiala\n  // <iframe src='https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n7/mode/1up' width='480px' height='430px' frameborder='0' ></iframe>\n  // TODO add support for resources from OpenLibrary\n  // https://openlibrary.org/books/OL7186607M/An_essay_in_answer_to_Mr._Hume's_Essay_on_miracles.\n\n  /**\n   * A reference parse handler to support digital copies from the Internet\n   * Archive.\n   */\n  function InternetArchiveRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      if (parsed.path.substr(0, 8) === '/stream/') {\n        id = parsed.path.substr(8);\n\n        var pageNo = parsed.fragment.match(/page\\/([^\\/]+)/);\n        if (pageNo && pageNo.length >= 2) {\n          seq = pageNo[1];\n        }\n      }\n\n      return makePropertiesObject(url, id, seq);\n    }\n\n    handle.id = 'internetarchive';\n    handle.display = 'Internet Archive';\n\n    /**\n     * Constructs an object literal that represents the stored-properties\n     * to associate with an InternetArchive digital copy.\n     *\n     * @param  {string} src The source URL from which the properties were parsed.\n     * @param  {string} id  The identifier used to uniquely reference a\n     *                      particular digial copy at the Internet Archive.\n     * @param  {string} seq The sequence number that identifies the page to be\n     *                      used as the initial page of this digital copy.\n     * @return {object}     The object literal of properties to be associated\n     *                      with this digital copy.\n     */\n    function makePropertiesObject(src, id, seq) {\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: src,\n        id: id,\n        seq: seq\n      };\n    }\n\n    return handle;\n  }\n\n  function HathiTrustRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      switch (parsed.hostname) {\n        case 'babel.hathitrust.org':\n          id = parsed.query.id;\n          seq = parsed.query.seq;\n          break;\n\n        case 'hdl.handle.net':\n          id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1);\n\n          if (!parsed.query.urlappend) {\n            break;\n          }\n\n          var subquery = parseQueryString(parsed.query.urlappend);\n          if (!subquery) {\n            break;\n          }\n          seq = subquery.seq;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        htid: id,\n        seq: seq\n      };\n    }\n\n    handle.id = 'hathitrust';\n    handle.display = 'HathiTrust';\n\n    return handle;\n  }\n\n  function GoogleBooksRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      switch (parsed.hostname) {\n        case 'books.google.com':\n          var id = parsed.query.id;\n          var section = parsed.query.printsec;\n          var page = parsed.query.pg;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        id: id,\n        section: section,\n        page: page\n      };\n    }\n\n    handle.id = 'googlebooks';\n    handle.display = 'Google Books';\n\n    return handle;\n  }\n\n  /**\n   * Parses a URL string into its components\n   *\n   * @param  {string} url\n   * @return {URL}\n   */\n  function parseUrl(url) {\n    if (!url) {\n      return null;\n    }\n\n    // eslint-disable-next-line angular/document-service\n    var parser = document.createElement('a');\n    parser.href = url;\n\n    return {\n      toString: function() {\n        return url;\n      },\n      protocol: parser.protocol,\n      host: parser.host,\n      hostname: parser.hostname,\n      port: parser.port,\n      path: parser.pathname,\n      query: parseQueryString(parser.search),\n      fragment: parser.hash\n    };\n  }\n\n  /**\n   * Parses a query string into key/value pairs\n   *\n   * @param {string} query\n   * @return {object.<string,any>}\n   */\n  function parseQueryString(query, sep) {\n    if (!query || !angular.isString(query)) {\n      return {};\n    }\n\n    // remove leading '?'\n    if (query[0] === '?') {\n      query = query.substr(1);\n    }\n\n    // attempt to auto-detect separator\n    if (!sep) {\n      // auto-detection \"bitmask\"\n      // 0 = none detected -- prefer '&'\n      // 1 = only ';' detected -- use it\n      // 2 = only '&' detected -- use it\n      // 3 = both detected -- prefer '&'\n      var flags = (query.indexOf(';') >= 0 ? 1 : 0) + (query.indexOf('&') >= 0 ? 2 : 0);\n      sep = flags === 1 ? ';' : '&';\n    }\n\n    var parsed = {};\n\n    var kvpairs = query.split(sep);\n    kvpairs.forEach(function (pair) {\n      var ix = pair.indexOf('=');\n      var key = pair;\n      var value = null;\n\n      if (!key) {\n        return;\n      }\n\n      if (ix >= 0) {\n        key = pair.substr(0, ix);\n        value = pair.substr(ix + 1);\n      }\n\n      try {\n        key = decodeURIComponent(key);\n        value = decodeURIComponent(value);\n      } catch (URIError) {\n        return;\n      }\n\n      // TODO: handle key array/map notation\n\n      if (parsed.hasOwnProperty(key)) {\n        // convert repeated keys into an array\n        if (angular.isArray(parsed[key])) {\n          parsed[key].push(value);\n        } else {\n          parsed[key] = [parsed[key], value];\n        }\n      } else {\n        parsed[key] = value;\n      }\n    });\n\n    return parsed;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('authorRefEditor', authorRefEditorDirective);\n\n  /** @ngInject */\n  function authorRefEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/author-ref-editor/author-ref-editor.html',\n      scope: {\n        ref: '=ngModel'\n      },\n      controller: AuthorRefEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function AuthorRefEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.linkAuthorSearchText = '';\n      vm.authorRoles = [\n        'author',\n        'editor',\n        'translator',\n        'other'\n      ];\n\n      vm.setLinkedAuthor = setLinkedAuthor;\n      vm.getResults = getResults;\n\n      activate();\n\n      function activate() {\n        if ($scope.ref.authorId) {\n          var author = peopleRepo.get($scope.ref.authorId);\n          author.$promise.then(function () {\n            vm.linkAuthorSearchText = author.name.label;\n          })\n        }\n      }\n\n      function setLinkedAuthor(person) {\n        $scope.ref.authorId = person.id;\n      }\n\n      function getResults(query) {\n        var resultSet = peopleRepo.search(query);\n        return resultSet.$promise.then(function () {\n          return resultSet.items;\n        });\n      }\n\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditorItem', workEditorItemDirective);\n\n  /** @ngInject */\n  function workEditorItemDirective($log) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/task/components/work-editor-item/work-editor-item.html',\n      link: linkFunc,\n      scope: {\n        id: '=id'\n      },\n      controller: WorkEditorItemController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc($scope) {\n      if (!$scope.id) {\n        $log.error('missing required attribute \"id\"');\n      }\n    }\n\n    /** @ngInject */\n    function WorkEditorItemController($scope, worksRepo) {\n      var vm = this;\n\n      vm.loaded = false;\n\n      activate();\n\n      function activate() {\n        if ($scope.id) {\n          vm.work = worksRepo.get($scope.id);\n          vm.work.$promise.then(function () {\n            vm.loaded = true;\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditor', workEditorDirective);\n\n  /** @ngInject */\n  function workEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/work-editor/work-editor.html',\n      scope: {\n        work: '=ngModel'\n      },\n      controller: WorkEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function WorkEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.editions = [];\n\n      vm.createEdition = createEdition;\n      vm.deleteEdition = deleteEdition;\n\n      activate();\n\n      function activate() {\n        $scope.work.editions.forEach(function (edition) {\n          vm.editions.push({\n            model: edition,\n            focused: false\n          });\n        });\n      }\n\n      function createEdition() {\n        var edition = worksRepo.createEdition();\n        edition.titles = _.cloneDeep($scope.work.titles);\n        edition.authors = _.cloneDeep($scope.work.authors);\n\n        $scope.work.editions.push(edition);\n        vm.editions.push({\n          model: edition,\n          focused: true\n        });\n      }\n\n      function deleteEdition(ix) {\n        vm.editions.splice(ix, 1);\n        $scope.work.editions.splice(ix, 1);\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('volumeEditor', volumeEditorDirective);\n\n  /** @ngInject */\n  function volumeEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/volume-editor/volume-editor.html',\n      scope: {\n        volume: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('editionEditor', editionEditorDirective);\n\n  /** @ngInject */\n  function editionEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/edition-editor/edition-editor.html',\n      scope: {\n        edition: '=ngModel'\n      },\n      controller: EditionEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function EditionEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.volumes = [];\n\n      vm.createVolume = createVolume;\n      vm.deleteVolume = deleteVolume;\n\n      activate();\n\n      function activate() {\n        $scope.edition.volumes.forEach(function (volume) {\n          vm.volumes.push({\n            model: volume,\n            focused: false\n          });\n        });\n      }\n\n      function createVolume() {\n        var volume = worksRepo.createVolume();\n        volume.titles = _.cloneDeep($scope.edition.titles);\n        volume.authors = _.cloneDeep($scope.edition.authors);\n        volume.publicationInfo = _.cloneDeep($scope.edition.publicationInfo);\n\n        $scope.edition.volumes.push(volume);\n        vm.volumes.push({\n          model: volume,\n          focused: true\n        });\n      }\n\n      function deleteVolume(ix) {\n        vm.volumes.splice(ix, 1);\n        $scope.edition.volumes.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('nameEditor', nameEditorDirective);\n\n  /** @ngInject */\n  function nameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/name-editor/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('eventEditor', eventEditorDirective);\n\n  /** @ngInject */\n  function eventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/event-editor/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('sdaAdmin')\n      .directive('treeCategorizationEditor', treeCategorizationEditor);\n\n   /** @ngInject */\n   function treeCategorizationEditor() {\n      var directive = {\n         restrict: 'E',\n         templateUrl: 'app/admin/editors/articles/thematic-overview.html',\n         scope: {\n           scopeId: \"@\",\n           scheme: \"@\"\n          //  need param to indicate whether this categorization owns related entrties\n         },\n         controller: TreeCategorizationController,\n         controllerAs: 'vm'\n      };\n\n      return directive;\n   }\n\n   // NOTE this needs to move toward being a more general puropose control\n\n   /** @ngInject */\n   function TreeCategorizationController($scope, $log, $mdDialog, $mdToast, $state, $q,\n     articlesRepo, categorizationService) {\n\n     var vm = this;\n     var repo = null;\n\n     // TODO need to allow actions to be pluggable\n     vm.handleAssociateEntry = handleAssociateEntry;\n     vm.handleRemoveEntry = handleRemoveEntry;\n     vm.handleCreateChild = handleCreateChild;\n     vm.handleDeleteNode = handleDeleteNode;\n\n     activate();\n\n     //'overviews'\n     function activate() {\n       $log.info(\"Loading article editor\", articlesRepo);\n       repo = categorizationService.getScopedRepo($scope.scopeId);\n       // TODO need to handle case when this fails to load. Display throbber pending load\n       vm.overviews = repo.get($scope.scheme);\n     }\n\n     // TODO allow edit labels\n\n     /* ================================\n      * API METHODS\n      * ================================ */\n      function handleAssociateEntry($event, node) {\n        $log.info(\"creating article\");\n        // TODO need to offer option of create or link\n        // TODO magic string\n\n        var type = \"overviews\";\n        var title = node.label;\n\n        // TODO  display prompt dialog, allow entry of title, selection of type (but not)\n        // TODO error handling!!\n        var article = articlesRepo.create(\"overviews\", title);\n        var articlePromise = articlesRepo.save(article);\n        var linkPromise = articlePromise.then(linkArticle);\n\n        $q.all({\n          article: articlePromise,\n          ref: linkPromise\n        }).then(openEditor);\n\n        function linkArticle(article) {\n          var ref = repo.nodes.link(node, article.reference);\n          return ref.$promise;\n        }\n\n        function openEditor(values) {\n          $state.go(\"article.edit\", {\n            id: values.article.id\n          });\n        }\n        // TODO creates article and (once created) associates\n        //      that article with this node in the hierarchy.\n        //      On completion, opens that article in the editor.\n      }\n\n      function handleRemoveEntry($event, node) {\n        $log.info(\"Removing entry\", node);\n\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      If OK, removes the associated entry from this node\n        //      and then deletes the article.\n\n      }\n\n      /**\n       * Handler to be invoked to create a new category with an hierarchical\n       * categorization.\n       *\n       * @param  {event} $event  The event that triggered this request.\n       * @param  {object} parent The parent node on which the child should be created.\n       * @return {[type]}        [description]\n       */\n      function handleCreateChild($event, parent) {\n        $log.info(parent);\n\n        var newCategoryDialog = $mdDialog.prompt({\n          title: \"Enter Category Label\",\n          // TODO add description\n          placeholder: 'new category',\n          ok: \"Create\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(newCategoryDialog)\n                 .then(onCreate);\n\n        function onCreate(label) {\n          $log.info(\"Creating category \" + label);\n\n          repo.nodes.create(parent, label);\n        }\n      }\n\n      function handleDeleteNode($event, node, parent) {\n        $log.info(node);\n\n        var title = \"Delete category '\" + node.label + \"'\";\n        var msg = \"<p>This will delete the selected category, \" + node.label + \", \" +\n                  \"its sub-categories and all associated articles.\" +\n                  \"<em>This action cannot be undone.</em></p>\" +\n                  \"<p>Permanently delete this category?</p>\";\n        var removeCatgorizationDialog = $mdDialog.confirm({\n          title: title,\n          htmlContent: msg,\n          ok: \"Delete\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(removeCatgorizationDialog).then(function() {\n           // TODO dispaly success/failure toasts\n           repo.nodes.remove(node, true, parent).then(function () {\n             return 'category deleted';\n           }, function () {\n             return 'unable to delete category';\n           })\n           .then(function (msg) {\n             $mdToast.showSimple(msg);\n           });\n         });\n\n\n        function deleteNode() {\n        }\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      Recursively removes all articles associated with descendants\n        //      Removes this categorization entry (and children)\n      }\n\n      /* ================================\n       * PRIVATE METHODS\n       * ================================ */\n\n       function getChildren(node) {\n         if (node.childIds.length != node.chilren.length) {\n           throw new Error(\"Lazy loading of children not yet supported.\");\n         }\n\n         return $q.when(node.chilren);\n       }\n\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n// TODO admin-page-articles\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorSectionController', ArticleEditorSectionController);\n\n  /** @ngInject */\n  function ArticleEditorSectionController(articlesRepo, $log, categorizationService) {\n    var vm = this;\n    //\n    // vm.handleAssociateEntry = handleAssociateEntry;\n    // vm.handleRemoveEntry = handleRemoveEntry;\n    // vm.handleCreateChild = handleCreateChild;\n    // vm.handleDeleteNode = handleDeleteNode;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo);\n      // var repo = categorizationService.getScopedRepo('default');\n      // vm.overviews = repo.get('overviews');\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n\n    //  function handleAssociateEntry($event) {\n    //    $log(\"creating article\");\n     //\n    //  }\n     //\n    //  function handleRemoveEntry($event, node) {\n    //    $log.info(node);\n    //  }\n    //  function handleCreateChild($event, node) {\n    //    $log.info(node);\n    //  }\n    //  function handleDeleteNode($event, node) {\n    //    $log.info(node);\n    //  }\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorController', ArticleEditorController);\n\n  var CKEDITOR_CONFIG = {\n    toolbarGroups: [\n      { name: 'styles', groups: [ 'styles' ] },\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n      { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n      { name: 'colors', groups: [ 'colors' ] },\n      { name: 'links', groups: [ 'links' ] },\n      { name: 'insert', groups: [ 'insert' ] },\n      { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },\n      { name: 'forms', groups: [ 'forms' ] },\n      { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },\n      { name: 'tools', groups: [ 'tools' ] },\n      { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },\n      { name: 'others', groups: [ 'others' ] },\n    ],\n\n    // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n    format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address',\n\n    extraPlugins: 'mathjax',\n\n    mathJaxLib: '//cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-MML-AM_CHTML'\n  };\n\n  /** @ngInject */\n  function ArticleEditorController($q, $log, $stateParams, $scope, $mdBottomSheet, articlesRepo, refsRepoFactory) {\n    var refsRepoUrl = articlesRepo.getReferencesEndpoint($stateParams.id);\n    var refsRepo = refsRepoFactory.getRepo(refsRepoUrl);\n\n    var vm = this;\n\n    vm.save = save;\n    vm.cancel = cancel;\n    vm.body = \"test\";\n\n    vm.abstractEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'HorizontalRule',\n          'Maximize',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editFootnote = editFootnote;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo)\n\n      vm.article = articlesRepo.get($stateParams.id);\n      vm.references = refsRepo.get();\n\n      $q.all([vm.article.$promise, vm.references.$promise]).then(function () {\n        // start watching for opportunities to remove unused citations and footnotes\n        $scope.$watch('vm.article.body', cleanArticleHandler);\n        $scope.$watchCollection('vm.article.footnotes', cleanRefsHandler);\n      });\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n     function save() {\n        articlesRepo.save(vm.article);\n        refsRepo.save(vm.references);\n     }\n\n     function cancel() {\n       alert('cancel');\n     }\n\n     /**\n      * Displays a bottom sheet to edit an existing footnote.\n      * Delegates to the edit dialog in ckeditor-footnotes component, which should probably be refactored elsewhere.\n      * @param  {MouseEvent} $event\n      * @param  {Footnote} footnote\n      */\n     function editFootnote($event, footnote) {\n       var newFootnote = angular.copy(footnote);\n       var newReferences = refsRepoFactory.createRefCollection();\n\n       var config = {\n         templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n         controller: 'FootnoteEditDialogController',\n         controllerAs: 'vm',\n         clickOutsideToClose: false,\n         locals: {\n           footnote: newFootnote,\n           references: newReferences\n         }\n       };\n\n       var promise = $mdBottomSheet.show(config);\n\n       promise.then(function () {\n         vm.article.footnotes[newFootnote.id] = newFootnote;\n\n         // update bibliography\n         var updatedReferences = refsRepoFactory.merge(vm.references, refsRepoFactory.compact(newReferences));\n         angular.merge(vm.references, updatedReferences);\n       });\n     }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n\n     function cleanRefsHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanReferences(vm.article, vm.references);\n       vm.references = refsRepo.compact(vm.references);\n     }\n\n     function cleanArticleHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanFootnotes(vm.article, vm.article.footnotes);\n       cleanRefsHandler(obj);\n     }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero', [\n      'ngAnimate',\n      'ngAria',\n      'ngMaterial',\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .controller('ZoteroTestController', ZoteroTestController);\n\n  /** @ngInject */\n  function ZoteroTestController() {\n    var vm = this;\n\n    vm.item = {};\n\n    vm.types = [];\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcCore', [\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcCore')\n    .provider('categorizationService', categorizationRepoProvider);\n\n  var Strategies = {\n    set: \"set\",\n    list: \"list\",\n    tree: \"hierarchical\"\n  };\n\n  function categorizationRepoProvider() {\n    var provider = {};\n    provider.url = '/api/categorizations';\n    provider.$get = categorizationRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function categorizationRepoFactory($q, $resource, $http) {\n      var repo = {\n        getScopedRepo: getScopedRepo\n      };\n\n      var schemesResource = $resource(provider.url + '/:scopeId/:key', {\n        key: '@key'\n      });\n      var nodeResource = $resource(provider.url + '/:scopeId/:schemeId/nodes/:nodeId', {\n        schemeId: '@schemeId',\n        nodeId: '@nodeId'\n      });\n      var nodeChilrenResource = $resource(provider.url + '/:scopeId/:schemeId/nodes/:nodeId/children', {\n        schemeId: '@schemeId',\n        nodeId: '@nodeId'\n      });\n      var associatedEntryResource = $resource(provider.url + '/:scopeId/:schemeId/nodes/:nodeId/entryRef', {\n        schemeId: '@schemeId',\n        nodeId: '@nodeId'\n      }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n\n      // REPO API DEFN goes here\n      return repo;\n\n      function getScopedRepo(scopeId) {\n        return new ScopedRepository(scopeId);\n      }\n\n      /**\n       * Creates a new ScopedRepository.\n       *\n       * @param {string} scopeId The scope id that will be used by this\n       *                         repository\n       * @constructor\n       * @classdesc The primary API for working with categorizations. Categorizations\n       * are defined relative to a scope id.\n       *\n       * TODO explain why here.\n       */\n      function ScopedRepository(scopeId) {\n\n        this.get = getCategorization;\n        this.create = createCategorization;\n        this.remove = removeCategorization;\n\n        this.nodes = {\n          get: getNode,\n          getChildren: getNodeChildren,\n\n          create: createNode,\n          move: moveNode,\n          remove: removeNode,\n          update: updateNode,\n          link: linkEntry,\n          unlink: unlinkEntry\n        };\n\n        /* ================================\n         * ScopedRepository API METHODS\n         * ================================ */\n\n        function getCategorization(key) {\n          // HACK: load from local file. Note that this does not match the eventual behavior of the resource-backed API\n          // return $http.get('app/trc-core/categorizations/overviews.json').then(function(response) { return response.data; });\n          return schemesResource.get({scopeId: scopeId, key: key });\n        }\n\n        function createCategorization(key, label, description, type) {\n          // TODO convert to object\n          // TODO VERIFY KEY, check uniqueness\n          var data = {\n            key: key,\n            label: label,\n            description: description,\n            type: type\n          }\n        }\n\n        function removeCategorization(key) {\n\n        }\n\n        function getNode(schemeId, nodeId) {\n\n        }\n\n        function getNodeChildren(node) {\n\n        }\n\n        function createNode(parent, label, description) {\n          var options = {\n            scopeId: scopeId,\n            schemeId: parent.schemeId,\n            nodeId: parent.id\n          };\n           var data = {\n            label: label,\n            description: description\n          };\n\n          var result = nodeChilrenResource.save(options, data);\n          result.$promise.then(function(node) {\n            parent.childIds.push(node.id);\n            parent.children.push(node);\n          });\n\n          return result;\n        }\n\n\n        /**\n         * [removeNode description]\n         * @param  {[type]} node       [description]\n         * @param  {boolean} removeRefs [description]\n         * @return {[type]}            [description]\n         */\n        function removeNode(node, removeRefs, parent) {\n          var result = nodeResource.delete({\n            scopeId: scopeId,\n            schemeId: node.schemeId,\n            nodeId: node.id,\n            remove_refs: !!removeRefs\n          });\n\n          if (parent) {\n            // remove child from parent node\n            result.$promise.then(function () {\n              var ix = parent.children.indexOf(node)\n              if (ix >= 0) {\n                parent.children.splice(ix, 1);\n              }\n            });\n          }\n\n          return result.$promise;\n        }\n        function moveNode() {\n\n        }\n\n\n        function updateNode() {\n\n        }\n\n        function linkEntry(node, entryRef) {\n          var params = {\n            scopeId: scopeId,\n            schemeId: node.schemeId,\n            nodeId: node.id\n          };\n\n          var result = associatedEntryResource.update(params, entryRef);\n          result.$promise.then(function(ref) {\n            node.entryRef = ref;\n          });\n\n          return result;\n        }\n\n        function unlinkEntry() {\n          var params = {\n            scopeId: scopeId,\n            schemeId: node.schemeId,\n            nodeId: node.id\n          };\n\n          var result = associatedEntryResource.delete(params);\n          result.$promise.then(function() {\n            node.entryRef = null;\n          });\n\n          return result;\n        }\n\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('SummaryEditDialogController', SummaryEditDialogController);\n\n  /** @ngInject */\n  function SummaryEditDialogController($mdDialog, summary) {\n    var vm = this;\n\n    vm.summary = summary;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.summary);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('summaryEditor', summaryEditorDirective);\n\n  /** @ngInject */\n  function summaryEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/summary-editor/summary-editor.html',\n      scope: {\n        summary: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.config = {\n        // FIXME set up minimal toolbar and restrict HTML content\n        toolbarGroups: [\n          { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n          { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n          { name: 'links', groups: [ 'links' ] },\n          { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n        ],\n\n        removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles'\n      };\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('stripTags', stripTagsFilter);\n\n  function stripTagsFilter() {\n    return stripTags;\n  }\n\n  function stripTags(html) {\n    return html ? String(html).replace(/<[^>]+>/gm, '') : '';\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .animation('.slide', slideToggle);\n\n  function slideToggle() {\n    var NG_HIDE_CLASS = 'ng-hide';\n\n    return {\n      beforeAddClass: beforeAddClass,\n      removeClass: removeClass\n    };\n\n    function beforeAddClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.slideUp(done);\n      }\n    }\n\n    function removeClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.hide().slideDown(done);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('navbar', {\n      templateUrl: 'app/components/navbar/navbar.html',\n      bindings: {\n        title: '@',\n        sidenavId: '@?'\n      },\n      controller: NavbarController\n    });\n\n  /** @ngInject */\n  function NavbarController($mdSidenav) {\n    var vm = this;\n\n    vm.toggleSidenav = toggleSidenav;\n\n    activate();\n\n    function activate() {\n\n    }\n\n    function toggleSidenav(id) {\n      $mdSidenav(id).toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  /**\n  * Formats ranked by precedence to check for when parsing date strings.\n  *\n  * NOTE: dashes can be any number of non-alphanumeric characters, so 'DD-MM-YYYY' parses\n  *       '02/02/2015', '02.02.2015', '02:02,2015', and '02*#!02   ^^^2015' into '02-02-2015'\n  *\n  * @type {Array}\n  */\n  var INFER_FORMATS = [\n    // year\n    'YYYY',             // e.g. 2015\n\n    // month year\n    'MMMM-YYYY',        // e.g. February 2015\n    'MMM-YYYY',         // e.g. Feb. 2015\n    'MM-YYYY',          // e.g. 02/2015\n    'M-YYYY',           // e.g. 2/2015\n\n    // year month\n    'YYYY-MMMM',        // e.g. 2015 February\n    'YYYY-MMM',         // e.g. 2015 Feb.\n    'YYYY-MM',          // e.g. 2015-02\n    'YYYY-M',           // e.g. 2015-2\n\n    // month day year\n    'MMMM-DD-YYYY',     // e.g. February 02, 2015\n    'MMM-DD-YYYY',      // e.g. Feb. 02, 2015\n    'MM-DD-YYYY',       // e.g. 02/02/2015\n    'M-DD-YYYY',        // e.g. 2/02/2015\n    'MMMM-D-YYYY',      // e.g. February 2, 2015\n    'MMM-D-YYYY',       // e.g. Feb. 2, 2015\n    'MM-D-YYYY',        // e.g. 02-2-2015\n    'M-D-YYYY',         // e.g. 2/2/2015\n\n    // day month year\n    'DD-MMMM-YYYY',     // e.g. 02 February 2015\n    'DD-MMM-YYYY',      // e.g. 02 Feb. 2015\n    'DD-MM-YYYY',       // e.g. 02/02/2015\n    'DD-M-YYYY',        // e.g. 02/2/2015\n    'D-MMMM-YYYY',      // e.g. 2 February 2015\n    'D-MMM-YYYY',       // e.g. 2 Feb. 2015\n    'D-MM-YYYY',        // e.g. 2/02/2015\n    'D-M-YYYY',         // e.g. 2/2/2015\n\n    // year month day\n    'YYYY-MM-DD',       // e.g. 2015-02-02\n    'YYYY-M-D'          // e.g. 2015-2-2\n  ];\n\n  angular\n    .module('sdaAdmin')\n    .factory('guessDate', guessDateFactory);\n\n  /** @ngInject */\n  function guessDateFactory(moment) {\n    return guessDate;\n\n    /**\n     * Parse a date string into a Moment.\n     *\n     * See moment.js\n     *\n     * @param  {string} str Date string to parse\n     * @return {Moment}     Parsed moment\n     */\n    function guessDate(str) {\n        return moment(str, INFER_FORMATS);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('dateEditor', dateEditorDirective);\n\n  /** @ngInject */\n  function dateEditorDirective(guessDate) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/date-editor/date-editor.html',\n      scope: {\n        date: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      // indicates whether the current value in the date.calendar field was automatically set\n      scope.calendarAutoSet = false;\n\n      scope.$watch('date.description', function (dateDescription) {\n        if (dateDescription && (!scope.date.calendar || scope.calendarAutoSet)) {\n          scope.date.calendar = guessDate(dateDescription).format('YYYY-MM-DD');\n          scope.calendarAutoSet = true;\n        }\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('DataContainerController', DataContainerController);\n\n\n  /** @ngInject */\n  function DataContainerController() {\n    var vm = this;\n    var listeners = [];\n\n    vm.watch = watch;\n    vm.set = set;\n    vm.value = null;\n\n    /**\n     * Attach a listener to watch for value changes\n     * @param  {Function} fn listener callback\n     * @return {Function} unregister function\n     */\n    function watch(fn) {\n      listeners.push(fn);\n      fn(vm.value);\n      return unregister;\n\n      function unregister() {\n        var ix = listeners.indexOf(fn);\n        if (ix >= 0) {\n          listeners.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Updates internal value\n     * @param {*} newValue\n     */\n    function set(newValue) {\n      if (vm.value === newValue) {\n        return;\n      }\n\n      vm.value = newValue;\n\n      listeners.forEach(function (fn) {\n        fn(newValue);\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('FootnoteEditDialogController', FootnoteEditDialogController);\n\n  /** @ngInject */\n  function FootnoteEditDialogController($mdBottomSheet, footnote, references) {\n    var vm = this;\n\n    vm.footnote = footnote;\n    vm.references = references;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdBottomSheet.hide();\n    }\n\n    function cancel() {\n      $mdBottomSheet.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorFootnotes', ckeditorFootnotesDirective);\n\n  /** @ngInject */\n  function ckeditorFootnotesDirective($document, $mdBottomSheet, articlesRepo, refsRepoFactory) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorFootnotes', '?ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var anchorIdPrefix = attrs.ckeditorFootnotesAnchorIdPrefix || 'fn_anchor_';\n\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n      var ckeditorBibliography = requires[2];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorFootnotes;\n\n      // capture footnotes reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (footnotes) {\n        if (ctrl.value !== footnotes) {\n          ctrl.set(footnotes);\n        }\n      });\n\n      var FOOTNOTE_COMMAND_NAME = 'insertFootnote';\n      editor.addCommand(FOOTNOTE_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        requiredContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        exec: insertFootnoteCommand\n      });\n\n      editor.ui.addButton('Footnote', {\n        label: 'Insert Footnote',\n        command: FOOTNOTE_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertFootnoteCommand(editor) {\n        var command = this;\n\n        // create a new footnote object to edit.\n        var newFootnote = articlesRepo.createFootnote();\n        newFootnote.backlinkId = anchorIdPrefix + newFootnote.id;\n\n        var newReferences = ckeditorBibliography ? refsRepoFactory.createRefCollection() : null;\n\n        var config = {\n          templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n          controller: 'FootnoteEditDialogController',\n          controllerAs: 'vm',\n          clickOutsideToClose: false,\n          locals: {\n            footnote: newFootnote,\n            references: newReferences\n          }\n        };\n\n        var promise = $mdBottomSheet.show(config);\n\n        promise.then(function () {\n          ctrl.value[newFootnote.id] = newFootnote;\n\n          // update bibliography if provided\n          if (newReferences && ckeditorBibliography) {\n            var updatedReferences = refsRepoFactory.merge(ckeditorBibliography.value, refsRepoFactory.compact(newReferences));\n            angular.merge(ckeditorBibliography.value, updatedReferences);\n          }\n\n          editor.insertHtml('<sup contenteditable=\"false\" class=\"footnote\" id=\"' + newFootnote.backlinkId + '\" data-footnote=\"' + newFootnote.id + '\">#</a>');\n          done();\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: FOOTNOTE_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorBibliography', ckeditorBibliographyDirective);\n\n  /** @ngInject */\n  function ckeditorBibliographyDirective($mdDialog, $document, refsRepoFactory, refsRenderer, citationEditDialog) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorBibliography;\n\n      // capture bibliography reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (refs) {\n        if (ctrl.value !== refs) {\n          ctrl.set(refs);\n        }\n      });\n\n      var CITATION_COMMAND_NAME = 'insertCitation';\n      editor.addCommand(CITATION_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'cite[id,contenteditable]',\n        requiredContent: 'cite[id,contenteditable]',\n        exec: insertCitationCommand\n      });\n\n      editor.ui.addButton('Citation', {\n        label: 'Insert Citation',\n        command: CITATION_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertCitationCommand(editor) {\n        var command = this;\n\n        // create citation object with its own ref collection for editing\n        var newReference = refsRepoFactory.createRefCollection();\n        var citation = refsRepoFactory.createCitation();\n        newReference.citations[citation.id] = citation;\n\n        citationEditDialog.show(newReference).then(function () {\n          var updatedReferences = refsRepoFactory.merge(ctrl.value, refsRepoFactory.compact(newReference));\n          angular.merge(ctrl.value, updatedReferences);\n\n          refsRenderer.render('modern-language-association', newReference).then(function (rendered) {\n            var label = rendered.citations[citation.id];\n            editor.insertHtml('<cite id=\"' + citation.id + '\" contenteditable=\"false\">' + label + '</cite>')\n            done();\n          });\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: CITATION_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n/**\n * @typedef ItemContainer\n * @type {object}\n * @property {string} id\n * @property {string} label\n * @property {BiblioItem} item\n */\n\n(function () {\n  'use strict';\n\n  var LOCATOR_TYPES = [\n    'book', 'chapter', 'column', 'figure', 'folio', 'issue', 'line', 'note', 'opus', 'page',\n    'paragraph', 'part', 'section', 'sub verbo', 'verse', 'volume'\n  ];\n\n  var ZOTERO_USER_ACCOUNT_ID = '2536190';\n  var ZOTERO_USER_ACCOUNT_API_KEY = '3A4q05BNg0h0bHKJkpoCi1Oa';\n  var ZOTERO_GROUP_ID = '381134';\n\n  angular\n    .module('sdaAdmin')\n    .component('citationEditor', {\n      templateUrl: 'app/components/citation-edit-dialog/citation-editor.html',\n      controller: CitationEditorController,\n      bindings: {\n        references: '=',\n        citation: '='\n      }\n    });\n\n  /** @ngInject */\n  function CitationEditorController($filter, $q, $log, $mdDialog, zotero, _, refsRepoFactory, refsRenderer) {\n    var vm = this;\n\n    // referenced item autocomplete models\n    vm.selectedBiblioItem = null;\n    vm.searchText = '';\n\n    vm.locatorTypes = LOCATOR_TYPES;\n\n    vm.activeCitationItem = {};\n\n    vm.groupLibraryP = null;\n\n    vm.zoteroItem = null\n\n    vm.search = search;\n    vm.addCitationItem = addCitationItem;\n    vm.selectBiblioItem = selectBiblioItem;\n    vm.edit = editCitationItem;\n    vm.createZoteroItem = createZoteroItem;\n    vm.cancelZoteroItem = cancelZoteroItem;\n    vm.saveZoteroItem = saveZoteroItem;\n\n    var stripTags = $filter('stripTags');\n\n    activate();\n\n    function activate() {\n      var account = zotero.getUserAccount(ZOTERO_USER_ACCOUNT_ID, ZOTERO_USER_ACCOUNT_API_KEY);\n\n      // account.getGroup and account.getLibrary return native Promises.\n      // we wrap them in $q promises for consistency\n      var groupP = $q.when(account.getGroup(ZOTERO_GROUP_ID));\n      vm.groupLibraryP = groupP.then(function (group) {\n        return $q.when(account.getLibrary(group));\n      });\n\n      if (!vm.citation) {\n        throw new Error('no citation provided');\n      }\n\n      if (!vm.references.citations[vm.citation.id]) {\n        $log.warn('Citation is not a member of the provided reference collection. Adding to collection...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      } else if (vm.references.citations[vm.citation.id] !== vm.citation) {\n        $log.warn('provided citation does not match citation in reference collection. Overriding...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      }\n    }\n\n    /**\n     * Provides autocomplete items\n     * @param  {string} query\n     * @return {Promise.<ItemContainer[]>}\n     */\n    function search(query) {\n      return vm.groupLibraryP.then(function (library) {\n        // library.searchItems returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        var resultsP = $q.when(library.searchItems(query))\n        return resultsP.then(function (items) {\n          return $q.all(items.map(adaptItem).map(wrapItem));\n        });\n      });\n    }\n\n    /**\n     * Adapts a ZoteroItem for use in the autocomplete field and citation metadata\n     * @param  {ZoteroItem} zItem\n     * @return {BiblioItem}\n     */\n    function adaptItem(zItem) {\n      var id = 'zotero/' + zItem.library.id + '/' + zItem.id;\n\n      var item = refsRepoFactory.createBiblioItem(id);\n      item.type = zItem.type;\n      item.creators = zItem.properties.creators.map(adaptCreator);\n\n      // NOTE: this omits a lot of metadata fields... need to decide what other metadata (if any) to keep.\n\n      item.meta = angular.extend(\n        _.pick(zItem.meta, ['creatorSummary', 'parsedDate']),\n        _.pick(zItem.properties, ['key', 'dateAdded', 'dateModified'])\n      );\n\n      item.fields = _.omit(zItem.properties, [\n        // these properties are extracted to the top-level item\n        'creators', 'itemType',\n        // these properties are extracted to metadata\n        'key', 'dateAdded', 'dateModified',\n        // these properties are just forgotten\n        'version', 'collections', 'tags', 'relations'\n      ]);\n\n      return item;\n    }\n\n    /**\n     * Adapts a Zotero creator for use in the BiblioItem TRC-local type\n     * @param  {ZoteraCreator}\n     * @return {Creator}\n     */\n    function adaptCreator(zCreator) {\n      return {\n        role: zCreator.creatorType,\n        firstName: zCreator.firstName,\n        lastName: zCreator.lastName,\n        name: zCreator.name\n      };\n    }\n\n    /**\n     * Wraps a BiblioItem for use in the autocomplete field and citation metadata\n     * @param  {BiblioItem} item\n     * @return {Promise.<ItemContainer>}\n     */\n    function wrapItem(item) {\n      var labelP = refsRenderer.renderBiblioItem('modern-language-association', item);\n\n      return labelP.then(function (label) {\n        return {\n          id: item.id,\n          label: label,\n          item: item\n        };\n      });\n    }\n\n    /**\n     * Appends the given citation item to the citation\n     * @return {CitationItem}\n     */\n    function addCitationItem(citationItem) {\n      if (vm.citation.items.indexOf(citationItem) < 0) {\n        // new item\n        vm.citation.items.push(citationItem);\n      } else {\n        // edited existing item in-place\n      }\n\n      // set/update label\n      var referencedBibItem = vm.references.bibliography[citationItem.id];\n      renderCitationItemLabel(citationItem, referencedBibItem).then(function (label) {\n        citationItem.label = label;\n      });\n\n      // clear active item and start editing a new one\n      clearForm();\n    }\n\n    /**\n     * Sets the current citation item's referent id to the given item's id and\n     * adds the given item to the bibliography\n     * @param {ItemContainer} itemContainer\n     */\n    function selectBiblioItem(itemContainer) {\n      if (itemContainer) {\n        vm.activeCitationItem.id = itemContainer.id;\n        vm.references.bibliography[itemContainer.id] = itemContainer.item;\n      } else {\n        vm.activeCitationItem.id = null;\n      }\n    }\n\n    /**\n     * Sets the given citation item as the item being actively edited\n     * @param {CitationItem} item\n     */\n    function editCitationItem(citationItem) {\n      var biblioItem = vm.references.bibliography[citationItem.id];\n      return wrapItem(biblioItem).then(function (biblioItemContainer) {\n        vm.activeCitationItem = citationItem;\n        vm.selectedBiblioItem = biblioItemContainer;\n        vm.searchText = stripTags(vm.selectedBiblioItem.label);\n      });\n    }\n\n    /**\n     * Resets the model behind the citation item form\n     */\n    function clearForm() {\n      vm.activeCitationItem = {};\n      vm.searchText = '';\n      vm.selectedBiblioItem = null;\n    }\n\n    /**\n     * Renders a label for a single citation item\n     * @praam {CitationItem} citationItem\n     * @param {ZoteroItem} biblioItem Corresponding bibliographic item\n     * @return {Promise.<string>}\n     */\n    function renderCitationItemLabel(citationItem, biblioItem) {\n      // create a singleton citation for the citation item\n      var citation = refsRepoFactory.createCitation();\n      citation.items.push(citationItem);\n\n      // create a singleton reference for the singleton citation\n      var reference = refsRepoFactory.createRefCollection();\n      reference.citations[citation.id] = citation;\n      reference.bibliography[citationItem.id] = biblioItem;\n\n      var renderedP = refsRenderer.render('modern-language-association', reference);\n\n      return renderedP.then(function (rendered) {\n        return rendered.citations[citation.id];\n      });\n    }\n\n    function createZoteroItem() {\n      vm.zoteroItem = {};\n    }\n\n    function cancelZoteroItem() {\n      vm.zoteroItem = null;\n    }\n\n    function saveZoteroItem($event, item) {\n      var zItemP = vm.groupLibraryP.then(function (library) {\n        // library.saveItem returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        return $q.when(library.saveItem(item));\n      });\n\n      var biblioItemP = zItemP.then(adaptItem);\n\n      var itemContainerP = biblioItemP.then(wrapItem);\n\n      itemContainerP.then(function (item) {\n        vm.selectedBiblioItem = item;\n        selectBiblioItem(item);\n        vm.searchText = stripTags(item.label);\n        vm.zoteroItem = null;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('citationEditDialog', CitationEditDialogFactory);\n\n  /** @ngInject */\n  function CitationEditDialogFactory($mdDialog, _, refsRepoFactory) {\n    return {\n      show: show\n    };\n\n    /**\n     * Displays the edit dialog.\n     * @param  {ReferenceCollection} references\n     * @param  {Citation} [citation]\n     * @param  {MouseEvent} [$event]\n     * @return {Promise.<ReferenceCollection>}\n     */\n    function show(references, citation, $event) {\n      if (!citation) {\n        var citations = _.values(references.citations);\n\n        if (citations.length === 0) {\n          citation = refsRepoFactory.createCitation();\n          references.citations[citation.id] = citation;\n        } else {\n          citation = citations[0];\n        }\n      } else if (angular.isString(citation)) {\n        citation = references.citations[citation];\n      }\n\n      if (!citation) {\n        throw new Error('Unable to find a suitable citation. Please pass one explicitly or check that the reference collection is not malformed');\n      }\n\n      var config = {\n        targetEvent: $event,\n        templateUrl: 'app/components/citation-edit-dialog/citation-edit-dialog.html',\n        controller: 'CitationEditDialogController',\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          references: references,\n          citation: citation\n        }\n      };\n\n      return $mdDialog.show(config).then(function () {\n        return references;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('CitationEditDialogController', CitationEditDialogController);\n\n  /** @ngInject */\n  function CitationEditDialogController($mdDialog, references, citation) {\n    var vm = this;\n\n    vm.references = references;\n    vm.citation = citation;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdDialog.hide();\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('bibliography', bibliographyDirective);\n\n  function bibliographyDirective(refsRenderer) {\n    var directive = {\n      restrict: 'E',\n      scope: {\n        collection: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope, el) {\n      scope.$watch('collection', watcher, true);\n\n      function watcher(obj) {\n        if (!obj) {\n          return;\n        }\n\n        refsRenderer.render('modern-language-association', scope.collection).then(function (rendered) {\n          el.html(rendered.bibliography.html);\n        });\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroEditor', {\n      templateUrl: 'app/zotero/editor.html',\n      controller: ZoteroEditorController,\n      bindings: {\n        item: '=',\n        typeFilter: '<types'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroEditorController(zotero) {\n    var vm = this;\n\n    vm.itemTypeSearchText = '';\n    vm.itemType = null;\n\n    vm.types = [];\n    vm.fields = [];\n    vm.roles = [];\n\n    vm.selectType = selectType;\n\n    activate();\n\n    function activate() {\n      zotero.getItemTypes().then(function (types) {\n        vm.types = (vm.typeFilter && vm.typeFilter.length > 0)\n          ? types.filter(function (field) {\n              return vm.typeFilter.indexOf(field.id) >= 0;\n            })\n          : types;\n      });\n\n      if (!vm.item.creators) {\n        vm.item.creators = [{}];\n      }\n\n      if (vm.item.creators.length === 0) {\n        vm.item.creators.push({});\n      }\n    }\n\n    function selectType(itemType) {\n      if (!itemType) {\n        vm.item.itemType = null;\n        vm.fields = [];\n        vm.roles = [];\n        return;\n      }\n\n      vm.item.itemType = itemType.id;\n\n      itemType.getFields().then(function (fields) {\n        vm.fields = fields;\n      });\n\n      itemType.getCreatorRoles().then(function (roles) {\n        vm.roles = roles;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroCreatorField', {\n      templateUrl: 'app/zotero/creator-field.html',\n      controller: ZoteroCreatorFieldController,\n      bindings: {\n        creator: '=',\n        roles: '<'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroCreatorFieldController() {\n  }\n\n})();\n\n/*global zotero:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .factory('zotero', ZoteroFactory);\n\n  /** @ngInject */\n  function ZoteroFactory() {\n    return new zotero(zotero.getDefaultBaseUrl(), angular.toJson);\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowWorkController', ShowWorkController);\n\n  /** @ngInject */\n  function ShowWorkController($state, $stateParams, worksRepo, relnRepo, refsRepoFactory, $mdDialog, $mdToast, $q, $timeout, citationEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.title = null;\n    vm.relationships = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.addEdition = addEdition;\n    vm.deleteEdition = deleteEdition;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n    vm.deleteWork = deleteWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n\n      vm.work = worksRepo.get(workId);\n\n      vm.work.$promise.then(function () {\n        vm.bcTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n        vm.title = worksRepo.getTitle(vm.work.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      var relationshipsPromise = loadRelationships();\n\n      var refsEndpointUrl = worksRepo.getReferencesEndpoint(workId);\n      refsRepo = refsRepoFactory.getRepo(refsEndpointUrl);\n      vm.references = refsRepo.get();\n\n      $q.all([vm.work.$promise, relationshipsPromise, vm.references.$promise]).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function getCurrentUri() {\n      var workId = $stateParams.workId;\n      return 'works/' + workId;\n    }\n\n    function loadRelationships() {\n      vm.relationships = [];\n      var currentUri = getCurrentUri();\n      var relationships = relnRepo.search(currentUri);\n      return relationships.$promise.then(function () {\n        vm.relationships = relnRepo.normalizeRelationships(relationships, currentUri, worksRepo);\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          work: angular.copy(vm.work)\n        },\n        controller: 'WorkEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedWork) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.work, updatedWork);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.work.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.work.summary = updatedSummary;\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast);\n      });\n    }\n\n    function addEdition($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Edition')\n        .textContent('Please provide a name for the new edition.')\n        .placeholder('edition name')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (editionName) {\n        var edition = worksRepo.createEdition();\n        edition.editionName = editionName;\n        edition.titles = angular.copy(vm.work.titles);\n        edition.authors = angular.copy(vm.work.authors);\n\n        vm.work.editions.push(edition);\n\n        // resolve to the created edition when save is successful\n        return worksRepo.saveEdition(vm.work.id, edition);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (edition) {\n        $state.go('editor.edition', { workId: vm.work.id, editionId: edition.id });\n      });\n    }\n\n    function deleteEdition(edition, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this edition?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.editions.indexOf(edition);\n          if (ix >= 0) {\n            vm.work.editions.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.work.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/copy-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          copy: angular.copy(copy)\n        },\n        controller: 'CopyEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.work.copies.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast);\n          }\n        });\n    }\n\n    function openRelationship(relationship) {\n      // HACK just working with first entity\n      var entity = relationship.entities[0];\n      $state.go('editor.' + entity.type, entity.refParams);\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/relationship-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          relationship: angular.copy(relationship),\n          currentUri: getCurrentUri()\n        },\n        controller: 'RelationshipEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (updatedRelationship) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(relationship, updatedRelationship);\n\n        return relnRepo.save(relationship);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function () {\n        // HACK give relationship a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n\n    }\n\n    function deleteRelationship(relationship, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      var deletePromise = confirmPromise.then(function () {\n        return relnRepo.delete(relationship.id);\n      });\n\n      deletePromise.then(showSavedToast);\n\n      deletePromise.then(function () {\n        // HACK give relationship a chance to be deleted from the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function deleteWork($event, work) {\n      var title = worksRepo.getTitle(vm.work.titles);\n      var workLabel = title ? '\"' + title.title + (title.subtitle ? ': ' + title.subtitle : '') + '\"' : 'this work';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + workLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return worksRepo.delete(work)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        var message = workLabel + ' has been deleted.';\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .position('bottom right');\n\n        $state.go('editor');\n\n        return $mdToast.show(toast);\n      }\n\n      function showErrorToast() {\n        var toast = $mdToast.simple()\n          .textContent('Unable to delete ' + workLabel)\n          .position('bottom right');\n\n        return $mdToast.show(toast);\n      }\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('WorkEditDialogController', WorkEditDialogController);\n\n  /** @ngInject */\n  function WorkEditDialogController($mdDialog, work) {\n    var vm = this;\n\n    vm.work = work;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.work);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.work[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.work[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.work[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.work.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.work.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.work.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowVolumeController', ShowVolumeController);\n\n  /** @ngInject */\n  function ShowVolumeController($state, $stateParams, worksRepo, relnRepo, _, $mdDialog, $mdToast, $q, $timeout) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.volume = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToEdition = copyToEdition;\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId\n      var editionId = $stateParams.editionId;\n      var volumeId = $stateParams.volumeId;\n\n      vm.work = worksRepo.getWork(workId);\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      vm.volume = worksRepo.getVolume(workId, editionId, volumeId);\n\n      vm.work.$promise.then(function () {\n        vm.workTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n      });\n\n      vm.volume.$promise.then(function () {\n        vm.title = worksRepo.getTitle(vm.volume.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      var relationshipsPromise = loadRelationships();\n\n      $q.all([vm.work.$promise, vm.edition.$promise, vm.volume.$promise, relationshipsPromise]).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function getCurrentUri() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n      var volumeId = $stateParams.volumeId;\n      return 'works/' + workId + '/editions/' + editionId + '/volumes/' + volumeId;\n    }\n\n    function loadRelationships() {\n\n      vm.relationships = [];\n      var currentUri = getCurrentUri();\n      var relationships = relnRepo.search(currentUri);\n      relationships.$promise.then(function () {\n        vm.relationships = relnRepo.normalizeRelationships(relationships, currentUri, worksRepo);\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/volume-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          volume: angular.copy(vm.volume)\n        },\n        controller: 'VolumeEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedVolume) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.volume, updatedVolume);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.volume.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.volume.summary = updatedSummary;\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.volume.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/copy-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          copy: angular.copy(copy)\n        },\n        controller: 'CopyEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.volume.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.volume.copies.splice(ix, 1);\n            worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n          }\n        });\n    }\n\n    function copyToEdition(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var edition = worksRepo.getEdition(vm.work.id, vm.edition.id);\n      edition.$promise.then(function () {\n        edition.copies.push(newCopy);\n        return worksRepo.saveEdition(vm.work.id, edition);\n      }).then(showSavedToast);\n    }\n\n    function openRelationship(relationship) {\n      // HACK just working with first entity\n      var entity = relationship.entities[0];\n      $state.go('editor.' + entity.type, entity.refParams);\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/relationship-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          relationship: angular.copy(relationship),\n          currentUri: getCurrentUri()\n        },\n        controller: 'RelationshipEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (updatedRelationship) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(relationship, updatedRelationship);\n\n        return relnRepo.save(relationship);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function deleteRelationship(relationship, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      var deletePromise = confirmPromise.then(function () {\n        return relnRepo.delete(relationship.id);\n      });\n\n      deletePromise.then(showSavedToast);\n\n      deletePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('VolumeEditDialogController', VolumeEditDialogController);\n\n  /** @ngInject */\n  function VolumeEditDialogController($mdDialog, volume) {\n    var vm = this;\n\n    vm.volume = volume;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.volume);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.volume[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.volume[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.volume[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.volume.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.volume.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.volume.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('RelationshipEditDialogController', RelationshipEditDialogController);\n\n  /** @ngInject */\n  function RelationshipEditDialogController($mdDialog, worksRepo, relnRepo, currentUri, relationship) {\n    var vm = this;\n\n    vm.relationship = relationship;\n    vm.types = [];\n    vm.selectedType = null;\n    vm.targets = [];\n    vm.selectedTarget = null;\n    vm.searchText = '';\n    vm.isReverse = false;\n\n    vm.getResults = getResults;\n    vm.selectWork = selectWork;\n    vm.setType = setType;\n    vm.setTarget = setTarget;\n    vm.close = close;\n    vm.cancel = cancel;\n\n    activate();\n\n    function activate() {\n      vm.types = getTypes();\n\n      vm.target = relnRepo.createAnchor();\n      vm.relationship.targetEntities = [vm.target];\n\n      var self = relnRepo.createAnchor();\n      self.entryUris = [currentUri];\n      vm.relationship.relatedEntities = [self];\n\n      vm.relationship.descriptionMimeType = 'text/html';\n    }\n\n    function getTypes() {\n      var rawTypes = relnRepo.getTypes();\n      var types = [];\n\n      Object.defineProperty(types, '$promise', {\n        value: rawTypes.$promise\n      });\n\n      rawTypes.$promise.then(function () {\n        angular.forEach(rawTypes, function (type) {\n          types.push({\n            id: type.identifier,\n            label: type.title,\n            reverse: false\n          });\n\n          if (type.isDirected) {\n            types.push({\n              id: type.identifier,\n              label: type.reverseTitle,\n              reverse: true\n            });\n          }\n        });\n      });\n\n      return types;\n    }\n\n    function getResults(query) {\n      var results = worksRepo.search(query);\n      return results.$promise.then(function () {\n        return results.items;\n      });\n    }\n\n    function setType(type) {\n      vm.relationship.typeId = type.id;\n      if (vm.isReverse && !type.reverse || !vm.isReverse && type.reverse) {\n        var swap = vm.relationship.relatedEntities;\n        vm.relationship.relatedEntities = vm.relationship.targetEntities;\n        vm.relationship.targetEntities = swap;\n      }\n      vm.isReverse = type.reverse;\n    }\n\n    function selectWork(workProxy) {\n      vm.targets = [];\n\n      if (!workProxy) {\n        return;\n      }\n\n      var work = worksRepo.getWork(workProxy.id);\n\n      work.$promise.then(function () {\n        var workUri = 'works/' + work.id;\n        var workTitle = worksRepo.getTitle(work.titles, ['short', 'canonical', 'bibliographic']);\n\n        vm.targets.push({\n          uri: workUri,\n          label: workTitle.title + (workTitle.subtitle ? ': ' + workTitle.subtitle : '')\n        });\n\n        work.editions.forEach(function (edition) {\n          var editionUri = workUri + '/editions/' + edition.id;\n          var editionTitle = worksRepo.getTitle(edition.titles, ['short', 'canonical', 'bibliographic']);\n\n          vm.targets.push({\n            uri: editionUri,\n            label: editionTitle.title + (editionTitle.subtitle ? ': ' + editionTitle.subtitle : '') + '. ' + edition.editionName\n          });\n\n          edition.volumes.forEach(function (volume) {\n            var volumeUri = editionUri + '/volumes/' + volume.id;\n            var volumeTitle = worksRepo.getTitle(volume.titles, ['short', 'canonical', 'bibliographic']);\n\n            vm.targets.push({\n              uri: volumeUri,\n              label: volumeTitle.title + (volumeTitle.subtitle ? ': ' + volumeTitle.subtitle : '') + '. ' + edition.editionName + '. Volume ' + volume.volumeNumber\n            });\n          });\n        });\n\n        vm.selectedTarget = vm.targets[0];\n        setTarget(vm.selectedTarget);\n      });\n    }\n\n    function setTarget(target) {\n      vm.target.entryUris = target && target.uri ? [target.uri] : [];\n    }\n\n    function close() {\n      $mdDialog.hide(vm.relationship);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowEditionController', ShowEditionController);\n\n  /** @ngInject */\n  function ShowEditionController($state, $stateParams, worksRepo, relnRepo, _, $mdDialog, $mdToast, $q, $timeout) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addVolume = addVolume;\n    vm.deleteVolume = deleteVolume;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToWork = copyToWork;\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n\n      vm.work = worksRepo.getWork(workId);\n      vm.edition = worksRepo.getEdition(workId, editionId);\n\n      vm.work.$promise.then(function () {\n        vm.workTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n      });\n\n      vm.edition.$promise.then(function () {\n        vm.title = worksRepo.getTitle(vm.edition.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      var relationshipsPromise = loadRelationships();\n\n      $q.all([vm.work.$promise, vm.edition.$promise, relationshipsPromise]).then(function (){\n        vm.loading = false;\n      });\n    }\n\n    function getCurrentUri() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n\n      return 'works/' + workId + '/editions/' + editionId;\n    }\n\n    function loadRelationships() {\n\n      vm.relationships = [];\n      var currentUri = getCurrentUri();\n      var relationships = relnRepo.search(currentUri);\n      relationships.$promise.then(function () {\n        vm.relationships = relnRepo.normalizeRelationships(relationships, currentUri, worksRepo);\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/edition-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          edition: angular.copy(vm.edition)\n        },\n        controller: 'EditionEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedEdition) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.edition, updatedEdition);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.edition.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.edition.summary = updatedSummary;\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n    }\n\n    function addVolume($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Volume')\n        .textContent('Please provide a number for the new volume.')\n        .placeholder('volume number')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (volumeNumber) {\n        var volume = worksRepo.createVolume();\n        volume.volumeNumber = volumeNumber;\n        volume.titles = angular.copy(vm.edition.titles);\n        volume.authors = angular.copy(vm.edition.authors);\n        volume.publicationInfo = angular.copy(vm.edition.publicationInfo);\n\n        vm.edition.volumes.push(volume);\n\n        return worksRepo.saveVolume(vm.work.id, vm.edition.id, volume);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (volume) {\n        $state.go('editor.volume', { workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id });\n      });\n    }\n\n    function deleteVolume(volume, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this volume?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.volumes.indexOf(volume);\n          if (ix >= 0) {\n            vm.edition.volumes.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.edition.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/copy-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          copy: angular.copy(copy)\n        },\n        controller: 'CopyEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.edition.copies.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n          }\n        });\n    }\n\n    function copyToWork(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var work = worksRepo.getWork(vm.work.id);\n      work.$promise.then(function () {\n        work.copies.push(newCopy);\n        return worksRepo.saveWork(work);\n      }).then(showSavedToast);\n    }\n\n    function openRelationship(relationship) {\n      // HACK just working with first entity\n      var entity = relationship.entities[0];\n      $state.go('editor.' + entity.type, entity.refParams);\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/relationship-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          relationship: angular.copy(relationship),\n          currentUri: getCurrentUri()\n        },\n        controller: 'RelationshipEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (updatedRelationship) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(relationship, updatedRelationship);\n\n        return relnRepo.save(relationship);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function deleteRelationship(relationship, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      var deletePromise = confirmPromise.then(function () {\n        return relnRepo.delete(relationship.id);\n      });\n\n      deletePromise.then(showSavedToast);\n\n      deletePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('EditionEditDialogController', EditionEditDialogController);\n\n  /** @ngInject */\n  function EditionEditDialogController($mdDialog, edition) {\n    var vm = this;\n\n    vm.edition = edition;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.edition);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.edition[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.edition[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.edition[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.edition.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.edition.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.edition.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('CopyEditDialogController', CopyEditDialogController);\n\n  /** @ngInject */\n  function CopyEditDialogController($mdDialog, copy) {\n    var vm = this;\n\n    vm.copy = copy;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.copy);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * @typedef {object} Workflow\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {object.<string, WorkflowStage>} stages\n * @property {string} status\n */\n\n/**\n * @typedef {object} WorkflowStage\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {boolean} isFinal\n * @property {WorkflowStageTransition[]} transitions\n */\n\n/**\n * @typedef {object} WorkflowStageTransition\n * @property {string} sourceStage\n * @property {string} targetStage\n * @property {string} label\n */\n\n/**\n * @typedef {object} Worklist\n * @property {string} groupId\n * @property {string} label\n * @property {integer} itemCount\n * @property {integer} start\n * @property {integer} max\n * @property {WorkItem[]} items\n */\n\n/**\n * @typedef {object} WorkItem\n * @property {string} itemId\n * @property {string} type\n * @property {string} entityId\n * @property {string} label\n * @property {object.<string,string>} properties\n * @property {string} stage\n * @property {string} task\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks')\n    .provider('tasksRepo', tasksRepoProvider);\n\n  /**\n   * @return {angular.provider}\n   */\n  function tasksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/tasks';\n    provider.$get = tasksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function tasksRepoFactory($resource) {\n      var taskResource = $resource(provider.url + '/:taskId', { taskId: '@id' });\n      var workflowResource = $resource(provider.url + '/:taskId/workflow');\n      var itemResource = $resource(provider.url + '/:taskId/items/:itemId', { itemId: '@itemId' });\n\n      var repo = {};\n      repo.getTask = getTask;\n      repo.getWorkflow = getWorkflow;\n      repo.all = getAllTasks;\n      repo.getItems = getItems;\n      repo.transition = transition;\n      return repo;\n\n      /**\n       * Retrieves a listing of all tasks\n       *\n       * @return {Task[]}\n       */\n      function getAllTasks() {\n        return taskResource.query();\n      }\n\n      /**\n       * Retrieves a task by id\n       *\n       * @param  {string} taskId\n       * @return {GroupedTaskList}\n       */\n      function getTask(taskId) {\n        return taskResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Retrieves a workflow by task id\n       * @param  {string} taskId\n       * @return {Workflow}\n       */\n      function getWorkflow(taskId) {\n        return workflowResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Gets items from the task endpoint for a given stage\n       *\n       * @param  {string}  [taskId]  Task ID\n       * @param  {string}  stageId          Workflow stage for which to get items\n       * @param  {object}  options\n       * @param  {integer} [options.start]  Starting index\n       * @param  {integer} [options.max]    Maximum number of items to fetch per page\n       * @return {Worklist}\n       */\n      function getItems(taskId, stageId, options) {\n        options = options || {};\n        return itemResource.get({\n          taskId: taskId,\n          stage: stageId,\n          start: options.start,\n          max: options.max\n        });\n      }\n\n      /**\n       * Transition an item from its current stage to a target stage\n       *\n       * @param  {WorkItem}                item   Work item instance\n       * @param  {WorkflowStageTransition} transition Target workflow stage\n       * @return {WorkItem}                       Updated work item instance\n       */\n      function transition(taskId, item, transition) {\n        if (item.stage !== transition.sourceStage) {\n          throw new Error('Transition (' + transition.sourceStage + ' -> ' + transition.targetStage + ') is not valid for item currently in stage ' + item.stage);\n        }\n\n        var result = itemResource.save({\n          taskId: taskId,\n          itemId: item.itemId\n        }, {\n          stage: transition.targetStage,\n          // NOTE comments are not saved yet\n          comments: null\n        });\n\n        // propagate updates to the original item\n        result.$promise.then(function (resp) {\n          angular.extend(item, resp);\n        });\n\n        return result;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('TaskController', TaskController);\n\n  /** @ngInject */\n  function TaskController($mdSidenav, $mdToast, tasksRepo) {\n    var vm = this;\n\n    vm.loading = false;\n\n    vm.openMenu = openMenu;\n\n    activate();\n\n    function activate() {\n      vm.loading = true;\n      vm.tasks = tasksRepo.all();\n\n      vm.tasks.$promise.then(function () {\n        vm.loading = false;\n      }, function () {\n        vm.loading = false;\n        $mdToast.show($mdToast.simple().textContent('Unable to load tasks from server'));\n      });\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowTaskController', ShowTaskController);\n\n  /** @ngInject */\n  function ShowTaskController($state, $stateParams, $mdSidenav, tasksRepo, $q) {\n    var vm = this;\n\n    // HACK this will eventually be made available on the workflow data model itself.\n    vm.stageOrder = [\n      'pinned',\n      'inprogress',\n      'review',\n      'pending',\n      'deferred'\n    ];\n\n    vm.loading = true;\n    vm.worklists = {};\n    vm.task = null;\n\n    vm.focusItem = focusItem;\n    vm.transition = transitionItem;\n\n    activate();\n\n    function activate() {\n      vm.taskId = $stateParams.taskId;\n      vm.task = tasksRepo.getTask(vm.taskId);\n      vm.workflow = tasksRepo.getWorkflow(vm.taskId);\n\n      vm.workflow.$promise.then(function () {\n        var worklistPromises = [];\n\n        angular.forEach(vm.workflow.stages, function (stage) {\n          var worklistPromise = fetchStage(stage.id);\n          worklistPromises.push(worklistPromise);\n        });\n\n        $q.all(worklistPromises).then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    function focusItem(item, $event) {\n      $event.stopImmediatePropagation();\n\n      // TODO resolve handler based on item.type\n      $state.go('editor.work', { workId: item.entityId });\n    }\n\n    function transitionItem(item, transition, $event) {\n      $event.stopImmediatePropagation();\n\n      var updatedItem = tasksRepo.transition(vm.taskId, item, transition);\n      updatedItem.$promise.then(function () {\n        fetchStage(transition.sourceStage);\n        fetchStage(transition.targetStage);\n      });\n    }\n\n    function fetchStage(stageId) {\n      var group = tasksRepo.getItems(vm.taskId, stageId, { max: 9999 });\n\n      group.$promise.then(function () {\n        vm.worklists[stageId] = group.items.length > 0 ? group : null;\n      });\n\n      return group.$promise;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowPersonController', ShowPersonController);\n\n  /** @ngInject */\n  function ShowPersonController(peopleRepo, refsRepoFactory, $log, $state, $stateParams, $mdDialog, $mdToast, _, citationEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.person = null;\n\n    vm.editBioInfo = editBioInfo;\n    vm.editEvent = editEvent;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.deletePerson = deletePerson;\n\n    activate();\n\n    function activate() {\n      var personId = $stateParams.id;\n\n      var personRefsUrl = peopleRepo.getReferencesEndpoint(personId);\n      refsRepo = refsRepoFactory.getRepo(personRefsUrl);\n\n      vm.person = peopleRepo.get(personId);\n      vm.references = refsRepo.get();\n\n      vm.references.$promise.then(function () {\n        var citations = _.values(vm.references.citations);\n\n        if (citations.length === 0) {\n          vm.citation = refsRepo.createCitation();\n          vm.references.citations[vm.citation.id] = vm.citation;\n        } else {\n          if (citations.length > 1) {\n            $log.warn('reference collection contains ' + citations.length + ' citations');\n          }\n          vm.citation = citations[0];\n        }\n      })\n    }\n\n    function editBioInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          person: angular.copy(vm.person)\n        },\n        controller: 'PersonEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedPerson) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person, updatedPerson);\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editEvent(field, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/event-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          event: angular.copy(vm.person[field])\n        },\n        controller: 'EventEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedEvent) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person[field], updatedEvent);\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.person.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.person.summary = updatedSummary;\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast);\n      });\n    }\n\n    function deletePerson($event, person) {\n      var nameLabel = person.name.label ? '\"' + person.name.label + '\"' : 'this person';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + nameLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return peopleRepo.delete(person)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        var message = nameLabel + ' has been deleted.';\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .position('bottom right');\n\n        $state.go('editor');\n\n        return $mdToast.show(toast);\n      }\n\n      function showErrorToast() {\n        var toast = $mdToast.simple()\n          .textContent('Unable to delete ' + nameLabel)\n          .position('bottom right');\n\n        return $mdToast.show(toast);\n      }\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('PersonEditDialogController', PersonEditDialogController);\n\n  /** @ngInject */\n  function PersonEditDialogController(peopleRepo, $mdDialog, person) {\n    var vm = this;\n\n    vm.person = person;\n    vm.nameRoles = [\n        // { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n    ]\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addName = addName;\n    vm.deleteName = deleteName;\n\n    function close() {\n      $mdDialog.hide(vm.person);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addName() {\n      var name = peopleRepo.createName();\n      vm.person.altNames.push(name);\n    }\n\n    function deleteName(name) {\n      var ix = vm.person.altNames.indexOf(name);\n      if (ix >= 0) {\n        vm.person.altNames.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('EventEditDialogController', EventEditDialogController);\n\n  /** @ngInject */\n  function EventEditDialogController($mdDialog, event) {\n    var vm = this;\n\n    vm.event = event;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.event);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController(worksRepo, peopleRepo, $state, $stateParams, $mdSidenav, _, $q, $mdDialog, $mdToast) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.searchQuery = '';\n\n    vm.openMenu = openMenu;\n    vm.createPerson = createPerson;\n    vm.createWork = createWork;\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      if ($stateParams.q) {\n        vm.searchQuery = $stateParams.q;\n        search(vm.searchQuery);\n      }\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      $q.all([\n        vm.peopleResults.$promise,\n        vm.worksResults.$promise\n      ])\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function createArticle($event) {\n\n    }\n    \n    function createPerson($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: peopleRepo.create()\n        },\n        controller: 'PersonEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (person) {\n        return peopleRepo.save(person);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (person) {\n        $state.go('editor.person', { id: person.id });\n      });\n    }\n\n    function createWork($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: worksRepo.createWork()\n        },\n        controller: 'WorkEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (work) {\n        return worksRepo.saveWork(work);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (work) {\n        $state.go('editor.work', { workId: work.id });\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('editor', {\n        url: '/?q',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'vm'\n      })\n\n      .state('editor.person', {\n        url: 'people/:id',\n        views: {\n          main: {\n            templateUrl: 'app/person/person.html',\n            controller: 'ShowPersonController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('editor.work', {\n        url: 'works/:workId',\n        views: {\n          main: {\n            templateUrl: 'app/work/work.html',\n            controller: 'ShowWorkController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.edition', {\n        url: 'works/:workId/editions/:editionId',\n        views: {\n          main: {\n            templateUrl: 'app/work/edition.html',\n            controller: 'ShowEditionController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.volume', {\n        url: 'works/:workId/editions/:editionId/volumes/:volumeId',\n        views: {\n          main: {\n            templateUrl: 'app/work/volume.html',\n            controller: 'ShowVolumeController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('article', {\n        url: '/articles',\n        templateUrl: 'app/admin/editors/articles/article.html',\n        controller: 'ArticleEditorSectionController',\n        controllerAs: 'vm'\n      })\n\n      .state('article.edit', {\n        url: '/:id',\n        templateUrl: 'app/admin/editors/articles/article-editor.html',\n        controller: 'ArticleEditorController',\n        controllerAs: 'vm'\n      })\n\n      .state('task', {\n        url: '/task',\n        templateUrl: 'app/task/task.html',\n        controller: 'TaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('task.show', {\n        url: '/:taskId',\n        templateUrl: 'app/task/show.html',\n        controller: 'ShowTaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('vwise', {\n        url: '/vwise/:workspaceId',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      })\n\n      .state('zotero', {\n        url: '/zotero',\n        templateUrl: 'app/zotero/test/test.html',\n        controller: 'ZoteroTestController',\n        controllerAs: 'vm'\n      });\n\n\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, /* toastrConfig, */ $mdThemingProvider,\n                  tasksRepoProvider,\n                  worksRepoProvider,\n                  peopleRepoProvider,\n                  articlesRepoProvider,\n                  relnRepoProvider,\n                  categorizationServiceProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    tasksRepoProvider.url = '/api/catalog/v1/tasks';\n    worksRepoProvider.url = '/api/catalog/works';\n    peopleRepoProvider.url = '/api/catalog/people';\n    articlesRepoProvider.url = '/api/catalog/entries/articles';\n    relnRepoProvider.url = '/api/catalog/relationships';\n    categorizationServiceProvider.url = '/api/catalog/categorizations';\n\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config(citeprocProvider) {\n    addLocale('en-US');\n    addStyle('modern-language-association');\n\n    function addLocale(localeId) {\n      citeprocProvider.addLocale(localeId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('assets/csl/locales/locales-' + localeId + '.xml').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n\n    function addStyle(styleId) {\n      citeprocProvider.addStyle(styleId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('assets/csl/styles/' + styleId + '.csl').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n  }\n\n})();\n\nangular.module(\"sdaAdmin\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<md-content flex layout=column><navbar title=\\\"Editorial Tools\\\" sidenav-id=left></navbar><md-content flex layout=row><md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" ui-view=sidebar layout=column><form layout=row flex=none><md-input-container flex><label for=searchQuery>Search</label><md-icon>search</md-icon><input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required></md-input-container></form><md-content flex><div ng-if=vm.loading layout=row layout-align=center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"><md-subheader>People</md-subheader><md-list><md-list-item ng-repeat=\\\"person in vm.peopleResults.items\\\" ui-sref=\\\"editor.person({id: person.id})\\\"><div class=md-list-item-text><span>{{person.label}}</span></div></md-list-item></md-list></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"><md-subheader>Works</md-subheader><md-list><md-list-item ng-repeat=\\\"work in vm.worksResults.items\\\" ui-sref=\\\"editor.work({workId: work.id})\\\"><div class=md-list-item-text><span>{{work.label}}</span></div></md-list-item></md-list></div></md-content><md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"><md-fab-trigger><md-button aria-label=New... class=md-fab><md-icon>add</md-icon></md-button></md-fab-trigger><md-fab-actions><md-button aria-label=\\\"New Article\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createArticle($event)><md-tooltip md-direction=left>New Article</md-tooltip><md-icon>description</md-icon></md-button><md-button aria-label=\\\"New Person\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createPerson($event)><md-tooltip md-direction=left>New Person</md-tooltip><md-icon>person</md-icon></md-button><md-button aria-label=\\\"New Work\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createWork($event)><md-tooltip md-direction=left>New Book</md-tooltip><md-icon>book</md-icon></md-button></md-fab-actions></md-fab-speed-dial></md-sidenav><md-content flex layout=column ui-view=main></md-content></md-content></md-content>\");\n$templateCache.put(\"app/person/event-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Event Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><event-editor ng-model=vm.event flex></event-editor></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/person/person-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Biographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><section class=name layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Canonical Name</h2></div></md-toolbar><div class=name><name-editor ng-model=vm.person.name flex></name-editor></div></section><section class=alt-names layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Alternate Names</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addName()><md-icon>add</md-icon></md-button></div></md-toolbar><div class=name layout=row ng-repeat=\\\"name in vm.person.altNames\\\"><md-input-container><label>role</label><md-select ng-model=name.role><md-option ng-repeat=\\\"role in vm.nameRoles\\\" value={{role.value}}>{{role.label}}</md-option></md-select></md-input-container><name-editor ng-model=name flex></name-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteName(name)><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/person/person.html\",\"<div layout=row layout-padding flex=noshrink><div flex=60><section class=\\\"content names\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h1 class=content-heading>{{vm.person.name.label}}</h1><span flex></span><md-button class=md-icon-button ng-click=vm.editBioInfo($event)><md-icon>edit</md-icon></md-button></div><div ng-if=\\\"vm.person.altNames && vm.person.altNames.length > 0\\\"><p>Other names:</p><ul><li ng-repeat=\\\"name in vm.person.altNames\\\">{{name.label}}</li></ul></div></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.person.summary ng-bind-html=vm.person.summary></p></section><section class=\\\"content bibliography\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliography</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibliography($event)><md-icon>edit</md-icon></md-button></div><bibliography collection=vm.references></bibliography></section></div><div flex=40><section class=\\\"content birth\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Birth</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'birth\\', $event)\\\"><md-icon>edit</md-icon></md-button></div><p><span class=description ng-if=vm.person.birth.date.description>{{vm.person.birth.date.description}}</span> <span class=location ng-if=vm.person.birth.location>in {{vm.person.birth.location}}</span></p><p ng-bind-html=vm.person.birth.description ng-if=vm.person.birth.description></p></section><section class=\\\"content death\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Death</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'death\\', $event)\\\"><md-icon>edit</md-icon></md-button></div><p><span class=description ng-if=vm.person.death.date.description>{{vm.person.death.date.description}}</span> <span class=location ng-if=vm.person.death.location>in {{vm.person.death.location}}</span></p><p ng-bind-html=vm.person.death.description ng-if=vm.person.death.description></p></section></div></div><div layout=row layout-align=end layout-margin><div><md-button aria-label=\\\"Delete this person\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deletePerson($event, vm.person)\\\"><md-icon>delete</md-icon><md-tooltip md-direction=left>Delete</md-tooltip></md-button></div></div>\");\n$templateCache.put(\"app/task/show.html\",\"<md-content flex layout=column><div class=task-info><span class=label>{{vm.task.label}}</span> <span class=description>{{vm.task.description}}</span></div><md-input-container><label>Search</label><md-icon>search</md-icon><input type=search ng-model=filter ng-change=vm.search(filter)></md-input-container><md-content flex><div layout=row layout-align=\\\"center center\\\" ng-if=vm.loading><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-repeat=\\\"stageId in vm.stageOrder\\\" ng-if=vm.worklists[stageId]><md-subheader>{{vm.workflow.stages[stageId].label}}</md-subheader><md-list><md-list-item ng-repeat=\\\"item in vm.worklists[stageId].items | filter : filter | limitTo : 20\\\" ng-mouseover=\\\"item.hover = true\\\" ng-mouseout=\\\"item.hover = false\\\" ng-click=\\\"vm.focusItem(item, $event)\\\"><span ng-bind-html=item.label></span> <span flex></span><md-button class=md-exclude ng-repeat=\\\"transition in vm.workflow.stages[stageId].transitions\\\" ng-click=\\\"vm.transition(item, transition, $event)\\\" ng-show=item.hover><span>{{transition.label}}</span></md-button></md-list-item></md-list></div></md-content></md-content>\");\n$templateCache.put(\"app/task/task.html\",\"<md-content flex layout=column><navbar title=\\\"Task Management Dashboard\\\" sidenav-id=left></navbar><md-content flex layout=row><md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column><div ng-if=vm.loading flex layout=row layout-align=\\\"center center\\\"><md-progress-circular md-mode=indeterminate></md-progress-circular></div><md-list ng-if=!vm.loading><md-list-item ng-repeat=\\\"task in vm.tasks\\\" ui-sref=\\\"task.show({ taskId: task.id })\\\">{{ task.label }}</md-list-item></md-list></md-sidenav><md-content flex layout=column ui-view><div layout=row layout-padding layout-margin layout-align=\\\"center center\\\"><div class=md-headline>Please select a task from the sidebar.</div></div></md-content></md-content></md-content>\");\n$templateCache.put(\"app/work/copy-edit-dialog.html\",\"<md-dialog flex=50><md-toolbar><div class=md-toolbar-tools><h3>Digital Copy Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><copy-editor ng-model=vm.copy></copy-editor></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/edition-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Bibliographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><div layout=row><md-input-container flex><label>edition name</label><input type=text ng-model=vm.edition.editionName required></md-input-container></div><section class=publication layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Publication Information</h2></div></md-toolbar><publication-info-editor ng-model=vm.edition.publicationInfo flex></publication-info-editor></section><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addTitle($event)><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in vm.edition.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in vm.edition.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/edition.html\",\"<nav layout=row layout-padding><ol class=breadcrumbs flex><li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li><li>{{vm.edition.editionName}}</li></ol></nav><div layout=row layout-padding><div layout=column flex=60><section class=\\\"content citation\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliographic Information</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibInfo($event)><md-icon>edit</md-icon></md-button></div><p><span class=authors ng-if=\\\"vm.edition.authors && vm.edition.authors.length > 0\\\"><span class=author ng-repeat=\\\"author in vm.edition.authors\\\"><span ng-if=author.authorId><a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span><span ng-if=!author.authorId>{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span></span></span><span class=title ng-if=vm.title>{{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span><span class=publication ng-if=vm.edition.publicationInfo><span ng-if=vm.edition.publicationInfo.place><span class=place>{{vm.edition.publicationInfo.place}}</span>: </span><span ng-if=vm.edition.publicationInfo.publisher><span class=publisher>{{vm.edition.publicationInfo.publisher}}</span>, </span><span ng-if=vm.edition.publicationInfo.date><time class=date datetime={{vm.edition.publicationInfo.date.calendar}}>{{vm.edition.publicationInfo.date.description}}</time>.</span></span></p></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.edition.summary ng-bind-html=vm.edition.summary></p></section><section class=\\\"content volumes\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Volumes</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addVolume($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"volume in vm.edition.volumes\\\" ui-sref=\\\"editor.volume({workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id})\\\"><span>Volume {{volume.volumeNumber}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteVolume(volume, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div><div layout=column flex=40><section class=\\\"content references\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Relationships</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addRelationship($event)><md-icon>add</md-icon></md-button></div><div ng-repeat=\\\"type in vm.relationships\\\"><h3 class=content-heading>{{type.label}}</h3><md-list><md-list-item ng-repeat=\\\"relationship in type.relationships\\\" ng-click=vm.openRelationship(relationship)><span ng-repeat=\\\"entity in relationship.entities\\\">{{entity.label}}.</span><md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"vm.deleteRelationship(relationship, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></div></section><section class=\\\"content copies\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addCopy($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"copy in vm.edition.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"><span>{{copy.title}}</span><md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToWork(copy) aria-label=\\\"copy to parent work\\\"><md-icon>file_upload</md-icon><md-tooltip>Copy to Work</md-tooltip></md-button><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div></div>\");\n$templateCache.put(\"app/work/relationship-edit-dialog.html\",\"<md-dialog flex=50><md-toolbar><div class=md-toolbar-tools><h3>Relationship Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form name=relationship ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content layout=column><md-input-container><label>type</label><md-select name=type ng-model=vm.selectedType ng-change=vm.setType(vm.selectedType) required><md-option ng-repeat=\\\"type in vm.types\\\" ng-value=type>{{type.label}}</md-option></md-select><div class=errors ng-messages=relationship.type.$error ng-if=relationship.$dirty><div ng-message=required>Required</div></div></md-input-container><md-autocomplete md-items=\\\"work in vm.getResults(vm.searchText)\\\" md-item-text=work.label md-search-text=vm.searchText md-selected-item-change=vm.selectWork(work) placeholder=\\\"search works\\\" required><md-item-template><span md-highlight=vm.searchText md-highlight-flags=^i>{{work.label}}</span></md-item-template></md-autocomplete><md-input-container ng-if=\\\"vm.targets && vm.targets.length > 1\\\"><label>target</label><md-select name=target ng-model=vm.selectedTarget ng-change=vm.setTarget(vm.selectedTarget) required><md-option ng-repeat=\\\"target in vm.targets\\\" ng-value=target>{{target.label}}</md-option></md-select><div class=errors ng-messages=relationship.target.$error ng-if=relationship.$dirty><div ng-message=required>Required</div></div></md-input-container><div class=summary><h2>Summary</h2><div ckeditor ng-model=vm.relationship.description></div></div></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/volume-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Bibliographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><div layout=row><md-input-container flex><label>volume number</label><input type=text ng-model=vm.volume.volumeNumber required></md-input-container></div><section class=publication layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Publication Information</h2></div></md-toolbar><publication-info-editor ng-model=vm.volume.publicationInfo></publication-info-editor></section><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addTitle($event)><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in vm.volume.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in vm.volume.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/volume.html\",\"<nav layout=row layout-padding><ol class=breadcrumbs flex><li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li><li><a ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: vm.edition.id})\\\">{{vm.edition.editionName}}</a></li><li>Volume {{vm.volume.volumeNumber}}</li></ol></nav><div layout=row layout-padding><div layout=column flex=60><section class=\\\"content citation\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliographic Information</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibInfo($event)><md-icon>edit</md-icon></md-button></div><p><span class=authors ng-if=\\\"vm.volume.authors && vm.volume.authors.length > 0\\\"><span class=author ng-repeat=\\\"author in vm.volume.authors\\\"><span ng-if=author.authorId><a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span><span ng-if=!author.authorId>{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span></span></span><span class=title ng-if=vm.title>{{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span><span class=publication ng-if=vm.volume.publicationInfo><span ng-if=vm.volume.publicationInfo.place><span class=place>{{vm.volume.publicationInfo.place}}</span>: </span><span ng-if=vm.volume.publicationInfo.publisher><span class=publisher>{{vm.volume.publicationInfo.publisher}}</span>, </span><span ng-if=vm.volume.publicationInfo.date><time class=date datetime={{vm.volume.publicationInfo.date.calendar}}>{{vm.volume.publicationInfo.date.description}}</time>.</span></span></p></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.volume.summary ng-bind-html=vm.volume.summary></p></section></div><div layout=column flex=40><section class=\\\"content references\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Relationships</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addRelationship($event)><md-icon>add</md-icon></md-button></div><div ng-repeat=\\\"type in vm.relationships\\\"><h3 class=content-heading>{{type.label}}</h3><md-list><md-list-item ng-repeat=\\\"relationship in type.relationships\\\" ng-click=vm.openRelationship(relationship)><span ng-repeat=\\\"entity in relationship.entities\\\">{{entity.label}}.</span><md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"vm.deleteRelationship(relationship, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></div></section><section class=\\\"content copies\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addCopy($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"copy in vm.volume.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"><span>{{copy.title}}</span><md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToEdition(copy) aria-label=\\\"copy to parent edition\\\"><md-icon>file_upload</md-icon><md-tooltip>Copy to Edition</md-tooltip></md-button><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div></div>\");\n$templateCache.put(\"app/work/work-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Bibliographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addTitle($event)><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in vm.work.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in vm.work.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/work.html\",\"<nav layout=row layout-padding><ol class=breadcrumbs flex><li>{{vm.bcTitle.title}}{{vm.bcTitle && vm.bcTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.bcTitle.subtitle}}</li></ol></nav><div layout=row layout-padding flex=noshrink><div layout=column flex=60><section class=\\\"content citation\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliographic Information</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibInfo($event)><md-icon>edit</md-icon></md-button></div><p><span class=authors ng-if=\\\"vm.work.authors && vm.work.authors.length > 0\\\"><span class=author ng-repeat=\\\"author in vm.work.authors\\\"><span ng-if=author.authorId><a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span><span ng-if=!author.authorId>{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span></span></span><span class=title ng-if=vm.title>{{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}.</span></p></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.work.summary ng-bind-html=vm.work.summary></p></section><section class=\\\"content editions\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Editions</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addEdition($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"edition in vm.work.editions\\\" ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: edition.id})\\\"><span>{{edition.editionName}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteEdition(edition, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section><section class=\\\"content bibliography\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliography</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibliography($event)><md-icon>edit</md-icon></md-button></div><bibliography collection=vm.references></bibliography></section></div><div layout=column flex=40><section class=\\\"content references\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Relationships</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addRelationship($event)><md-icon>add</md-icon></md-button></div><div ng-repeat=\\\"type in vm.relationships\\\"><h3 class=content-heading>{{type.label}}</h3><md-list><md-list-item ng-repeat=\\\"relationship in type.relationships\\\" ng-click=vm.openRelationship(relationship)><span ng-repeat=\\\"entity in relationship.entities\\\">{{entity.label}}.</span><md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"vm.deleteRelationship(relationship, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></div></section><section class=\\\"content copies\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addCopy($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"copy in vm.work.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"><span>{{copy.title}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div></div><div layout=row layout-align=end layout-margin><div><md-button aria-label=\\\"Delete this work\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deleteWork($event, vm.work)\\\"><md-icon>delete</md-icon><md-tooltip md-direction=left>Delete</md-tooltip></md-button></div></div>\");\n$templateCache.put(\"app/zotero/creator-field.html\",\"<div layout=row layout-margin><md-input-container><label>Role</label><md-select ng-model=$ctrl.creator.creatorType ng-disabled=\\\"!$ctrl.roles || $ctrl.roles.length == 0\\\"><md-option ng-value=role.role ng-repeat=\\\"role in $ctrl.roles\\\">{{role.label}}</md-option></md-select></md-input-container><md-input-container ng-if=verbatim flex><label>Name</label><input type=text ng-model=$ctrl.creator.name></md-input-container><md-input-container ng-if=!verbatim flex><label>First Name</label><input type=text ng-model=$ctrl.creator.firstName></md-input-container><md-input-container ng-if=!verbatim flex><label>Last Name</label><input type=text ng-model=$ctrl.creator.lastName></md-input-container><div layout=column layout-align=\\\"center center\\\"><md-button ng-show=verbatim ng-click=\\\"verbatim = false\\\" class=md-icon-button aria-label=\\\"First/Last Names\\\"><md-icon>people</md-icon><md-tooltip>First/Last Names</md-tooltip></md-button><md-button ng-hide=verbatim ng-click=\\\"verbatim = true\\\" class=md-icon-button aria-label=\\\"Single Name\\\"><md-icon>domain</md-icon><md-tooltip>Single Name</md-tooltip></md-button></div></div>\");\n$templateCache.put(\"app/zotero/editor.html\",\"<div layout=column flex><div layout=row layout-margin><md-autocomplete md-search-text=$ctrl.itemTypeSearchText md-items=\\\"type in $ctrl.types | filter: {label: $ctrl.itemTypeSearchText}\\\" md-item-text=type.label md-selected-item=$ctrl.itemType md-selected-item-change=$ctrl.selectType($ctrl.itemType) md-min-length=0 md-floating-label=\\\"Item Type\\\" required><md-item-template><span md-highlight-text=$ctrl.itemTypeSearchText md-highlight-flags=^i>{{type.label}}</span></md-item-template></md-autocomplete></div><div layout=row ng-repeat=\\\"creator in $ctrl.item.creators\\\" layout-align=\\\"start center\\\"><zotero-creator-field creator=creator roles=$ctrl.roles flex></zotero-creator-field><md-button ng-click=\\\"$ctrl.item.creators.splice($index+1, 0, {})\\\" class=md-icon-button aria-label=\\\"New Creator\\\"><md-icon>add</md-icon><md-tooltip>New</md-tooltip></md-button><md-button ng-disabled=\\\"$ctrl.item.creators.length <= 1\\\" ng-click=\\\"$ctrl.item.creators.splice($index, 1)\\\" class=\\\"md-icon-button md-warn\\\" aria-label=\\\"Delete Creator\\\"><md-icon>remove</md-icon><md-tooltip>Delete</md-tooltip></md-button></div><div layout=row layout-margin ng-repeat=\\\"field in $ctrl.fields\\\"><md-input-container flex><label>{{field.label}}</label><input type=text ng-model=$ctrl.item[field.id]></md-input-container></div><div ng-if=!$ctrl.itemType layout-margin><p>Please select an item type first.</p></div></div>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-edit-dialog.html\",\"<md-dialog aria-label=\\\"Edit Citation\\\" flex=50 layout=column><form ng-cloak><md-toolbar><div class=md-toolbar-tools><h2>Edit Citation</h2><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon aria-label=Cancel>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content><citation-editor references=vm.references citation=vm.citation></citation-editor></div></md-dialog-content><md-dialog-actions layout=row><md-button ng-click=vm.cancel()>Cancel</md-button><md-button ng-click=vm.done()>Save</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-editor.html\",\"<div class=citation-editor-layout layout=column flex><div class=citation-editor-container ng-hide=$ctrl.zoteroItem layout=column flex><div layout=row layout-wrap><div layout=row layout-align=\\\"start center\\\" layout-margin class=md-whiteframe-2dp ng-repeat=\\\"item in $ctrl.citation.items\\\"><span ng-bind-html=item.label></span><md-button class=md-icon-button aria-label=Edit ng-click=$ctrl.edit(item)><md-icon>edit</md-icon><md-tooltip>Edit Item</md-tooltip></md-button><md-button class=\\\"md-icon-button md-warn\\\" aria-label=Remove ng-click=\\\"$ctrl.citation.items.splice($index, 1)\\\"><md-icon>remove</md-icon><md-tooltip>Remove Item</md-tooltip></md-button></div></div><div layout=column><md-autocomplete md-autoselect md-floating-label=\\\"Referenced Item\\\" md-selected-item=$ctrl.selectedBiblioItem md-selected-item-change=$ctrl.selectBiblioItem($ctrl.selectedBiblioItem) md-search-text=$ctrl.searchText md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-delay=200 md-require-match required><md-item-template><span ng-bind-html=item.label></span></md-item-template><md-not-found>No matches found.<md-button ng-click=$ctrl.createZoteroItem($event)>Create</md-button></md-not-found></md-autocomplete><div layout=row><md-input-container><label>Locator Type</label><md-select ng-model=$ctrl.activeCitationItem.locatorType><md-option></md-option><md-option ng-repeat=\\\"type in $ctrl.locatorTypes\\\" ng-value=type>{{type}}</md-option></md-select></md-input-container><md-input-container flex><label>Locator</label><input type=text ng-model=$ctrl.activeCitationItem.locator></md-input-container></div><md-checkbox ng-model=$ctrl.activeCitationItem.suppressAuthor>Suppress Author Name in In-Text Citation</md-checkbox></div><div layout=row layout-align=end><md-button class=md-raised ng-click=$ctrl.addCitationItem($ctrl.activeCitationItem)>Save Item</md-button></div></div><div class=zotero-item-editor-container ng-if=$ctrl.zoteroItem layout=row flex><div layout=column><md-button class=md-icon-button ng-click=$ctrl.cancelZoteroItem($event)><md-icon>cancel</md-icon><md-tooltip md-direction=right>Cancel New Item</md-tooltip></md-button><md-button class=md-icon-button ng-click=\\\"$ctrl.saveZoteroItem($event, $ctrl.zoteroItem)\\\"><md-icon>check_circle</md-icon><md-tooltip md-direction=right>Save and Cite Item</md-tooltip></md-button></div><zotero-editor item=$ctrl.zoteroItem flex></zotero-editor></div></div>\");\n$templateCache.put(\"app/components/ckeditor-footnotes/footnote-edit-dialog.html\",\"<md-bottom-sheet aria-label=\\\"Insert Footnote\\\" layout=column><md-toolbar><div class=md-toolbar-tools><h2>Insert Footnote</h2><span flex></span><md-button ng-click=vm.cancel()>Cancel</md-button><md-button ng-click=vm.done()>Save</md-button></div></md-toolbar><div ng-if=vm.references ng-model=vm.footnote.content ckeditor ckeditor-bibliography=vm.references></div><div ng-if=!vm.references ng-model=vm.footnote.content ckeditor></div></md-bottom-sheet>\");\n$templateCache.put(\"app/components/date-editor/date-editor.html\",\"<div layout=row><md-input-container flex><label>date</label><input type=text ng-model=date.description></md-input-container><md-input-container flex><label>ISO-8601 date</label><input type=datetime ng-model=date.calendar ng-change=\\\"calendarAutoSet = false\\\"></md-input-container></div>\");\n$templateCache.put(\"app/components/navbar/navbar.html\",\"<md-toolbar><div class=md-toolbar-tools><md-button ng-if=$ctrl.sidenavId class=\\\"md-accent md-icon-button\\\" ng-click=$ctrl.toggleSidenav($ctrl.sidenavId) title=\\\"toggle menu\\\" hide-gt-sm><md-icon>menu</md-icon></md-button><img class=logo src=assets/images/sda-logo-light.png><h2><span>{{$ctrl.title}}</span><!-- make this change based on page --></h2><span flex></span><md-button ui-sref=editor>People and Works</md-button><md-button ui-sref=article>Article</md-button><md-button ui-sref=task>Tasks</md-button></div></md-toolbar>\");\n$templateCache.put(\"app/components/summary-edit-dialog/summary-edit-dialog.html\",\"<md-dialog flex=50><md-toolbar><div class=md-toolbar-tools><h3>Summary Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><!-- material-compliant padding not used since WYSIWYG text editor *is* the UI --><summary-editor ng-model=vm.summary></summary-editor></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/components/summary-editor/summary-editor.html\",\"<div ckeditor ng-model=summary></div>\");\n$templateCache.put(\"app/zotero/test/test.html\",\"<div layout=column flex><md-content><zotero-editor item=vm.item types=vm.types></zotero-editor></md-content></div>\");\n$templateCache.put(\"app/admin/editors/articles/article-editor.html\",\"<form flex layout=column layout-padding><!-- title editor bar --><md-content layout=row><md-input-container flex=60 layout-sm=column layout-align=\\\"begin end\\\"><label>Title</label><input type=text ng-model=vm.article.title></md-input-container><section flex=40 layout=row layout-sm=column layout-align=\\\"end center\\\" layout-wrap><md-button class=md-raised ng-click=vm.cancel()>Cancel</md-button><md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button></section></md-content><!-- TODO add space for authors --><!-- TODO add save button and auto-save --><!-- TODO add sidebar for notes, biblio, links, etc --><div id=article_editor flex layout=column><div ng-model=vm.article.body ckeditor=vm.editor.config ckeditor-bibliography=vm.references ckeditor-footnotes=vm.article.footnotes></div><md-tabs flex><md-tab label=Abstract><div ckeditor=vm.abstractEditor.config ng-model=vm.article.abstract></div></md-tab><md-tab label=Bibliography><bibliography collection=vm.references></bibliography></md-tab><md-tab label=Footnotes><div class=footnotes ng-repeat=\\\"footnote in vm.article.footnotes\\\" layout=row><div class=footnote ng-bind-html=footnote.content flex></div><md-button class=md-icon-button aria-label=\\\"edit footnote\\\" ng-click=\\\"vm.editFootnote($event, footnote)\\\"><md-icon>edit</md-icon><md-tooltip>Edit Footnote</md-tooltip></md-button></div></md-tab></md-tabs></div><!-- TODO how to make this fill all available space --></form>\");\n$templateCache.put(\"app/admin/editors/articles/article.html\",\"<md-content flex layout=column><navbar title=Articles sidenav-id=left></navbar><md-content flex layout=row><md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column><md-tabs flex><md-tab><md-tab-label><md-icon>format_list_bulleted</md-icon><md-tooltip md-direction=bottom>Thematic Overviews</md-tooltip></md-tab-label><md-tab-body><tree-categorization-editor scope-id=sda scheme=overviews></tree-categorization-editor></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>book</md-icon><md-tooltip md-direction=bottom>Book Reviews</md-tooltip></md-tab-label><md-tab-body></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>person</md-icon><md-tooltip md-direction=bottom>Biographies</md-tooltip></md-tab-label><md-tab-body></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>school</md-icon><md-tooltip md-direction=bottom>Scholarly Articles</md-tooltip></md-tab-label><md-tab-body></md-tab-body></md-tab></md-tabs></md-sidenav><md-content flex layout=column ui-view></md-content><md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right\\\"><md-fab-trigger><md-button aria-label=New... class=md-fab><md-icon>add</md-icon></md-button></md-fab-trigger><md-fab-actions><md-button aria-label=\\\"New Article\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createArticle($event)><md-tooltip md-direction=left>New Article</md-tooltip><md-icon>description</md-icon></md-button></md-fab-actions></md-fab-speed-dial></md-content></md-content>\");\n$templateCache.put(\"app/admin/editors/articles/thematic-overview.html\",\"<div id=thematic_overviews><script type=text/ng-template id=treeCategoryEntry.html><div class=\\\"category-node\\\" layout=\\\"row\\\" layout-align=\\\"start center\\\">\\n     <!--  Display label for the category node-->\\n     <span ng-if=\\\"node.entryRef == null\\\" class=\\\"node-label\\\">{{ node.label }}</span>\\n     <a ui-sref=\\\"article.edit({id:node.entryRef.id})\\\" ng-if=\\\"node.entryRef != null\\\" class=\\\"node-label\\\">{{ node.label }}</a>\\n\\n     <!-- push buttons to edge -->\\n     <span flex></span>\\n\\n     <!-- node action menu -->\\n     <md-menu class=\\\"action\\\">\\n       <!-- activate handle -->\\n       <md-button ng-click=\\\"$mdOpenMenu($event)\\\" class=\\\"md-icon-button\\\">\\n         <md-icon>arrow_drop_down</md-icon>\\n       </md-button>\\n\\n       <md-menu-content>\\n         <!-- Associate/Remove  -->\\n         <md-menu-item>\\n           <md-button ng-if=\\\"node.entryRef.id == null\\\"\\n                      ng-click=\\\"vm.handleAssociateEntry($event, node)\\\">\\n             <md-icon>add_circle_outline</md-icon>\\n             Create Article\\n           </md-button>\\n           <md-button ng-if=\\\"node.entryRef.id != null\\\"\\n                      ng-click=\\\"vm.handleRemoveEntry($event, node)\\\">\\n             <md-icon>remove_circle_outline</md-icon>\\n             Remove Article\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleCreateChild($event, node)\\\">\\n             <!-- Will create a child node at the end of this list. User can drag to re-arrange -->\\n             <md-icon>create_new_folder</md-icon>\\n             Create Sub-Category\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleDeleteNode($event, node, parent)\\\">\\n             <!-- Will delete this node, all children and associated articles. If leaf node,\\n             displays delete instead of delete sweep. Prompts user to confirm. -->\\n             <md-icon>delete{{ node.children.length == 0 ? \\'\\' : \\'_sweep\\' }}</md-icon>\\n             Remove Category\\n           </md-button>\\n         </md-menu-item>\\n       </md-menu-content>\\n     </md-menu>\\n   </div>\\n\\n   <ol ng-if=\\\"node.children.length > 0\\\">\\n     <li ng-repeat=\\\"node in node.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = $parent.$parent.node\\\"></li>\\n   </ol></script><ol><li ng-repeat=\\\"node in vm.overviews.root.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = vm.overviews.root\\\"></li></ol><div layout=row layout-align=\\\"center center\\\"><!-- TODO need additional styling --><md-button ng-click=\\\"vm.handleCreateChild($event, vm.overviews.root)\\\" class=md-raised aria-label=\\\"create category\\\">Create Category</md-button></div></div>\");\n$templateCache.put(\"app/person/components/event-editor/event-editor.html\",\"<div layout=column><div layout=row><md-input-container flex><label>location</label><input type=text ng-model=event.location></md-input-container><date-editor ng-model=event.date flex></date-editor></div><div layout=row layout-padding><div flex><h2>Description</h2><div flex ckeditor ng-model=event.description></div></div></div></div>\");\n$templateCache.put(\"app/person/components/name-editor/name-editor.html\",\"<div layout=column><div layout=row><md-input-container flex=10><label>title</label><input type=text ng-model=name.title></md-input-container><md-input-container flex=30><label>given</label><input type=text ng-model=name.givenName></md-input-container><md-input-container flex=20><label>middle</label><input type=text ng-model=name.middleName></md-input-container><md-input-container flex=30><label>family</label><input type=text ng-model=name.familyName></md-input-container><md-input-container flex=10><label>suffix</label><input type=text ng-model=name.suffix></md-input-container></div><md-input-container><label>display label</label><input type=text ng-model=name.label required></md-input-container></div>\");\n$templateCache.put(\"app/task/components/edition-editor/edition-editor.html\",\"<div layout=row><md-input-container flex><label>edition name</label><input type=text ng-model=edition.editionName required></md-input-container></div><section class=publication layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Publication Information</h2></div></md-toolbar><publication-info-editor ng-model=edition.publicationInfo flex></publication-info-editor></section><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=edition.titles.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in edition.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.titles.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=edition.authors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in edition.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.authors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=summary><h2>Summary</h2><summary-editor ng-model=edition.summary flex></summary-editor></section><section class=volumes><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Volumes</h2><span flex></span><md-button class=md-icon-button ng-click=vm.createVolume()><md-icon>add</md-icon></md-button></div></md-toolbar><md-whiteframe class=volume layout=column layout-margin ng-repeat=\\\"volume in vm.volumes\\\" ng-class=\\\"{\\'md-whiteframe-2dp\\': !volume.focused, \\'md-whiteframe-8dp\\': volume.focused}\\\"><h3 layout=row><div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"volume.focused = !volume.focused\\\"><md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon><span>Volume {{volume.model.volumeNumber}}</span> <span flex></span></div><md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteVolume($index)><md-icon>delete</md-icon></md-button></h3><div class=slide ng-show=volume.focused><volume-editor ng-model=volume.model flex></volume-editor></div></md-whiteframe></section><section class=copies><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=edition.copies.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=copy layout=column ng-repeat=\\\"copy in edition.copies\\\"><div layout=row><copy-editor ng-model=copy flex></copy-editor><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.copies.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></div></div></section>\");\n$templateCache.put(\"app/task/components/volume-editor/volume-editor.html\",\"<div layout=row><md-input-container flex><label>volume number</label><input type=text ng-model=volume.volumeNumber required></md-input-container></div><section class=publication layout=column><h2>Publication Information</h2><publication-info-editor ng-model=volume.publicationInfo></publication-info-editor></section><section class=titles layout=column><h2 layout=row><span flex>Titles</span><md-button class=md-icon-button ng-click=volume.titles.push({})><md-icon>add</md-icon></md-button></h2><div class=title layout=row ng-repeat=\\\"title in volume.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.titles.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><h2 layout=row><span flex>Authors</span><md-button class=md-icon-button ng-click=volume.authors.push({})><md-icon>add</md-icon></md-button></h2><div class=author layout=row ng-repeat=\\\"author in volume.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.authors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=summary><h2>Summary</h2><summary-editor ng-model=volume.summary flex></summary-editor></section><section class=copies><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=volume.copies.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=copy layout=column ng-repeat=\\\"copy in volume.copies\\\"><div layout=row><copy-editor ng-model=copy flex></copy-editor><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.copies.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></div></div></section>\");\n$templateCache.put(\"app/task/components/work-editor/work-editor.html\",\"<section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=work.titles.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in work.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.titles.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=work.authors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in work.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.authors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=summary><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Summary</h2></div></md-toolbar><summary-editor ng-model=work.summary flex></summary-editor></section><section class=editions><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Editions</h2><span flex></span><md-button class=md-icon-button ng-click=vm.createEdition()><md-icon>add</md-icon></md-button></div></md-toolbar><md-whiteframe class=edition layout=column layout-margin ng-repeat=\\\"edition in vm.editions\\\" ng-class=\\\"{ \\'md-whiteframe-2dp\\': !edition.focused, \\'md-whiteframe-8dp\\': edition.focused }\\\"><h3 layout=row><div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"edition.focused = !edition.focused\\\"><md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon><span>{{edition.model.editionName}}</span> <span flex></span></div><md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteEdition($index)><md-icon>delete</md-icon></md-button></h3><div class=slide ng-show=edition.focused><edition-editor ng-model=edition.model flex></edition-editor></div></md-whiteframe></section><section class=copies><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=work.copies.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=copy layout=column ng-repeat=\\\"copy in work.copies\\\"><div layout=row><copy-editor ng-model=copy flex></copy-editor><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.copies.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></div></div></section>\");\n$templateCache.put(\"app/task/components/work-editor-item/work-editor-item.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=!vm.loaded><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-if=vm.loaded><work-editor ng-model=vm.work></work-editor></div>\");\n$templateCache.put(\"app/work/components/author-ref-editor/author-ref-editor.html\",\"<div layout=column><div layout=row><md-autocomplete required md-items=\\\"item in vm.authorRoles\\\" md-item-text=role md-min-length=0 md-search-text=ref.role md-selected-item-change=\\\"ref.role = item\\\" md-floating-label=role><md-item-template><span md-highlight-text=ref.role>{{item}}</span></md-item-template></md-autocomplete><md-input-container flex><label>first name</label><input type=text ng-model=ref.firstName></md-input-container><md-input-container flex><label>last name</label><input type=text ng-model=ref.lastName></md-input-container></div><div layout=row><md-autocomplete flex md-items=\\\"person in vm.getResults(vm.linkAuthorSearchText)\\\" md-item-text=person.label md-search-text=vm.linkAuthorSearchText md-search-text-change=vm.searchPeople(vm.linkAuthorSearchText) md-selected-item-change=vm.setLinkedAuthor(person) md-floating-label=\\\"linked author\\\"><span md-highlight-text=vm.linkAuthorSearchText>{{person.label}}</span></md-autocomplete></div></div>\");\n$templateCache.put(\"app/work/components/copy-editor/copy-editor.html\",\"<ng-form name=copyForm layout=column flex><md-input-container><label for=title>Title</label><input type=text name=title id=title ng-model=copy.title></md-input-container><div layout=row><md-input-container><label for=type>Type</label><md-select name=type id=type ng-model=copy.type required ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"><md-option ng-repeat=\\\"handler in vm.refHandlers\\\" value={{handler.id}}>{{handler.display}}</md-option></md-select></md-input-container><md-input-container flex><label for=url>URL</label><input type=url name=url id=url ng-model=copyUrl ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"></md-input-container></div><ul class=\\\"properties properties-inline\\\"><li ng-repeat=\\\"(key, value) in copy.properties\\\"><span class=label>{{key}}</span> <span class=value>{{value}}</span></li></ul><md-input-container><label for=rights>Description of Rights</label><input type=text name=rights id=rights ng-model=copy.rights></md-input-container><h3>Summary</h3><summary-editor ng-model=copy.summary flex></summary-editor></ng-form>\");\n$templateCache.put(\"app/work/components/publication-info-editor/publication-info-editor.html\",\"<div layout=row><md-input-container flex><label>publisher</label><input type=text ng-model=pubInfo.publisher></md-input-container><md-input-container flex><label>location</label><input type=text ng-model=pubInfo.place></md-input-container><date-editor ng-model=pubInfo.date flex></date-editor></div>\");\n$templateCache.put(\"app/work/components/title-editor/title-editor.html\",\"<div layout=row><md-input-container><label>type</label><md-select ng-model=title.type required><md-option value=bibliographic>bibliographic</md-option><md-option value=canonical>canonical</md-option><md-option value=short>short</md-option></md-select></md-input-container><md-input-container flex><label>title</label><input type=text ng-model=title.title required><div ng-switch=title.type><small ng-switch-when=bibliographic>the full title as published on the work</small> <small ng-switch-when=canonical>title by which the work is commonly known in the academic realm</small> <small ng-switch-when=short>shortened title coloquially used by the public</small></div></md-input-container><md-input-container flex><label>subtitle</label><input type=text ng-model=title.subtitle></md-input-container></div>\");}]);"],"sourceRoot":"/source/"}