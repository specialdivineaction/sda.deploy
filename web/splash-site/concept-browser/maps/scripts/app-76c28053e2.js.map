{"version":3,"sources":["scripts/app.js"],"names":["angular","module","graphRepoProvider","graphRepoFactory","$resource","getGraph","type","restResource","get","provider","url","repo","$inject","$get","peopleRepoProvider","peopleRepoFactory","$q","createPerson","person","adaptPerson","createMeta","meta","adaptMeta","createName","name","adaptName","createEvent","evt","adaptEvent","createDateDescription","dateDescription","findById","id","search","query","q","savePerson","response","update","save","$promise","then","personId","deletePerson","altNames","forEach","birth","death","links","date","method","create","trcPersonEditorDirective","PersonEditorController","$scope","peopleRepo","addName","newName","push","removeName","ix","splice","addEvent","key","newEvent","removeEvent","vm","this","directive","restrict","templateUrl","scope","controller","controllerAs","trcNameEditorDirective","NameEditorController","roles","value","label","trcEventEditorDirective","event","MainController","$http","$mdToast","$mdDialog","$mdMedia","$location","$stateParams","$filter","$timeout","$document","worksRepo","graphRepo","activate","loadSelectModes","loadSizeMetrics","defaultGraphType","graphType","graphLoading","getGraphData","showSimple","data","graph","$watch","node","sidebarLoading","loadNodeData","searchQuery","highlightedNodes","nodes","toggleRelnTypeFilter","typeId","relnTypeFilter","indexOf","selectModes","strategy","selected","adjacent","outEdges","filter","edgeFilter","map","edge","target","incident","inEdges","source","concat","worklist","visited","length","pop","selectMode","sizeMetrics","metadata","pagerank","disabled","sizeMetric","toggleSearchForm","showSearchForm","element","focus","clearSearchForm","showHelp","$event","config","targetEvent","fullscreen","clickOutsideToClose","show","relation","makeTypeGroup","group","directed","out","title","reverseTitle","none","ensureTypeGroup","related","hasOwnProperty","works","searchByAuthor","worksP","items","Error","TYPES","all","nodesById","edges","activeNode","relnTypes","uk.ac.ox.bodleian.sda.relationships.influence","uk.ac.ox.bodleian.sda.relationships.provoked","uk.ac.ox.bodleian.sda.relationships.patternmatch","HelpDialogController","closeDialog","hide","close","worksRepoProvider","worksRepoFactory","findAll","max","authorId","aid","getWork","workId","isUndefined","TypeError","work","adaptWork","getEdition","editionId","edition","editionResource","adaptEdition","getVolume","volumeId","volume","volumeResource","adaptVolume","createWork","titles","authors","createEdition","createVolume","arguments","saveWork","apply","saveEdition","saveVolume","$update","$save","deleteWork","dataItem","adaptCommon","entity","toLowerCase","author","role","otherAuthors","copies","editions","volumes","getTitleByTypePreference","types","isArray","reduce","found","i","getAll","getTitle","conceptBrowserDirective","$window","linkFunc","el","width","autoWidth","height","autoHeight","layout","rootEl","ConceptBrowser","size","nodeCentralityMetric","refresh","on","oldWidth","oldHeight","preventActivate","$apply","$watchGroup","newValues","oldValues","queueRefresh","graphData","copy","$watchCollection","highlight","updateGraphSelections","padding","link","runBlock","$log","debug","run","routerConfig","$stateProvider","$urlRouterProvider","state","otherwise","constant","d3","moment","$logProvider","$mdThemingProvider","debugEnabled","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","dark","root","factory","define","amd","exports","EventDispatcher","trigger","eventName","context","eventHandlers","handler","e","console","error","globalHandlers","addGlobalListener","addListener","addOnceListener","deregister","API","once","require","dragstart","d","fixed","dragend","mouseover","px","x","py","y","mouseout","accumulate","quad","alpha","charges","cx","cy","charge","leaf","c","n","point","Math","random","k","index","pointCharge","isFunction","o","isNumber","LINK_DISTANCE","LINK_STRENGTH","CHARGE_DISTANCE_2","Infinity","force","cylindrical","wrapDx","dx","abs","repulse","x1","_","x2","dy","dw","dn","theta2","chargeDistance2","dragmove","resume","drag","distances","strengths","dispatch","friction","linkDistance","linkStrength","gravity","tick","end","s","t","l","m","sqrt","weight","geom","quadtree","visit","chargeDistance","theta","start","timer","position","dimension","neighbors","Array","j","candidates","cs","isNaN","w","h","call","stop","behavior","origin","edgePath","getX1","getY1","getX2","getY2","drawLine","selection","attr","y1","y2","fn","rebind","options","setSize","dims","isInitialized","svg","progressScale","range","setNodeCentralityMetric","centralityMetric","centralityExtent","extent","centralityMetricScale","domain","setSelectMode","_selectMode","setData","_nodes","_edges","setHighlighted","allNodesInGraph","every","unhighlightAll","setActivated","deactivate","deselectAll","select","setEdgeFilter","initialize","bindNodes","bindEdges","append","edgeTypes","defineArrowheads","baseGroup","edgeLayer","nodeLayer","progressBar","scale","linear","log","nodeRadiusScale","NODE_MIN_SIZE","NODE_MAX_SIZE","GRAPH_LAYOUT_CTORS","configureGraph","drawEdge","tip","tooltip","TIP_CSS_CLASS","direction","tooltipDirection","offset","tooltipOffset","html","events","showTooltip","hideTooltip","debounce","applyStyleClasses","sz","chargeRange","influenceRange","updatePositions","selectAll","transition","duration","nodeSelect","nodeEnter","enter","blur","ctrlKey","deselect","exit","remove","edgeSelect","ns","highlighted","focused","activated","activatedSet","selectedSet","slice","focusedSet","p","highlightedSet","classed","cls","min","dir","TIP_POSITION_MARGIN","bottom","top","right","left","radius","left_right","classTypes","arrowTypes","wait","leading","trailing","timeout","later","ctx","args","callNow","clearTimeout","setTimeout","planar","warn","$templateCache","put"],"mappings":"CAAA,WACE,YAEAA,SACGC,OAAO,YACN,kBAKN,WACE,YAMA,SAASC,KAOP,QAASC,GAAiBC,GAaxB,QAASC,GAASC,GAChB,MAAOC,GAAaC,KAAMF,KAAMA,IAblC,GAAIC,GAAeH,EAAUK,EAASC,IAAM,UAExCC,IAEJ,OADAA,GAAKH,IAAMH,EACJM,EAXTR,EAAiBS,SAAW,YAA5B,IAAIH,KAGJ,OAFAA,GAASC,IAAM,aACfD,EAASI,KAAOV,EACTM,EARTT,QACGC,OAAO,YACPQ,SAAS,YAAaP,MA8B3B,WACE,YAEAF,SACGC,OAAO,UACN,kBAyFN,WACE,YAQA,SAASa,KAMP,QAASC,GAAkBC,EAAIZ,GAoB7B,QAASa,KACP,GAAIC,GAAS,GAAIX,EACjB,OAAOY,GAAYD,GAQrB,QAASE,KACP,GAAIC,KACJ,OAAOC,GAAUD,GAQnB,QAASE,KACP,GAAIC,KACJ,OAAOC,GAAUD,GAQnB,QAASE,KACP,GAAIC,KACJ,OAAOC,GAAWD,GAQpB,QAASE,KACP,GAAIC,KACJ,OAAOA,GAaT,QAASC,GAASC,GAChB,MAAOzB,GAAaC,KAAMwB,GAAIA,IAShC,QAASC,GAAOC,GACd,MAAO3B,GAAaC,KAAM2B,EAAGD,IAY/B,QAASE,GAAWlB,GAClB,GAAImB,EAOJ,OALEA,GADEnB,EAAOc,GACEzB,EAAa+B,QAASN,GAAId,EAAOc,IAAMd,GAEvCX,EAAagC,KAAK,KAAMrB,GAG9BmB,EAASG,SAASC,KAAK,SAAUC,GAEtC,MADAxB,GAAOc,GAAKU,EAASV,GACdd,IAUX,QAASyB,GAAaX,GACpB,GAAIK,GAAW9B,EAAAA,WAAsByB,GAAIA,GACzC,OAAOK,GAASG,SASlB,QAASrB,GAAYD,GA+BnB,MA9BKA,GAAOG,KAGVC,EAAUJ,EAAOG,MAFjBH,EAAOG,KAAOD,IAKXF,EAAOM,KAGVC,EAAUP,EAAOM,MAFjBN,EAAOM,KAAOD,IAKXL,EAAO0B,SAGV1B,EAAO0B,SAASC,QAAQpB,GAFxBP,EAAO0B,YAKJ1B,EAAO4B,MAGVlB,EAAWV,EAAO4B,OAFlB5B,EAAO4B,MAAQpB,IAKZR,EAAO6B,MAGVnB,EAAWV,EAAO6B,OAFlB7B,EAAO6B,MAAQrB,IAKVR,EAST,QAASI,GAAUD,GAKjB,MAJKA,GAAK2B,QACR3B,EAAK2B,UAGA3B,EAQT,QAASI,GAAUD,GAEjB,MAAOA,GAST,QAASI,GAAWD,GAKlB,MAJKA,GAAIsB,OACPtB,EAAIsB,KAAOpB,KAGNF,EArMT,GAAIpB,GAAeH,EAAUK,EAASC,IAAM,OAAQ,MAClD4B,QAAYY,OAAQ,SAGlBvC,IAQJ,OAPAA,GAAKwC,OAASlC,EACdN,EAAKY,WAAaA,EAClBZ,EAAKe,YAAcA,EACnBf,EAAKH,IAAMuB,EACXpB,EAAKsB,OAASA,EACdtB,EAAK4B,KAAOH,EACZzB,EAAAA,UAAcgC,EACPhC,EAlBTI,EAAkBH,SAAW,KAAM,YADnC,IAAIH,KAGJ,OAFAA,GAASC,IAAM,cACfD,EAASI,KAAOE,EACTN,EATTT,QACGC,OAAO,UACPQ,SAAS,aAAcK,MAuN5B,WACE,YASA,SAASsC,KAYP,QAASC,GAAuBC,EAAQC,GAWtC,QAASC,KACP,GAAIC,GAAUF,EAAWhC,YACzB+B,GAAOpC,OAAO0B,SAASc,KAAKD,GAQ9B,QAASE,GAAWC,GAClBN,EAAOpC,OAAO0B,SAASiB,OAAOD,EAAI,GAQpC,QAASE,GAASC,GAChB,GAAIC,GAAWT,EAAW7B,aAC1B4B,GAAOpC,OAAO6C,GAAOC,EAQvB,QAASC,GAAYF,GACnBT,EAAOpC,OAAO6C,GAAO,KAxCvB,GAAIG,GAAKC,IAETD,GAAGV,QAAUA,EACbU,EAAGP,WAAaA,EAChBO,EAAGJ,SAAWA,EACdI,EAAGD,YAAcA,EAjBnBZ,EAAuBzC,SAAW,SAAU,aAF5C,IAAIwD,IACFC,SAAU,IACVC,YAAa,iCACbC,OACErD,OAAQ,YAEVsD,WAAYnB,EACZoB,aAAc,eAGhB,OAAOL,GAhBTpE,QACGC,OAAO,UACPmE,UAAU,kBAAmBhB,MAiElC,WACE,YAOA,SAASsB,KAaP,QAASC,KACP,GAAIT,GAAKC,IAETD,GAAGU,QACCC,MAAO,YAAaC,MAAO,mBAC3BD,MAAO,YAAaC,MAAO,cAC3BD,MAAO,SAAUC,MAAO,gBACxBD,MAAO,cAAeC,MAAO,yBAC7BD,MAAO,WAAYC,MAAO,aAC1BD,MAAO,WAAYC,MAAO,kBArBhC,GAAIV,IACFC,SAAU,IACVC,YAAa,+BACbC,OACE/C,KAAM,YAERgD,WAAYG,EACZF,aAAc,aAGhB,OAAOL,GAhBTpE,QACGC,OAAO,UACPmE,UAAU,gBAAiBM,MAgChC,WACE,YAOA,SAASK,KACP,GAAIX,IACFC,SAAU,IACVC,YAAa,gCACbC,OACES,MAAO,YAIX,OAAOZ,GAdTpE,QACGC,OAAO,UACPmE,UAAU,iBAAkBW,MAiBjC,WACE,YAEA/E,SACGC,OAAO,uBACN,YACA,YACA,aACA,aACA,SACA,aACA,YACA,aACA,YACA,SACA,gBAKN,WACE,YA4BA,SAASgF,GAAeC,EAAO5B,EAAQtC,EAAImE,EAAUC,EAAWC,EAAUC,EAAWC,EAAcC,EAASC,EAAUC,EAAWnC,EAAYoC,EAAWC,GAgCtJ,QAASC,KACPC,IACAC,GAEA,IAAIC,GAAmB,SACnBC,EAAYV,EAAajF,MAAQ0F,CACrC9B,GAAGgC,cAAe,EAClBC,EAAaF,GAAbE,SAA8B,WAE5B,MADAhB,GAASiB,WAAW,uBAAyBH,EAAY,iCAAmCD,EAAmB,MACxGG,EAAaH,KACnBvD,KAAK,SAAU4D,GAChBnC,EAAGgC,cAAe,EAClBhC,EAAGoC,MAAQD,EAAKC,OACf,WACDpC,EAAGgC,cAAe,EAClBf,EAASiB,WAAW,gCAGtB9C,EAAOiD,OAAO,kBAAmB,SAAUC,GACrCA,GACFtC,EAAGuC,gBAAiB,EACpBC,EAAaF,GAAM/D,KAAK,WACtByB,EAAGuC,gBAAiB,GACnB,WACDvC,EAAGuC,gBAAiB,EACpBtB,EAASiB,WAAW,+BAGtBlC,EAAGhD,OAAS,OAIhBoC,EAAOiD,OAAO,cAAe,SAAUI,GACrCzC,EAAG0C,iBAAmBD,EAAcnB,EAAQ,UAAUtB,EAAGoC,MAAMO,OAAS/B,MAAO6B,SAInF,QAASG,GAAqBC,GAC5B,GAAInD,GAAKM,EAAG8C,eAAeC,QAAQF,EAC1B,GAALnD,EACFM,EAAG8C,eAAetD,KAAKqD,GAEvB7C,EAAG8C,eAAenD,OAAOD,EAAI,GAIjC,QAASkC,KACP5B,EAAGgD,YAAYxD,MACboB,MAAO,YACPqC,SAAU,SAAUC,GAClB,IAAKA,EACH,QAGF,IAAIC,GAAWD,EAASE,SAASC,OAAOC,GAAYC,IAAI,SAAUC,GAChE,MAAOA,GAAKC,SAEVC,EAAWR,EAASS,QAAQN,OAAOC,GAAYC,IAAI,SAAUC,GAC/D,MAAOA,GAAKI,QAEd,QAAQV,GAAUW,OAAOV,EAAUO,MAIvC1D,EAAGgD,YAAYxD,MACboB,MAAO,QACPqC,SAAU,SAAUC,GAClB,IAAKA,EACH,QAMF,KAHA,GAAIY,IAAYZ,GACZa,KAEGD,EAASE,OAAS,GAAG,CAC1B,GAAI1B,GAAOwB,EAASG,KACpBF,GAAQvE,KAAK8C,GACbA,EAAKc,SAASzE,QAAQ,SAAU6E,GAC1BO,EAAQhB,QAAQS,EAAKC,QAAU,GACjCK,EAAStE,KAAKgE,EAAKC,UAKzB,MAAOM,MAIX/D,EAAGgD,YAAYxD,MACboB,MAAO,UACPqC,SAAU,SAAUC,GAClB,MAAOA,IAAYA,GAAUW,OAAOX,EAASS,QAAQN,OAAOC,GAAYC,IAAI,SAAUC,GACpF,MAAOA,GAAKI,gBAKlB5D,EAAGgD,YAAYxD,MACboB,MAAO,WACPqC,SAAU,SAAUC,GAClB,MAAOA,IAAYA,GAAUW,OAAOX,EAASE,SAASC,OAAOC,GAAYC,IAAI,SAAUC,GACrF,MAAOA,GAAKC,gBAKlBzD,EAAGkE,WAAalE,EAAGgD,YAAY,GAGjC,QAASnB,KACP7B,EAAGmE,YAAY3E,MACboB,MAAO,WACPqC,SAAU,SAAUX,GAClB,MAAOA,GAAK8B,SAASC,YAIzBrE,EAAGmE,YAAY3E,MACboB,MAAO,UACPqC,SAAU,WACR,MAAO,MAIXjD,EAAGmE,YAAY3E,MACboB,MAAO,OACP0D,UAAU,EACVrB,SAAU,WACR,MAAO,MAIXjD,EAAGuE,WAAavE,EAAGmE,YAAY,GAGjC,QAASK,KACPxE,EAAGyE,gBAAkBzE,EAAGyE,eAEpBzE,EAAGyE,eACLlD,EAAS,WACPzF,QAAQ4I,QAAQ,uCAAuCC,UAGzDvF,EAAOqD,YAAc,GAIzB,QAASmC,KACPxF,EAAOqD,YAAc,GACrBlB,EAAS,WACPvB,EAAGyE,gBAAiB,IAIxB,QAASI,GAASC,GAChB,GAAIC,IACFC,YAAaF,EACbG,WAAY9D,EAAS,OAASA,EAAS,MACvCf,YAAa,qBACbE,WAAY,uBACZ4E,qBAAqB,EAGvBhE,GAAUiE,KAAKJ,GAKjB,QAASzB,GAAWE,GAClB,MAAoC,KAA7BxD,EAAG8C,eAAekB,QAAgBhE,EAAG8C,eAAeC,QAAQS,EAAK4B,WAAa,EAGvF,QAAS5C,GAAaF,GAiBpB,QAAS+C,GAAcjJ,GACrB,GAAIkJ,IAAUxH,GAAI1B,EAAK0B,GAAIyH,SAAUnJ,EAAKmJ,SAS1C,OAPInJ,GAAKmJ,UACPD,EAAME,KAAQ5E,MAAOxE,EAAKqJ,MAAO9C,UACjC2C,EAAAA,OAAa1E,MAAOxE,EAAKsJ,aAAc/C,WAEvC2C,EAAMK,MAAS/E,MAAOxE,EAAKqJ,MAAO9C,UAG7B2C,EAGT,QAASM,GAAgBxJ,GAKvB,MAJKyJ,GAAQC,eAAe1J,EAAK0B,MAC/B+H,EAAQzJ,EAAK0B,IAAMuH,EAAcjJ,IAG5ByJ,EAAQzJ,EAAK0B,IAhCtBkC,EAAGhD,OAASqC,EAAW/C,IAAIgG,EAAKxE,GAEhC,IAAIiI,GAAQtE,EAAUuE,eAAe1D,EAAKxE,IACtCmI,EAASF,EAAMzH,SAASC,KAAK,WAC/B,IAAKwH,EAAMG,MACT,KAAM,IAAIC,OAAM,uBAIlB,OADAnG,GAAG+F,MAAQA,EAAMG,MACVlG,EAAG+F,QAGRF,IAuBJvD,GAAKc,SAASG,IAAI,SAAUC,GAC1B,GAAIpH,GAAOgK,EAAM5C,EAAK4B,SACtB,IAAKhJ,EAAL,CAEA,GAAIkJ,GAAQM,EAAgBxJ,EAC5BkJ,GAAMlJ,EAAKmJ,SAAW,MAAQ,QAAQ5C,MAAMnD,KAAKgE,EAAKC,WAGxDnB,EAAKqB,QAAQJ,IAAI,SAAUC,GACzB,GAAIpH,GAAOgK,EAAM5C,EAAK4B,SACtB,IAAKhJ,EAAL,CAEA,GAAIkJ,GAAQM,EAAgBxJ,EAC5BkJ,GAAMlJ,EAAKmJ,SAAW,KAAO,QAAQ5C,MAAMnD,KAAKgE,EAAKI,WAGvD5D,EAAG6F,UACH,KAAK,GAAIhG,KAAOgG,GAAaA,EAAQC,eAAejG,IAClDG,EAAG6F,QAAQrG,KAAKqG,EAAQhG,GAG1B,OAAO/C,GAAGuJ,KAAKrG,EAAGhD,OAAOsB,SAAU2H,IAGrC,QAAShE,GAAa7F,GACpB,GAAIgG,GAAQV,EAAUpF,IAAIF,EAE1B,OAAOgG,GAAM9D,SAASC,KAAK,WACzB,GAAI+H,KA0BJ,OAvBAlE,GAAMA,MAAMO,MAAMhE,QAAQ,SAAU2D,GAClCA,EAAKqB,WACLrB,EAAKc,YAELkD,EAAUhE,EAAKxE,IAAMwE,IAQvBF,EAAMA,MAAMmE,MAAM5H,QAAQ,SAAU6E,GAClC,GAAIC,GAAS6C,EAAU9C,EAAKI,QACxBA,EAAS0C,EAAU9C,EAAKC,OAE5BD,GAAKI,OAASA,EACdA,EAAOR,SAAS5D,KAAKgE,GAErBA,EAAKC,OAASA,EACdA,EAAOE,QAAQnE,KAAKgE,KAGfpB,IAvSX,GAAIpC,GAAKC,IAETD,GAAGwE,iBAAmBA,EACtBxE,EAAG4E,gBAAkBA,EACrB5E,EAAGyE,gBAAiB,EACpBzE,EAAGyC,YAAc,GAEjBzC,EAAG6E,SAAWA,EAEd7E,EAAGoC,MAAQ,KACXpC,EAAGwG,WAAa,KAChBxG,EAAGhD,OAAS,KACZgD,EAAG+F,MAAQ,KACX/F,EAAG6F,QAAU,KACb7F,EAAGuC,gBAAiB,EACpBvC,EAAGgC,cAAe,EAElBhC,EAAGyG,UAAYL,EACfpG,EAAG8C,kBACH9C,EAAG4C,qBAAuBA,EAE1B5C,EAAGkE,WAAa,KAChBlE,EAAGgD,eAEHhD,EAAGuE,WAAa,KAChBvE,EAAGmE,eAEHnE,EAAG0C,oBAEHf,IApDFZ,EAAerE,SAAW,QAAS,SAAU,KAAM,WAAY,YAAa,WAAY,YAAa,eAAgB,UAAW,WAAY,YAAa,aAAc,YAAa,YAHpL,IAAI0J,IACFM,iDACE5I,GAAI,gDACJ2H,MAAO,aACPC,aAAc,gBACdH,UAAU,GAEZoB,gDACE7I,GAAI,+CACJ2H,MAAO,WACPC,aAAc,cACdH,UAAU,GAEZqB,oDACE9I,GAAI,mDACJ2H,MAAO,yBACPF,UAAU,GAIdzJ,SACGC,OAAO,uBACPuE,WAAW,iBAAkBS,MAkTlC,WACE,YAOA,SAAS8F,GAAqBzH,EAAQ8B,GAGpC,QAAS4F,KACP5F,EAAU6F,OAHZ3H,EAAO4H,MAAQF,EAFjBD,EAAqBnK,SAAW,SAAU,aAJ1CZ,QACGC,OAAO,uBACPuE,WAAW,uBAAwBuG,MAaxC,WACE,YAEA/K,SACGC,OAAO,aACN,kBAKN,WACE,YAiBA,SAASkL,KAEP,QAASC,GAAiBhL,GA4CxB,QAASiL,KACP,MAAOpJ,GAAO,IAQhB,QAASA,GAAOC,GACd,MAAO3B,GAAaC,KAAM2B,EAAGD,EAAOoJ,IAAK,KAQ3C,QAASpB,GAAeqB,GACtB,MAAOhL,GAAaC,KAAMgL,IAAKD,EAAUD,IAAK,KAahD,QAASG,GAAQC,GACf,GAAI1L,QAAQ2L,YAAYD,GACtB,KAAM,IAAIE,WAAU,iCAGtB,IAAIC,GAAOtL,EAAaC,KAAMkL,OAAQA,GAItC,OAFAG,GAAKrJ,SAASC,KAAKqJ,GAEZD,EAcT,QAASE,GAAWL,EAAQM,GAC1B,GAAIhM,QAAQ2L,YAAYD,IAAW1L,QAAQ2L,YAAYK,GACrD,KAAM,IAAIJ,WAAU,qCAGtB,IAAIK,GAAUC,EAAgB1L,KAAMkL,OAAQA,EAAQM,UAAWA,GAI/D,OAFAC,GAAQzJ,SAASC,KAAK0J,GAEfF,EAeT,QAASG,GAAUV,EAAQM,EAAWK,GACpC,GAAIrM,QAAQ2L,YAAYD,IAAW1L,QAAQ2L,YAAYK,IAAchM,QAAQ2L,YAAYU,GACvF,KAAM,IAAIT,WAAU,oCAGtB,IAAIU,GAASC,EAAe/L,KAAMkL,OAAQA,EAAQM,UAAWA,EAAWK,SAAUA,GAIlF,OAFAC,GAAO9J,SAASC,KAAK+J,GAEdF,EAQT,QAASG,KACP,GAAIZ,GAAO,GAAItL,EAIf,OAHAuL,GAAUD,GACVA,EAAKa,OAAOhJ,SACZmI,EAAKc,QAAQjJ,SACNmI,EAQT,QAASe,KACP,GAAIX,GAAU,GAAIC,EAClB,OAAOC,GAAaF,GAQtB,QAASY,KACP,GAAIP,GAAS,GAAIC,EACjB,OAAOC,GAAYF,GASrB,QAAS/J,KACP,OAAQuK,UAAU5E,QAChB,IAAK,GAAG,MAAO6E,GAASC,MAAM,KAAMF,UACpC,KAAK,GAAG,MAAOG,GAAYD,MAAM,KAAMF,UACvC,KAAK,GAAG,MAAOI,GAAWF,MAAM,KAAMF,WAExC,KAAM,IAAIlB,WAAU,0CAStB,QAASmB,GAASlB,GAChB,KAAMA,YAAgBtL,IACpB,KAAM,IAAI8J,OAAM,oCAIlB,OAAOwB,GAAK7J,GACR6J,EAAKsB,UACLtB,EAAKuB,QAUX,QAASH,GAAYvB,EAAQO,GAC3B,IAAKP,EACH,KAAM,IAAIrB,OAAM,sBAGlB,MAAM4B,YAAmBC,IACvB,KAAM,IAAI7B,OAAM,uCAGlB,OAAO4B,GAAQjK,GACXiK,EAAQkB,SAAUzB,OAAQA,IAC1BO,EAAQmB,OAAQ1B,OAAQA,IAW9B,QAASwB,GAAWxB,EAAQM,EAAWM,GACrC,IAAKZ,EACH,KAAM,IAAIrB,OAAM,sBAGlB,KAAK2B,EACH,KAAM,IAAI3B,OAAM,yBAGlB,MAAMiC,YAAkBC,IACtB,KAAM,IAAIlC,OAAM,sCAGlB,OAAOiC,GAAOtK,GACVsK,EAAOa,SAAUzB,OAAQA,EAAQM,UAAWA,IAC5CM,EAAOc,OAAQ1B,OAAQA,EAAQM,UAAWA,IAQhD,QAASqB,GAAW3B,GAClB,GAAI4B,GAAW/M,EAAAA,WAAsByB,GAAI0J,GACzC,OAAO4B,GAAS9K,SASlB,QAAS+K,GAAYC,GA6BnB,MA5BKA,GAAOd,OAGVc,EAAOd,OAAO7J,QAAQ,SAAU8G,GAC9BA,EAAMrJ,KAAOqJ,EAAMrJ,KAAKmN,gBAH1BD,EAAOd,UAOJc,EAAOb,QAGVa,EAAOb,QAAQ9J,QAAQ,SAAU6K,GAC/BA,EAAOC,KAAOD,EAAOC,KAAKF,gBAH5BD,EAAOb,WAOJa,EAAOI,aAGVJ,EAAOI,aAAa/K,QAAQ,SAAU6K,GACpCA,EAAOC,KAAOD,EAAOC,KAAKF,gBAH5BD,EAAOI,gBAOJJ,EAAOK,SACVL,EAAOK,WAGFL,EAST,QAAS1B,GAAUD,GASjB,MARA0B,GAAY1B,GAEPA,EAAKiC,SAGRjC,EAAKiC,SAASjL,QAAQsJ,GAFtBN,EAAKiC,YAKAjC,EAST,QAASM,GAAaF,GASpB,MARAsB,GAAYtB,GAEPA,EAAQ8B,QAGX9B,EAAQ8B,QAAQlL,QAAQ2J,GAFxBP,EAAQ8B,WAKH9B,EAST,QAASO,GAAYF,GAGnB,MAFAiB,GAAYjB,GAELA,EAWT,QAAS0B,GAAyBtB,EAAQuB,GAKxC,MAJKjO,SAAQkO,QAAQD,KACnBA,GAASA,IAGJA,EAAME,OAAO,SAAUC,EAAO9N,GACnC,GAAI8N,EACF,MAAOA,EAGT,KAAK,GAAIC,GAAI,EAAGA,EAAI3B,EAAOxE,OAAQmG,IACjC,GAAI3B,EAAO2B,GAAG/N,OAASA,EACrB,MAAOoM,GAAO2B,EAIlB,OAAO,OACN,MA/WL,GAAI9N,GAAeH,EAAUK,EAASC,IAAM,YAAcgL,OAAQ,QAChEpJ,QACEY,OAAQ,SAIRgJ,EAAkB9L,EAAUK,EAASC,IAAM,gCAAkCsL,UAAW,QAC1F1J,QACEY,OAAQ,SAIRqJ,EAAiBnM,EAAUK,EAASC,IAAM,kDAAoD2L,SAAU,QAC1G/J,QACEY,OAAQ,SAIRvC,IAkBJ,OAjBAA,GAAK2N,OAASjD,EACd1K,EAAKsB,OAASA,EACdtB,EAAKuJ,eAAiBA,EACtBvJ,EAAKH,IAAMiL,EACX9K,EAAK8K,QAAUA,EACf9K,EAAKoL,WAAaA,EAClBpL,EAAKyL,UAAYA,EACjBzL,EAAKwC,OAASsJ,EACd9L,EAAK8L,WAAaA,EAClB9L,EAAKiM,cAAgBA,EACrBjM,EAAKkM,aAAeA,EACpBlM,EAAK4B,KAAOA,EACZ5B,EAAKoM,SAAWA,EAChBpM,EAAKsM,YAAcA,EACnBtM,EAAKuM,WAAaA,EAClBvM,EAAAA,UAAc0M,EACd1M,EAAK4N,SAAWP,EACTrN,EAtCTyK,EAAiBxK,SAAW,YAL5B,IAAIH,KAGJ,OAFAA,GAASC,IAAM,aACfD,EAASI,KAAOuK,EACT3K,EAdTT,QACGC,OAAO,aACPQ,SAAS,YAAa0K,MAuY3B,WACE,YAOA,SAASqD,GAAwBC,EAAShJ,GAoBxC,QAASiJ,GAASnK,EAAOoK,GACvB,GAAIC,GAAQrK,EAAMqK,MACdC,GAAY,EACZC,EAASvK,EAAMuK,OACfC,GAAa,EACbC,EAASzK,EAAMyK,OACfC,EAASN,EAAGnO,IAAI,EAGpBiF,GAAS,WACFmJ,IACHA,EAAQD,EAAGC,QACXC,GAAY,GAGTC,IACHA,EAASH,EAAGG,SACZC,GAAa,EAGf,IAAIzI,GAAQ4I,eAAeD,EAAQD,GAChCG,MAAMP,EAAOE,IACbtH,WAAW,SAAUE,GACpB,MAAkC,KAA3BnD,EAAMoG,UAAUzC,QAAgB3D,EAAMoG,UAAU1D,QAAQS,EAAK4B,WAAa,GAGjF/E,GAAMkE,YACRnC,EAAM8I,qBAAqB7K,EAAMkE,YAG/BlE,EAAM6D,YACR9B,EAAM8B,WAAW7D,EAAM6D,YAGrB7D,EAAM+B,QACRA,EAAMD,KAAK9B,EAAM+B,MAAMO,MAAOtC,EAAM+B,MAAMmE,OAC1CnE,EAAM+I,WAGRrP,QAAQ4I,QAAQ6F,GAASa,GAAG,SAAU,WACpC,GAAKT,GAAcE,EAAnB,CAIA,GAAIQ,GAAWX,EACXY,EAAYV,CAEZD,KACFD,EAAQD,EAAGC,SAGTG,IACFD,EAASH,EAAGG,WAGVS,IAAaX,GAASY,IAAcV,KACtCxI,EAAM6I,MAAMP,EAAOE,IACnBxI,EAAM+I,aAOV,IAAII,IAAkB,CACtBnJ,GAAMgJ,GAAG,WAAY,SAAU3N,GACzB8N,GAIJlL,EAAMmL,OAAO,WACXnL,EAAMmG,WAAa/I,EAAI6E,SAK3BjC,EAAMoL,aAAa,QAAS,SAAU,QAAS,aAAc,aAAc,cAAe,SAAUC,EAAWC,GAC7G,GAAIC,IAAe,CAkBnB,IAhBIF,EAAU,IAAMA,EAAU,KAAOC,EAAU,KAC7CjB,EAAQgB,EAAU,GAClBtJ,EAAM6I,MAAMP,EAAOE,IACfc,EAAU,KACZE,GAAe,IAIfF,EAAU,IAAMA,EAAU,KAAOC,EAAU,KAC7Cf,EAASc,EAAU,GACnBtJ,EAAM6I,MAAMP,EAAOE,IACfc,EAAU,KACZE,GAAe,IAIfF,EAAU,IAAMA,EAAU,KAAOC,EAAU,GAAI,CAEjD,GAAIE,GAAY/P,QAAQgQ,KAAKJ,EAAU,GACvCtJ,GAAMD,KAAK0J,EAAUlJ,MAAOkJ,EAAUtF,OACtCqF,GAAe,EAGbF,EAAU,KAAOC,EAAU,KAC7BJ,GAAkB,EAClBnJ,EAAMT,SAAS+J,EAAU,IACzBH,GAAkB,GAGhBG,EAAU,IAAMA,EAAU,KAAOC,EAAU,KAC7CvJ,EAAM8I,qBAAqBQ,EAAU,IACrCE,GAAe,GAGbF,EAAU,IAAMA,EAAU,KAAOC,EAAU,IAC7CvJ,EAAM8B,WAAWwH,EAAU,IAGzBE,GACFxJ,EAAM+I,YAIV9K,EAAM0L,iBAAiB,mBAAoB,SAAUL,GAC/CA,GACFtJ,EAAM4J,UAAUN,KAIpBrL,EAAM0L,iBAAiB,YAAa,SAAUL,GACxCA,GACFtJ,EAAM6J,4BArJd,GAAI/L,IACFC,SAAU,IACVE,OACE+B,MAAO,WACPsI,MAAO,IACPE,OAAQ,IACRsB,QAAS,IACTpB,OAAQ,IACRtE,WAAY,IACZjC,WAAY,IACZL,WAAY,IACZxB,iBAAkB,IAClB+D,UAAW,KAEb0F,KAAM3B,EAGR,OAAOtK,GAjBToK,EAAwB5N,SAAW,UAAW,YAN9CZ,QACGC,OAAO,uBACPmE,UAAU,iBAAkBoK,MAkKjC,WACE,YAOA,SAAS8B,GAASC,GAChBA,EAAKC,MAAM,gBACbF,EAAS1P,SAAW,QAPpBZ,QACGC,OAAO,uBACPwQ,IAAIH,MAST,WACE,YAOA,SAASI,GAAaC,EAAgBC,GACpCD,EACGE,MAAM,QACLnQ,IAAK,UACL4D,YAAa,qBACbE,WAAY,iBACZC,aAAc,SAGlBmM,EAAmBE,UAAU,KAN/BJ,EAAa9P,SAAW,iBAAkB,sBAR1CZ,QACGC,OAAO,uBACPgJ,OAAOyH,MAkBZ,WACE,YAEA1Q,SACGC,OAAO,uBACP8Q,SAAS,KAAMC,IACfD,SAAS,SAAUE,WAIxB,WACE,YAOA,SAAShI,GAAOiI,EAAcC,EAAoBrQ,EAAoBqK,EAAmBjL,GAEvFgR,EAAaE,cAAa,GAE1BD,EAAmBE,cAAc,aAC/BC,GAAM,UACNC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UAERC,qBAAsB,QACtBC,oBAAqB,UAGvBlB,EAAmBE,cAAc,UAC/BC,GAAM,UACNC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,IAAO,UACPC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UACRC,KAAQ,UAERC,qBAAsB,QACtBC,oBAAqB,KAAM,MAAO,MAAO,UAG3ClB,EAAmBmB,MAAM,WACtBC,eAAe,aACfC,cAAc,UAEjBrB,EAAmBmB,MAAM,YACtBC,eAAe,aACfE,OAEH3R,EAAmBJ,IAAM,sBACzByK,EAAkBzK,IAAM,qBACxBR,EAAkBQ,IAAM,qBAlD1BuI,EAAOrI,SAAW,eAAgB,qBAAsB,qBAAsB,oBAAqB,qBATnGZ,QACGC,OAAO,uBACPgJ,OAAOA,MA+DZ,SAAWyJ,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,UAAWD,GACgB,gBAAX1S,SAAuBA,OAAO6S,QAC9C7S,OAAO6S,QAAUH,IAEjBD,EAAKK,gBAAkBJ,KAExBxO,KAAM,WACP,YAKA,SAAS4O,KA6BP,QAASC,GAAQC,EAAWC,GACtBC,EAAcF,IAChBE,EAAcF,GAAWpQ,QAAQ,SAAUuQ,GACzC,IACEA,EAAQF,GACR,MAAOG,GAEPC,QAAQC,MAAMF,MAKpBG,EAAe3Q,QAAQ,SAAUuQ,GAC/B,IACEA,EAAQH,EAAWC,GACnB,MAAOG,GAEPC,QAAQC,MAAMF,MAUpB,QAASI,GAAkBL,GAGzB,MAFAI,GAAe9P,KAAK0P,GAEb,WACL,GAAIxP,GAAK4P,EAAevM,QAAQmM,EAC5BxP,IAAM,GACR4P,EAAe3P,OAAOD,EAAI,IAWhC,QAAS8P,GAAYT,EAAWG,GAO9B,MANKD,GAAcF,KACjBE,EAAcF,OAGhBE,EAAcF,GAAWvP,KAAK0P,GAEvB,WACL,GAAIxP,GAAKuP,EAAcF,GAAWhM,QAAQmM,EACtCxP,IAAM,GACRuP,EAAcF,GAAWpP,OAAOD,EAAI,IAW1C,QAAS+P,GAAgBV,EAAWG,GAClC,GAAIQ,GAAaF,EAAYT,EAAW,SAAUC,GAChD,IACEE,EAAQF,GACR,MAAOG,GAEPC,QAAQC,MAAMF,GAWd,QATAO,MAIJ,OAAOA,GArGT,GAAIT,MAMAK,KAIAK,IAKJ,OAJAA,GAAItJ,IAAMkJ,EACVI,EAAIvE,GAAKoE,EACTG,EAAIC,KAAOH,EACXE,EAAIb,QAAUA,EACPa,EA0FT,MAAOd,KAMT,SAAWL,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,QAAQ,MAAOD,GACY,gBAAX1S,SAAuBA,OAAO6S,QAC9C7S,OAAO6S,QAAUH,EAAQoB,QAAQ,OAEjCpB,EAAQ3B,KAET7M,KAAM,SAAU6M,GACjB,YAmaA,SAASgD,GAAUC,GACjBA,EAAEC,OAAS,EAGb,QAASC,GAAQF,GACfA,EAAEC,OAAS,GAGb,QAASE,GAAUH,GACjBA,EAAEC,OAAS,EACXD,EAAEI,GAAKJ,EAAEK,EACTL,EAAEM,GAAKN,EAAEO,EAGX,QAASC,GAASR,GAChBA,EAAEC,OAAS,GAGb,QAASQ,GAAWC,EAAMC,EAAOC,GAC/B,GAAIC,GAAK,EACPC,EAAK,CAIP,IAFAJ,EAAKK,OAAS,GAETL,EAAKM,KAMR,IALA,GAGEC,GAHErO,EAAQ8N,EAAK9N,MACfsO,EAAItO,EAAMqB,OACVmG,EAAI,KAGGA,EAAI8G,GACXD,EAAIrO,EAAMwH,GACL6G,IAELR,EAAWQ,EAAGN,EAAOC,GACrBF,EAAKK,QAAUE,EAAEF,OACjBF,GAAMI,EAAEF,OAASE,EAAEJ,GACnBC,GAAMG,EAAEF,OAASE,EAAEH,GAIvB,IAAIJ,EAAKS,MAAO,CAETT,EAAKM,OACRN,EAAKS,MAAMd,GAAKe,KAAKC,SAAW,GAChCX,EAAKS,MAAMZ,GAAKa,KAAKC,SAAW,GAGlC,IAAIC,GAAIX,EAAQC,EAAQF,EAAKS,MAAMI,MAEnCb,GAAKK,QAAUL,EAAKc,YAAcF,EAElCT,GAAMS,EAAIZ,EAAKS,MAAMd,EACrBS,GAAMQ,EAAIZ,EAAKS,MAAMZ,EAGvBG,EAAKG,GAAKA,EAAKH,EAAKK,OACpBL,EAAKI,GAAKA,EAAKJ,EAAKK,OAGtB,QAASU,GAAWC,GAClB,MAAoB,kBAANA,GAGhB,QAASC,GAASD,GAChB,MAAoB,gBAANA,GAlehB,GAAIE,GAAgB,GAChBC,EAAgB,EAChBC,EAAoBC,EAAAA,CAOxBhF,GAAGhC,OAAOiH,MAAMC,YAAc,WAmB5B,QAASC,GAAOC,EAAIxH,GAYlB,MAXI,GAAIyG,KAAKgB,IAAID,GAAMxH,IAEZ,EAALwH,EAEFA,GAAMxH,EAGNwH,GAAMxH,GAIHwH,EAGT,QAASE,GAAQ9P,GACf,MAAO,UAAUmO,EAAM4B,EAAIC,EAAGC,GAC5B,GAAI9B,EAAKS,QAAU5O,EAAM,CACvB,GAAIoI,GAAQO,EAAK,GAEbiH,EAAKD,EAAOxB,EAAKG,GAAKtO,EAAK8N,EAAG1F,GAC9B8H,EAAK/B,EAAKI,GAAKvO,EAAKgO,EACpBmC,EAAKF,EAAKF,EAGVK,EAAKR,EAAKA,EAAKM,EAAKA,EACpBnB,EAAI,CAGR,IAAuBqB,EAAnBD,EAAKA,EAAKE,EAMZ,MALSC,GAALF,IACFrB,EAAIZ,EAAKK,OAAS4B,EAClBpQ,EAAK6N,IAAM+B,EAAKb,EAChB/O,EAAK+N,IAAMmC,EAAKnB,IAEX,CAGLZ,GAAKS,OAASwB,GAAWE,EAALF,IACtBrB,EAAIZ,EAAKc,YAAcmB,EACvBpQ,EAAK6N,IAAM+B,EAAKb,EAChB/O,EAAK+N,IAAMmC,EAAKnB,GAGpB,OAAQZ,EAAKK,QAoSjB,QAAS+B,GAAS9C,GAChBA,EAAEI,GAAKrD,EAAGhM,MAAMsP,EAChBL,EAAEM,GAAKvD,EAAGhM,MAAMwP,EAChByB,EAAMe,SArWR,GAGIC,GACArC,EAUAsC,EACAC,EACAtC,EAhBAoB,KACAjR,EAAQgM,EAAGoG,SAAS,QAAS,OAAQ,OACrCjI,GAAQ,EAAG,GAGXkI,EAAW,GACXC,EAAezB,EACf0B,EAAezB,EACfd,EAAS,IACT8B,EAAkBf,EAClByB,EAAU,GACVX,EAAS,IACThQ,KACA7D,IAiYJ,OA5UAiT,GAAMwB,KAAO,WAEX,IAAK7C,GAAS,KAAQ,KAKpB,MAJA5P,GAAM0S,KACJpX,KAAM,MACNsU,MAAOA,EAAQ,KAEV,CAGT,IAEEzS,GACAkM,EACAsH,EACAgC,EACAC,EACAC,EACAtC,EACAjB,EACAE,EAVEW,EAAItO,EAAMqB,OACZ4P,EAAI9U,EAAMkF,MAYZ,KAAKmG,EAAI,EAAOyJ,EAAJzJ,IAASA,EACnBsH,EAAI3S,EAAMqL,GACVsJ,EAAIhC,EAAE7N,OACN8P,EAAIjC,EAAEhO,OACN2M,EAAI6B,EAAOyB,EAAEtD,EAAIqD,EAAErD,EAAGnF,EAAK,IAC3BqF,EAAIoD,EAAEpD,EAAImD,EAAEnD,EACZqD,EAAKvD,EAAIA,EAAIE,EAAIA,EAEP,IAANqD,IACFA,EAAIjD,EAAQuC,EAAU9I,KAAOwJ,EAAIxC,KAAK0C,KAAKF,IAAMX,EAAU7I,IAAMwJ,EACjEvD,GAAKuD,EACLrD,GAAKqD,EAELD,EAAEtD,GAAKA,GAAKiB,EAAIoC,EAAEK,QAAUJ,EAAEI,OAASL,EAAEK,SACzCJ,EAAEpD,GAAKA,EAAIe,EAEXoC,EAAErD,GAAKA,GAAKiB,EAAI,EAAIA,GACpBoC,EAAEnD,GAAKA,EAAIe,EAMf,IADAA,EAAIX,EAAQ4C,EACF,IAANjC,IACFjB,EAAInF,EAAK,GAAK,EACdqF,EAAIrF,EAAK,GAAK,EACdd,EAAI,GACAkH,GACF,OAASlH,EAAI8G,GACXQ,EAAI9O,EAAMwH,GAEVsH,EAAEnB,IAAMA,EAAImB,EAAEnB,GAAKe,CAKzB,IAAIP,EAGF,IAFAN,EAAWvS,EAAI6O,EAAGiH,KAAKC,SAASrR,GAAQ+N,EAAOC,GAC/CxG,EAAI,KACKA,EAAI8G,IACLQ,EAAI9O,EAAMwH,IAAI6F,OAClB/R,EAAEgW,MAAM7B,EAAQX,GAOtB,KADAtH,EAAI,KACKA,EAAI8G,GACXQ,EAAI9O,EAAMwH,GACNsH,EAAEzB,OACJyB,EAAErB,EAAIqB,EAAEtB,GACRsB,EAAEnB,EAAImB,EAAEpB,KAERoB,EAAErB,IAAMqB,EAAEtB,IAAMsB,EAAEtB,GAAKsB,EAAErB,IAAM+C,EAC/B1B,EAAEnB,IAAMmB,EAAEpB,IAAMoB,EAAEpB,GAAKoB,EAAEnB,IAAM6C,EAKnChJ,GAAI,EAEJ,KADA,GAAIO,GAAQO,EAAK,KACRd,EAAI8G,GAAG,CACdQ,EAAI9O,EAAMwH,EAEV,IAAI+H,GAAKT,EAAEtB,GAAKsB,EAAErB,CAClBqB,GAAErB,GAAK1F,EAEH+G,EAAErB,EAAI,IACRqB,EAAErB,GAAK1F,GAIT+G,EAAEtB,GAAKsB,EAAErB,EAAI8B,EAIfpR,EAAMyS,MACJnX,KAAM,OACNsU,MAAOA,KAIXqB,EAAMpP,MAAQ,SAAUyN,GACtB,MAAKxH,WAAU5E,QACfrB,EAAQyN,EACD2B,GAFuBpP,GAKhCoP,EAAMjT,MAAQ,SAAUsR,GACtB,MAAKxH,WAAU5E,QACflF,EAAQsR,EACD2B,GAFuBjT,GAKhCiT,EAAM9G,KAAO,SAAUmF,GACrB,MAAKxH,WAAU5E,QACfiH,EAAOmF,EACA2B,GAFuB9G,GAKhC8G,EAAMqB,aAAe,SAAUhD,GAC7B,MAAKxH,WAAU5E,QACfoP,EAAe5B,EAAWpB,GAAKA,GAAKA,EAC7B2B,GAFuBqB,GAKhCrB,EAAMsB,aAAe,SAAUjD,GAC7B,MAAKxH,WAAU5E,QACfqP,EAAe7B,EAAWpB,GAAKA,GAAKA,EAC7B2B,GAFuBsB,GAKhCtB,EAAMoB,SAAW,SAAU/C,GACzB,MAAKxH,WAAU5E,QACfmP,GAAY/C,EACL2B,GAFuBoB,GAKhCpB,EAAMjB,OAAS,SAAUV,GACvB,MAAKxH,WAAU5E,QACf8M,EAASU,EAAWpB,GAAKA,GAAKA,EACvB2B,GAFuBjB,GAKhCiB,EAAMmC,eAAiB,SAAU9D,GAC/B,MAAKxH,WAAU5E,QACf4O,EAAkBxC,EAAIA,EACf2B,GAFuBZ,KAAK0C,KAAKjB,IAK1Cb,EAAMuB,QAAU,SAAUlD,GACxB,MAAKxH,WAAU5E,QACfsP,GAAWlD,EACJ2B,GAFuBuB,GAKhCvB,EAAMoC,MAAQ,SAAU/D,GACtB,MAAKxH,WAAU5E,QACf2O,EAASvC,EAAIA,EACN2B,GAFuBZ,KAAK0C,KAAKlB,IAK1CZ,EAAMrB,MAAQ,SAAUN,GACtB,MAAKxH,WAAU5E,QAEfoM,GAAKA,EACDM,EACSA,EAAPN,EAAI,EAAWA,EACN,EACJA,EAAI,IACbtP,EAAMsT,OACJhY,KAAM,QACNsU,MAAOA,EAAQN,IAEjBtD,EAAGuH,MAAMtC,EAAMwB,OAGVxB,GAduBrB,GAiBhCqB,EAAMqC,MAAQ,WAmDZ,QAASE,GAASC,EAAWtJ,GAC3B,IAAKuJ,EAAW,CAGd,IAFAA,EAAY,GAAIC,OAAMxD,GAEjByD,EAAI,EAAOzD,EAAJyD,IAASA,EACnBF,EAAUE,KAEZ,KAAKA,EAAI,EAAOd,EAAJc,IAASA,EAAG,CACtB,GAAIjD,GAAI3S,EAAM4V,EACdF,GAAU/C,EAAE7N,OAAO0N,OAAO9R,KAAKiS,EAAEhO,QACjC+Q,EAAU/C,EAAEhO,OAAO6N,OAAO9R,KAAKiS,EAAE7N,SASrC,IALA,GAGEwM,GAHEuE,EAAaH,EAAUrK,GACzBuK,EAAI,GACJE,EAAKD,EAAW3Q,SAGT0Q,EAAIE,GACX,IAAKC,MAAMzE,EAAIuE,EAAWD,GAAGH,IAAa,MAAOnE,EAEnD,OAAOe,MAAKC,SAAWnG,EAxEzB,GAAId,GAKFqK,EACA/C,EALAR,EAAItO,EAAMqB,OACV4P,EAAI9U,EAAMkF,OACV8Q,EAAI7J,EAAK,GACT8J,EAAI9J,EAAK,EAIX,KAAKd,EAAI,EAAO8G,EAAJ9G,IAASA,GAClBsH,EAAI9O,EAAMwH,IAAImH,MAAQnH,EACvBsH,EAAEqC,OAAS,CAGb,KAAK3J,EAAI,EAAOyJ,EAAJzJ,IAASA,EACnBsH,EAAI3S,EAAMqL,GACNuH,EAASD,EAAE7N,UAAS6N,EAAE7N,OAASjB,EAAM8O,EAAE7N,SACvC8N,EAASD,EAAEhO,UAASgO,EAAEhO,OAASd,EAAM8O,EAAEhO,WACzCgO,EAAE7N,OAAOkQ,SACTrC,EAAEhO,OAAOqQ,MAGb,KAAK3J,EAAI,EAAO8G,EAAJ9G,IAASA,EACnBsH,EAAI9O,EAAMwH,GACN0K,MAAMpD,EAAErB,KAAIqB,EAAErB,EAAIkE,EAAS,IAAKQ,IAChCD,MAAMpD,EAAEnB,KAAImB,EAAEnB,EAAIgE,EAAS,IAAKS,IAChCF,MAAMpD,EAAEtB,MAAKsB,EAAEtB,GAAKsB,EAAErB,GACtByE,MAAMpD,EAAEpB,MAAKoB,EAAEpB,GAAKoB,EAAEnB,EAI5B,IADA0C,KACIxB,EAAW4B,GACb,IAAKjJ,EAAI,EAAOyJ,EAAJzJ,IAASA,EAAG6I,EAAU7I,IAAMiJ,EAAa4B,KAAK/U,KAAMnB,EAAMqL,GAAIA,OAE1E,KAAKA,EAAI,EAAOyJ,EAAJzJ,IAASA,EAAG6I,EAAU7I,GAAKiJ,CAGzC,IADAH,KACIzB,EAAW6B,GACb,IAAKlJ,EAAI,EAAOyJ,EAAJzJ,IAASA,EAAG8I,EAAU9I,IAAMkJ,EAAa2B,KAAK/U,KAAMnB,EAAMqL,GAAIA,OAE1E,KAAKA,EAAI,EAAOyJ,EAAJzJ,IAASA,EAAG8I,EAAU9I,GAAKkJ,CAGzC,IADA1C,KACIa,EAAWV,GACb,IAAK3G,EAAI,EAAO8G,EAAJ9G,IAASA,EAAGwG,EAAQxG,IAAM2G,EAAOkE,KAAK/U,KAAM0C,EAAMwH,GAAIA,OAElE,KAAKA,EAAI,EAAO8G,EAAJ9G,IAASA,EAAGwG,EAAQxG,GAAK2G,CA8BvC,OAAOiB,GAAMe,UAGff,EAAMe,OAAS,WACb,MAAOf,GAAMrB,MAAM,KAGrBqB,EAAMkD,KAAO,WACX,MAAOlD,GAAMrB,MAAM,IAIrBqB,EAAMgB,KAAO,WASX,MARKA,KAAMA,EAAOjG,EAAGoI,SAASnC,OAC3BoC,OAAO,SAAU1D,GAChB,MAAOA,KAERrG,GAAG,kBAAmB0E,GACtB1E,GAAG,aAAcyH,GACjBzH,GAAG,gBAAiB6E,IAElBrH,UAAU5E,WAEf/D,MAAKmL,GAAG,kBAAmB8E,GACxB9E,GAAG,iBAAkBmF,GACrByE,KAAKjC,GAJsBA,GAahChB,EAAMqD,SAAW,WACf,GAAI1K,GAAQO,EAAK,GAEboK,EAAQ,SAAUtF,GAAK,MAAOA,GAAE,GAAG,IACnCuF,EAAQ,SAAUvF,GAAK,MAAOA,GAAE,GAAG,IACnCwF,EAAQ,SAAUxF,GAAK,MAAOA,GAAE,GAAG,IACnCyF,EAAQ,SAAUzF,GAAK,MAAOA,GAAE,GAAG,IAEnC0F,EAAW,SAAUC,GACvBA,EAAUC,KAAK,IAAK,SAAU5F,GAC5B,GAAIsC,GAAKgD,EAAMtF,GACX6F,EAAKN,EAAMvF,GACXwC,EAAKgD,EAAMxF,GACX8F,EAAKL,EAAMzF,EAEf,OAAI,GAAEoB,KAAKgB,IAAIE,EAAGE,GAAM7H,EAEf,KAAO2H,EAAK,IAAMuD,EAAK,MAAQrD,EAAK,IAAMsD,EACnCtD,EAALF,EAEF,KAAOA,EAAK,IAAMuD,EAAK,OAASrD,EAAK7H,GAAS,IAAMmL,EAAK,MACvDtD,EAAK,IAAMsD,EAAK,OAASxD,EAAK3H,GAAS,IAAMkL,EAG/C,KAAOvD,EAAK,IAAMuD,EAAK,OAASrD,EAAK7H,GAAS,IAAMmL,EAAK,MACvDtD,EAAK,IAAMsD,EAAK,OAASxD,EAAK3H,GAAS,IAAMkL,IAU5D,OALAH,GAASpD,GAAK,SAAUyD,GAAkB,MAAZT,GAAQS,EAAWL,GACjDA,EAASG,GAAK,SAAUE,GAAkB,MAAZR,GAAQQ,EAAWL,GACjDA,EAASlD,GAAK,SAAUuD,GAAkB,MAAZP,GAAQO,EAAWL,GACjDA,EAASI,GAAK,SAAUC,GAAkB,MAAZN,GAAQM,EAAWL,GAE1CA,GAGF3I,EAAGiJ,OAAOhE,EAAOjR,EAAO,SAgFnC,SAAW0N,EAAMC,GACO,kBAAXC,SAAyBA,OAAOC,IACzCD,QAAQ,KAAM,mBAAoB,wBAAyBD,GAChC,gBAAX1S,SAAuBA,OAAO6S,SAC9CiB,QAAQ,wBACR9T,OAAO6S,QAAUH,EAAQoB,QAAQ,MAAOA,QAAQ,sBAEhDrB,EAAKxD,eAAiByD,EAAQD,EAAK1B,GAAI0B,EAAKK,kBAE7C5O,KAAM,SAAU6M,EAAI+B,GACrB,YAsCA,SAAS7D,GAAeD,EAAQD,EAAQkL,GAmMtC,QAASC,GAAQC,GAUf,MATAxL,GAAQwL,EAAK,GACbtL,EAASsL,EAAK,GAEVC,KACFC,EAAIT,KAAK,QAASjL,GAAOiL,KAAK,SAAU/K,GACxCyL,EAAcC,OAAO,EAAG5L,IACxBtI,EAAM6I,MAAMP,EAAOE,KAGd+E,GAQT,QAAS4G,GAAwBrL,GAG/B,GAFAsL,GAAmBtL,EAEfiL,GAAe,CACjB,GAAIM,GAAmB3J,EAAG4J,OAAO/T,EAAO6T,GACxCG,GAAsBC,OAAOH,EAAiB,KAAOA,EAAiB,IAAMA,EAAiB,GAAK,EAAGA,EAAiB,GAAK,GAAKA,GAGlI,MAAO9G,IAQT,QAASkH,GAAcC,GAGrB,MAFA5S,IAAa4S,EAENnH,GAST,QAASoH,GAAQC,EAAQC,GAUvB,MATAtU,GAAQqU,EACRzQ,EAAQ0Q,EAGRtU,EAAMhE,QAAQ,SAAU2D,GACtBA,EAAK8N,GAAK9N,EAAK8N,GAAKe,KAAKC,UAAY1G,EACrCpI,EAAKgO,GAAKhO,EAAKgO,GAAKa,KAAKC,UAAYxG,IAGhC+E,GAQT,QAASuH,GAAexU,GAChBA,YAA4B+R,SAChC/R,GAAoBA,GAItB,IAAIyU,GAAkBzU,EAAiB0U,MAAM,SAAU9U,GACrD,MAAOK,GAAMI,QAAQT,IAAS,GAGhC,KAAK6U,EACH,KAAM,IAAIhR,OAAM,8DAMlB,OAHAkR,KACArL,EAAUtJ,GAEHiN,GAQT,QAAS2H,GAAahV,GACpB,GAAIA,GAAQK,EAAMI,QAAQT,GAAQ,EAChC,KAAM,IAAI6D,OAAM,oDAalB,OAVAoR,KAEIjV,IACFX,EAASW,GAGTkV,IACAC,EAAOnV,IAGFqN,GAQT,QAAS+H,GAAc5B,GAGrB,MAFAxS,IAAawS,EAENnG,GAQT,QAASxE,KAaP,MAXAwM,KAGAvV,EACGO,MAAMA,GACN7D,MAAMyH,GACN6N,QAEHwD,IACAC,IAEOlI,GAKT,QAASgI,KACP,IAAKjN,IAAUE,EACb,KAAM,IAAIzE,OAAM,iFAGlB,KAAKxD,IAAU4D,EACb,KAAM,IAAIJ,OAAM,6EAGlB,KAAIgQ,GAAJ,CAIAA,IAAgB,EAEhBC,EAAMtJ,EAAG2K,OAAO1M,GAAQ+M,OAAO,OAC5BnC,KAAK,QAASjL,GACdiL,KAAK,SAAU/K,EAGlB,IAAImN,GAAYxR,EAAM0D,OAAO,SAAUF,EAAOvG,GAI5C,MAHIuG,GAAMhH,QAAQS,EAAK4B,UAAY,GACjC2E,EAAMvK,KAAKgE,EAAK4B,UAEX2E,MAGTiO,GAAiB5B,EAAK2B,GAAY,GAAI,YAAa,WAAY,WAE/D,IAAIE,GAAY7B,EAAI0B,OAAO,KAAKnC,KAAK,QAAS,kBAC9CuC,GAAYD,EAAUH,OAAO,KAAKnC,KAAK,QAAS,SAChDwC,EAAYF,EAAUH,OAAO,KAAKnC,KAAK,QAAS,SAEhDyC,EAAcH,EAAUH,OAAO,QAAQnC,KAAK,QAAS,YAClDA,KAAK,IAAK,GACVA,KAAK,IAAK,GACVA,KAAK,SAAU,GAElBU,EAAgBvJ,EAAGuL,MAAMC,SACtB1B,QAAQzF,KAAKoH,IAAI,IAAMpH,KAAKoH,IAAI,QAChCjC,OAAO,EAAG5L,GAEb,IAAI+L,GAAmB3J,EAAG4J,OAAO/T,EAAO6T,GACxCG,GAAwB7J,EAAGuL,MAAMC,SAC9B1B,OAAOH,EAAiB,KAAOA,EAAiB,IAAMA,EAAiB,GAAK,EAAGA,EAAiB,GAAK,GAAKA,GAC1GH,OAAO,EAAG,IAEbkC,EAAkB,SAAUpI,GAC1B,MAAOqI,IAAiBC,EAAgBD,GAAiB9B,EAAsBvG,IAGjFhO,EAAQuW,EAAmB7N,GAAU,YAClCG,MAAMP,EAAOE,IACbQ,GAAG,OAAQmI,GACdqF,EAAexW,GAEXA,EAAMgT,WACRyD,GAAWzW,EAAMgT,WACd/C,GAAG,SAAU7O,GAAQ,MAAOA,GAAKI,OAAOwM,IACxCwF,GAAG,SAAUpS,GAAQ,MAAOA,GAAKI,OAAO0M,IACxCiC,GAAG,SAAU/O,GAAQ,MAAOA,GAAKC,OAAO2M,IACxCyF,GAAG,SAAUrS,GAAQ,MAAOA,GAAKC,OAAO6M,KAGzCxD,EAAGgM,MACLC,GAAUjM,EAAGgM,MACRnD,KAAK,QAASqD,GACdC,UAAUC,GACVC,OAAOC,GACPC,KAAK,SAAU/W,GAAQ,MAAOA,GAAK1B,QAExC0Y,EAAOlO,GAAG,QAAS,SAAU3N,GAAO8b,EAAY9b,EAAI6E,QACpDgX,EAAOlO,GAAG,OAAQ,SAAU3N,GAAO+b,EAAY/b,EAAI6E,QAGrD,IAAI2J,GAAwBwN,EAASC,EAAmB,KAAK,GAAM,EAEnEJ,GAAOlO,GAAG,YAAaa,GACvBqN,EAAOlO,GAAG,cAAea,GACzBqN,EAAOlO,GAAG,QAASa,GACnBqN,EAAOlO,GAAG,OAAQa,GAClBqN,EAAOlO,GAAG,SAAUa,GACpBqN,EAAOlO,GAAG,WAAYa,GACtBqN,EAAOlO,GAAG,WAAYa,GACtBqN,EAAOlO,GAAG,aAAca,IAQ1B,QAAS2M,GAAexW,GACtBA,EACGkR,QAAQ,IAGRF,aAAa,IACbC,aAAa,SAAU7P,GAEtB,GAAImW,GAAKnD,GAAiBhT,EAAKI,OAC/B,OAAO+S,GAAsBgD,KAI9B7I,OAAO,SAAUxO,GAEhB,GAAIsX,IAAe,IAAK,MACpBC,GAAkB,EAAG,GACrBF,EAAKnD,GAAiBlU,EAE1B,OAAOsX,GAAY,IAAMA,EAAY,GAAKA,EAAY,KAAKC,EAAe,GAAKA,EAAe,KAAOlD,EAAsBgD,GAAME,EAAe,MAEjJ1G,SAAS,IASd,QAASI,GAAK9V,GAGZ,GAFAqc,IAEIrc,EAAIiT,MAAQ,OAGd,GAFA0H,EAAYzC,KAAK,QAASU,EAAclF,KAAKoH,IAAI9a,EAAIiT,SAEjDS,KAAKC,SAAW,IAAM,WAE1BgH,GAAYzC,KAAK,QAAS,EAG5BwC,GAAU4B,UAAU,SAASC,aAAaC,SAAS,KAChDtE,KAAK,YAAa,SAAUrT,GAC3B,MAAO,aAAeA,EAAK8N,EAAI,IAAM9N,EAAKgO,EAAI,MAGlD4H,EAAU6B,UAAU,SAASC,aAAaC,SAAS,KAChDjF,KAAK6D,IAQV,QAASjB,KACP,IAAKjV,GAA0B,IAAjBA,EAAMqB,OAClB,KAAM,IAAImC,OAAM,oBASlB,IAAI+T,GAAa/B,EAAU4B,UAAU,SAClC5X,KAAKQ,EAAO,SAAUL,GACrB,MAAOA,GAAKxE,KAGZqc,EAAYD,EAAWE,QAAQtC,OAAO,KACvCnC,KAAK,QAAS,QACdA,KAAK,YAAa,SAAUrT,GAC3B,MAAO,aAAeA,EAAK8N,EAAI,IAAM9N,EAAKgO,EAAI,MAE/ClF,GAAG,YAAazG,GAChByG,GAAG,WAAYiP,GACfjP,GAAG,WAAYzJ,GACfyJ,GAAG,QAAS,SAAU9I,GACjBwK,EAAGhM,MAAMwZ,QACPpX,GAASH,QAAQT,GAAQ,EAC3BmV,EAAOnV,GAEPiY,EAASjY,IAGXkV,IACAC,EAAOnV,KAIb6X,GAAUrC,OAAO,UAEjBoC,EAAWzC,OAAO,UACf9B,KAAK,IAAK,SAAUrT,GACnB,GAAIqX,GAAKnD,GAAiBlU,EAC1B,OAAOkW,GAAgBmB,KAG3BO,EAAWM,OAAOC,SAEd1B,IACFZ,EAAUnD,KAAK+D,IASnB,QAASlB,KACP,IAAKtR,GAA0B,IAAjBA,EAAMvC,OAClB,KAAM,IAAImC,OAAM,oBAGlB,IAAIuU,GAAaxC,EAAU6B,UAAU,SAClC5X,KAAKoE,EAAO,SAAU/C,GACrB,MAAOA,GAAKI,OAAO9F,GAAK,IAAM0F,EAAKC,OAAO3F,IAG9C4c,GAAWN,QAAQtC,OAAO,QACvBnC,KAAK,QAAS,SAAUnS,GACvB,MAAO,QAAUA,EAAK4B,WAEvBuQ,KAAK,aAAc,SAAUnS,GAC5B,MAAO,kBAAoBA,EAAK4B,SAAW,MAM5C4P,KAAK6D,IAER6B,EAAWF,OAAOC,SAQpB,QAASzO,GAAU2O,GACXA,YAAclG,SAClBkG,GAAMA,IAGRA,EAAGhc,QAAQ,SAAUsS,GACf2J,EAAY7X,QAAQkO,GAAK,GAC3B2J,EAAYpb,KAAKyR,GAGnBqI,EAAOxK,QAAQ,aAAexM,KAAM2O,EAAGyE,UAAWxS,OA0BtD,QAASmU,KACPuD,EAAYjc,QAAQ,SAAU2D,GAC5BgX,EAAOxK,QAAQ,eAAiBxM,KAAMA,EAAMoT,UAAWxS,OAGzD0X,KAQF,QAASjW,GAAMrC,GAEb+X,IAEAQ,GAAUvY,EACVgX,EAAOxK,QAAQ,SAAWxM,KAAMuY,GAASnF,UAAWxS,KAQtD,QAASmX,GAAK/X,GAGZ,GAFAA,EAAOA,GAAQuY,GAEL,CACR,GAAIA,KAAYvY,EAGd,KAAM,IAAI6D,OAAM,4CAFhB0U,IAAU,KAKZvB,EAAOxK,QAAQ,QAAUxM,KAAMA,EAAMoT,UAAWxS,MASpD,QAASvB,GAASW,GAEZwY,KAAcxY,IAKlBiV,IAEAuD,GAAYxY,EACZgX,EAAOxK,QAAQ,YAAcxM,KAAMwY,GAAWpF,UAAWxS,MAQ3D,QAASqU,GAAWjV,GAGlB,GAFAA,EAAOA,GAAQwY,GAEL,CACR,GAAIA,KAAcxY,EAGhB,KAAM,IAAI6D,OAAM,oDAFhB2U,IAAY,KAKdxB,EAAOxK,QAAQ,cAAgBxM,KAAMA,EAAMoT,UAAWxS,MAS1D,QAASuU,GAAOnV,GACd,IAAKA,EACH,KAAM,IAAI6D,OAAM,mBAGlB,MAAIjD,GAASH,QAAQT,GAAQ,GAG3B,KAAM,IAAI6D,OAAM,kDAFhBjD,IAAS1D,KAAK8C,GAKhBgX,EAAOxK,QAAQ,UAAYxM,KAAMA,EAAMoT,UAAWxS,KAQpD,QAASqX,GAASjY,GAChB,IAAKA,EACH,KAAM,IAAI6D,OAAM,+BAGlB,IAAIzG,GAAKwD,GAASH,QAAQT,EAC1B,IAAS,EAAL5C,EACF,KAAM,IAAIyG,OAAM,iDAEhBjD,IAASvD,OAAOD,EAAI,GAGtB4Z,EAAOxK,QAAQ,YAAcxM,KAAMA,EAAMoT,UAAWxS,KAMtD,QAASsU,KACPtU,GAASvE,QAAQ,SAAU2D,GACzBgX,EAAOxK,QAAQ,YAAcxM,KAAMA,EAAMoT,iBAG3CxS,MAQF,QAASqW,GAAYjX,GACfyW,IACFA,GAAQpD,KAAK,QAASqD,GACnB7T,KAAK7C,GASZ,QAASkX,GAAYlX,GACfyW,IACFA,GAAQpD,KAAK,QAASqD,GACnBjS,KAAKzE,GAOZ,QAASoX,KACP,GAAIqB,IAAgBD,IAGhBE,EAAc9X,GAAS+X,QAEvBC,EAAahX,GAAW2W,GAG5B3X,IAASvE,QAAQ,SAAUwc,GACzBjX,GAAWiX,GAAGxc,QAAQ,SAAUV,GAC1Bid,EAAWnY,QAAQ9E,GAAK,GAC1Bid,EAAW1b,KAAKvB,OAMtBiG,GAAW4W,IAAWnc,QAAQ,SAAUV,GAClCid,EAAWnY,QAAQ9E,GAAK,GAC1Bid,EAAW1b,KAAKvB,IAIpB,IAAImd,GAAiBR,EAAYK,OAEjC9C,GAAU4B,UAAU,SACjBsB,QAAQ,YAAa,SAAU/Y,GAC9B,MAAOyY,GAAahY,QAAQT,IAAS,IAEtC+Y,QAAQ,WAAY,SAAU/Y,GAC7B,MAAO0Y,GAAYjY,QAAQT,IAAS,IAErC+Y,QAAQ,UAAW,SAAU/Y,GAC5B,MAAO4Y,GAAWnY,QAAQT,IAAS,IAEpC+Y,QAAQ,cAAe,SAAU/Y,GAChC,MAAO8Y,GAAerY,QAAQT,IAAS,IAG3C4V,EAAU6B,UAAU,SACjBsB,QAAQ,YAAa,SAAU7X,GAC9B,MAAOuX,GAAahY,QAAQS,EAAKI,SAAW,GAAKmX,EAAahY,QAAQS,EAAKC,SAAW,IAEvF4X,QAAQ,WAAY,SAAU7X,GAC7B,MAAOwX,GAAYjY,QAAQS,EAAKI,SAAW,GAAKoX,EAAYjY,QAAQS,EAAKC,SAAW,IAErF4X,QAAQ,UAAW,SAAU7X,GAC5B,MAAO0X,GAAWnY,QAAQS,EAAKI,SAAW,GAAKsX,EAAWnY,QAAQS,EAAKC,SAAW,IAEnF4X,QAAQ,SAAU,SAAU7X,GAC3B,OAAQF,GAAWE,KAEpBmS,KAAK,aAAc,SAAUnS,GAC5B,GAAI8X,GAAM,EAUV,OARIP,GAAahY,QAAQS,EAAKI,SAAW,GAAKmX,EAAahY,QAAQS,EAAKC,SAAW,EACjF6X,EAAM,aACGN,EAAYjY,QAAQS,EAAKI,SAAW,GAAKoX,EAAYjY,QAAQS,EAAKC,SAAW,EACtF6X,EAAM,YACGJ,EAAWnY,QAAQS,EAAKI,SAAW,GAAKsX,EAAWnY,QAAQS,EAAKC,SAAW,IACpF6X,EAAM,YAGD,kBAAoB9X,EAAK4B,SAAWkW,EAAM,MAOvD,QAASxB,KACPnX,EAAMhE,QAAQ,SAAU2D,GAEtBA,EAAK8N,EAAIe,KAAK/J,IAAI+J,KAAKoK,IAAIjZ,EAAK8N,EAAG1F,GAAQ,GAC3CpI,EAAKgO,EAAIa,KAAK/J,IAAI+J,KAAKoK,IAAIjZ,EAAKgO,EAAG1F,GAAS,KAWhD,QAASsO,GAAiB5W,GACxB,GAAIkZ,GAAM,EAaV,OAVIlZ,GAAKgO,EAAI1F,EAAS6Q,EAAoBC,OAAQF,GAAO,IAChDlZ,EAAKgO,EAAImL,EAAoBE,MAAKH,GAAO,KAG9ClZ,EAAK8N,EAAI1F,EAAQ+Q,EAAoBG,MAAOJ,GAAO,IAC9ClZ,EAAK8N,EAAIqL,EAAoBI,OAAML,GAAO,KAGvC,KAARA,IAAYA,EAAM,KAEfA,EAWT,QAASpC,GAAc9W,GACrB,GAAIqX,GAAKnD,GAAiBlU,GACtBwZ,EAAStD,EAAgBmB,GACzBR,GAAU,EAAG,EAUjB,OARI7W,GAAKgO,EAAI1F,EAAS6Q,EAAoBC,OAAQvC,EAAO,IAAM2C,EACtDxZ,EAAKgO,EAAImL,EAAoBE,MAAKxC,EAAO,IAAM2C,GAEpDxZ,EAAK8N,EAAI1F,EAAQ+Q,EAAoBM,WAAY5C,EAAO,IAAM2C,EACzDxZ,EAAK8N,EAAIqL,EAAoBM,aAAY5C,EAAO,IAAM2C,GAE7C,IAAd3C,EAAO,IAA0B,IAAdA,EAAO,KAAUA,EAAO,IAAM2C,GAE9C3C,EAQT,QAASnB,GAAiB5B,EAAK2B,EAAWiE,GACxC,GAAIC,KACJlE,GAAUpZ,QAAQ,SAAUvC,GAC1B4f,EAAWrd,QAAQ,SAAU2c,GAC3BW,EAAWzc,KAAK,aAAepD,GAAQkf,EAAM,IAAMA,EAAM,SAK7DlF,EAAI0B,OAAO,QAAQiC,UAAU,UACxB5X,KAAK8Z,GACP7B,QAAQtC,OAAO,UACbnC,KAAK,KAAM,SAAS7X,GAAM,MAAOA,KACjC6X,KAAK,UAAW,aAChBA,KAAK,OAAQ,IACbA,KAAK,OAAQ,GACbA,KAAK,cAAe,GACpBA,KAAK,eAAgB,GACrBA,KAAK,SAAU,QACjBmC,OAAO,QACLnC,KAAK,IAAK,uBAh5BjB7K,EAASA,GAAU,SACnBkL,EAAUA,KAEV,IAAIsD,GAASzK,GAETmH,GAAQ1J,OACVgN,EAAOjT,IAAI,SAAU0I,EAAWC,GAE9BI,QAAQmJ,IAAIxJ,EAAWC,EAAQ1M,KAAO0M,EAAQ1M,KAAKxE,GAAKkR,IAS5D,IAAItE,GAOAE,EA+CAwL,EAKA+B,EAKAD,EAKAE,EAKA/B,EAKAmC,EAKA7B,EAKAvU,EA3EAO,KAOA4D,KAOAqU,KAOAC,GAAU,KAOV3X,MAOA4X,GAAY,KAgDZjC,GAAW,SAAUnD,GACvBA,EAAUC,KAAK,IAAK,SAAUnS,GAC5B,GAAI6O,GAAK7O,EAAKI,OAAOwM,EACjBwF,EAAKpS,EAAKI,OAAO0M,EACjBiC,EAAK/O,EAAKC,OAAO2M,EACjByF,EAAKrS,EAAKC,OAAO6M,CAErB,OAAO,KAAO+B,EAAK,IAAMuD,EAAK,MAAQrD,EAAK,IAAMsD,KAOjDkD,GAAU,KAKV5C,IAAgB,EAMhBjS,GAAa,SAAU5B,GACzB,IAAKA,EACH,QAGF,IAAIa,GAAWb,EAAKc,SAASzE,QAAQ,SAAU6E,GAC7C,MAAOA,GAAKC,SAGVC,EAAWpB,EAAKqB,QAAQhF,QAAQ,SAAU6E,GAC5C,MAAOA,GAAKI,QAGd,QAAQtB,GAAMuB,OAAOV,EAAUO,IAO7B8S,GAAmB,WACrB,MAAO,IAOLlT,GAAa,WACf,OAAO,GAMLqM,KAWJ,OAVAA,IAAI1E,KAAOgL,EACXtG,GAAIzE,qBAAuBqL,EAC3B5G,GAAIzL,WAAa2S,EACjBlH,GAAIxN,KAAO4U,EACXpH,GAAI3D,UAAYkL,EAChBvH,GAAIhO,SAAW2V,EACf3H,GAAIrM,WAAaoU,EACjB/H,GAAI1D,sBAAwByN,EAC5B/J,GAAIxE,QAAUA,EACdwE,GAAIvE,GAAKkO,EAAOlO,GACTuE,GA6tBT,QAAS8J,GAAS3D,EAAIoG,EAAMC,EAASC,GACnC,GAAIC,EAUJ,OARuB,mBAAZF,KACTA,GAAU,GAGY,mBAAbC,KACTA,GAAW,GAGN,WAYL,QAASE,KACPD,EAAU,KACND,GACFtG,EAAGhN,MAAMyT,EAAKC,GAdlB,GAAID,GAAMtc,KACNuc,EAAO5T,UAEP6T,EAAUN,IAAYE,CAC1BK,cAAaL,GACbA,EAAUM,WAAWL,EAAOJ,GAExBO,GACF3G,EAAGhN,MAAMyT,EAAKC,IA98BpB,GAAI/D,GAAgB,EAGhBC,EAAgB,GAGhBC,GACFiE,OAAQ9P,EAAGhC,OAAOiH,MAClBC,YAAalF,EAAGhC,OAAOiH,MAAMC,aAI3BgH,EAAgB,SAGhByC,GACFI,KAAM,IACND,MAAO,IACPD,IAAK,IACLD,OAAQ,IAq6BV,OAl6BK5O,GAAGgM,KAEN1J,QAAQyN,KAAK,gEAg6BR7R,IAoCTlP,QAAQC,OAAO,uBAAuBwQ,KAAK,iBAAkB,SAASuQ,GAAiBA,EAAeC,IAAI,qBAAqB,kbAC/HD,EAAeC,IAAI,qBAAqB;AACxCD,EAAeC,IAAI,gCAAgC,40BACnDD,EAAeC,IAAI,+BAA+B,24BAClDD,EAAeC,IAAI,iCAAiC","file":"scripts/app-76c28053e2.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('trcGraph', [\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcGraph')\n    .provider('graphRepo', graphRepoProvider);\n\n  function graphRepoProvider() {\n    var provider = {};\n    provider.url = '/api/graph';\n    provider.$get = graphRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function graphRepoFactory($resource) {\n      var restResource = $resource(provider.url + '/:type');\n\n      var repo = {};\n      repo.get = getGraph;\n      return repo;\n\n      /**\n       * Retrieves a graph by type identifier\n       *\n       * @param  {string} type\n       * @return {Graph}\n       */\n      function getGraph(type) {\n        return restResource.get({ type: type });\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * Data model representing a person returned by the TRC REST API\n * @typedef Person\n * @type {object}\n * @property {string}           id       - a unique identifier for this person; assigned upon creation\n * @property {EntryMeta}        meta     - metadata about the record and its history in the system\n * @property {PersonName}       name     - primary name used to identify this person\n * @property {PersonName[]}     altNames - other names by which this person is known\n * @property {?HistoricalEvent} birth    - the date and location this person was born; may be null if unknown\n * @property {?HistoricalEvent} death    - the date and location this person was born; may be null if unknown or still alive\n * @property {string}           summary  - an HTML summary of the person and his or her significance\n */\n\n/**\n * Simplified, lightweight representation of a person for use in search results\n * @typedef Person\n * @type {object}\n * @property {string}     id             - a unique identifier for the person\n * @property {EntryMeta}  meta           - metadata about the record and its history in the system\n * @property {PersonName} name           - structured name representation\n * @property {string}     label          - formatted name to display\n * @property {string}     summaryExcerpt - a leading excerpt from the full summary\n */\n\n/**\n * Metadata about a TRC entry\n * @typedef EntryMeta\n * @type {object}\n * @property {string}                      slug         - a short, unique identifier intended to be more human-readable than the id\n * @property {integer}                     version      - a monotonically increasing version number incremented on each change\n * @property {object.<string, SimpleLink>} links        - links to related resources; keyed by link role\n * @property {string}                      lastModified - ISO 8601 timestamp of the last modification date\n */\n\n/**\n * Container for linking to related entities\n * @typedef SimpleLink\n * @type {object}\n * @property {string} uri  - a URI representing the linked item\n * @property {string} type - MIME type of the related linked item\n */\n\n/**\n * Structured form of a person's name\n * @typedef PersonName\n * @type {object}\n * @property {string} role        - clarifies the use of this name\n * @property {string} label       - a simple representation of this name for display purposes\n * @property {?string} title      - title of address\n * @property {?string} givenName  - given or first name\n * @property {?string} middleName - middle name\n * @property {?string} familyName - family or last name\n * @property {?string} suffix     - a suffix (e.g. 'Jr' or 'III')\n */\n\n/**\n * Event with a date/time, location, and descriptive information\n * @typedef HistoricalEvent\n * @type {object}\n * @property {string}          id          - a unique identifier for this event\n * @property {string}          title       - a brief title of the event for display purposes\n * @property {string}          description - a detailed summary of the event\n * @property {string}          location    - the location in which the event took place\n * @property {DateDescription} date        - the date the event took place\n */\n\n/**\n * Container for encapsulating human-readable and machine-readable forms of a date.\n * @typedef DateDescription\n * @type {object}\n * @property {string} calendar    - machine-readable ISO 8601 timestamp\n * @property {string} description - human-readable description of this date\n */\n\n/**\n * Container for search results\n * @typedef PersonSearchResultSet\n * @type {object}\n * @property {SimplePerson[]} items  - search results\n * @property {string}         qs     - query string that gives the current set of search results\n * @property {?string}        qsNext - query string that gives next set of search results or null if this is the last set\n * @property {?string}        qsPrev - query string that gives preceding set of search results or null if this is the first set\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .provider('peopleRepo', peopleRepoProvider);\n\n\n  function peopleRepoProvider() {\n    var provider = {};\n    provider.url = '/api/people';\n    provider.$get = peopleRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function peopleRepoFactory($q, $resource) {\n      var restResource = $resource(provider.url + '/:id', null, {\n        'update': { method: 'PUT' }\n      });\n\n      var repo = {};\n      repo.create = createPerson;\n      repo.createName = createName;\n      repo.createEvent = createEvent;\n      repo.get = findById;\n      repo.search = search;\n      repo.save = savePerson;\n      repo.delete = deletePerson;\n      return repo;\n\n      /**\n       * Creates a new empty person instance.\n       *\n       * @return {Person}\n       */\n      function createPerson() {\n        var person = new restResource();\n        return adaptPerson(person);\n      }\n\n      /**\n       * Creates a new empty entry metadata instance\n       *\n       * @return {EntryMeta}\n       */\n      function createMeta() {\n        var meta = {};\n        return adaptMeta(meta);\n      }\n\n      /**\n       * Creates a new empty name instance\n       *\n       * @return {PersonName}\n       */\n      function createName() {\n        var name = {};\n        return adaptName(name);\n      }\n\n      /**\n       * Creates a new historical event instance\n       *\n       * @return {HistoricalEvent}\n       */\n      function createEvent() {\n        var evt = {};\n        return adaptEvent(evt);\n      }\n\n      /**\n       * Creates a date/description instance\n       *\n       * @return {DateDescription}\n       */\n      function createDateDescription() {\n        var dateDescription = {};\n        return dateDescription;\n      }\n\n      /**\n       * Retrieves a person object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promise is available on Person.$promise.\n       *\n       * @param  {string} id\n       * @return {Person}\n       */\n      function findById(id) {\n        return restResource.get({ id: id });\n      }\n\n      /**\n       * Retrieves a serch result set of people who match the given query.\n       *\n       * @param {string} query\n       * @return {PersonSearchResultSet}\n       */\n      function search(query) {\n        return restResource.get({ q: query });\n      }\n\n      /**\n       * Saves a person model to the REST API.\n       *\n       * If no ID is provided on the person model, the API will create save the model as a new\n       * person. Otherwise, the API will attempt to update the existing person model with that ID.\n       *\n       * @param {Person} person\n       * @return {Promise.<Person>} - resolves to the saved person on success\n       */\n      function savePerson(person) {\n        var response;\n        if (person.id) {\n          response = restResource.update({ id: person.id }, person);\n        } else {\n          response = restResource.save(null, person);\n        }\n\n        return response.$promise.then(function (personId) {\n          person.id = personId.id;\n          return person;\n        });\n      }\n\n      /**\n       * Deletes a person on the server via the REST API.\n       *\n       * @param {Person|string} idOrPerson\n       * @return {Promise} - resolves on success\n       */\n      function deletePerson(id) {\n        var response = restResource.delete({ id: id });\n        return response.$promise;\n      }\n\n      /**\n       * Populates a person with aggregate fields\n       *\n       * @param  {Person} person\n       * @return {Person}\n       */\n      function adaptPerson(person) {\n        if (!person.meta) {\n          person.meta = createMeta();\n        } else {\n          adaptMeta(person.meta);\n        }\n\n        if (!person.name) {\n          person.name = createName();\n        } else {\n          adaptName(person.name);\n        }\n\n        if (!person.altNames) {\n          person.altNames = [];\n        } else {\n          person.altNames.forEach(adaptName);\n        }\n\n        if (!person.birth) {\n          person.birth = createEvent();\n        } else {\n          adaptEvent(person.birth);\n        }\n\n        if (!person.death) {\n          person.death = createEvent();\n        } else {\n          adaptEvent(person.death);\n        }\n\n        return person\n      }\n\n      /**\n       * Ensure that entry metadata aggregate fields exist and are formatted correctly.\n       *\n       * @param  {EntryMeta} meta\n       * @return {EntryMeta}\n       */\n      function adaptMeta(meta) {\n        if (!meta.links) {\n          meta.links = {};\n        }\n\n        return meta;\n      }\n\n      /**\n       * Ensure that name aggregate fields exist and are formatted correctly\n       * @param  {PersonName} name\n       * @return {PersonName}\n       */\n      function adaptName(name) {\n        // no aggregate fields yet...\n        return name;\n      }\n\n      /**\n       * Ensure that event aggregate fields exist and are formatted correctly.\n       *\n       * @param  {HistoricalEvent} evt\n       * @return {HistoricalEvent}\n       */\n      function adaptEvent(evt) {\n        if (!evt.date) {\n          evt.date = createDateDescription();\n        }\n\n        return evt;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcPersonEditor', trcPersonEditorDirective);\n\n  /** @ngInject */\n  function trcPersonEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/person-editor.html',\n      scope: {\n        person: '=ngModel'\n      },\n      controller: PersonEditorController,\n      controllerAs: 'personEditor'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function PersonEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.addName = addName;\n      vm.removeName = removeName;\n      vm.addEvent = addEvent;\n      vm.removeEvent = removeEvent;\n\n      /**\n       * Adds a name to the current person model.\n       */\n      function addName() {\n        var newName = peopleRepo.createName();\n        $scope.person.altNames.push(newName);\n      }\n\n      /**\n       * Removes the name at the specified index from the current person model.\n       *\n       * @param {integer} ix\n       */\n      function removeName(ix) {\n        $scope.person.altNames.splice(ix, 1);\n      }\n\n      /**\n       * Adds an event to the current person model.\n       *\n       * @param {string} key - 'birth' or 'death'\n       */\n      function addEvent(key) {\n        var newEvent = peopleRepo.createEvent();\n        $scope.person[key] = newEvent;\n      }\n\n      /**\n       * Removes the event from the current person model.\n       *\n       * @param {string} key - 'birth' or 'death'\n       */\n      function removeEvent(key) {\n        $scope.person[key] = null;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcNameEditor', trcNameEditorDirective);\n\n  /** @ngInject */\n  function trcNameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      },\n      controller: NameEditorController,\n      controllerAs: 'nameEditor'\n    };\n\n    return directive;\n\n    function NameEditorController() {\n      var vm = this;\n\n      vm.roles = [\n        { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n      ];\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcEventEditor', trcEventEditorDirective);\n\n  /** @ngInject */\n  function trcEventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ngMaterial',\n      'trcBiblio',\n      'trcBio',\n      'trcGraph'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  // HACK types should be loaded from reln repo\n  var TYPES = {\n    'uk.ac.ox.bodleian.sda.relationships.influence': {\n      id: 'uk.ac.ox.bodleian.sda.relationships.influence',\n      title: 'Influenced',\n      reverseTitle: 'Influenced By',\n      directed: true\n    },\n    'uk.ac.ox.bodleian.sda.relationships.provoked': {\n      id: 'uk.ac.ox.bodleian.sda.relationships.provoked',\n      title: 'Provoked',\n      reverseTitle: 'Provoked By',\n      directed: true\n    },\n    'uk.ac.ox.bodleian.sda.relationships.patternmatch': {\n      id: 'uk.ac.ox.bodleian.sda.relationships.patternmatch',\n      title: 'Possible Pattern Match',\n      directed: false\n    }\n  };\n\n  angular\n    .module('sda.concept-browser')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($http, $scope, $q, $mdToast, $mdDialog, $mdMedia, $location, $stateParams, $filter, $timeout, $document, peopleRepo, worksRepo, graphRepo) {\n    var vm = this;\n\n    vm.toggleSearchForm = toggleSearchForm;\n    vm.clearSearchForm = clearSearchForm;\n    vm.showSearchForm = false;\n    vm.searchQuery = '';\n\n    vm.showHelp = showHelp;\n\n    vm.graph = null;\n    vm.activeNode = null;\n    vm.person = null;\n    vm.works = null;\n    vm.related = null;\n    vm.sidebarLoading = false;\n    vm.graphLoading = false;\n\n    vm.relnTypes = TYPES;\n    vm.relnTypeFilter = [];\n    vm.toggleRelnTypeFilter = toggleRelnTypeFilter;\n\n    vm.selectMode = null;\n    vm.selectModes = [];\n\n    vm.sizeMetric = null;\n    vm.sizeMetrics = [];\n\n    vm.highlightedNodes = [];\n\n    activate();\n\n    function activate() {\n      loadSelectModes();\n      loadSizeMetrics();\n\n      var defaultGraphType = 'people';\n      var graphType = $stateParams.type || defaultGraphType;\n      vm.graphLoading = true;\n      getGraphData(graphType).catch(function () {\n        $mdToast.showSimple('Unable to load the \"' + graphType + '\"graph type. Falling back to \"' + defaultGraphType + '\".');\n        return getGraphData(defaultGraphType);\n      }).then(function (data) {\n        vm.graphLoading = false;\n        vm.graph = data.graph;\n      }, function () {\n        vm.graphLoading = false;\n        $mdToast.showSimple('Unable to load graph data.');\n      });\n\n      $scope.$watch('main.activeNode', function (node) {\n        if (node) {\n          vm.sidebarLoading = true;\n          loadNodeData(node).then(function () {\n            vm.sidebarLoading = false;\n          }, function () {\n            vm.sidebarLoading = false;\n            $mdToast.showSimple('Unable to load node data');\n          });\n        } else {\n          vm.person = null;\n        }\n      });\n\n      $scope.$watch('searchQuery', function (searchQuery) {\n        vm.highlightedNodes = searchQuery ? $filter('filter')(vm.graph.nodes, { label: searchQuery }) : [];\n      });\n    }\n\n    function toggleRelnTypeFilter(typeId) {\n      var ix = vm.relnTypeFilter.indexOf(typeId);\n      if (ix < 0) {\n        vm.relnTypeFilter.push(typeId);\n      } else {\n        vm.relnTypeFilter.splice(ix, 1);\n      }\n    }\n\n    function loadSelectModes() {\n      vm.selectModes.push({\n        label: 'Neighbors',\n        strategy: function (selected) {\n          if (!selected) {\n            return [];\n          }\n\n          var adjacent = selected.outEdges.filter(edgeFilter).map(function (edge) {\n            return edge.target;\n          });\n          var incident = selected.inEdges.filter(edgeFilter).map(function (edge) {\n            return edge.source;\n          });\n          return [selected].concat(adjacent, incident);\n        }\n      });\n\n      vm.selectModes.push({\n        label: 'Trace',\n        strategy: function (selected) {\n          if (!selected) {\n            return [];\n          }\n\n          var worklist = [selected];\n          var visited = [];\n\n          while (worklist.length > 0) {\n            var node = worklist.pop();\n            visited.push(node);\n            node.outEdges.forEach(function (edge) {\n              if (visited.indexOf(edge.target) < 0) {\n                worklist.push(edge.target);\n              }\n            });\n          }\n\n          return visited;\n        }\n      });\n\n      vm.selectModes.push({\n        label: 'Inbound',\n        strategy: function (selected) {\n          return selected ? [selected].concat(selected.inEdges.filter(edgeFilter).map(function (edge) {\n            return edge.source;\n          })) : [];\n        }\n      });\n\n      vm.selectModes.push({\n        label: 'Outbound',\n        strategy: function (selected) {\n          return selected ? [selected].concat(selected.outEdges.filter(edgeFilter).map(function (edge) {\n            return edge.target;\n          })) : [];\n        }\n      });\n\n      vm.selectMode = vm.selectModes[0];\n    }\n\n    function loadSizeMetrics() {\n      vm.sizeMetrics.push({\n        label: 'PageRank',\n        strategy: function (node) {\n          return node.metadata.pagerank;\n        }\n      });\n\n      vm.sizeMetrics.push({\n        label: 'Uniform',\n        strategy: function () {\n          return 1;\n        }\n      });\n\n      vm.sizeMetrics.push({\n        label: 'HITS',\n        disabled: true,\n        strategy: function () {\n          return 1;\n        }\n      });\n\n      vm.sizeMetric = vm.sizeMetrics[0];\n    }\n\n    function toggleSearchForm() {\n      vm.showSearchForm = !vm.showSearchForm;\n\n      if (vm.showSearchForm) {\n        $timeout(function () {\n          angular.element('.search-form > input[type=\"search\"]').focus();\n        });\n      } else {\n        $scope.searchQuery = '';\n      }\n    }\n\n    function clearSearchForm() {\n      $scope.searchQuery = '';\n      $timeout(function () {\n        vm.showSearchForm = false;\n      });\n    }\n\n    function showHelp($event) {\n      var config = {\n        targetEvent: $event,\n        fullscreen: $mdMedia('sm') || $mdMedia('xs'),\n        templateUrl: 'app/main/help.html',\n        controller: 'HelpDialogController',\n        clickOutsideToClose: true\n      };\n\n      $mdDialog.show(config)\n    }\n\n    // HACK: this function is duplicated in the concept browser directive...\n    //       need a way to tell the graph to update from outside the directive...\n    function edgeFilter(edge) {\n      return vm.relnTypeFilter.length === 0 || vm.relnTypeFilter.indexOf(edge.relation) >= 0;\n    }\n\n    function loadNodeData(node) {\n      // HACK only works for people; should probably refactor to a directive with parallel one for works,\n      //      but how should we determine which directive to display?\n      vm.person = peopleRepo.get(node.id);\n\n      var works = worksRepo.searchByAuthor(node.id);\n      var worksP = works.$promise.then(function () {\n        if (!works.items) {\n          throw new Error('unable to load items');\n        }\n\n        vm.works = works.items;\n        return vm.works;\n      });\n\n      var related = {};\n\n      function makeTypeGroup(type) {\n        var group = { id: type.id, directed: type.directed };\n\n        if (type.directed) {\n          group.out = { label: type.title, nodes: [] };\n          group.in = { label: type.reverseTitle, nodes: [] };\n        } else {\n          group.none = { label: type.title, nodes: [] };\n        }\n\n        return group;\n      }\n\n      function ensureTypeGroup(type) {\n        if (!related.hasOwnProperty(type.id)) {\n          related[type.id] = makeTypeGroup(type);\n        }\n\n        return related[type.id];\n      }\n\n      node.outEdges.map(function (edge) {\n        var type = TYPES[edge.relation];\n        if (!type) return;\n\n        var group = ensureTypeGroup(type);\n        group[type.directed ? 'out' : 'none'].nodes.push(edge.target);\n      });\n\n      node.inEdges.map(function (edge) {\n        var type = TYPES[edge.relation];\n        if (!type) return;\n\n        var group = ensureTypeGroup(type);\n        group[type.directed ? 'in' : 'none'].nodes.push(edge.source);\n      });\n\n      vm.related = [];\n      for (var key in related) if (related.hasOwnProperty(key)) {\n        vm.related.push(related[key]);\n      }\n\n      return $q.all([vm.person.$promise, worksP]);\n    }\n\n    function getGraphData(type) {\n      var graph = graphRepo.get(type);\n\n      return graph.$promise.then(function () {\n        var nodesById = {};\n\n        // index nodes by ID; prepare structure for dereferencing\n        graph.graph.nodes.forEach(function (node) {\n          node.inEdges = [];\n          node.outEdges = [];\n\n          nodesById[node.id] = node;\n        });\n\n        // dereference edges\n        // edge direction plays an opposite role in the view than it does in the server data:\n        //    suppose A provoked B, C, and D\n        //    we would like to draw arrows from A to B, C, and D (A->B, A->C, A->D)\n        //    but for analytical purposes, the data treats provocation as references from B, C, and D back to A (B->A, C->A, D->A)\n        graph.graph.edges.forEach(function (edge) {\n          var target = nodesById[edge.source];\n          var source = nodesById[edge.target];\n\n          edge.source = source;\n          source.outEdges.push(edge);\n\n          edge.target = target;\n          target.inEdges.push(edge);\n        });\n\n        return graph;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser')\n    .controller('HelpDialogController', HelpDialogController);\n\n  /** @ngInject */\n  function HelpDialogController($scope, $mdDialog) {\n    $scope.close = closeDialog;\n\n    function closeDialog() {\n      $mdDialog.hide();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBiblio', [\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBiblio')\n    .provider('worksRepo', worksRepoProvider);\n\n  /**\n   * This functionality is already being implemented as a standalone trc-biblio module. The code is\n   * used here as an interim until the Bower build/dependency workflow has been finalized.\n   *\n   * @return {angular.provider}\n   */\n  function worksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/works';\n    provider.$get = worksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function worksRepoFactory($resource) {\n      var restResource = $resource(provider.url + '/:workId', { workId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var editionResource = $resource(provider.url + '/:workId/editions/:editionId', { editionId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var volumeResource = $resource(provider.url + '/:workId/editions/:editionId/volumes/:volumeId', { volumeId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var repo = {};\n      repo.getAll = findAll;\n      repo.search = search;\n      repo.searchByAuthor = searchByAuthor;\n      repo.get = getWork;\n      repo.getWork = getWork;\n      repo.getEdition = getEdition;\n      repo.getVolume = getVolume;\n      repo.create = createWork;\n      repo.createWork = createWork;\n      repo.createEdition = createEdition;\n      repo.createVolume = createVolume;\n      repo.save = save;\n      repo.saveWork = saveWork;\n      repo.saveEdition = saveEdition;\n      repo.saveVolume = saveVolume;\n      repo.delete = deleteWork;\n      repo.getTitle = getTitleByTypePreference;\n      return repo;\n\n      /**\n       * Retrieves a listing of all works\n       *\n       * @return {WorkProxy[]}\n       */\n      function findAll() {\n        return search('');\n      }\n\n      /**\n       * Search for works by query\n       *\n       * @return {SearchResultSet}\n       */\n      function search(query) {\n        return restResource.get({ q: query, max: 50 });\n      }\n\n      /**\n       * Search for works by author\n       *\n       * @return {SearchResultSet}\n       */\n      function searchByAuthor(authorId) {\n        return restResource.get({ aid: authorId, max: 50 });\n      }\n\n      /**\n       * Retrieves a work object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Work.$promise.\n       *\n       * @param {string} workId\n       * @return {Work}\n       */\n      function getWork(workId) {\n        if (angular.isUndefined(workId)) {\n          throw new TypeError('Invalid ID provided to getWork');\n        }\n\n        var work = restResource.get({ workId: workId });\n\n        work.$promise.then(adaptWork);\n\n        return work;\n      }\n\n      /**\n       * Retrieves an edition object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Edition.$promise.\n       *\n       * @param {string} workId\n       * @param {string} editionId\n       * @return {Edition}\n       */\n      function getEdition(workId, editionId) {\n        if (angular.isUndefined(workId) || angular.isUndefined(editionId)) {\n          throw new TypeError('Invalid IDs provided to getEdition');\n        }\n\n        var edition = editionResource.get({ workId: workId, editionId: editionId });\n\n        edition.$promise.then(adaptEdition);\n\n        return edition;\n      }\n\n      /**\n       * Retrieves a volume object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Volume.$promise.\n       *\n       * @param {string} workId\n       * @param {string} editionId\n       * @param {string} volumeId\n       * @return {Volume}\n       */\n      function getVolume(workId, editionId, volumeId) {\n        if (angular.isUndefined(workId) || angular.isUndefined(editionId) || angular.isUndefined(volumeId)) {\n          throw new TypeError('Invalid IDs provided to getVolume');\n        }\n\n        var volume = volumeResource.get({ workId: workId, editionId: editionId, volumeId: volumeId });\n\n        volume.$promise.then(adaptVolume);\n\n        return volume;\n      }\n\n      /**\n       * Creates a new work instance\n       *\n       * @return {Work}\n       */\n      function createWork() {\n        var work = new restResource();\n        adaptWork(work);\n        work.titles.push({});\n        work.authors.push({});\n        return work;\n      }\n\n      /**\n       * Creates a new edition instance\n       *\n       * @return {Edition}\n       */\n      function createEdition() {\n        var edition = new editionResource();\n        return adaptEdition(edition);\n      }\n\n      /**\n       * Creates a new volume instance\n       *\n       * @return {Volume}\n       */\n      function createVolume() {\n        var volume = new volumeResource();\n        return adaptVolume(volume);\n      }\n\n      /**\n       * Dispatch method for saving works, editions, and volumes\n       *\n       * @deprecated use saveWork, saveEdition, or saveVolume directly\n       * @return {Promise}\n       */\n      function save() {\n        switch (arguments.length) {\n          case 1: return saveWork.apply(null, arguments);\n          case 2: return saveEdition.apply(null, arguments);\n          case 3: return saveVolume.apply(null, arguments);\n        }\n        throw new TypeError('Unexpected arguments to worksRepo#save');\n      }\n\n      /**\n       * Saves a work instance back to the server\n       *\n       * @param {Work} work\n       * @return {Promise.<Work>}\n       */\n      function saveWork(work) {\n        if (!(work instanceof restResource)) {\n          throw new Error('work was not created by this repo');\n        }\n\n        // ngResource automatically updates the model to reflect any server changes (e.g. setting IDs for the work/edtions/volumes/copies).\n        return work.id\n          ? work.$update()\n          : work.$save();\n      }\n\n      /**\n       * Saves an edition instance back to the server\n       *\n       * @param  {string} workId\n       * @param  {Edition} edition\n       * @return {Promise.<Edition>}\n       */\n      function saveEdition(workId, edition) {\n        if (!workId) {\n          throw new Error('no work id provided');\n        }\n\n        if (!(edition instanceof editionResource)) {\n          throw new Error('edition was not created by this repo');\n        }\n\n        return edition.id\n          ? edition.$update({ workId: workId })\n          : edition.$save({ workId: workId });\n      }\n\n      /**\n       * Saves a volume instance back to the server\n       *\n       * @param  {string} workId\n       * @param  {string} editionId\n       * @param  {Volume} volume\n       * @return {Promise.<Volume>}\n       */\n      function saveVolume(workId, editionId, volume) {\n        if (!workId) {\n          throw new Error('no work id provided');\n        }\n\n        if (!editionId) {\n          throw new Error('no edition id provided');\n        }\n\n        if (!(volume instanceof volumeResource)) {\n          throw new Error('volume was not created by this repo');\n        }\n\n        return volume.id\n          ? volume.$update({ workId: workId, editionId: editionId })\n          : volume.$save({ workId: workId, editionId: editionId });\n      }\n\n      /**\n       * Deletes a work instance from the server\n       *\n       * @param  {string} id\n       */\n      function deleteWork(workId) {\n        var dataItem = restResource.delete({ id: workId });\n        return dataItem.$promise;\n      }\n\n      /**\n       * Ensure that aggregate fields common to all work/edition/volume entities exist and are formatted correctly\n       *\n       * @param  {Work|Edition|Volume} entity\n       * @return {Work|Edition|Volume}\n       */\n      function adaptCommon(entity) {\n        if (!entity.titles) {\n          entity.titles = [];\n        } else {\n          entity.titles.forEach(function (title) {\n            title.type = title.type.toLowerCase();\n          });\n        }\n\n        if (!entity.authors) {\n          entity.authors = [];\n        } else {\n          entity.authors.forEach(function (author) {\n            author.role = author.role.toLowerCase();\n          });\n        }\n\n        if (!entity.otherAuthors) {\n          entity.otherAuthors = [];\n        } else {\n          entity.otherAuthors.forEach(function (author) {\n            author.role = author.role.toLowerCase();\n          });\n        }\n\n        if (!entity.copies) {\n          entity.copies = [];\n        }\n\n        return entity;\n      }\n\n      /**\n       * Ensure that work aggregate fields exist and are formatted correctly\n       *\n       * @param  {Work} work\n       * @return {Work}\n       */\n      function adaptWork(work) {\n        adaptCommon(work);\n\n        if (!work.editions) {\n          work.editions = [];\n        } else {\n          work.editions.forEach(adaptEdition);\n        }\n\n        return work;\n      }\n\n      /**\n       * Ensure that edition aggregate fields exist and are formatted correctly\n       *\n       * @param  {Edition} edition\n       * @return {Edition}\n       */\n      function adaptEdition(edition) {\n        adaptCommon(edition);\n\n        if (!edition.volumes) {\n          edition.volumes = [];\n        } else {\n          edition.volumes.forEach(adaptVolume);\n        }\n\n        return edition;\n      }\n\n      /**\n       * Ensure that volume aggregate fields exist and are formatted correctly\n       *\n       * @param  {Volume} volume\n       * @return {Volume}\n       */\n      function adaptVolume(volume) {\n        adaptCommon(volume);\n\n        return volume;\n      }\n\n      /**\n       * Retrieves the first available title of the given type or falsey if no title can be found.\n       * If multiple types are given, returns the title corresponding to the first type for which a title is found.\n       *\n       * @param  {Title[]}         titles\n       * @param  {string|string[]} types\n       * @return {Title}\n       */\n      function getTitleByTypePreference(titles, types) {\n        if (!angular.isArray(types)) {\n          types = [types];\n        }\n\n        return types.reduce(function (found, type) {\n          if (found) {\n            return found;\n          }\n\n          for (var i = 0; i < titles.length; i++) {\n            if (titles[i].type === type) {\n              return titles[i];\n            }\n          }\n\n          return null;\n        }, null);\n      }\n    }\n  }\n\n})();\n\n/*global ConceptBrowser:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser')\n    .directive('conceptBrowser', conceptBrowserDirective);\n\n  /** @ngInject */\n  function conceptBrowserDirective($window, $timeout) {\n    var directive = {\n      restrict: 'E',\n      scope: {\n        graph: '=ngModel',\n        width: '=',\n        height: '=',\n        padding: '=',\n        layout: '@',\n        activeNode: '=',\n        sizeMetric: '=',\n        selectMode: '=',\n        highlightedNodes: '=',\n        relnTypes: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope, el) {\n      var width = scope.width;\n      var autoWidth = false;\n      var height = scope.height;\n      var autoHeight = false;\n      var layout = scope.layout;\n      var rootEl = el.get(0);\n\n      // HACK: delay initialization until flex elements have a width/height\n      $timeout(function () {\n        if (!width) {\n          width = el.width();\n          autoWidth = true;\n        }\n\n        if (!height) {\n          height = el.height();\n          autoHeight = true;\n        }\n\n        var graph = ConceptBrowser(rootEl, layout)\n          .size([width, height])\n          .edgeFilter(function (edge) {\n            return scope.relnTypes.length === 0 || scope.relnTypes.indexOf(edge.relation) >= 0;\n          });\n\n        if (scope.sizeMetric) {\n          graph.nodeCentralityMetric(scope.sizeMetric);\n        }\n\n        if (scope.selectMode) {\n          graph.selectMode(scope.selectMode);\n        }\n\n        if (scope.graph) {\n          graph.data(scope.graph.nodes, scope.graph.edges);\n          graph.refresh();\n        }\n\n        angular.element($window).on('resize', function () {\n          if (!autoWidth && !autoHeight) {\n            return;\n          }\n\n          var oldWidth = width;\n          var oldHeight = height;\n\n          if (autoWidth) {\n            width = el.width();\n          }\n\n          if (autoHeight) {\n            height = el.height();\n          }\n\n          if (oldWidth !== width || oldHeight !== height) {\n            graph.size([width, height]);\n            graph.refresh();\n          }\n        });\n\n        // listen for graph events\n\n        // HACK if digest is already in progress, do not try to set active node (probably because it was set from the parent scope)\n        var preventActivate = false;\n        graph.on('activate', function (evt) {\n          if (preventActivate) {\n            return;\n          }\n\n          scope.$apply(function () {\n            scope.activeNode = evt.node;\n          });\n        });\n\n        // listen for data updates\n        scope.$watchGroup(['width', 'height', 'graph', 'activeNode', 'sizeMetric', 'selectMode'], function (newValues, oldValues) {\n          var queueRefresh = false;\n\n          if (newValues[0] && newValues[0] !== oldValues[0]) {\n            width = newValues[0];\n            graph.size([width, height]);\n            if (newValues[2]) {\n              queueRefresh = true;\n            }\n          }\n\n          if (newValues[1] && newValues[1] !== oldValues[1]) {\n            height = newValues[1];\n            graph.size([width, height]);\n            if (newValues[2]) {\n              queueRefresh = true;\n            }\n          }\n\n          if (newValues[2] && newValues[2] !== oldValues[2]) {\n            // make a copy of the data so changes within this directive don't get leaked out\n            var graphData = angular.copy(newValues[2]);\n            graph.data(graphData.nodes, graphData.edges);\n            queueRefresh = true;\n          }\n\n          if (newValues[3] !== oldValues[3]) {\n            preventActivate = true;\n            graph.activate(newValues[3]);\n            preventActivate = false;\n          }\n\n          if (newValues[4] && newValues[4] !== oldValues[4]) {\n            graph.nodeCentralityMetric(newValues[4]);\n            queueRefresh = true;\n          }\n\n          if (newValues[5] && newValues[5] !== oldValues[5]) {\n            graph.selectMode(newValues[5]);\n          }\n\n          if (queueRefresh) {\n            graph.refresh();\n          }\n        });\n\n        scope.$watchCollection('highlightedNodes', function (newValues) {\n          if (newValues) {\n            graph.highlight(newValues);\n          }\n        });\n\n        scope.$watchCollection('relnTypes', function (newValues) {\n          if (newValues) {\n            graph.updateGraphSelections();\n          }\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/{type}',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'main'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global d3:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser')\n    .constant('d3', d3)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sda.concept-browser')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, $mdThemingProvider, peopleRepoProvider, worksRepoProvider, graphRepoProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n\n    $mdThemingProvider.theme('sda-dark')\n      .primaryPalette('darkBrown')\n      .dark();\n\n    peopleRepoProvider.url = '/api/catalog/people';\n    worksRepoProvider.url = '/api/catalog/works';\n    graphRepoProvider.url = '/api/catalog/graph';\n  }\n\n})();\n\n/*eslint-env amd,browser,node*/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory();\n  } else {\n    root.EventDispatcher = factory();\n  }\n})(this, function () {\n  'use strict';\n\n  /**\n   * Creates a new simple event dispatcher object that handles listener registration and event triggering.\n   */\n  function EventDispatcher() {\n    /**\n     * Map of event name to registered event handlers\n     * @type {object.<string,function[]>}\n     */\n    var eventHandlers = {};\n\n    /**\n     * List of registered global event handlers\n     * @type {function[]}\n     */\n    var globalHandlers = [];\n\n    ////////////////////////////////////////////////////////////\n\n    var API = {};\n    API.all = addGlobalListener;\n    API.on = addListener;\n    API.once = addOnceListener;\n    API.trigger = trigger;\n    return API;\n\n    ////////////////////////////////////////////////////////////\n\n    /**\n     * Trigger the named event, passing the given context to all registered event handlers\n     * @param {string} eventName\n     * @param {object} context\n     */\n    function trigger(eventName, context) {\n      if (eventHandlers[eventName]) {\n        eventHandlers[eventName].forEach(function (handler) {\n          try {\n            handler(context);\n          } catch (e) {\n            // eslint-disable-next-line no-console\n            console.error(e);\n          }\n        });\n      }\n\n      globalHandlers.forEach(function (handler) {\n        try {\n          handler(eventName, context);\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.error(e);\n        }\n      });\n    }\n\n    /**\n     * Attach an event handler that will be triggered for all events\n     * @param {function} handler\n     * @return {function} deregistration function\n     */\n    function addGlobalListener(handler) {\n      globalHandlers.push(handler);\n\n      return function () {\n        var ix = globalHandlers.indexOf(handler);\n        if (ix >= 0) {\n          globalHandlers.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Attach an event handler to the given event name.\n     * @param {string} eventName\n     * @param {function} handler\n     * @return {function} deregistration function\n     */\n    function addListener(eventName, handler) {\n      if (!eventHandlers[eventName]) {\n        eventHandlers[eventName] = [];\n      }\n\n      eventHandlers[eventName].push(handler);\n\n      return function () {\n        var ix = eventHandlers[eventName].indexOf(handler);\n        if (ix >= 0) {\n          eventHandlers[eventName].splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Attach an event listener to the given event name that will automatically deregister after it has been fired.\n     * @param {string} eventName\n     * @param {function} handler\n     * @return {function} deregistration function\n     */\n    function addOnceListener(eventName, handler) {\n      var deregister = addListener(eventName, function (context) {\n        try {\n          handler(context);\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.error(e);\n        } finally {\n          deregister();\n        }\n      });\n\n      return deregister;\n    }\n  }\n\n  return EventDispatcher;\n\n});\n\n/*global d3:false*/\n/*eslint-env amd,browser,node*/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['d3'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('d3'));\n  } else {\n    factory(d3);\n  }\n})(this, function (d3) {\n  'use strict';\n\n  var LINK_DISTANCE = 20,\n      LINK_STRENGTH = 1,\n      CHARGE_DISTANCE_2 = Infinity;\n\n  /**\n   * force layout based on d3.layout.force(), but with horizontal wrapping\n   *\n   * @return {object}\n   */\n  d3.layout.force.cylindrical = function () {\n    var force = {},\n        event = d3.dispatch(\"start\", \"tick\", \"end\"),\n        size = [1, 1],\n        drag,\n        alpha,\n        friction = 0.9,\n        linkDistance = LINK_DISTANCE,\n        linkStrength = LINK_STRENGTH,\n        charge = -30,\n        chargeDistance2 = CHARGE_DISTANCE_2,\n        gravity = 0.1,\n        theta2 = 0.64,\n        nodes = [],\n        links = [],\n        distances,\n        strengths,\n        charges;\n\n    function wrapDx(dx, width) {\n      if (2 * Math.abs(dx) > width) {\n        // the \"other side\" of the cylinder is closer\n        if (dx < 0) {\n          // quad point is to the left: simulate force as if it were on the right\n          dx += width;\n        } else {\n          // quad point is to the right: simulate force as if it were on the left\n          dx -= width;\n        }\n      }\n\n      return dx;\n    }\n\n    function repulse(node) {\n      return function (quad, x1, _, x2) {\n        if (quad.point !== node) {\n          var width = size[0];\n\n          var dx = wrapDx(quad.cx - node.x, width),\n              dy = quad.cy - node.y,\n              dw = x2 - x1;\n\n\n          var dn = dx * dx + dy * dy;\n          var k = 0;\n\n          /* Barnes-Hut criterion. */\n          if (dw * dw / theta2 < dn) {\n            if (dn < chargeDistance2) {\n              k = quad.charge / dn;\n              node.px -= dx * k;\n              node.py -= dy * k;\n            }\n            return true;\n          }\n\n          if (quad.point && dn && dn < chargeDistance2) {\n            k = quad.pointCharge / dn;\n            node.px -= dx * k;\n            node.py -= dy * k;\n          }\n        }\n        return !quad.charge;\n      };\n    }\n\n    force.tick = function () {\n      // simulated annealing, basically\n      if ((alpha *= 0.99) < 0.005) {\n        event.end({\n          type: \"end\",\n          alpha: alpha = 0\n        });\n        return true;\n      }\n\n      var n = nodes.length,\n        m = links.length,\n        q,\n        i, // current index\n        o, // current object\n        s, // current source\n        t, // current target\n        l, // current distance\n        k, // current force\n        x, // x-distance\n        y; // y-distance\n\n      // gauss-seidel relaxation for links\n      for (i = 0; i < m; ++i) {\n        o = links[i];\n        s = o.source;\n        t = o.target;\n        x = wrapDx(t.x - s.x, size[0]);\n        y = t.y - s.y;\n        l = (x * x + y * y);\n\n        if (l !== 0) {\n          l = alpha * strengths[i] * ((l = Math.sqrt(l)) - distances[i]) / l;\n          x *= l;\n          y *= l;\n\n          t.x -= x * (k = s.weight / (t.weight + s.weight));\n          t.y -= y * k;\n\n          s.x += x * (k = 1 - k);\n          s.y += y * k;\n        }\n      }\n\n      // apply gravity forces\n      k = alpha * gravity;\n      if (k !== 0) {\n        x = size[0] / 2;\n        y = size[1] / 2;\n        i = -1;\n        if (k)\n          while (++i < n) {\n            o = nodes[i];\n            // o.x += (x - o.x) * k;\n            o.y += (y - o.y) * k;\n          }\n      }\n\n      // compute quadtree center of mass and apply charge forces\n      if (charge) {\n        accumulate(q = d3.geom.quadtree(nodes), alpha, charges);\n        i = -1;\n        while (++i < n) {\n          if (!(o = nodes[i]).fixed) {\n            q.visit(repulse(o));\n          }\n        }\n      }\n\n      // position verlet integration\n      i = -1;\n      while (++i < n) {\n        o = nodes[i];\n        if (o.fixed) {\n          o.x = o.px;\n          o.y = o.py;\n        } else {\n          o.x -= (o.px - (o.px = o.x)) * friction;\n          o.y -= (o.py - (o.py = o.y)) * friction;\n        }\n      }\n\n      // update positions if a node gets pushed off the sides of the visualization\n      i = -1;\n      var width = size[0];\n      while (++i < n) {\n        o = nodes[i];\n\n        var dx = o.px - o.x;\n        o.x %= width;\n        // ensure node.x is positive; there's a chance that -width < node.x % width < 0\n        if (o.x < 0) {\n          o.x += width;\n        }\n\n        // ensure that previous x position (used to calculate velocity) is semantically correct after wrapping\n        o.px = o.x + dx;\n\n      }\n\n      event.tick({\n        type: \"tick\",\n        alpha: alpha\n      });\n    };\n\n    force.nodes = function (x) {\n      if (!arguments.length) return nodes;\n      nodes = x;\n      return force;\n    };\n\n    force.links = function (x) {\n      if (!arguments.length) return links;\n      links = x;\n      return force;\n    };\n\n    force.size = function (x) {\n      if (!arguments.length) return size;\n      size = x;\n      return force;\n    };\n\n    force.linkDistance = function (x) {\n      if (!arguments.length) return linkDistance;\n      linkDistance = isFunction(x) ? x : +x;\n      return force;\n    };\n\n    force.linkStrength = function (x) {\n      if (!arguments.length) return linkStrength;\n      linkStrength = isFunction(x) ? x : +x;\n      return force;\n    };\n\n    force.friction = function (x) {\n      if (!arguments.length) return friction;\n      friction = +x;\n      return force;\n    };\n\n    force.charge = function (x) {\n      if (!arguments.length) return charge;\n      charge = isFunction(x) ? x : +x;\n      return force;\n    };\n\n    force.chargeDistance = function (x) {\n      if (!arguments.length) return Math.sqrt(chargeDistance2);\n      chargeDistance2 = x * x;\n      return force;\n    };\n\n    force.gravity = function (x) {\n      if (!arguments.length) return gravity;\n      gravity = +x;\n      return force;\n    };\n\n    force.theta = function (x) {\n      if (!arguments.length) return Math.sqrt(theta2);\n      theta2 = x * x;\n      return force;\n    };\n\n    force.alpha = function (x) {\n      if (!arguments.length) return alpha;\n\n      x = +x;\n      if (alpha) { // if we're already running\n        if (x > 0) alpha = x; // we might keep it hot\n        else alpha = 0; // or, next tick will dispatch \"end\"\n      } else if (x > 0) { // otherwise, fire it up!\n        event.start({\n          type: \"start\",\n          alpha: alpha = x\n        });\n        d3.timer(force.tick);\n      }\n\n      return force;\n    };\n\n    force.start = function () {\n      var i,\n        n = nodes.length,\n        m = links.length,\n        w = size[0],\n        h = size[1],\n        neighbors,\n        o;\n\n      for (i = 0; i < n; ++i) {\n        (o = nodes[i]).index = i;\n        o.weight = 0;\n      }\n\n      for (i = 0; i < m; ++i) {\n        o = links[i];\n        if (isNumber(o.source)) o.source = nodes[o.source];\n        if (isNumber(o.target)) o.target = nodes[o.target];\n        ++o.source.weight;\n        ++o.target.weight;\n      }\n\n      for (i = 0; i < n; ++i) {\n        o = nodes[i];\n        if (isNaN(o.x)) o.x = position(\"x\", w);\n        if (isNaN(o.y)) o.y = position(\"y\", h);\n        if (isNaN(o.px)) o.px = o.x;\n        if (isNaN(o.py)) o.py = o.y;\n      }\n\n      distances = [];\n      if (isFunction(linkDistance))\n        for (i = 0; i < m; ++i) distances[i] = +linkDistance.call(this, links[i], i);\n      else\n        for (i = 0; i < m; ++i) distances[i] = linkDistance;\n\n      strengths = [];\n      if (isFunction(linkStrength))\n        for (i = 0; i < m; ++i) strengths[i] = +linkStrength.call(this, links[i], i);\n      else\n        for (i = 0; i < m; ++i) strengths[i] = linkStrength;\n\n      charges = [];\n      if (isFunction(charge))\n        for (i = 0; i < n; ++i) charges[i] = +charge.call(this, nodes[i], i);\n      else\n        for (i = 0; i < n; ++i) charges[i] = charge;\n\n      // inherit node position from first neighbor with defined position\n      // or if no such neighbors, initialize node position randomly\n      // initialize neighbors lazily to avoid overhead when not needed\n      function position(dimension, size) {\n        if (!neighbors) {\n          neighbors = new Array(n);\n\n          for (j = 0; j < n; ++j)\n            neighbors[j] = [];\n\n          for (j = 0; j < m; ++j) {\n            var o = links[j];\n            neighbors[o.source.index].push(o.target);\n            neighbors[o.target.index].push(o.source);\n          }\n        }\n\n        var candidates = neighbors[i],\n          j = -1,\n          cs = candidates.length,\n          x;\n\n        while (++j < cs)\n          if (!isNaN(x = candidates[j][dimension])) return x;\n\n        return Math.random() * size;\n      }\n\n      return force.resume();\n    };\n\n    force.resume = function () {\n      return force.alpha(0.1);\n    };\n\n    force.stop = function () {\n      return force.alpha(0);\n    };\n\n    // use `node.call(force.drag)` to make nodes draggable\n    force.drag = function () {\n      if (!drag) drag = d3.behavior.drag()\n        .origin(function (o) {\n          return o;\n        })\n        .on(\"dragstart.force\", dragstart)\n        .on(\"drag.force\", dragmove)\n        .on(\"dragend.force\", dragend);\n\n      if (!arguments.length) return drag;\n\n      this.on(\"mouseover.force\", mouseover)\n        .on(\"mouseout.force\", mouseout)\n        .call(drag);\n    };\n\n    function dragmove(d) {\n      d.px = d3.event.x;\n      d.py = d3.event.y;\n      force.resume(); // restart annealing\n    }\n\n    force.edgePath = function () {\n      var width = size[0];\n\n      var getX1 = function (d) { return d[0][0]; }\n      var getY1 = function (d) { return d[0][1]; }\n      var getX2 = function (d) { return d[1][0]; }\n      var getY2 = function (d) { return d[1][1]; }\n\n      var drawLine = function (selection) {\n        selection.attr('d', function (d) {\n          var x1 = getX1(d);\n          var y1 = getY1(d);\n          var x2 = getX2(d);\n          var y2 = getY2(d);\n\n          if (2*Math.abs(x1-x2) < width) {\n            // draw direct from source to target\n            return 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2;\n          } else if (x1 < x2) {\n            // shorter to go around the \"back\" and x1 is on the left\n            return 'M ' + x1 + ' ' + y1 + ' L ' + (x2 - width) + ' ' + y2 + ' ' +\n              'M ' + x2 + ' ' + y2 + ' L ' + (x1 + width) + ' ' + y1;\n          } else {\n            // shorter to go around the \"back\" and x1 is on the right\n            return 'M ' + x1 + ' ' + y1 + ' L ' + (x2 + width) + ' ' + y2 + ' ' +\n              'M ' + x2 + ' ' + y2 + ' L ' + (x1 - width) + ' ' + y1;\n          }\n        });\n      };\n\n      drawLine.x1 = function (fn) { getX1 = fn; return drawLine; }\n      drawLine.y1 = function (fn) { getY1 = fn; return drawLine; }\n      drawLine.x2 = function (fn) { getX2 = fn; return drawLine; }\n      drawLine.y2 = function (fn) { getY2 = fn; return drawLine; }\n\n      return drawLine;\n    };\n\n    return d3.rebind(force, event, \"on\");\n  };\n\n  // The fixed property has three bits:\n  // Bit 1 can be set externally (e.g., d.fixed = true) and show persist.\n  // Bit 2 stores the dragging state, from mousedown to mouseup.\n  // Bit 3 stores the hover state, from mouseover to mouseout.\n  // Dragend is a special case: it also clears the hover state.\n\n  function dragstart(d) {\n    d.fixed |= 2; // set bit 2\n  }\n\n  function dragend(d) {\n    d.fixed &= ~6; // unset bits 2 and 3\n  }\n\n  function mouseover(d) {\n    d.fixed |= 4; // set bit 3\n    d.px = d.x;\n    d.py = d.y; // set velocity to zero\n  }\n\n  function mouseout(d) {\n    d.fixed &= ~4; // unset bit 3\n  }\n\n  function accumulate(quad, alpha, charges) {\n    var cx = 0,\n      cy = 0;\n\n    quad.charge = 0;\n\n    if (!quad.leaf) {\n      var nodes = quad.nodes,\n        n = nodes.length,\n        i = -1,\n        c;\n\n      while (++i < n) {\n        c = nodes[i];\n        if (!c) continue;\n\n        accumulate(c, alpha, charges);\n        quad.charge += c.charge;\n        cx += c.charge * c.cx;\n        cy += c.charge * c.cy;\n      }\n    }\n\n    if (quad.point) {\n      // jitter internal nodes that are coincident\n      if (!quad.leaf) {\n        quad.point.x += Math.random() - 0.5;\n        quad.point.y += Math.random() - 0.5;\n      }\n\n      var k = alpha * charges[quad.point.index];\n\n      quad.charge += quad.pointCharge = k;\n\n      cx += k * quad.point.x;\n      cy += k * quad.point.y;\n    }\n\n    quad.cx = cx / quad.charge;\n    quad.cy = cy / quad.charge;\n  }\n\n  function isFunction(o) {\n    return typeof o === 'function';\n  }\n\n  function isNumber(o) {\n    return typeof o === 'number';\n  }\n\n});\n\n/*eslint-env amd,browser,node*/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['d3', 'event-dispatcher', 'd3-force-cylindrical'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    require('d3-force-cylindrical');\n    module.exports = factory(require('d3'), require('event-dispatcher'));\n  } else {\n    root.ConceptBrowser = factory(root.d3, root.EventDispatcher);\n  }\n})(this, function (d3, EventDispatcher) {\n  'use strict';\n\n  /** @type {integer} */\n  var NODE_MIN_SIZE = 5;\n\n  /** @type {integer} */\n  var NODE_MAX_SIZE = 13;\n\n  /** @type {object.<string,functin>} */\n  var GRAPH_LAYOUT_CTORS = {\n    planar: d3.layout.force,\n    cylindrical: d3.layout.force.cylindrical\n  };\n\n  /** @type {string} */\n  var TIP_CSS_CLASS = 'd3-tip';\n\n  /** @type {object.<string,integer>} */\n  var TIP_POSITION_MARGIN = {\n    left: 200,\n    right: 200,\n    top: 100,\n    bottom: 100\n  };\n\n  if (!d3.tip) {\n    // eslint-disable-next-line no-console\n    console.warn('d3.tip is not available; tooltips will not display properly.');\n  }\n\n  /**\n   * SDA Concept Browser Visualization\n   *\n   * @param  {Element} rootEl\n   * @param  {integer} width\n   * @param  {integer} height\n   * @param  {string} [layout=planar] - one of: (planar, cylindrical)\n   */\n  function ConceptBrowser(rootEl, layout, options) {\n    layout = layout || 'planar';\n    options = options || {};\n\n    var events = EventDispatcher();\n\n    if (options.debug) {\n      events.all(function (eventName, context) {\n        // eslint-disable-next-line no-console\n        console.log(eventName, context.node ? context.node.id : context);\n      });\n    }\n\n    /**\n     * visualization width in pixels\n     *\n     * @type {integer}\n     */\n    var width;\n\n    /**\n     * visualization height in pixels\n     *\n     * @type {integer}\n     */\n    var height;\n\n    /**\n     * Nodes in the graph\n     *\n     * @type {Node[]}\n     */\n    var nodes = [];\n\n    /**\n     * Edges connecting nodes in the graph\n     *\n     * @type {Node[]}\n     */\n    var edges = [];\n\n    /**\n     * Collection of nodes that are in the \"highlighted\" state\n     *\n     * @type {Node[]}\n     */\n    var highlighted = [];\n\n    /**\n     * The currently focused node (if there is one)\n     *\n     * @type {?Node}\n     */\n    var focused = null;\n\n    /**\n     * Collection of nodes that are in the \"selected\" state\n     *\n     * @type {Node[]}\n     */\n    var selected = [];\n\n    /**\n     * The currently activated node (if there is one)\n     *\n     * @type {?Node}\n     */\n    var activated = null;\n\n    /**\n     * @type {d3.selection}\n     */\n    var svg;\n\n    /**\n     * @type {d3.selection}\n     */\n    var nodeLayer;\n\n    /**\n     * @type {d3.selection}\n     */\n    var edgeLayer;\n\n    /**\n     * @type {d3.selection}\n     */\n    var progressBar;\n\n    /**\n     * @type {d3.scale}\n     */\n    var progressScale;\n\n    /**\n     * @type {d3.scale}\n     */\n    var nodeRadiusScale;\n\n    /**\n     * @type {d3.scale}\n     */\n    var centralityMetricScale;\n\n    /**\n     * @type {d3.layout.force}\n     */\n    var graph;\n\n    /**\n     * function used in a selection.call() method for drawing edge paths.\n     * by default, it draws a straight line between the edge source and target nodes\n     *\n     * @type {function}\n     */\n    var drawEdge = function (selection) {\n      selection.attr('d', function (edge) {\n        var x1 = edge.source.x;\n        var y1 = edge.source.y;\n        var x2 = edge.target.x;\n        var y2 = edge.target.y;\n\n        return 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2;\n      });\n    }\n\n    /**\n     * @type {?d3.tip}\n     */\n    var tooltip = null;\n\n    /**\n     * @type {boolean}\n     */\n    var isInitialized = false;\n\n    /**\n     * Given a selected node, determines what other nodes should be highlighted.\n     * @type {function}\n     */\n    var selectMode = function (node) {\n      if (!node) {\n        return [];\n      }\n\n      var adjacent = node.outEdges.forEach(function (edge) {\n        return edge.target;\n      });\n\n      var incident = node.inEdges.forEach(function (edge) {\n        return edge.source;\n      });\n\n      return [node].concat(adjacent, incident);\n    };\n\n    /**\n     * Given a node, what is its size metric?\n     * @type {function}\n     */\n    var centralityMetric = function () {\n      return 1;\n    };\n\n    /**\n     * A predicate to determine whether a given edge should display\n     * @type {function}\n     */\n    var edgeFilter = function () {\n      return true;\n    };\n\n    ////////////////////////////////////////////////////////////\n\n    // expose public methods\n    var API = {};\n    API.size = setSize;\n    API.nodeCentralityMetric = setNodeCentralityMetric;\n    API.selectMode = setSelectMode;\n    API.data = setData;\n    API.highlight = setHighlighted;\n    API.activate = setActivated;\n    API.edgeFilter = setEdgeFilter;\n    API.updateGraphSelections = applyStyleClasses;\n    API.refresh = refresh;\n    API.on = events.on;\n    return API;\n\n    ////////////////////////////////////////////////////////////\n\n    /**\n     * Sets graph dimensions. refresh() must be called in order for changes to take effect\n     *\n     * @param {integer[]} dims - dimensions (width, height) of new viewing area\n     */\n    function setSize(dims) {\n      width = dims[0];\n      height = dims[1];\n\n      if (isInitialized) {\n        svg.attr('width', width).attr('height', height);\n        progressScale.range([0, width]);\n        graph.size([width, height]);\n      }\n\n      return API;\n    }\n\n    /**\n     * Sets a node size metric function\n     *\n     * @param {function} nodeCentralityMetric\n     */\n    function setNodeCentralityMetric(nodeCentralityMetric) {\n      centralityMetric = nodeCentralityMetric;\n\n      if (isInitialized) {\n        var centralityExtent = d3.extent(nodes, centralityMetric);\n        centralityMetricScale.domain(centralityExtent[0] === centralityExtent[1] ? [centralityExtent[0] - 1, centralityExtent[1] + 1] : centralityExtent);\n      }\n\n      return API;\n    }\n\n    /**\n     * Sets a node selection mode function\n     *\n     * @param {function} _selectMode\n     */\n    function setSelectMode(_selectMode) {\n      selectMode = _selectMode;\n\n      return API;\n    }\n\n    /**\n     * Sets graph data. refresh() must be called in order for changes to take effect\n     *\n     * @param {Node[]} _nodes\n     * @param {Edge[]} _edges\n     */\n    function setData(_nodes, _edges) {\n      nodes = _nodes;\n      edges = _edges;\n\n      // randomize node positions if not already set\n      nodes.forEach(function (node) {\n        node.x = (node.x || Math.random()) * width;\n        node.y = (node.y || Math.random()) * height;\n      });\n\n      return API;\n    }\n\n    /**\n     * Sets the set of currently highlighted nodes\n     *\n     * @param {Node|Node[]} nodes\n     */\n    function setHighlighted(highlightedNodes) {\n      if (!(highlightedNodes instanceof Array)) {\n        highlightedNodes = [highlightedNodes];\n      }\n\n      // make sure every node is present in the graph\n      var allNodesInGraph = highlightedNodes.every(function (node) {\n        return nodes.indexOf(node) >= 0;\n      });\n\n      if (!allNodesInGraph) {\n        throw new Error('some node(s) to be highlighted are not members of the graph');\n      }\n\n      unhighlightAll();\n      highlight(highlightedNodes);\n\n      return API;\n    }\n\n    /**\n     * Sets the currently active node\n     *\n     * @param {Node} node\n     */\n    function setActivated(node) {\n      if (node && nodes.indexOf(node) < 0) {\n        throw new Error('node to be activated is not a member of the graph');\n      }\n\n      deactivate();\n\n      if (node) {\n        activate(node);\n\n        // also select nodes\n        deselectAll();\n        select(node);\n      }\n\n      return API;\n    }\n\n    /**\n     * Sets an edge predicate that determines whether an edge should be displayed\n     *\n     * @param {function} fn\n     */\n    function setEdgeFilter(fn) {\n      edgeFilter = fn;\n\n      return API;\n    }\n\n    /**\n     * Update node and edge bindings for display and run force-directed graph simulation\n     *\n     * @param {object} data\n     */\n    function refresh() {\n      // ensure visualization is initialized\n      initialize();\n\n      // begin force-directed simulation\n      graph\n        .nodes(nodes)\n        .links(edges)\n        .start();\n\n      bindNodes();\n      bindEdges();\n\n      return API;\n    }\n\n    ////////////////////////////////////////////////////////////\n\n    function initialize() {\n      if (!width || !height) {\n        throw new Error('No width/height set. Use size([width, height]) to set size before initializing');\n      }\n\n      if (!nodes || !edges) {\n        throw new Error('No nodes/edges set. Use data(nodes, edges) to set them before initializing');\n      }\n\n      if (isInitialized) {\n        return;\n      }\n\n      isInitialized = true;\n\n      svg = d3.select(rootEl).append('svg')\n        .attr('width', width)\n        .attr('height', height);\n\n      // extract edge types and create arrowhead styles for them\n      var edgeTypes = edges.reduce(function (types, edge) {\n        if (types.indexOf(edge.relation) < 0) {\n          types.push(edge.relation);\n        }\n        return types;\n      }, []);\n\n      defineArrowheads(svg, edgeTypes, ['', 'activated', 'selected', 'focused']);\n\n      var baseGroup = svg.append('g').attr('class', 'concept-browser');\n      edgeLayer = baseGroup.append('g').attr('class', 'edges');\n      nodeLayer = baseGroup.append('g').attr('class', 'nodes');\n\n      progressBar = baseGroup.append('rect').attr('class', 'progress')\n        .attr('x', 0)\n        .attr('y', 0)\n        .attr('height', 2);\n\n      progressScale = d3.scale.linear()\n        .domain([Math.log(0.1), Math.log(0.005)])\n        .range([0, width]);\n\n      var centralityExtent = d3.extent(nodes, centralityMetric);\n      centralityMetricScale = d3.scale.linear()\n        .domain(centralityExtent[0] === centralityExtent[1] ? [centralityExtent[0] - 1, centralityExtent[1] + 1] : centralityExtent)\n        .range([0, 1]);\n\n      nodeRadiusScale = function (x) {\n        return NODE_MIN_SIZE + (NODE_MAX_SIZE - NODE_MIN_SIZE) * centralityMetricScale(x);\n      }\n\n      graph = GRAPH_LAYOUT_CTORS[layout || 'planar']()\n        .size([width, height])\n        .on('tick', tick);\n      configureGraph(graph);\n\n      if (graph.edgePath) {\n        drawEdge = graph.edgePath()\n          .x1(function (edge) { return edge.source.x; })\n          .y1(function (edge) { return edge.source.y; })\n          .x2(function (edge) { return edge.target.x; })\n          .y2(function (edge) { return edge.target.y; });\n      }\n\n      if (d3.tip) {\n        tooltip = d3.tip()\n            .attr('class', TIP_CSS_CLASS)\n            .direction(tooltipDirection)\n            .offset(tooltipOffset)\n            .html(function (node) { return node.label; });\n\n        events.on('focus', function (evt) { showTooltip(evt.node); });\n        events.on('blur', function (evt) { hideTooltip(evt.node); });\n      }\n\n      var updateGraphSelections = debounce(applyStyleClasses, 100, true, true);\n\n      events.on('highlight', updateGraphSelections);\n      events.on('unhighlight', updateGraphSelections);\n      events.on('focus', updateGraphSelections);\n      events.on('blur', updateGraphSelections);\n      events.on('select', updateGraphSelections);\n      events.on('deselect', updateGraphSelections);\n      events.on('activate', updateGraphSelections);\n      events.on('deactivate', updateGraphSelections);\n    }\n\n    /**\n     * Sets configuration values on a D3 graph instance\n     *\n     * @param  {d3.svg.graph} graph\n     */\n    function configureGraph(graph) {\n      graph\n        .gravity(0.1)\n        // .linkDistance(50)\n        // .chargeDistance(width * 0.25)\n        .linkDistance(50)\n        .linkStrength(function (edge) {\n          // influential nodes pull their supporters closer\n          var sz = centralityMetric(edge.source);\n          return centralityMetricScale(sz)\n          // var targetInfluence = edge.target.stats.in_degree / 10;\n          // return 1 - 1/(1 + targetInfluence);\n        })\n        .charge(function (node) {\n          // HACK experiment with variably-charged nodes\n          var chargeRange = [-50, -300];\n          var influenceRange = [0, 1];\n          var sz = centralityMetric(node);\n\n          return chargeRange[0] + (chargeRange[1] - chargeRange[0])/(influenceRange[1] - influenceRange[0]) * (centralityMetricScale(sz) - influenceRange[0]);\n        })\n        .friction(.9);\n        // .theta(0.08);\n    }\n\n    /**\n     * Update node positions with each tick of a graph's physics simulation\n     *\n     * @param {object} evt\n     */\n    function tick(evt) {\n      updatePositions();\n\n      if (evt.alpha > 0.0051) {\n        progressBar.attr('width', progressScale(Math.log(evt.alpha)));\n        // bail early; do not render nodes\n        if (Math.random() < 0.95) return;\n      } else {\n        progressBar.attr('width', 0);\n      }\n\n      nodeLayer.selectAll('.node').transition().duration(500)\n        .attr('transform', function (node) {\n          return 'translate(' + node.x + ',' + node.y + ')';\n        });\n\n      edgeLayer.selectAll('.edge').transition().duration(500)\n        .call(drawEdge);\n    }\n\n    /**\n     * Update node bindings on the visualization\n     *\n     * @param  {Node[]} nodes\n     */\n    function bindNodes() {\n      if (!nodes || nodes.length === 0) {\n        throw new Error('no nodes provided');\n      }\n\n      // var nodeMetricExtent = d3.extent(nodes, function (node) {\n      //   return (node.metadata && node.metadata.pagerank) || 1;\n      // });\n\n      // nodeRadiusScale.domain(nodeMetricExtent);\n\n      var nodeSelect = nodeLayer.selectAll('.node')\n        .data(nodes, function (node) {\n          return node.id;\n        });\n\n      var nodeEnter = nodeSelect.enter().append('g')\n        .attr('class', 'node')\n        .attr('transform', function (node) {\n          return 'translate(' + node.x + ',' + node.y + ')';\n        })\n        .on('mouseover', focus)\n        .on('mouseout', blur)\n        .on('dblclick', activate)\n        .on('click', function (node) {\n          if (d3.event.ctrlKey) {\n            if (selected.indexOf(node) < 0) {\n              select(node);\n            } else {\n              deselect(node);\n            }\n          } else {\n            deselectAll();\n            select(node);\n          }\n        });\n\n      nodeEnter.append('circle');\n\n      nodeSelect.select('circle')\n        .attr('r', function (node) {\n          var sz = centralityMetric(node);\n          return nodeRadiusScale(sz);\n        });\n\n      nodeSelect.exit().remove();\n\n      if (tooltip) {\n        nodeLayer.call(tooltip);\n      }\n    }\n\n    /**\n     * Update edge bindings on the visualization\n     *\n     * @param  {Edge[]} edges\n     */\n    function bindEdges() {\n      if (!edges || edges.length === 0) {\n        throw new Error('no edges provided');\n      }\n\n      var edgeSelect = edgeLayer.selectAll('.edge')\n        .data(edges, function (edge) {\n          return edge.source.id + ',' + edge.target.id;\n        });\n\n      edgeSelect.enter().append('path')\n        .attr('class', function (edge) {\n          return 'edge ' + edge.relation;\n        })\n        .attr('marker-end', function (edge) {\n          return 'url(#arrowhead-' + edge.relation + ')';\n        })\n        // .style('stroke-width', function (edge) {\n        //   var multiplicity = (edge.metadata && edge.metadata.multiplicity) || 1;\n        //   return multiplicity + 'pt';\n        // })\n        .call(drawEdge);\n\n      edgeSelect.exit().remove();\n    }\n\n    /**\n     * Adds the given node or nodes to the set of highlighted nodes\n     *\n     * @param {Node|Node[]} ns\n     */\n    function highlight(ns) {\n      if (!(ns instanceof Array)) {\n        ns = [ns];\n      }\n\n      ns.forEach(function (n) {\n        if (highlighted.indexOf(n) < 0) {\n          highlighted.push(n);\n        }\n\n        events.trigger('highlight', { node: n, selection: selected });\n      });\n    }\n\n    /**\n     * Unhighlights the given node, nodes, or all currently highlighted nodes\n     * @param  {Node|Node[]} [ns]\n     */\n    function unhighlight(ns) {\n      if (!ns) {\n        return unhighlightAll();\n      } else if (!(ns instanceof Array)) {\n        ns = [ns];\n      }\n\n      ns.forEach(function (n) {\n        var ix = highlighted.indexOf(n);\n        if (ix >= 0) {\n          highlighted.splice(ix, 1);\n        }\n      });\n    }\n\n    /**\n     * Unhighlights all nodes\n     */\n    function unhighlightAll() {\n      highlighted.forEach(function (node) {\n        events.trigger('unhighlight', { node: node, selection: selected });\n      });\n\n      highlighted = [];\n    }\n\n    /**\n     * Focuses the given node\n     *\n     * @param {Node} node\n     */\n    function focus(node) {\n      // ensure that the currently selected node has already been blurred\n      blur();\n\n      focused = node;\n      events.trigger('focus', { node: focused, selection: selected });\n    }\n\n    /**\n     * Blurs the given node or the currently focused node.\n     *\n     * @param {Node} [node]\n     */\n    function blur(node) {\n      node = node || focused;\n\n      if (node) {\n        if (focused === node) {\n          focused = null;\n        } else {\n          throw new Error('tried to blur a node that was not focused');\n        }\n\n        events.trigger('blur', { node: node, selection: selected });\n      }\n    }\n\n    /**\n     * Activates the given node\n     *\n     * @param {Node} node\n     */\n    function activate(node) {\n      // don't do anything if node is already active\n      if (activated === node) {\n        return;\n      }\n\n      // ensure that the active node has been deactivated\n      deactivate()\n\n      activated = node;\n      events.trigger('activate', { node: activated, selection: selected });\n    }\n\n    /**\n     * Deactivates the given node or the currently activated node.\n     *\n     * @param {Node} node\n     */\n    function deactivate(node) {\n      node = node || activated;\n\n      if (node) {\n        if (activated === node) {\n          activated = null;\n        } else {\n          throw new Error('tried to deactivate a node that was not activated');\n        }\n\n        events.trigger('deactivate', { node: node, selection: selected });\n      }\n    }\n\n    /**\n     * Adds the given node to the list of currently selected nodes\n     *\n     * @param {Node} node\n     */\n    function select(node) {\n      if (!node) {\n        throw new Error('no node provided');\n      }\n\n      if (selected.indexOf(node) < 0) {\n        selected.push(node);\n      } else {\n        throw new Error('tried to select a node that is already selected');\n      }\n\n      events.trigger('select', { node: node, selection: selected });\n    }\n\n    /**\n     * Removes the given node from the list of currently selected nodes\n     *\n     * @param {Node} node\n     */\n    function deselect(node) {\n      if (!node) {\n        throw new Error('no node provided to deselect');\n      }\n\n      var ix = selected.indexOf(node);\n      if (ix < 0) {\n        throw new Error('tried to deselect a node that was not selected');\n      } else {\n        selected.splice(ix, 1);\n      }\n\n      events.trigger('deselect', { node: node, selection: selected });\n    }\n\n    /**\n     * Deselects all selected nodes\n     */\n    function deselectAll() {\n      selected.forEach(function (node) {\n        events.trigger('deselect', { node: node, selection: [] });\n      });\n\n      selected = [];\n    }\n\n    /**\n     * Displays a tooltip with a label for the given node.\n     *\n     * @param {Node} node\n     */\n    function showTooltip(node) {\n      if (tooltip) {\n        tooltip.attr('class', TIP_CSS_CLASS)\n          .show(node);\n      }\n    }\n\n    /**\n     * Hides the tooltip for the given node.\n     *\n     * @param {Node} node\n     */\n    function hideTooltip(node) {\n      if (tooltip) {\n        tooltip.attr('class', TIP_CSS_CLASS)\n          .hide(node);\n      }\n    }\n\n    /**\n     * Marks selected nodes and edges as highlighted\n     */\n    function applyStyleClasses() {\n      var activatedSet = [activated];\n\n\n      var selectedSet = selected.slice();\n\n      var focusedSet = selectMode(focused);\n\n      // ego graphs of selected nodes get focused\n      selected.forEach(function (p) {\n        selectMode(p).forEach(function (q) {\n          if (focusedSet.indexOf(q) < 0) {\n            focusedSet.push(q);\n          }\n        });\n      });\n\n      // ego graphs of activated nodes get focused\n      selectMode(activated).forEach(function (q) {\n        if (focusedSet.indexOf(q) < 0) {\n          focusedSet.push(q);\n        }\n      });\n\n      var highlightedSet = highlighted.slice();\n\n      nodeLayer.selectAll('.node')\n        .classed('activated', function (node) {\n          return activatedSet.indexOf(node) >= 0;\n        })\n        .classed('selected', function (node) {\n          return selectedSet.indexOf(node) >= 0;\n        })\n        .classed('focused', function (node) {\n          return focusedSet.indexOf(node) >= 0;\n        })\n        .classed('highlighted', function (node) {\n          return highlightedSet.indexOf(node) >= 0;\n        });\n\n      edgeLayer.selectAll('.edge')\n        .classed('activated', function (edge) {\n          return activatedSet.indexOf(edge.source) >= 0 && activatedSet.indexOf(edge.target) >= 0;\n        })\n        .classed('selected', function (edge) {\n          return selectedSet.indexOf(edge.source) >= 0 && selectedSet.indexOf(edge.target) >= 0;\n        })\n        .classed('focused', function (edge) {\n          return focusedSet.indexOf(edge.source) >= 0 && focusedSet.indexOf(edge.target) >= 0;\n        })\n        .classed('hidden', function (edge) {\n          return !edgeFilter(edge);\n        })\n        .attr('marker-end', function (edge) {\n          var cls = '';\n\n          if (activatedSet.indexOf(edge.source) >= 0 && activatedSet.indexOf(edge.target) >= 0) {\n            cls = '-activated';\n          } else if (selectedSet.indexOf(edge.source) >= 0 && selectedSet.indexOf(edge.target) >= 0) {\n            cls = '-selected'\n          } else if (focusedSet.indexOf(edge.source) >= 0 && focusedSet.indexOf(edge.target) >= 0) {\n            cls = '-focused'\n          }\n\n          return 'url(#arrowhead-' + edge.relation + cls + ')';\n        });\n    }\n\n    /**\n     * Sets positions of each node to within the viewing area, wrapping left and right sides\n     */\n    function updatePositions() {\n      nodes.forEach(function (node) {\n        // constrain x and y positions to within viewing area\n        node.x = Math.max(Math.min(node.x, width), 0);\n        node.y = Math.max(Math.min(node.y, height), 0);\n      });\n    }\n\n    /**\n     * Gets node-relative tooltip positioning information from a node.\n     * Based on how close the node is to the border/sides of the visualization.\n     *\n     * @param {Node} node\n     * @return {string} tooltip direction (one of: n, ne, e, se, s, sw, w, nw)\n     */\n    function tooltipDirection(node) {\n      var dir = '';\n\n      // control top/bottom based on proximity to borders\n      if (node.y > height - TIP_POSITION_MARGIN.bottom) dir += 'n';\n      else if (node.y < TIP_POSITION_MARGIN.top) dir += 's';\n\n      // control side based on proximity to borders\n      if (node.x > width - TIP_POSITION_MARGIN.right) dir += 'w';\n      else if (node.x < TIP_POSITION_MARGIN.left) dir += 'e';\n\n      // fall back to top\n      if (dir === '') dir = 'n';\n\n      return dir;\n    }\n\n     /**\n      * Controls how far to place the tooltip from the point at which the node is located.\n      * Offset coordinates based on how close the node is to the border/sides of the visualization\n      * (i.e. the node's radius)\n      *\n      * @param {Node} node\n      * @return {integer[]} tooltip x/y offset coordinates\n      */\n    function tooltipOffset(node) {\n      var sz = centralityMetric(node);\n      var radius = nodeRadiusScale(sz);\n      var offset = [0, 0];\n\n      if (node.y > height - TIP_POSITION_MARGIN.bottom) offset[0] -= radius;\n      else if (node.y < TIP_POSITION_MARGIN.top) offset[0] += radius;\n\n      if (node.x > width - TIP_POSITION_MARGIN.left_right) offset[1] -= radius;\n      else if (node.x < TIP_POSITION_MARGIN.left_right) offset[1] += radius;\n\n      if (offset[1] === 0 && offset[0] === 0) offset[0] -= radius;\n\n      return offset;\n    }\n\n    /**\n     * Sets arrowhead definitions on the SVG defs element\n     *\n     * @param  {object} svg\n     */\n    function defineArrowheads(svg, edgeTypes, classTypes) {\n      var arrowTypes = [];\n      edgeTypes.forEach(function (type) {\n        classTypes.forEach(function (cls) {\n          arrowTypes.push('arrowhead-' + type + (cls ? '-' + cls : ''));\n        });\n      });\n\n      // arrowhead definitions\n      svg.append('defs').selectAll('marker')\n          .data(arrowTypes)\n        .enter().append('marker')\n          .attr('id', function(id) { return id; })\n          .attr('viewBox', '0 -4 10 8')\n          .attr('refX', 25)\n          .attr('refY', 0)\n          .attr('markerWidth', 6)\n          .attr('markerHeight', 6)\n          .attr('orient', 'auto')\n        .append('path')\n          .attr('d', 'M 0,-4 L 10,0 L 0,4');\n    }\n  }\n\n  return ConceptBrowser;\n\n  function debounce(fn, wait, leading, trailing) {\n    var timeout;\n\n    if (typeof leading === 'undefined') {\n      leading = true;\n    }\n\n    if (typeof trailing === 'undefined') {\n      trailing = false;\n    }\n\n    return function () {\n      var ctx = this;\n      var args = arguments;\n\n      var callNow = leading && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n\n      if (callNow) {\n        fn.apply(ctx, args);\n      }\n\n      function later() {\n        timeout = null;\n        if (trailing) {\n          fn.apply(ctx, args);\n        }\n      }\n    };\n  }\n\n});\n\nangular.module(\"sda.concept-browser\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/help.html\",\"<md-dialog><md-toolbar><div class=md-toolbar-tools><h2>Help</h2><span flex></span><md-button class=md-icon-button ng-click=close()><md-icon>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content layout=column layout-align=\\\"center center\\\"><iframe width=1280 height=720 src=https://www.youtube.com/embed/P8V_bx0L4RY frameborder=0 allowfullscreen></iframe></div></md-dialog-content></md-dialog>\");\n$templateCache.put(\"app/main/main.html\",\"<md-sidenav md-component-id=right class=md-sidenav-right md-is-open=main.activeNode md-disable-backdrop md-whiteframe=4 layout=column><md-toolbar><div class=md-toolbar-tools><h2>Node Information</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"main.activeNode = null\\\"><md-icon>close</md-icon></md-button></div></md-toolbar><div flex layout=column layout-align=\\\"center center\\\" ng-if=main.sidebarLoading><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div class=node-info flex layout=column ng-if=!main.sidebarLoading><h3 class=name><span class=given>{{main.person.name.givenName}}</span> <span class=family>{{main.person.name.familyName}}</span></h3><md-tabs flex><md-tab ng-if=main.person.summary><md-tab-label><md-icon>person</md-icon></md-tab-label><md-tab-body><div class=summary ng-if=main.person.summary ng-bind-html=main.person.summary></div></md-tab-body></md-tab><md-tab ng-if=\\\"main.works &amp;&amp; main.works.length &gt; 0\\\"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><div class=books><h4>Books ({{main.works.length}})</h4><md-list><md-list-item ng-repeat=\\\"work in main.works\\\" ng-href=../#/library/books/{{work.id}}>{{work.label}}</md-list-item></md-list></div></md-tab-body></md-tab><md-tab ng-if=\\\"main.related &amp;&amp; main.related.length &gt; 0\\\"><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body><md-list class=relationships><div ng-repeat=\\\"group in main.related\\\"><div ng-if=group.directed><div ng-if=\\\"group.out.nodes.length &gt; 0\\\"><md-subheader class=md-no-sticky>{{group.out.label}}</md-subheader><md-list-item ng-repeat=\\\"node in group.out.nodes track by node.id\\\" ng-click=\\\"main.activeNode = node\\\">{{node.label}}</md-list-item></div><div ng-if=\\\"group.in.nodes.length &gt; 0\\\"><md-subheader class=md-no-sticky>{{group.in.label}}</md-subheader><md-list-item ng-repeat=\\\"node in group.in.nodes track by node.id\\\" ng-click=\\\"main.activeNode = node\\\">{{node.label}}</md-list-item></div></div><div ng-if=!group.directed><div ng-if=\\\"group.none.nodes.length &gt; 0\\\"><md-subheader class=md-no-sticky>{{group.none.label}}</md-subheader><md-list-item ng-repeat=\\\"node in group.none.nodes track by node.id\\\" ng-click=\\\"main.activeNode = node\\\">{{node.label}}</md-list-item></div></div></div></md-list></md-tab-body></md-tab></md-tabs></div></md-sidenav><md-toolbar><div class=md-toolbar-tools><img class=logo src=assets/images/sda-logo-light.png alt=SDA><h1>Concept Browser</h1><span flex></span><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title=\\\"Ranking Model\\\"><md-icon>adjust</md-icon></md-button><md-menu-content><md-menu-item ng-repeat=\\\"metric in main.sizeMetrics\\\"><md-button ng-click=\\\"main.sizeMetric = metric\\\" ng-disabled=metric.disabled><md-icon md-menu-align-target>radio_button_{{main.sizeMetric === metric ? \\'\\' : \\'un\\'}}checked</md-icon>{{metric.label}}</md-button></md-menu-item></md-menu-content></md-menu><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title=\\\"Selection Mode\\\"><md-icon>device_hub</md-icon></md-button><md-menu-content><md-menu-item ng-repeat=\\\"mode in main.selectModes\\\"><md-button ng-click=\\\"main.selectMode = mode\\\" ng-disabled=metric.disabled><md-icon md-menu-align-target>radio_button_{{main.selectMode === mode ? \\'\\' : \\'un\\'}}checked</md-icon>{{mode.label}}</md-button></md-menu-item></md-menu-content></md-menu><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title=\\\"Relationship Types\\\"><md-icon>filter_list</md-icon></md-button><md-menu-content><md-menu-item><md-button ng-click=\\\"main.relnTypeFilter = []\\\"><md-icon md-menu-align-target>check_box{{main.relnTypeFilter.length &gt; 0 ? \\'_outline_blank\\' : \\'\\'}}</md-icon>All Relationships</md-button></md-menu-item><md-divider></md-divider><md-menu-item ng-repeat=\\\"type in main.relnTypes\\\"><md-button ng-click=main.toggleRelnTypeFilter(type.id) md-prevent-menu-close><md-icon md-menu-align-target>check_box{{main.relnTypeFilter.indexOf(type.id) &lt; 0 ? \\'_outline_blank\\' : \\'\\'}}</md-icon>{{type.title}}</md-button></md-menu-item></md-menu-content></md-menu><span flex></span><md-button class=md-icon-button ng-click=main.toggleSearchForm($event)><md-icon>search</md-icon></md-button><form name=search class=search-form layout=row ng-style=\\\"{ width: main.showSearchForm ? \\'20rem\\' : \\'0\\' }\\\"><input type=search name=query ng-model=searchQuery ng-change=main.highlightNodes() flex> <button class=clear ng-click=main.clearSearchForm()><md-icon>clear</md-icon></button></form><md-button class=md-icon-button ng-click=main.showHelp($event)><md-icon>help_outline</md-icon></md-button></div></md-toolbar><div style=\\\"overflow: hidden\\\" flex layout=column><concept-browser flex ng-if=main.graph ng-model=main.graph active-node=main.activeNode size-metric=main.sizeMetric.strategy select-mode=main.selectMode.strategy highlighted-nodes=main.highlightedNodes reln-types=main.relnTypeFilter></concept-browser><div ng-if=\\\"!main.graph &amp;&amp; main.graphLoading\\\" flex layout=column layout-align=\\\"center center\\\" layout-padding><md-progress-circular md-mode=indeterminate></md-progress-circular><div class=\\\"text-center md-headline md-secondary\\\">Loading graph data&hellip;<br>This may take a while.</div></div></div>\");\n$templateCache.put(\"app/trc-bio/event-editor.html\",\"<div class=form-group><label class=control-label for=event-title>Title</label><input type=text id=event-title name=event-title class=\\\"form-control event-title\\\" ng-model=event.title></div><div class=form-group><label class=control-label for=event-description>Description</label><textarea id=event-description name=event-description class=\\\"form-control event-description\\\" ng-model=event.description></textarea></div><div class=form-group><label class=control-label for=event-location>Location</label><input type=text id=event-location name=event-location class=\\\"form-control event-location\\\" ng-model=event.location></div><div class=form-group><label class=control-label for=event-date>Date</label><input type=text id=event-date name=event-date class=\\\"form-control event-date\\\" ng-model=event.date.description><!-- TODO add datepicker --></div>\");\n$templateCache.put(\"app/trc-bio/name-editor.html\",\"<div class=form-group class=name-role><label class=control-label for=name-role>Role</label><select id=name-role name=name-role class=\\\"form-control name-role\\\" ng-model=name.role><option ng-repeat=\\\"role in nameEditor.roles\\\" value={{role.value}}>{{role.label}}</option></select></div><div class=form-group class=name-structure><label class=control-label>Structured Name</label><input type=text class=name-title placeholder=title ng-model=name.title> <input type=text class=name-given placeholder=given ng-model=name.givenName> <input type=text class=name-middle placeholder=middle ng-model=name.middleName> <input type=text class=name-family placeholder=family ng-model=name.familyName> <input type=text class=name-suffix placeholder=suffix ng-model=name.suffix></div><div class=form-group class=name-label><label for=label>Display Label</label><input type=text placeholder=label ng-model=name.label></div>\");\n$templateCache.put(\"app/trc-bio/person-editor.html\",\"<div class=form-group><label for=person-name>Primary Name</label><trc-name-editor id=person-name ng-model=person.name></trc-name-editor></div><div class=form-group><label for=person-altnames>Alternate Names</label><div ng-repeat=\\\"name in person.altNames\\\"><trc-name-editor id=person-altnames ng-model=name></trc-name-editor><button ng-click=personEditor.removeName($index)>&minus;</button></div><button ng-click=personEditor.addName()>+</button></div><div class=form-group><label for=person-birth>Birth</label><div ng-if=person.birth><trc-event-editor id=person-birth ng-model=person.birth></trc-event-editor><button ng-click=\\\"personEditor.removeEvent(\\'birth\\')\\\">&minus;</button></div><div ng-if=!person.birth><button ng-click=\\\"personEditor.addEvent(\\'birth\\')\\\">+</button></div></div><div class=form-group><label for=person-death>Death</label><div ng-if=person.death><trc-event-editor id=person-death ng-model=person.death></trc-event-editor><button ng-click=\\\"personEditor.removeEvent(\\'death\\')\\\">&minus;</button></div><div ng-if=!person.death><button ng-click=\\\"personEditor.addEvent(\\'death\\')\\\">+</button></div></div><div class=form-group><label class=control-label for=person-summary>Summary</label><textarea id=person-summary name=person-summary class=\\\"form-control person-summary\\\" ng-model=person.summary></textarea></div>\");}]);"],"sourceRoot":"/source/"}