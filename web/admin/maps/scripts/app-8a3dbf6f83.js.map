{"version":3,"sources":["scripts/app.js"],"names":["angular","module","nameEditorDirective","directive","restrict","templateUrl","scope","name","eventEditorDirective","event","eventEditDialogFactory","$mdDialog","showDialog","$event","dialog","targetEvent","locals","controller","EventEditDialogController","controllerAs","show","close","hide","vm","cancel","this","$inject","factory","workEditorItemDirective","$log","linkFunc","$scope","id","error","WorkEditorItemController","worksRepo","activate","work","getWork","$promise","then","loaded","link","workEditorDirective","WorkEditorController","_","editions","forEach","edition","push","model","focused","createEdition","titles","cloneDeep","authors","deleteEdition","ix","splice","volumeEditorDirective","volume","editionEditorDirective","EditionEditorController","volumes","createVolume","publicationInfo","deleteVolume","titleEditorDirective","title","relnEditDialogFactory","RelationshipEditDialogController","$filter","relnRepo","types","getTypes","rawTypes","typesP","type","identifier","label","directed","isDirected","reverse","reverseTitle","Object","defineProperty","value","search","query","results","items","selectWork","proxy","anchors","baseLabel","stripTags","baseToken","ref","token","selectedAnchor","createAnchor","editionLabel","editionName","editionId","volumeLabel","volumeNumber","volumeId","typeId","selectedType","target","description","searchText","selectedWork","RelationshipsController","$state","$timeout","$mdToast","relnEditDialog","openRelationship","reln","anchor","state","params","TypeId","WORK","workId","properties","PERSON","ARTICLE","go","showSimple","addRelationship","relationship","createRelationship","dialogPromise","relnInfo","targets","related","saveP","save","loadRelationships","deleteRelationship","confirm","textContent","ok","confirmPromise","deleteP","$watch","newAnchor","loading","relns","typeGroupsP","typeGroups","normalizeRelationships","component","bindings","publicationInfoEditorDirective","pubInfo","copyEditorDirective","copy","CopyEditorController","addHandler","HathiTrustRefHandler","GoogleBooksRefHandler","InternetArchiveRefHandler","handler","refHandlers","parseProperties","url","copyForm","$setValidity","setProperties","handle","parsed","parseUrl","seq","path","substr","pageNo","fragment","match","length","makePropertiesObject","src","display","hostname","lastIndexOf","urlappend","subquery","parseQueryString","htid","section","printsec","page","pg","parser","document","createElement","href","toString","protocol","host","port","pathname","hash","sep","isString","flags","indexOf","kvpairs","split","pair","key","decodeURIComponent","URIError","hasOwnProperty","isArray","copyEditDialogFactory","CopyEditDialogController","authorRefEditorDirective","AuthorRefEditorController","peopleRepo","authorId","author","get","linkAuthorSearchText","setLinkedAuthor","person","getResults","resultSet","authorRoles","treeCategorizationEditor","scopeId","scheme","TreeCategorizationController","$q","articlesRepo","categorizationService","info","repo","getScopedRepo","overviews","handleAssociateEntry","node","linkArticle","article","nodes","reference","openEditor","values","create","articlePromise","linkPromise","all","handleRemoveEntry","handleCreateChild","parent","onCreate","newCategoryDialog","prompt","placeholder","handleDeleteNode","msg","removeCatgorizationDialog","htmlContent","remove","ArticleEditorSectionController","ArticleEditorController","$stateParams","$mdBottomSheet","refsRepoFactory","references","refsRepo","cleanArticleHandler","$watchCollection","cleanRefsHandler","alert","editFootnote","footnote","newFootnote","newReferences","createRefCollection","config","clickOutsideToClose","promise","footnotes","updatedReferences","merge","compact","obj","cleanReferences","cleanFootnotes","refsRepoUrl","getReferencesEndpoint","getRepo","body","abstractEditor","extend","CKEDITOR_CONFIG","removeButtons","join","editor","toolbarGroups","groups","format_tags","extraPlugins","mathJaxLib","ZoteroTestController","item","summaryEditorDirective","summary","summaryEditDialogFactory","SummaryEditDialogController","stripTagsFilter","html","String","replace","filter","slideToggle","beforeAddClass","element","className","done","NG_HIDE_CLASS","slideUp","removeClass","slideDown","animation","SeeAlsoEditorController","seeAlsoRepo","trcSearch","createLink","alreadyLinked","clearLinkForm","sourceToken","source","seeAlso","links","openLink","deleteLink","confirmP","combineSearchResults","newToken","some","existing","selectedItem","flatMap","UNIFIED_SEARCH_KEYS","map","NavbarController","$mdSidenav","toggleSidenav","toggle","sidenavId","guessDateFactory","moment","guessDate","str","INFER_FORMATS","emptyFilterFactory","isEmpty","dateEditorDirective","calendarAutoSet","dateDescription","date","calendar","format","DataContainerController","watch","fn","unregister","listeners","set","newValue","FootnoteEditDialogController","ckeditorFootnotesDirective","$document","el","attrs","requires","insertFootnoteCommand","fire","FOOTNOTE_COMMAND_NAME","command","createFootnote","backlinkId","anchorIdPrefix","ckeditorBibliography","ctrl","insertHtml","ckeditorFootnotesAnchorIdPrefix","ckeditor","instance","scopeValueExpr","ckeditorFootnotes","$eval","addCommand","async","allowedContent","requiredContent","exec","ui","addButton","toolbar","require","ckeditorBibliographyDirective","refsRenderer","citationEditDialog","insertCitationCommand","CITATION_COMMAND_NAME","newReference","citation","createCitation","citations","render","rendered","refs","CitationEditorController","zotero","account","getUserAccount","ZOTERO_USER_ACCOUNT_ID","ZOTERO_USER_ACCOUNT_API_KEY","groupP","when","getGroup","ZOTERO_GROUP_ID","groupLibraryP","group","getLibrary","Error","warn","library","resultsP","searchItems","adaptItem","wrapItem","zItem","createBiblioItem","creators","adaptCreator","meta","pick","fields","omit","zCreator","role","creatorType","firstName","lastName","labelP","renderBiblioItem","addCitationItem","citationItem","referencedBibItem","bibliography","renderCitationItemLabel","clearForm","selectBiblioItem","itemContainer","activeCitationItem","editCitationItem","biblioItem","biblioItemContainer","selectedBiblioItem","renderedP","createZoteroItem","zoteroItem","cancelZoteroItem","saveZoteroItem","zItemP","saveItem","biblioItemP","itemContainerP","locatorTypes","LOCATOR_TYPES","edit","CitationEditDialogFactory","CitationEditDialogController","ZoteroEditorController","getItemTypes","typeFilter","field","selectType","itemType","getFields","getCreatorRoles","roles","itemTypeSearchText","ZoteroCreatorFieldController","creator","ZoteroFactory","getDefaultBaseUrl","toJson","ShowPersonController","personEditDialog","eventEditDialog","summaryEditDialog","personId","personRefsUrl","editBioInfo","updatedPerson","showSavedToast","editEvent","updatedEvent","editSummary","updatedSummary","editBibliography","deletePerson","showSuccessToast","message","nameLabel","toast","simple","position","showErrorToast","confirmDialog","createBiographyArticle","articleTitleDialog","initialValue","titleP","articleP","createLinked","createBiography","personEditDialogFactory","PersonEditDialogController","addName","createName","altNames","deleteName","nameRoles","tasksRepoProvider","tasksRepoFactory","$resource","getAllTasks","taskResource","getTask","taskId","getWorkflow","workflowResource","getItems","stageId","options","itemResource","stage","start","max","transition","sourceStage","targetStage","result","itemId","comments","resp","provider","$get","TaskController","tasksRepo","tasks","openMenu","ShowTaskController","task","workflow","worklistPromises","stages","worklistPromise","fetchStage","focusItem","stopImmediatePropagation","entityId","transitionItem","updatedItem","worklists","stageOrder","ShowWorkController","workEditDialog","copyEditDialog","bcTitle","getTitle","getWorkLabel","refsEndpointUrl","editBibInfo","updatedWork","saveWork","addEdition","savePromise","saveEdition","addCopy","editCopy","copies","updatedCopy","deleteCopy","deleteWork","workLabel","subtitle","createBookReviewArticle","relationships","createBookReview","workEditDialogFactory","WorkEditDialogController","addAuthor","authorRef","deleteAuthor","addTitle","deleteTitle","ShowVolumeController","volumeEditDialog","getEdition","getVolume","workTitle","getVolumeLabel","updatedVolume","saveVolume","copyToEdition","origCopy","newCopy","volumeEditDialogFactory","VolumeEditDialogController","ShowEditionController","editionEditDialog","getEditionLabel","updatedEdition","addVolume","copyToWork","editionEditDialogFactory","EditionEditDialogController","MainController","q","searchQuery","peopleResults","worksResults","createPerson","createWork","debounce","runBlock","debug","run","routerConfig","$stateProvider","$urlRouterProvider","views","main","otherwise","constant","$logProvider","$mdThemingProvider","worksRepoProvider","peopleRepoProvider","articlesRepoProvider","relnRepoProvider","categorizationServiceProvider","seeAlsoRepoProvider","trcSearchProvider","debugEnabled","API_PREFIX","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","cslConfig","citeprocProvider","addLocale","filename","localeId","supplier","$http","res","data","addStyle","styleId","CSL_LOCALES","CSL_STYLES","en-US","mla","chicago","$templateCache","put"],"mappings":"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","file":"scripts/app-8a3dbf6f83.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ckeditor',\n      'ngMaterial',\n      'trcCore',\n      'trcBiblio',\n      'trcTasks',\n      'trcBio',\n      'trcReln',\n      'trcRefs',\n      'trcArticles',\n      'zotero'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('nameEditor', nameEditorDirective);\n\n  /** @ngInject */\n  function nameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/name-editor/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('eventEditor', eventEditorDirective);\n\n  /** @ngInject */\n  function eventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/event-editor/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('eventEditDialog', eventEditDialogFactory);\n\n  /** @ngInject */\n  function eventEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/components/event-edit-dialog/event-edit-dialog.html',\n        locals: {\n          event: event\n        },\n        controller: EventEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EventEditDialogController($mdDialog, event) {\n    var vm = this;\n\n    vm.event = event;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.event);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditorItem', workEditorItemDirective);\n\n  /** @ngInject */\n  function workEditorItemDirective($log) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/task/components/work-editor-item/work-editor-item.html',\n      link: linkFunc,\n      scope: {\n        id: '=id'\n      },\n      controller: WorkEditorItemController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc($scope) {\n      if (!$scope.id) {\n        $log.error('missing required attribute \"id\"');\n      }\n    }\n\n    /** @ngInject */\n    function WorkEditorItemController($scope, worksRepo) {\n      var vm = this;\n\n      vm.loaded = false;\n\n      activate();\n\n      function activate() {\n        if ($scope.id) {\n          vm.work = worksRepo.getWork($scope.id);\n          vm.work.$promise.then(function () {\n            vm.loaded = true;\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditor', workEditorDirective);\n\n  /** @ngInject */\n  function workEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/work-editor/work-editor.html',\n      scope: {\n        work: '=ngModel'\n      },\n      controller: WorkEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function WorkEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.editions = [];\n\n      vm.createEdition = createEdition;\n      vm.deleteEdition = deleteEdition;\n\n      activate();\n\n      function activate() {\n        $scope.work.editions.forEach(function (edition) {\n          vm.editions.push({\n            model: edition,\n            focused: false\n          });\n        });\n      }\n\n      function createEdition() {\n        var edition = worksRepo.createEdition();\n        edition.titles = _.cloneDeep($scope.work.titles);\n        edition.authors = _.cloneDeep($scope.work.authors);\n\n        $scope.work.editions.push(edition);\n        vm.editions.push({\n          model: edition,\n          focused: true\n        });\n      }\n\n      function deleteEdition(ix) {\n        vm.editions.splice(ix, 1);\n        $scope.work.editions.splice(ix, 1);\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('volumeEditor', volumeEditorDirective);\n\n  /** @ngInject */\n  function volumeEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/volume-editor/volume-editor.html',\n      scope: {\n        volume: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('editionEditor', editionEditorDirective);\n\n  /** @ngInject */\n  function editionEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/edition-editor/edition-editor.html',\n      scope: {\n        edition: '=ngModel'\n      },\n      controller: EditionEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function EditionEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.volumes = [];\n\n      vm.createVolume = createVolume;\n      vm.deleteVolume = deleteVolume;\n\n      activate();\n\n      function activate() {\n        $scope.edition.volumes.forEach(function (volume) {\n          vm.volumes.push({\n            model: volume,\n            focused: false\n          });\n        });\n      }\n\n      function createVolume() {\n        var volume = worksRepo.createVolume();\n        volume.titles = _.cloneDeep($scope.edition.titles);\n        volume.authors = _.cloneDeep($scope.edition.authors);\n        volume.publicationInfo = _.cloneDeep($scope.edition.publicationInfo);\n\n        $scope.edition.volumes.push(volume);\n        vm.volumes.push({\n          model: volume,\n          focused: true\n        });\n      }\n\n      function deleteVolume(ix) {\n        vm.volumes.splice(ix, 1);\n        $scope.edition.volumes.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('titleEditor', titleEditorDirective);\n\n  /** @ngInject */\n  function titleEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/title-editor/title-editor.html',\n      scope: {\n        title: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('relnEditDialog', relnEditDialogFactory);\n\n  /** @ngInject */\n  function relnEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event) {\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/reln-edit-dialog/reln-edit-dialog.html',\n        controller: RelationshipEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n\n    }\n  }\n\n  /** @ngInject */\n  function RelationshipEditDialogController($filter, $mdDialog, worksRepo, relnRepo) {\n    var stripTags = $filter('stripTags');\n    var vm = this;\n\n    vm.description = null;\n\n    vm.types = null;\n    vm.selectedType = null;\n\n    vm.searchText = null;\n    vm.selectedWork = null;\n\n    vm.anchors = null;\n    vm.selectedAnchor = null;\n\n    vm.search = search;\n    vm.selectWork = selectWork;\n    vm.close = close;\n    vm.cancel = cancel;\n\n    activate();\n\n    function activate() {\n      vm.types = getTypes();\n    }\n\n    function getTypes() {\n      var rawTypes = relnRepo.getTypes();\n      var types = [];\n\n      var typesP = rawTypes.$promise.then(function () {\n        angular.forEach(rawTypes, function (type) {\n          types.push({\n            id: type.identifier,\n            label: type.title,\n            directed: type.isDirected,\n            reverse: false\n          });\n\n          if (type.isDirected) {\n            types.push({\n              id: type.identifier,\n              label: type.reverseTitle,\n              directed: type.isDirected,\n              reverse: true\n            });\n          }\n        });\n\n        return types;\n      });\n\n\n      Object.defineProperty(types, '$promise', {\n        value: typesP\n      });\n\n      return types;\n    }\n\n    function search(query) {\n      var results = worksRepo.search(query);\n      return results.$promise.then(function () {\n        return results.items;\n      });\n    }\n\n    function selectWork(proxy) {\n      vm.anchors = [];\n\n      if (!proxy) {\n        return;\n      }\n\n      var baseLabel = stripTags(proxy.label);\n      var baseToken = proxy.ref.token;\n\n      // create default anchor for top-level work\n      vm.selectedAnchor = relnRepo.createAnchor(baseLabel, baseToken);\n      vm.anchors.push(vm.selectedAnchor);\n\n      var work = worksRepo.getWork(proxy.id);\n      work.$promise.then(function () {\n        work.editions.forEach(function (edition) {\n          // create anchor for each edition\n          var editionLabel = baseLabel + '. ' + edition.editionName;\n          vm.anchors.push(relnRepo.createAnchor(editionLabel, baseToken, {\n            editionId: [edition.id]\n          }));\n\n          edition.volumes.forEach(function (volume) {\n            // create anchor for each volume\n            var volumeLabel = editionLabel + '. Volume ' + volume.volumeNumber;\n            vm.anchors.push(relnRepo.createAnchor(volumeLabel, baseToken, {\n              editionId: [edition.id],\n              volumeId: [volume.id]\n            }));\n          });\n        });\n      });\n    }\n\n    function close() {\n      $mdDialog.hide({\n        typeId: vm.selectedType.id,\n        directed: vm.selectedType.directed,\n        reverse: vm.selectedType.reverse,\n        target: vm.selectedAnchor,\n        description: vm.description\n      });\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('relationships', {\n      templateUrl: 'app/work/components/relationships/relationships.html',\n      bindings: {\n        anchor: '<'\n      },\n      controller: RelationshipsController\n    });\n\n  // emulation of an enum\n  // HACK: this code is copied from the see-also-editor component\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n\n  /** @ngInject */\n  function RelationshipsController($scope, $state, $timeout, $mdDialog, $mdToast, _, relnRepo, relnEditDialog) {\n    var vm = this;\n\n    vm.typeGroups = null;\n\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    function openRelationship($event, reln) {\n      // HACK: only using first anchor\n      var anchor = reln.anchors[0];\n\n      var state = null;\n      var params = {};\n\n      switch(anchor.ref.type) {\n        case TypeId.WORK:\n          state = 'editor.work';\n          params.workId = anchor.ref.id;\n\n          if (anchor.properties.editionId) {\n            state = 'editor.edition';\n            params.editionId = anchor.properties.editionId;\n          }\n\n          if (anchor.properties.editionId && anchor.properties.volumeId) {\n            state = 'editor.volume';\n            params.volumeId = anchor.properties.volumeId;\n          }\n\n          break;\n        case TypeId.PERSON:\n          state = 'editor.person';\n          params.id = anchor.ref.id;\n          break;\n        case TypeId.ARTICLE:\n          state = 'article.edit';\n          params.id = anchor.ref.id;\n          break;\n        default:\n          break;\n      }\n\n      if (!state) {\n        $mdToast.showSimple('I don\\'t know how to follow that link.');\n      } else {\n        $state.go(state, params);\n      }\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialogPromise = relnEditDialog.show($event);\n      dialogPromise.then(function (relnInfo) {\n        relationship.typeId = relnInfo.typeId;\n        relationship.description = relnInfo.description;\n\n        /*\n        determine fields in which to place anchors...\n\n        directed | reverse || destination for self anchor | destination for selected anchor\n        ---------|---------||-----------------------------|--------------------------------\n        NO       | *       || \"related\"                   | \"related\"\n        YES      | YES     || \"targets\"                   | \"related\"\n        YES      | NO      || \"related\"                   | \"targets\"\n         */\n        if (!relnInfo.directed) {\n          relationship.related.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else if (relnInfo.reverse) {\n          relationship.targets.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else {\n          relationship.related.push(vm.anchor);\n          relationship.targets.push(relnInfo.target);\n        }\n\n        var saveP = relnRepo.save(relationship);\n        saveP.then(function () {\n          $mdToast.showSimple('Saved.');\n          // HACK give relationship a chance to save on the server\n          $timeout(loadRelationships, 1000);\n        });\n      });\n\n    }\n\n    function deleteRelationship($event, reln) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      confirmPromise.then(function () {\n        var deleteP = relnRepo.delete(reln.id);\n\n        deleteP.then(function () {\n          $mdToast.showSimple('Relationship deleted.');\n          // HACK give relationship a chance to be deleted from the server\n          $timeout(loadRelationships, 1000);\n        });\n      });\n    }\n\n    // PRIVATE METHODS\n\n    function activate() {\n      $scope.$watch('$ctrl.anchor', function (newAnchor) {\n        if (!newAnchor) {\n          return;\n        }\n\n        loadRelationships();\n      });\n    }\n\n    /**\n     * Loads relationships from the repository using the currently bound anchor.\n     * @return {Promise.<TypeGroup[]>}\n     */\n    function loadRelationships() {\n      vm.loading = true;\n      var relns = relnRepo.search(vm.anchor.ref, vm.anchor.properties);\n\n      var typeGroupsP = relns.$promise.then(function () {\n        vm.typeGroups = relnRepo.normalizeRelationships(relns, vm.anchor.ref);\n        return vm.typeGroups.$promise;\n      })\n\n      typeGroupsP.then(function () {\n        vm.loading = false;\n      }, function () {\n        vm.loading = false;\n      });\n\n      return typeGroupsP;\n    }\n  }\n\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('publicationInfoEditor', publicationInfoEditorDirective);\n\n  /** @ngInject */\n  function publicationInfoEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/publication-info-editor/publication-info-editor.html',\n      scope: {\n        pubInfo: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('copyEditor', copyEditorDirective);\n\n  /** @ngInject */\n  function copyEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/copy-editor/copy-editor.html',\n      scope: {\n        copy: '=ngModel'\n      },\n      controller: CopyEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function CopyEditorController($scope) {\n    var vm = this;\n\n    vm.refHandlers = {};\n    vm.setProperties = parseProperties;\n\n    activate();\n\n    function activate() {\n      addHandler(HathiTrustRefHandler());\n      addHandler(GoogleBooksRefHandler());\n      addHandler(InternetArchiveRefHandler());\n    }\n\n    function addHandler(handler) {\n      vm.refHandlers[handler.id] = handler;\n    }\n\n    function parseProperties(type, url) {\n      if (vm.refHandlers[type]) {\n        $scope.copy.properties = vm.refHandlers[type](url);\n      }\n\n      $scope.copyForm.url.$setValidity(type, $scope.copy.properties != null);\n    }\n  }\n\n  // https://archive.org/details/essayinanswertom00adamiala\n  // <iframe src='https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n7/mode/1up' width='480px' height='430px' frameborder='0' ></iframe>\n  // TODO add support for resources from OpenLibrary\n  // https://openlibrary.org/books/OL7186607M/An_essay_in_answer_to_Mr._Hume's_Essay_on_miracles.\n\n  /**\n   * A reference parse handler to support digital copies from the Internet\n   * Archive.\n   */\n  function InternetArchiveRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      if (parsed.path.substr(0, 8) === '/stream/') {\n        id = parsed.path.substr(8);\n\n        var pageNo = parsed.fragment.match(/page\\/([^\\/]+)/);\n        if (pageNo && pageNo.length >= 2) {\n          seq = pageNo[1];\n        }\n      }\n\n      return makePropertiesObject(url, id, seq);\n    }\n\n    handle.id = 'internetarchive';\n    handle.display = 'Internet Archive';\n\n    /**\n     * Constructs an object literal that represents the stored-properties\n     * to associate with an InternetArchive digital copy.\n     *\n     * @param  {string} src The source URL from which the properties were parsed.\n     * @param  {string} id  The identifier used to uniquely reference a\n     *                      particular digial copy at the Internet Archive.\n     * @param  {string} seq The sequence number that identifies the page to be\n     *                      used as the initial page of this digital copy.\n     * @return {object}     The object literal of properties to be associated\n     *                      with this digital copy.\n     */\n    function makePropertiesObject(src, id, seq) {\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: src,\n        id: id,\n        seq: seq\n      };\n    }\n\n    return handle;\n  }\n\n  function HathiTrustRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      switch (parsed.hostname) {\n        case 'babel.hathitrust.org':\n          id = parsed.query.id;\n          seq = parsed.query.seq;\n          break;\n\n        case 'hdl.handle.net':\n          id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1);\n\n          if (!parsed.query.urlappend) {\n            break;\n          }\n\n          var subquery = parseQueryString(parsed.query.urlappend);\n          if (!subquery) {\n            break;\n          }\n          seq = subquery.seq;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        htid: id,\n        seq: seq\n      };\n    }\n\n    handle.id = 'hathitrust';\n    handle.display = 'HathiTrust';\n\n    return handle;\n  }\n\n  function GoogleBooksRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      switch (parsed.hostname) {\n        case 'books.google.com':\n          var id = parsed.query.id;\n          var section = parsed.query.printsec;\n          var page = parsed.query.pg;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        id: id,\n        section: section,\n        page: page\n      };\n    }\n\n    handle.id = 'googlebooks';\n    handle.display = 'Google Books';\n\n    return handle;\n  }\n\n  /**\n   * Parses a URL string into its components\n   *\n   * @param  {string} url\n   * @return {URL}\n   */\n  function parseUrl(url) {\n    if (!url) {\n      return null;\n    }\n\n    // eslint-disable-next-line angular/document-service\n    var parser = document.createElement('a');\n    parser.href = url;\n\n    return {\n      toString: function() {\n        return url;\n      },\n      protocol: parser.protocol,\n      host: parser.host,\n      hostname: parser.hostname,\n      port: parser.port,\n      path: parser.pathname,\n      query: parseQueryString(parser.search),\n      fragment: parser.hash\n    };\n  }\n\n  /**\n   * Parses a query string into key/value pairs\n   *\n   * @param {string} query\n   * @return {object.<string,any>}\n   */\n  function parseQueryString(query, sep) {\n    if (!query || !angular.isString(query)) {\n      return {};\n    }\n\n    // remove leading '?'\n    if (query[0] === '?') {\n      query = query.substr(1);\n    }\n\n    // attempt to auto-detect separator\n    if (!sep) {\n      // auto-detection \"bitmask\"\n      // 0 = none detected -- prefer '&'\n      // 1 = only ';' detected -- use it\n      // 2 = only '&' detected -- use it\n      // 3 = both detected -- prefer '&'\n      var flags = (query.indexOf(';') >= 0 ? 1 : 0) + (query.indexOf('&') >= 0 ? 2 : 0);\n      sep = flags === 1 ? ';' : '&';\n    }\n\n    var parsed = {};\n\n    var kvpairs = query.split(sep);\n    kvpairs.forEach(function (pair) {\n      var ix = pair.indexOf('=');\n      var key = pair;\n      var value = null;\n\n      if (!key) {\n        return;\n      }\n\n      if (ix >= 0) {\n        key = pair.substr(0, ix);\n        value = pair.substr(ix + 1);\n      }\n\n      try {\n        key = decodeURIComponent(key);\n        value = decodeURIComponent(value);\n      } catch (URIError) {\n        return;\n      }\n\n      // TODO: handle key array/map notation\n\n      if (parsed.hasOwnProperty(key)) {\n        // convert repeated keys into an array\n        if (angular.isArray(parsed[key])) {\n          parsed[key].push(value);\n        } else {\n          parsed[key] = [parsed[key], value];\n        }\n      } else {\n        parsed[key] = value;\n      }\n    });\n\n    return parsed;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('copyEditDialog', copyEditDialogFactory);\n\n  /** @ngInject */\n  function copyEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, copy) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/copy-edit-dialog/copy-edit-dialog.html',\n        locals: {\n          copy: copy\n        },\n        controller: CopyEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function CopyEditDialogController($mdDialog, copy) {\n    var vm = this;\n\n    vm.copy = copy;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.copy);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('authorRefEditor', authorRefEditorDirective);\n\n  /** @ngInject */\n  function authorRefEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/author-ref-editor/author-ref-editor.html',\n      scope: {\n        ref: '=ngModel'\n      },\n      controller: AuthorRefEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function AuthorRefEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.linkAuthorSearchText = '';\n      vm.authorRoles = [\n        'author',\n        'editor',\n        'translator',\n        'other'\n      ];\n\n      vm.setLinkedAuthor = setLinkedAuthor;\n      vm.getResults = getResults;\n\n      activate();\n\n      function activate() {\n        if ($scope.ref.authorId) {\n          var author = peopleRepo.get($scope.ref.authorId);\n          author.$promise.then(function () {\n            vm.linkAuthorSearchText = author.name.label;\n          })\n        }\n      }\n\n      function setLinkedAuthor(person) {\n        $scope.ref.authorId = person.id;\n      }\n\n      function getResults(query) {\n        var resultSet = peopleRepo.search(query);\n        return resultSet.$promise.then(function () {\n          return resultSet.items;\n        });\n      }\n\n    }\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('sdaAdmin')\n      .directive('treeCategorizationEditor', treeCategorizationEditor);\n\n   /** @ngInject */\n   function treeCategorizationEditor() {\n      var directive = {\n         restrict: 'E',\n         templateUrl: 'app/admin/editors/articles/thematic-overview.html',\n         scope: {\n           scopeId: \"@\",\n           scheme: \"@\"\n          //  need param to indicate whether this categorization owns related entrties\n         },\n         controller: TreeCategorizationController,\n         controllerAs: 'vm'\n      };\n\n      return directive;\n   }\n\n   // NOTE this needs to move toward being a more general puropose control\n\n   /** @ngInject */\n   function TreeCategorizationController($scope, $log, $mdDialog, $mdToast, $state, $q,\n     articlesRepo, categorizationService) {\n\n     var vm = this;\n     var repo = null;\n\n     // TODO need to allow actions to be pluggable\n     vm.handleAssociateEntry = handleAssociateEntry;\n     vm.handleRemoveEntry = handleRemoveEntry;\n     vm.handleCreateChild = handleCreateChild;\n     vm.handleDeleteNode = handleDeleteNode;\n\n     activate();\n\n     //'overviews'\n     function activate() {\n       $log.info(\"Loading article editor\", articlesRepo);\n       repo = categorizationService.getScopedRepo($scope.scopeId);\n       // TODO need to handle case when this fails to load. Display throbber pending load\n       vm.overviews = repo.get($scope.scheme);\n     }\n\n     // TODO allow edit labels\n\n     /* ================================\n      * API METHODS\n      * ================================ */\n      function handleAssociateEntry($event, node) {\n        $log.info(\"creating article\");\n        // TODO need to offer option of create or link\n        // TODO magic string\n\n        var type = 'thematic';\n        var title = node.label;\n\n        // TODO  display prompt dialog, allow entry of title, selection of type (but not)\n        // TODO error handling!!\n        var article = articlesRepo.create(type, title);\n        var articlePromise = articlesRepo.save(article);\n        var linkPromise = articlePromise.then(linkArticle);\n\n        $q.all({\n          article: articlePromise,\n          ref: linkPromise\n        }).then(openEditor);\n\n        function linkArticle(article) {\n          var ref = repo.nodes.link(node, article.reference);\n          return ref.$promise;\n        }\n\n        function openEditor(values) {\n          $state.go(\"article.edit\", {\n            id: values.article.id\n          });\n        }\n        // TODO creates article and (once created) associates\n        //      that article with this node in the hierarchy.\n        //      On completion, opens that article in the editor.\n      }\n\n      function handleRemoveEntry($event, node) {\n        $log.info(\"Removing entry\", node);\n\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      If OK, removes the associated entry from this node\n        //      and then deletes the article.\n\n      }\n\n      /**\n       * Handler to be invoked to create a new category with an hierarchical\n       * categorization.\n       *\n       * @param  {event} $event  The event that triggered this request.\n       * @param  {object} parent The parent node on which the child should be created.\n       * @return {[type]}        [description]\n       */\n      function handleCreateChild($event, parent) {\n        $log.info(parent);\n\n        var newCategoryDialog = $mdDialog.prompt({\n          title: \"Enter Category Label\",\n          // TODO add description\n          placeholder: 'new category',\n          ok: \"Create\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(newCategoryDialog)\n                 .then(onCreate);\n\n        function onCreate(label) {\n          $log.info(\"Creating category \" + label);\n\n          repo.nodes.create(parent, label);\n        }\n      }\n\n      function handleDeleteNode($event, node, parent) {\n        $log.info(node);\n\n        var title = \"Delete category '\" + node.label + \"'\";\n        var msg = \"<p>This will delete the selected category, \" + node.label + \", \" +\n                  \"its sub-categories and all associated articles.\" +\n                  \"<em>This action cannot be undone.</em></p>\" +\n                  \"<p>Permanently delete this category?</p>\";\n        var removeCatgorizationDialog = $mdDialog.confirm({\n          title: title,\n          htmlContent: msg,\n          ok: \"Delete\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(removeCatgorizationDialog).then(function() {\n           // TODO dispaly success/failure toasts\n           repo.nodes.remove(node, true, parent).then(function () {\n             return 'category deleted';\n           }, function () {\n             return 'unable to delete category';\n           })\n           .then(function (msg) {\n             $mdToast.showSimple(msg);\n           });\n         });\n\n\n        function deleteNode() {\n        }\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      Recursively removes all articles associated with descendants\n        //      Removes this categorization entry (and children)\n      }\n\n      /* ================================\n       * PRIVATE METHODS\n       * ================================ */\n\n       function getChildren(node) {\n         if (node.childIds.length != node.chilren.length) {\n           throw new Error(\"Lazy loading of children not yet supported.\");\n         }\n\n         return $q.when(node.chilren);\n       }\n\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n// TODO admin-page-articles\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorSectionController', ArticleEditorSectionController);\n\n  /** @ngInject */\n  function ArticleEditorSectionController(articlesRepo, $log, categorizationService) {\n    var vm = this;\n    //\n    // vm.handleAssociateEntry = handleAssociateEntry;\n    // vm.handleRemoveEntry = handleRemoveEntry;\n    // vm.handleCreateChild = handleCreateChild;\n    // vm.handleDeleteNode = handleDeleteNode;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo);\n      // var repo = categorizationService.getScopedRepo('default');\n      // vm.overviews = repo.get('overviews');\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n\n    //  function handleAssociateEntry($event) {\n    //    $log(\"creating article\");\n     //\n    //  }\n     //\n    //  function handleRemoveEntry($event, node) {\n    //    $log.info(node);\n    //  }\n    //  function handleCreateChild($event, node) {\n    //    $log.info(node);\n    //  }\n    //  function handleDeleteNode($event, node) {\n    //    $log.info(node);\n    //  }\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorController', ArticleEditorController);\n\n  var CKEDITOR_CONFIG = {\n    toolbarGroups: [\n      { name: 'styles', groups: [ 'styles' ] },\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n      { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n      { name: 'colors', groups: [ 'colors' ] },\n      { name: 'links', groups: [ 'links' ] },\n      { name: 'insert', groups: [ 'insert' ] },\n      { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },\n      { name: 'forms', groups: [ 'forms' ] },\n      { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },\n      { name: 'tools', groups: [ 'tools' ] },\n      { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },\n      { name: 'others', groups: [ 'others' ] },\n    ],\n\n    // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n    format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address',\n\n    extraPlugins: 'mathjax',\n\n    mathJaxLib: '//cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-MML-AM_CHTML'\n  };\n\n  /** @ngInject */\n  function ArticleEditorController($q, $log, $stateParams, $scope, $mdBottomSheet, articlesRepo, refsRepoFactory) {\n    var refsRepoUrl = articlesRepo.getReferencesEndpoint($stateParams.id);\n    var refsRepo = refsRepoFactory.getRepo(refsRepoUrl);\n\n    var vm = this;\n\n    vm.save = save;\n    vm.cancel = cancel;\n    vm.body = \"test\";\n\n    vm.abstractEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'HorizontalRule',\n          'Maximize',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editFootnote = editFootnote;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo)\n\n      vm.article = articlesRepo.get($stateParams.id);\n      vm.references = refsRepo.get();\n\n      $q.all([vm.article.$promise, vm.references.$promise]).then(function () {\n        // start watching for opportunities to remove unused citations and footnotes\n        $scope.$watch('vm.article.body', cleanArticleHandler);\n        $scope.$watchCollection('vm.article.footnotes', cleanRefsHandler);\n      });\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n     function save() {\n        articlesRepo.save(vm.article);\n        refsRepo.save(vm.references);\n     }\n\n     function cancel() {\n       alert('cancel');\n     }\n\n     /**\n      * Displays a bottom sheet to edit an existing footnote.\n      * Delegates to the edit dialog in ckeditor-footnotes component, which should probably be refactored elsewhere.\n      * @param  {MouseEvent} $event\n      * @param  {Footnote} footnote\n      */\n     function editFootnote($event, footnote) {\n       var newFootnote = angular.copy(footnote);\n       var newReferences = refsRepoFactory.createRefCollection();\n\n       var config = {\n         templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n         controller: 'FootnoteEditDialogController',\n         controllerAs: 'vm',\n         clickOutsideToClose: false,\n         locals: {\n           footnote: newFootnote,\n           references: newReferences\n         }\n       };\n\n       var promise = $mdBottomSheet.show(config);\n\n       promise.then(function () {\n         vm.article.footnotes[newFootnote.id] = newFootnote;\n\n         // update bibliography\n         var updatedReferences = refsRepoFactory.merge(vm.references, refsRepoFactory.compact(newReferences));\n         angular.merge(vm.references, updatedReferences);\n       });\n     }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n\n     function cleanRefsHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanReferences(vm.article, vm.references);\n       vm.references = refsRepo.compact(vm.references);\n     }\n\n     function cleanArticleHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanFootnotes(vm.article, vm.article.footnotes);\n       cleanRefsHandler(obj);\n     }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero', [\n      'ngAnimate',\n      'ngAria',\n      'ngMaterial',\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .controller('ZoteroTestController', ZoteroTestController);\n\n  /** @ngInject */\n  function ZoteroTestController() {\n    var vm = this;\n\n    vm.item = {};\n\n    vm.types = [];\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('summaryEditor', summaryEditorDirective);\n\n  /** @ngInject */\n  function summaryEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/summary-editor/summary-editor.html',\n      scope: {\n        summary: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.config = {\n        // FIXME set up minimal toolbar and restrict HTML content\n        toolbarGroups: [\n          { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n          { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n          { name: 'links', groups: [ 'links' ] },\n          { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n        ],\n\n        removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles'\n      };\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('summaryEditDialog', summaryEditDialogFactory);\n\n  /** @ngInject */\n  function summaryEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, summary) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          summary: summary\n        },\n        controller: SummaryEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function SummaryEditDialogController($mdDialog, summary) {\n    var vm = this;\n\n    vm.summary = summary;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.summary);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('stripTags', stripTagsFilter);\n\n  function stripTagsFilter() {\n    return stripTags;\n  }\n\n  function stripTags(html) {\n    return html ? String(html).replace(/<[^>]+>/gm, '') : '';\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .animation('.slide', slideToggle);\n\n  function slideToggle() {\n    var NG_HIDE_CLASS = 'ng-hide';\n\n    return {\n      beforeAddClass: beforeAddClass,\n      removeClass: removeClass\n    };\n\n    function beforeAddClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.slideUp(done);\n      }\n    }\n\n    function removeClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.hide().slideDown(done);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('seeAlsoEditor', {\n      templateUrl: 'app/components/see-also-editor/see-also-editor.html',\n      bindings: {\n        sourceToken: '<'\n      },\n      controller: SeeAlsoEditorController\n    });\n\n  // emulation of an enum\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n  var UNIFIED_SEARCH_KEYS = ['people', 'works', 'articles'];\n\n  /** @ngInject */\n  function SeeAlsoEditorController($scope, $state, $mdDialog, $mdToast, _, seeAlsoRepo, trcSearch) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.seeAlso = null;\n\n    vm.searchText = null;\n    vm.selectedItem = null;\n\n    vm.createLink = createLink;\n    vm.openLink = openLink;\n    vm.deleteLink = deleteLink;\n    vm.search = search;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    /**\n     * Creates a new see-also link with the current token as the source\n     * and the given anchor as the target.\n     * @param {Anchor} anchor\n     */\n    function createLink(anchor) {\n      if (alreadyLinked(anchor)) {\n        $mdToast.showSimple('Item has already been linked.');\n        clearLinkForm();\n        return;\n      }\n\n      var link = seeAlsoRepo.create(vm.sourceToken, anchor.token);\n\n      link.$promise.then(function () {\n        // HACK: link to target comes back as source field\n        var anchor = link.source;\n        if (!vm.seeAlso.links.hasOwnProperty(anchor.type)) {\n          vm.seeAlso.links[anchor.type] = [];\n        }\n\n        vm.seeAlso.links[anchor.type].push(anchor);\n\n        clearLinkForm();\n\n        $mdToast.showSimple('Link created');\n      }, function () {\n        $mdToast.showSimple('Unable to create link');\n      });\n    }\n\n    /**\n     * Redirects the browser to the editor page for the item referenced by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function openLink($event, anchor) {\n      switch(anchor.type) {\n        case TypeId.WORK:\n          $state.go('editor.work', { workId: anchor.id });\n          break;\n        case TypeId.PERSON:\n          $state.go('editor.person', { id: anchor.id });\n          break;\n        case TypeId.ARTICLE:\n          $state.go('article.edit', { id: anchor.id });\n          break;\n        default:\n          $mdToast.showSimple('I don\\'t know how to follow that link.');\n          break;\n      }\n    }\n\n    /**\n     * Reoves the see-also link targeted by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function deleteLink($event, anchor) {\n      var dialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        htmlContent: 'Are you sure you want to delete this link?' + anchor.label,\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmP = $mdDialog.show(dialog);\n\n      confirmP.then(function () {\n        var deleteP = seeAlsoRepo.delete(vm.sourceToken, anchor.token);\n\n        deleteP.then(function () {\n          $mdToast.showSimple('Link deleted');\n          var ix = vm.seeAlso.links[anchor.type].indexOf(anchor);\n          if (ix >= 0) {\n            vm.seeAlso.links[anchor.type].splice(ix, 1);\n          }\n        }, function () {\n          $mdToast.showSimple('Unable to delete link');\n        })\n      });\n    }\n\n    /**\n     * Searches all entries matching the provided query.\n     * @param  {string} query\n     * @return {Promise.<Anchor[]>}\n     */\n    function search(query) {\n      var results = trcSearch.search(query);\n      return results.$promise.then(combineSearchResults);\n    }\n\n    // PRIVATE METHODS\n\n    /**\n     * Initializes controller state\n     */\n    function activate() {\n      $scope.$watch('$ctrl.sourceToken', function (newToken) {\n        if (!newToken) {\n          return;\n        }\n\n        vm.loading = true;\n        vm.seeAlso = seeAlsoRepo.get(newToken);\n        vm.seeAlso.$promise.then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    /**\n     * Determines whether the proided anchor has already been linked with the current token.\n     * @param {Anchor} anchor\n     * @return {boolean}\n     */\n    function alreadyLinked(anchor) {\n      return vm.seeAlso.links.hasOwnProperty(anchor.type) && vm.seeAlso.links[anchor.type].some(function (existing) {\n        return existing.token === anchor.token;\n      });\n    }\n\n    /**\n     * Clears the new link input form.\n     */\n    function clearLinkForm() {\n      vm.searchText = null;\n      vm.selectedItem = null;\n    }\n\n    /**\n     * Combines unified search results into a homogeneous list of anchors.\n     * @param {UnifiedSearchResult} results\n     * @return {Anchor[]}\n     */\n    function combineSearchResults(results) {\n      return _.flatMap(UNIFIED_SEARCH_KEYS, function (key) {\n        return results.results[key].map(function (item) {\n          return {\n            label: item.label || item.title,  // article search results don't have a 'label' attribute\n            type: item.ref.type,\n            token: item.ref.token\n          };\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('navbar', {\n      templateUrl: 'app/components/navbar/navbar.html',\n      bindings: {\n        title: '@',\n        sidenavId: '@?'\n      },\n      controller: NavbarController\n    });\n\n  /** @ngInject */\n  function NavbarController($mdSidenav) {\n    var vm = this;\n\n    vm.toggleSidenav = toggleSidenav;\n\n    activate();\n\n    function activate() {\n\n    }\n\n    function toggleSidenav(id) {\n      $mdSidenav(id).toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  /**\n  * Formats ranked by precedence to check for when parsing date strings.\n  *\n  * NOTE: dashes can be any number of non-alphanumeric characters, so 'DD-MM-YYYY' parses\n  *       '02/02/2015', '02.02.2015', '02:02,2015', and '02*#!02   ^^^2015' into '02-02-2015'\n  *\n  * @type {Array}\n  */\n  var INFER_FORMATS = [\n    // year\n    'YYYY',             // e.g. 2015\n\n    // month year\n    'MMMM-YYYY',        // e.g. February 2015\n    'MMM-YYYY',         // e.g. Feb. 2015\n    'MM-YYYY',          // e.g. 02/2015\n    'M-YYYY',           // e.g. 2/2015\n\n    // year month\n    'YYYY-MMMM',        // e.g. 2015 February\n    'YYYY-MMM',         // e.g. 2015 Feb.\n    'YYYY-MM',          // e.g. 2015-02\n    'YYYY-M',           // e.g. 2015-2\n\n    // month day year\n    'MMMM-DD-YYYY',     // e.g. February 02, 2015\n    'MMM-DD-YYYY',      // e.g. Feb. 02, 2015\n    'MM-DD-YYYY',       // e.g. 02/02/2015\n    'M-DD-YYYY',        // e.g. 2/02/2015\n    'MMMM-D-YYYY',      // e.g. February 2, 2015\n    'MMM-D-YYYY',       // e.g. Feb. 2, 2015\n    'MM-D-YYYY',        // e.g. 02-2-2015\n    'M-D-YYYY',         // e.g. 2/2/2015\n\n    // day month year\n    'DD-MMMM-YYYY',     // e.g. 02 February 2015\n    'DD-MMM-YYYY',      // e.g. 02 Feb. 2015\n    'DD-MM-YYYY',       // e.g. 02/02/2015\n    'DD-M-YYYY',        // e.g. 02/2/2015\n    'D-MMMM-YYYY',      // e.g. 2 February 2015\n    'D-MMM-YYYY',       // e.g. 2 Feb. 2015\n    'D-MM-YYYY',        // e.g. 2/02/2015\n    'D-M-YYYY',         // e.g. 2/2/2015\n\n    // year month day\n    'YYYY-MM-DD',       // e.g. 2015-02-02\n    'YYYY-M-D'          // e.g. 2015-2-2\n  ];\n\n  angular\n    .module('sdaAdmin')\n    .factory('guessDate', guessDateFactory);\n\n  /** @ngInject */\n  function guessDateFactory(moment) {\n    return guessDate;\n\n    /**\n     * Parse a date string into a Moment.\n     *\n     * See moment.js\n     *\n     * @param  {string} str Date string to parse\n     * @return {Moment}     Parsed moment\n     */\n    function guessDate(str) {\n        return moment(str, INFER_FORMATS);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('empty', emptyFilterFactory);\n\n  /** @ngInject */\n  function emptyFilterFactory(_) {\n    return _.isEmpty;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('dateEditor', dateEditorDirective);\n\n  /** @ngInject */\n  function dateEditorDirective(guessDate) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/date-editor/date-editor.html',\n      scope: {\n        date: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      // indicates whether the current value in the date.calendar field was automatically set\n      scope.calendarAutoSet = false;\n\n      scope.$watch('date.description', function (dateDescription) {\n        if (dateDescription && (!scope.date.calendar || scope.calendarAutoSet)) {\n          scope.date.calendar = guessDate(dateDescription).format('YYYY-MM-DD');\n          scope.calendarAutoSet = true;\n        }\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('DataContainerController', DataContainerController);\n\n\n  /** @ngInject */\n  function DataContainerController() {\n    var vm = this;\n    var listeners = [];\n\n    vm.watch = watch;\n    vm.set = set;\n    vm.value = null;\n\n    /**\n     * Attach a listener to watch for value changes\n     * @param  {Function} fn listener callback\n     * @return {Function} unregister function\n     */\n    function watch(fn) {\n      listeners.push(fn);\n      fn(vm.value);\n      return unregister;\n\n      function unregister() {\n        var ix = listeners.indexOf(fn);\n        if (ix >= 0) {\n          listeners.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Updates internal value\n     * @param {*} newValue\n     */\n    function set(newValue) {\n      if (vm.value === newValue) {\n        return;\n      }\n\n      vm.value = newValue;\n\n      listeners.forEach(function (fn) {\n        fn(newValue);\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('FootnoteEditDialogController', FootnoteEditDialogController);\n\n  /** @ngInject */\n  function FootnoteEditDialogController($mdBottomSheet, footnote, references) {\n    var vm = this;\n\n    vm.footnote = footnote;\n    vm.references = references;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdBottomSheet.hide();\n    }\n\n    function cancel() {\n      $mdBottomSheet.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorFootnotes', ckeditorFootnotesDirective);\n\n  /** @ngInject */\n  function ckeditorFootnotesDirective($document, $mdBottomSheet, articlesRepo, refsRepoFactory) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorFootnotes', '?ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var anchorIdPrefix = attrs.ckeditorFootnotesAnchorIdPrefix || 'fn_anchor_';\n\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n      var ckeditorBibliography = requires[2];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorFootnotes;\n\n      // capture footnotes reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (footnotes) {\n        if (ctrl.value !== footnotes) {\n          ctrl.set(footnotes);\n        }\n      });\n\n      var FOOTNOTE_COMMAND_NAME = 'insertFootnote';\n      editor.addCommand(FOOTNOTE_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        requiredContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        exec: insertFootnoteCommand\n      });\n\n      editor.ui.addButton('Footnote', {\n        label: 'Insert Footnote',\n        command: FOOTNOTE_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertFootnoteCommand(editor) {\n        var command = this;\n\n        // create a new footnote object to edit.\n        var newFootnote = articlesRepo.createFootnote();\n        newFootnote.backlinkId = anchorIdPrefix + newFootnote.id;\n\n        var newReferences = ckeditorBibliography ? refsRepoFactory.createRefCollection() : null;\n\n        var config = {\n          templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n          controller: 'FootnoteEditDialogController',\n          controllerAs: 'vm',\n          clickOutsideToClose: false,\n          locals: {\n            footnote: newFootnote,\n            references: newReferences\n          }\n        };\n\n        var promise = $mdBottomSheet.show(config);\n\n        promise.then(function () {\n          ctrl.value[newFootnote.id] = newFootnote;\n\n          // update bibliography if provided\n          if (newReferences && ckeditorBibliography) {\n            var updatedReferences = refsRepoFactory.merge(ckeditorBibliography.value, refsRepoFactory.compact(newReferences));\n            angular.merge(ckeditorBibliography.value, updatedReferences);\n          }\n\n          editor.insertHtml('<sup contenteditable=\"false\" class=\"footnote\" id=\"' + newFootnote.backlinkId + '\" data-footnote=\"' + newFootnote.id + '\">#</a>');\n          done();\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: FOOTNOTE_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorBibliography', ckeditorBibliographyDirective);\n\n  /** @ngInject */\n  function ckeditorBibliographyDirective($mdDialog, $document, refsRepoFactory, refsRenderer, citationEditDialog) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorBibliography;\n\n      // capture bibliography reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (refs) {\n        if (ctrl.value !== refs) {\n          ctrl.set(refs);\n        }\n      });\n\n      var CITATION_COMMAND_NAME = 'insertCitation';\n      editor.addCommand(CITATION_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'cite[id,contenteditable]',\n        requiredContent: 'cite[id,contenteditable]',\n        exec: insertCitationCommand\n      });\n\n      editor.ui.addButton('Citation', {\n        label: 'Insert Citation',\n        command: CITATION_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertCitationCommand(editor) {\n        var command = this;\n\n        // create citation object with its own ref collection for editing\n        var newReference = refsRepoFactory.createRefCollection();\n        var citation = refsRepoFactory.createCitation();\n        newReference.citations[citation.id] = citation;\n\n        citationEditDialog.show(newReference).then(function () {\n          var updatedReferences = refsRepoFactory.merge(ctrl.value, refsRepoFactory.compact(newReference));\n          angular.merge(ctrl.value, updatedReferences);\n\n          refsRenderer.render('modern-language-association', newReference).then(function (rendered) {\n            var label = rendered.citations[citation.id];\n            editor.insertHtml('<cite id=\"' + citation.id + '\" contenteditable=\"false\">' + label + '</cite>')\n            done();\n          });\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: CITATION_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n/**\n * @typedef ItemContainer\n * @type {object}\n * @property {string} id\n * @property {string} label\n * @property {BiblioItem} item\n */\n\n(function () {\n  'use strict';\n\n  var LOCATOR_TYPES = [\n    'book', 'chapter', 'column', 'figure', 'folio', 'issue', 'line', 'note', 'opus', 'page',\n    'paragraph', 'part', 'section', 'sub verbo', 'verse', 'volume'\n  ];\n\n  var ZOTERO_USER_ACCOUNT_ID = '2536190';\n  var ZOTERO_USER_ACCOUNT_API_KEY = '3A4q05BNg0h0bHKJkpoCi1Oa';\n  var ZOTERO_GROUP_ID = '381134';\n\n  angular\n    .module('sdaAdmin')\n    .component('citationEditor', {\n      templateUrl: 'app/components/citation-edit-dialog/citation-editor.html',\n      controller: CitationEditorController,\n      bindings: {\n        references: '=',\n        citation: '='\n      }\n    });\n\n  /** @ngInject */\n  function CitationEditorController($filter, $q, $log, $mdDialog, zotero, _, refsRepoFactory, refsRenderer) {\n    var vm = this;\n\n    // referenced item autocomplete models\n    vm.selectedBiblioItem = null;\n    vm.searchText = '';\n\n    vm.locatorTypes = LOCATOR_TYPES;\n\n    vm.activeCitationItem = {};\n\n    vm.groupLibraryP = null;\n\n    vm.zoteroItem = null\n\n    vm.search = search;\n    vm.addCitationItem = addCitationItem;\n    vm.selectBiblioItem = selectBiblioItem;\n    vm.edit = editCitationItem;\n    vm.createZoteroItem = createZoteroItem;\n    vm.cancelZoteroItem = cancelZoteroItem;\n    vm.saveZoteroItem = saveZoteroItem;\n\n    var stripTags = $filter('stripTags');\n\n    activate();\n\n    function activate() {\n      var account = zotero.getUserAccount(ZOTERO_USER_ACCOUNT_ID, ZOTERO_USER_ACCOUNT_API_KEY);\n\n      // account.getGroup and account.getLibrary return native Promises.\n      // we wrap them in $q promises for consistency\n      var groupP = $q.when(account.getGroup(ZOTERO_GROUP_ID));\n      vm.groupLibraryP = groupP.then(function (group) {\n        return $q.when(account.getLibrary(group));\n      });\n\n      if (!vm.citation) {\n        throw new Error('no citation provided');\n      }\n\n      if (!vm.references.citations[vm.citation.id]) {\n        $log.warn('Citation is not a member of the provided reference collection. Adding to collection...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      } else if (vm.references.citations[vm.citation.id] !== vm.citation) {\n        $log.warn('provided citation does not match citation in reference collection. Overriding...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      }\n    }\n\n    /**\n     * Provides autocomplete items\n     * @param  {string} query\n     * @return {Promise.<ItemContainer[]>}\n     */\n    function search(query) {\n      return vm.groupLibraryP.then(function (library) {\n        // library.searchItems returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        var resultsP = $q.when(library.searchItems(query))\n        return resultsP.then(function (items) {\n          return $q.all(items.map(adaptItem).map(wrapItem));\n        });\n      });\n    }\n\n    /**\n     * Adapts a ZoteroItem for use in the autocomplete field and citation metadata\n     * @param  {ZoteroItem} zItem\n     * @return {BiblioItem}\n     */\n    function adaptItem(zItem) {\n      var id = 'zotero/' + zItem.library.id + '/' + zItem.id;\n\n      var item = refsRepoFactory.createBiblioItem(id);\n      item.type = zItem.type;\n      item.creators = zItem.properties.creators.map(adaptCreator);\n\n      // NOTE: this omits a lot of metadata fields... need to decide what other metadata (if any) to keep.\n\n      item.meta = angular.extend(\n        _.pick(zItem.meta, ['creatorSummary', 'parsedDate']),\n        _.pick(zItem.properties, ['key', 'dateAdded', 'dateModified'])\n      );\n\n      item.fields = _.omit(zItem.properties, [\n        // these properties are extracted to the top-level item\n        'creators', 'itemType',\n        // these properties are extracted to metadata\n        'key', 'dateAdded', 'dateModified',\n        // these properties are just forgotten\n        'version', 'collections', 'tags', 'relations'\n      ]);\n\n      return item;\n    }\n\n    /**\n     * Adapts a Zotero creator for use in the BiblioItem TRC-local type\n     * @param  {ZoteraCreator}\n     * @return {Creator}\n     */\n    function adaptCreator(zCreator) {\n      return {\n        role: zCreator.creatorType,\n        firstName: zCreator.firstName,\n        lastName: zCreator.lastName,\n        name: zCreator.name\n      };\n    }\n\n    /**\n     * Wraps a BiblioItem for use in the autocomplete field and citation metadata\n     * @param  {BiblioItem} item\n     * @return {Promise.<ItemContainer>}\n     */\n    function wrapItem(item) {\n      var labelP = refsRenderer.renderBiblioItem('modern-language-association', item);\n\n      return labelP.then(function (label) {\n        return {\n          id: item.id,\n          label: label,\n          item: item\n        };\n      });\n    }\n\n    /**\n     * Appends the given citation item to the citation\n     * @return {CitationItem}\n     */\n    function addCitationItem(citationItem) {\n      if (vm.citation.items.indexOf(citationItem) < 0) {\n        // new item\n        vm.citation.items.push(citationItem);\n      } else {\n        // edited existing item in-place\n      }\n\n      // set/update label\n      var referencedBibItem = vm.references.bibliography[citationItem.id];\n      renderCitationItemLabel(citationItem, referencedBibItem).then(function (label) {\n        citationItem.label = label;\n      });\n\n      // clear active item and start editing a new one\n      clearForm();\n    }\n\n    /**\n     * Sets the current citation item's referent id to the given item's id and\n     * adds the given item to the bibliography\n     * @param {ItemContainer} itemContainer\n     */\n    function selectBiblioItem(itemContainer) {\n      if (itemContainer) {\n        vm.activeCitationItem.id = itemContainer.id;\n        vm.references.bibliography[itemContainer.id] = itemContainer.item;\n      } else {\n        vm.activeCitationItem.id = null;\n      }\n    }\n\n    /**\n     * Sets the given citation item as the item being actively edited\n     * @param {CitationItem} item\n     */\n    function editCitationItem(citationItem) {\n      var biblioItem = vm.references.bibliography[citationItem.id];\n      return wrapItem(biblioItem).then(function (biblioItemContainer) {\n        vm.activeCitationItem = citationItem;\n        vm.selectedBiblioItem = biblioItemContainer;\n        vm.searchText = stripTags(vm.selectedBiblioItem.label);\n      });\n    }\n\n    /**\n     * Resets the model behind the citation item form\n     */\n    function clearForm() {\n      vm.activeCitationItem = {};\n      vm.searchText = '';\n      vm.selectedBiblioItem = null;\n    }\n\n    /**\n     * Renders a label for a single citation item\n     * @praam {CitationItem} citationItem\n     * @param {ZoteroItem} biblioItem Corresponding bibliographic item\n     * @return {Promise.<string>}\n     */\n    function renderCitationItemLabel(citationItem, biblioItem) {\n      // create a singleton citation for the citation item\n      var citation = refsRepoFactory.createCitation();\n      citation.items.push(citationItem);\n\n      // create a singleton reference for the singleton citation\n      var reference = refsRepoFactory.createRefCollection();\n      reference.citations[citation.id] = citation;\n      reference.bibliography[citationItem.id] = biblioItem;\n\n      var renderedP = refsRenderer.render('modern-language-association', reference);\n\n      return renderedP.then(function (rendered) {\n        return rendered.citations[citation.id];\n      });\n    }\n\n    function createZoteroItem() {\n      vm.zoteroItem = {};\n    }\n\n    function cancelZoteroItem() {\n      vm.zoteroItem = null;\n    }\n\n    function saveZoteroItem($event, item) {\n      var zItemP = vm.groupLibraryP.then(function (library) {\n        // library.saveItem returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        return $q.when(library.saveItem(item));\n      });\n\n      var biblioItemP = zItemP.then(adaptItem);\n\n      var itemContainerP = biblioItemP.then(wrapItem);\n\n      itemContainerP.then(function (item) {\n        vm.selectedBiblioItem = item;\n        selectBiblioItem(item);\n        vm.searchText = stripTags(item.label);\n        vm.zoteroItem = null;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('citationEditDialog', CitationEditDialogFactory);\n\n  /** @ngInject */\n  function CitationEditDialogFactory($mdDialog, _, refsRepoFactory) {\n    return {\n      show: show\n    };\n\n    /**\n     * Displays the edit dialog.\n     * @param  {ReferenceCollection} references\n     * @param  {Citation} [citation]\n     * @param  {MouseEvent} [$event]\n     * @return {Promise.<ReferenceCollection>}\n     */\n    function show(references, citation, $event) {\n      if (!citation) {\n        var citations = _.values(references.citations);\n\n        if (citations.length === 0) {\n          citation = refsRepoFactory.createCitation();\n          references.citations[citation.id] = citation;\n        } else {\n          citation = citations[0];\n        }\n      } else if (angular.isString(citation)) {\n        citation = references.citations[citation];\n      }\n\n      if (!citation) {\n        throw new Error('Unable to find a suitable citation. Please pass one explicitly or check that the reference collection is not malformed');\n      }\n\n      var config = {\n        targetEvent: $event,\n        templateUrl: 'app/components/citation-edit-dialog/citation-edit-dialog.html',\n        controller: 'CitationEditDialogController',\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          references: references,\n          citation: citation\n        }\n      };\n\n      return $mdDialog.show(config).then(function () {\n        return references;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('CitationEditDialogController', CitationEditDialogController);\n\n  /** @ngInject */\n  function CitationEditDialogController($mdDialog, references, citation) {\n    var vm = this;\n\n    vm.references = references;\n    vm.citation = citation;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdDialog.hide();\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroEditor', {\n      templateUrl: 'app/zotero/editor.html',\n      controller: ZoteroEditorController,\n      bindings: {\n        item: '=',\n        typeFilter: '<types'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroEditorController(zotero) {\n    var vm = this;\n\n    vm.itemTypeSearchText = '';\n    vm.itemType = null;\n\n    vm.types = [];\n    vm.fields = [];\n    vm.roles = [];\n\n    vm.selectType = selectType;\n\n    activate();\n\n    function activate() {\n      zotero.getItemTypes().then(function (types) {\n        vm.types = (vm.typeFilter && vm.typeFilter.length > 0)\n          ? types.filter(function (field) {\n              return vm.typeFilter.indexOf(field.id) >= 0;\n            })\n          : types;\n      });\n\n      if (!vm.item.creators) {\n        vm.item.creators = [{}];\n      }\n\n      if (vm.item.creators.length === 0) {\n        vm.item.creators.push({});\n      }\n    }\n\n    function selectType(itemType) {\n      if (!itemType) {\n        vm.item.itemType = null;\n        vm.fields = [];\n        vm.roles = [];\n        return;\n      }\n\n      vm.item.itemType = itemType.id;\n\n      itemType.getFields().then(function (fields) {\n        vm.fields = fields;\n      });\n\n      itemType.getCreatorRoles().then(function (roles) {\n        vm.roles = roles;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroCreatorField', {\n      templateUrl: 'app/zotero/creator-field.html',\n      controller: ZoteroCreatorFieldController,\n      bindings: {\n        creator: '=',\n        roles: '<'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroCreatorFieldController() {\n  }\n\n})();\n\n/*global zotero:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .factory('zotero', ZoteroFactory);\n\n  /** @ngInject */\n  function ZoteroFactory() {\n    return new zotero(zotero.getDefaultBaseUrl(), angular.toJson);\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowPersonController', ShowPersonController);\n\n  /** @ngInject */\n  function ShowPersonController(peopleRepo, refsRepoFactory, articlesRepo, $log, $state, $stateParams, $mdDialog, $mdToast, _, personEditDialog, eventEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.person = null;\n\n    vm.editBioInfo = editBioInfo;\n    vm.editEvent = editEvent;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.createBiography = createBiographyArticle;\n    vm.deletePerson = deletePerson;\n\n    activate();\n\n    function activate() {\n      var personId = $stateParams.id;\n\n      var personRefsUrl = peopleRepo.getReferencesEndpoint(personId);\n      refsRepo = refsRepoFactory.getRepo(personRefsUrl);\n\n      vm.person = peopleRepo.get(personId);\n      vm.references = refsRepo.get();\n\n      vm.references.$promise.then(function () {\n        var citations = _.values(vm.references.citations);\n\n        if (citations.length === 0) {\n          vm.citation = refsRepo.createCitation();\n          vm.references.citations[vm.citation.id] = vm.citation;\n        } else {\n          if (citations.length > 1) {\n            $log.warn('reference collection contains ' + citations.length + ' citations');\n          }\n          vm.citation = citations[0];\n        }\n      })\n    }\n\n    function editBioInfo($event) {\n      var dialogPromise = personEditDialog.show($event, angular.copy(vm.person));\n\n      dialogPromise.then(function (updatedPerson) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person, updatedPerson);\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editEvent(field, $event) {\n      var dialogPromise = eventEditDialog.show($event, angular.copy(vm.person[field]));\n\n      dialogPromise.then(function (updatedEvent) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person[field], updatedEvent);\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.person.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.person.summary = updatedSummary;\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast);\n      });\n    }\n\n    function deletePerson($event, person) {\n      var nameLabel = person.name.label ? '\"' + person.name.label + '\"' : 'this person';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + nameLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return peopleRepo.delete(person)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        var message = nameLabel + ' has been deleted.';\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .position('bottom right');\n\n        $state.go('editor');\n\n        return $mdToast.show(toast);\n      }\n\n      function showErrorToast() {\n        var toast = $mdToast.simple()\n          .textContent('Unable to delete ' + nameLabel)\n          .position('bottom right');\n\n        return $mdToast.show(toast);\n      }\n    }\n\n    function createBiographyArticle($event, person) {\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Biography',\n        textContent: 'You are creating a new article attached to this person. Please enter a title for this article.',\n        initialValue: person.name.label,\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('biography', title, person.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          var toast = $mdToast.simple()\n          .textContent('Unable to create article.')\n          .position('bottom right');\n\n          return $mdToast.show(toast);\n        });\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('personEditDialog', personEditDialogFactory);\n\n  /** @ngInject */\n  function personEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, person) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: person\n        },\n        controller: PersonEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function PersonEditDialogController(peopleRepo, $mdDialog, person) {\n    var vm = this;\n\n    vm.person = person;\n    vm.nameRoles = [\n        // { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n    ]\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addName = addName;\n    vm.deleteName = deleteName;\n\n    function close() {\n      $mdDialog.hide(vm.person);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addName() {\n      var name = peopleRepo.createName();\n      vm.person.altNames.push(name);\n    }\n\n    function deleteName(name) {\n      var ix = vm.person.altNames.indexOf(name);\n      if (ix >= 0) {\n        vm.person.altNames.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * @typedef {object} Workflow\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {object.<string, WorkflowStage>} stages\n * @property {string} status\n */\n\n/**\n * @typedef {object} WorkflowStage\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {boolean} isFinal\n * @property {WorkflowStageTransition[]} transitions\n */\n\n/**\n * @typedef {object} WorkflowStageTransition\n * @property {string} sourceStage\n * @property {string} targetStage\n * @property {string} label\n */\n\n/**\n * @typedef {object} Worklist\n * @property {string} groupId\n * @property {string} label\n * @property {integer} itemCount\n * @property {integer} start\n * @property {integer} max\n * @property {WorkItem[]} items\n */\n\n/**\n * @typedef {object} WorkItem\n * @property {string} itemId\n * @property {string} type\n * @property {string} entityId\n * @property {string} label\n * @property {object.<string,string>} properties\n * @property {string} stage\n * @property {string} task\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks')\n    .provider('tasksRepo', tasksRepoProvider);\n\n  /**\n   * @return {angular.provider}\n   */\n  function tasksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/tasks';\n    provider.$get = tasksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function tasksRepoFactory($resource) {\n      var taskResource = $resource(provider.url + '/:taskId', { taskId: '@id' });\n      var workflowResource = $resource(provider.url + '/:taskId/workflow');\n      var itemResource = $resource(provider.url + '/:taskId/items/:itemId', { itemId: '@itemId' });\n\n      var repo = {};\n      repo.getTask = getTask;\n      repo.getWorkflow = getWorkflow;\n      repo.all = getAllTasks;\n      repo.getItems = getItems;\n      repo.transition = transition;\n      return repo;\n\n      /**\n       * Retrieves a listing of all tasks\n       *\n       * @return {Task[]}\n       */\n      function getAllTasks() {\n        return taskResource.query();\n      }\n\n      /**\n       * Retrieves a task by id\n       *\n       * @param  {string} taskId\n       * @return {GroupedTaskList}\n       */\n      function getTask(taskId) {\n        return taskResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Retrieves a workflow by task id\n       * @param  {string} taskId\n       * @return {Workflow}\n       */\n      function getWorkflow(taskId) {\n        return workflowResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Gets items from the task endpoint for a given stage\n       *\n       * @param  {string}  [taskId]  Task ID\n       * @param  {string}  stageId          Workflow stage for which to get items\n       * @param  {object}  options\n       * @param  {integer} [options.start]  Starting index\n       * @param  {integer} [options.max]    Maximum number of items to fetch per page\n       * @return {Worklist}\n       */\n      function getItems(taskId, stageId, options) {\n        options = options || {};\n        return itemResource.get({\n          taskId: taskId,\n          stage: stageId,\n          start: options.start,\n          max: options.max\n        });\n      }\n\n      /**\n       * Transition an item from its current stage to a target stage\n       *\n       * @param  {WorkItem}                item   Work item instance\n       * @param  {WorkflowStageTransition} transition Target workflow stage\n       * @return {WorkItem}                       Updated work item instance\n       */\n      function transition(taskId, item, transition) {\n        if (item.stage !== transition.sourceStage) {\n          throw new Error('Transition (' + transition.sourceStage + ' -> ' + transition.targetStage + ') is not valid for item currently in stage ' + item.stage);\n        }\n\n        var result = itemResource.save({\n          taskId: taskId,\n          itemId: item.itemId\n        }, {\n          stage: transition.targetStage,\n          // NOTE comments are not saved yet\n          comments: null\n        });\n\n        // propagate updates to the original item\n        result.$promise.then(function (resp) {\n          angular.extend(item, resp);\n        });\n\n        return result;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('TaskController', TaskController);\n\n  /** @ngInject */\n  function TaskController($mdSidenav, $mdToast, tasksRepo) {\n    var vm = this;\n\n    vm.loading = false;\n\n    vm.openMenu = openMenu;\n\n    activate();\n\n    function activate() {\n      vm.loading = true;\n      vm.tasks = tasksRepo.all();\n\n      vm.tasks.$promise.then(function () {\n        vm.loading = false;\n      }, function () {\n        vm.loading = false;\n        $mdToast.show($mdToast.simple().textContent('Unable to load tasks from server'));\n      });\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowTaskController', ShowTaskController);\n\n  /** @ngInject */\n  function ShowTaskController($state, $stateParams, $mdSidenav, tasksRepo, $q) {\n    var vm = this;\n\n    // HACK this will eventually be made available on the workflow data model itself.\n    vm.stageOrder = [\n      'pinned',\n      'inprogress',\n      'review',\n      'pending',\n      'deferred'\n    ];\n\n    vm.loading = true;\n    vm.worklists = {};\n    vm.task = null;\n\n    vm.focusItem = focusItem;\n    vm.transition = transitionItem;\n\n    activate();\n\n    function activate() {\n      vm.taskId = $stateParams.taskId;\n      vm.task = tasksRepo.getTask(vm.taskId);\n      vm.workflow = tasksRepo.getWorkflow(vm.taskId);\n\n      vm.workflow.$promise.then(function () {\n        var worklistPromises = [];\n\n        angular.forEach(vm.workflow.stages, function (stage) {\n          var worklistPromise = fetchStage(stage.id);\n          worklistPromises.push(worklistPromise);\n        });\n\n        $q.all(worklistPromises).then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    function focusItem(item, $event) {\n      $event.stopImmediatePropagation();\n\n      // TODO resolve handler based on item.type\n      $state.go('editor.work', { workId: item.entityId });\n    }\n\n    function transitionItem(item, transition, $event) {\n      $event.stopImmediatePropagation();\n\n      var updatedItem = tasksRepo.transition(vm.taskId, item, transition);\n      updatedItem.$promise.then(function () {\n        fetchStage(transition.sourceStage);\n        fetchStage(transition.targetStage);\n      });\n    }\n\n    function fetchStage(stageId) {\n      var group = tasksRepo.getItems(vm.taskId, stageId, { max: 9999 });\n\n      group.$promise.then(function () {\n        vm.worklists[stageId] = group.items.length > 0 ? group : null;\n      });\n\n      return group.$promise;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowWorkController', ShowWorkController);\n\n  /** @ngInject */\n  function ShowWorkController($state, $stateParams, worksRepo, relnRepo, refsRepoFactory, articlesRepo, $mdDialog, $mdToast, $q, workEditDialog, copyEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.title = null;\n    vm.relationships = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.addEdition = addEdition;\n    vm.deleteEdition = deleteEdition;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.createBookReview = createBookReviewArticle;\n    vm.deleteWork = deleteWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n\n      vm.work = worksRepo.getWork(workId);\n\n      vm.work.$promise.then(function () {\n        vm.bcTitle = worksRepo.getTitle(vm.work.titles);\n        vm.title = worksRepo.getTitle(vm.work.titles, ['canonical', 'bibliographic', 'short']);\n        vm.anchor = relnRepo.createAnchor(worksRepo.getWorkLabel(vm.work), vm.work.ref.token);\n      });\n\n      var refsEndpointUrl = worksRepo.getReferencesEndpoint(workId);\n      refsRepo = refsRepoFactory.getRepo(refsEndpointUrl);\n      vm.references = refsRepo.get();\n\n      $q.all([vm.work.$promise, vm.references.$promise]).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = workEditDialog.show($event, angular.copy(vm.work));\n\n      dialogPromise.then(function (updatedWork) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.work, updatedWork);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.work.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.work.summary = updatedSummary;\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast);\n      });\n    }\n\n    function addEdition($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Edition')\n        .textContent('Please provide a name for the new edition.')\n        .placeholder('edition name')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (editionName) {\n        var edition = worksRepo.createEdition();\n        edition.editionName = editionName;\n        edition.titles = angular.copy(vm.work.titles);\n        edition.authors = angular.copy(vm.work.authors);\n\n        vm.work.editions.push(edition);\n\n        // resolve to the created edition when save is successful\n        return worksRepo.saveEdition(vm.work.id, edition);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (edition) {\n        $state.go('editor.edition', { workId: vm.work.id, editionId: edition.id });\n      });\n    }\n\n    function deleteEdition(edition, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this edition?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.editions.indexOf(edition);\n          if (ix >= 0) {\n            vm.work.editions.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.work.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.work.copies.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast);\n          }\n        });\n    }\n\n    function deleteWork($event, work) {\n      var title = worksRepo.getTitle(vm.work.titles);\n      var workLabel = title ? '\"' + title.title + (title.subtitle ? ': ' + title.subtitle : '') + '\"' : 'this work';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + workLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return worksRepo.delete(work)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        var message = workLabel + ' has been deleted.';\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .position('bottom right');\n\n        $state.go('editor');\n\n        return $mdToast.show(toast);\n      }\n\n      function showErrorToast() {\n        var toast = $mdToast.simple()\n          .textContent('Unable to delete ' + workLabel)\n          .position('bottom right');\n\n        return $mdToast.show(toast);\n      }\n    }\n\n    function createBookReviewArticle($event, work) {\n      var title = worksRepo.getTitle(work.titles);\n\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Book Review',\n        textContent: 'You are creating a new article attached to this work. Please enter a title for this article.',\n        initialValue: title ? title.title + (title.subtitle ? ': ' + title.subtitle : '') : '[untitled work]',\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('book-review', title, work.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          var toast = $mdToast.simple()\n          .textContent('Unable to create article.')\n          .position('bottom right');\n\n          return $mdToast.show(toast);\n        });\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('workEditDialog', workEditDialogFactory);\n\n  /** @ngInject */\n  function workEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, work) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: work\n        },\n        controller: WorkEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function WorkEditDialogController($mdDialog, work) {\n    var vm = this;\n\n    vm.work = work;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.work);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.work[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.work[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.work[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.work.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.work.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.work.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowVolumeController', ShowVolumeController);\n\n  /** @ngInject */\n  function ShowVolumeController($stateParams, worksRepo, relnRepo, $mdDialog, $mdToast, $q, volumeEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.volume = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToEdition = copyToEdition;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId\n      var editionId = $stateParams.editionId;\n      var volumeId = $stateParams.volumeId;\n\n      vm.work = worksRepo.getWork(workId);\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      vm.volume = worksRepo.getVolume(workId, editionId, volumeId);\n\n      vm.work.$promise.then(function () {\n        vm.workTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n      });\n\n      vm.volume.$promise.then(function () {\n        vm.title = worksRepo.getTitle(vm.volume.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      $q.all([vm.work.$promise, vm.edition.$promise, vm.volume.$promise]).then(function () {\n        vm.loading = false;\n\n        vm.anchor = relnRepo.createAnchor(worksRepo.getVolumeLabel(vm.volume, vm.edition.editionName), vm.work.ref.token, {\n          editionId: [vm.edition.id],\n          volumeId: [vm.volume.id]\n        });\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = volumeEditDialog.show($event, angular.copy(vm.volume));\n\n      dialogPromise.then(function (updatedVolume) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.volume, updatedVolume);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.volume.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.volume.summary = updatedSummary;\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.volume.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.volume.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.volume.copies.splice(ix, 1);\n            worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n          }\n        });\n    }\n\n    function copyToEdition(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var edition = worksRepo.getEdition(vm.work.id, vm.edition.id);\n      edition.$promise.then(function () {\n        edition.copies.push(newCopy);\n        return worksRepo.saveEdition(vm.work.id, edition);\n      }).then(showSavedToast);\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('volumeEditDialog', volumeEditDialogFactory);\n\n  /** @ngInject */\n  function volumeEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, volume) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/volume-edit-dialog.html',\n        locals: {\n          volume: volume\n        },\n        controller: VolumeEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function VolumeEditDialogController($mdDialog, volume) {\n    var vm = this;\n\n    vm.volume = volume;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.volume);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.volume[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.volume[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.volume[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.volume.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.volume.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.volume.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowEditionController', ShowEditionController);\n\n  /** @ngInject */\n  function ShowEditionController($state, $stateParams, worksRepo, relnRepo, $mdDialog, $mdToast, $q, editionEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addVolume = addVolume;\n    vm.deleteVolume = deleteVolume;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToWork = copyToWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n\n      vm.work = worksRepo.getWork(workId);\n      vm.edition = worksRepo.getEdition(workId, editionId);\n\n      vm.work.$promise.then(function () {\n        vm.workTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n      });\n\n      vm.edition.$promise.then(function () {\n        vm.title = worksRepo.getTitle(vm.edition.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      $q.all([vm.work.$promise, vm.edition.$promise]).then(function (){\n        vm.loading = false;\n\n        vm.anchor = relnRepo.createAnchor(worksRepo.getEditionLabel(vm.edition), vm.work.ref.token, {\n          editionId: [vm.edition.id]\n        });\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = editionEditDialog.show($event, angular.copy(vm.edition));\n\n      dialogPromise.then(function (updatedEdition) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.edition, updatedEdition);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.edition.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.edition.summary = updatedSummary;\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n    }\n\n    function addVolume($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Volume')\n        .textContent('Please provide a number for the new volume.')\n        .placeholder('volume number')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (volumeNumber) {\n        var volume = worksRepo.createVolume();\n        volume.volumeNumber = volumeNumber;\n        volume.titles = angular.copy(vm.edition.titles);\n        volume.authors = angular.copy(vm.edition.authors);\n        volume.publicationInfo = angular.copy(vm.edition.publicationInfo);\n\n        vm.edition.volumes.push(volume);\n\n        return worksRepo.saveVolume(vm.work.id, vm.edition.id, volume);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (volume) {\n        $state.go('editor.volume', { workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id });\n      });\n    }\n\n    function deleteVolume(volume, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this volume?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.volumes.indexOf(volume);\n          if (ix >= 0) {\n            vm.edition.volumes.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.edition.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.edition.copies.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n          }\n        });\n    }\n\n    function copyToWork(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var work = worksRepo.getWork(vm.work.id);\n      work.$promise.then(function () {\n        work.copies.push(newCopy);\n        return worksRepo.saveWork(work);\n      }).then(showSavedToast);\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('editionEditDialog', editionEditDialogFactory);\n\n  /** @ngInject */\n  function editionEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, edition) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/edition-edit-dialog.html',\n        locals: {\n          edition: edition\n        },\n        controller: EditionEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EditionEditDialogController($mdDialog, edition) {\n    var vm = this;\n\n    vm.edition = edition;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.edition);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.edition[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.edition[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.edition[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.edition.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.edition.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.edition.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController(worksRepo, peopleRepo, $state, $stateParams, $mdSidenav, _, $q, $mdDialog, $mdToast) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.searchQuery = '';\n\n    vm.openMenu = openMenu;\n    vm.createPerson = createPerson;\n    vm.createWork = createWork;\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      if ($stateParams.q) {\n        vm.searchQuery = $stateParams.q;\n        search(vm.searchQuery);\n      }\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      $q.all([\n        vm.peopleResults.$promise,\n        vm.worksResults.$promise\n      ])\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function createArticle($event) {\n\n    }\n    \n    function createPerson($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: peopleRepo.create()\n        },\n        controller: 'PersonEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (person) {\n        return peopleRepo.save(person);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (person) {\n        $state.go('editor.person', { id: person.id });\n      });\n    }\n\n    function createWork($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: worksRepo.createWork()\n        },\n        controller: 'WorkEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (work) {\n        return worksRepo.saveWork(work);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (work) {\n        $state.go('editor.work', { workId: work.id });\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('editor', {\n        url: '/?q',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'vm'\n      })\n\n      .state('editor.person', {\n        url: 'people/:id',\n        views: {\n          main: {\n            templateUrl: 'app/person/person.html',\n            controller: 'ShowPersonController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('editor.work', {\n        url: 'works/:workId',\n        views: {\n          main: {\n            templateUrl: 'app/work/work.html',\n            controller: 'ShowWorkController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.edition', {\n        url: 'works/:workId/editions/:editionId',\n        views: {\n          main: {\n            templateUrl: 'app/work/edition.html',\n            controller: 'ShowEditionController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.volume', {\n        url: 'works/:workId/editions/:editionId/volumes/:volumeId',\n        views: {\n          main: {\n            templateUrl: 'app/work/volume.html',\n            controller: 'ShowVolumeController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('article', {\n        url: '/articles',\n        templateUrl: 'app/admin/editors/articles/article.html',\n        controller: 'ArticleEditorSectionController',\n        controllerAs: 'vm'\n      })\n\n      .state('article.edit', {\n        url: '/:id',\n        templateUrl: 'app/admin/editors/articles/article-editor.html',\n        controller: 'ArticleEditorController',\n        controllerAs: 'vm'\n      })\n\n      .state('task', {\n        url: '/task',\n        templateUrl: 'app/task/task.html',\n        controller: 'TaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('task.show', {\n        url: '/:taskId',\n        templateUrl: 'app/task/show.html',\n        controller: 'ShowTaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('vwise', {\n        url: '/vwise/:workspaceId',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      })\n\n      .state('zotero', {\n        url: '/zotero',\n        templateUrl: 'app/zotero/test/test.html',\n        controller: 'ZoteroTestController',\n        controllerAs: 'vm'\n      });\n\n\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, /* toastrConfig, */ $mdThemingProvider,\n                  tasksRepoProvider,\n                  worksRepoProvider,\n                  peopleRepoProvider,\n                  articlesRepoProvider,\n                  relnRepoProvider,\n                  categorizationServiceProvider,\n                  seeAlsoRepoProvider,\n                  trcSearchProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    var API_PREFIX = '/api/catalog';\n\n    tasksRepoProvider.url = API_PREFIX + '/v1/tasks';\n    worksRepoProvider.url = API_PREFIX + '/works';\n    peopleRepoProvider.url = API_PREFIX + '/people';\n    articlesRepoProvider.url = API_PREFIX + '/entries/articles';\n    relnRepoProvider.url = API_PREFIX + '/relationships';\n    categorizationServiceProvider.url = API_PREFIX + '/categorizations';\n    seeAlsoRepoProvider.url = API_PREFIX + '/seealso';\n    trcSearchProvider.url = API_PREFIX + '/search';\n\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(cslConfig);\n\n  var CSL_LOCALES = {\n    'en-US': 'en-US'\n  };\n\n  var CSL_STYLES = {\n    mla: 'modern-language-association',\n    chicago: 'chicago-author-date'\n  };\n\n  /** @ngInject */\n  function cslConfig(citeprocProvider) {\n    angular.forEach(CSL_LOCALES, addLocale);\n    angular.forEach(CSL_STYLES, addStyle);\n\n    function addLocale(filename, localeId) {\n      citeprocProvider.addLocale(localeId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/locales/locales-' + filename + '.xml').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n\n    function addStyle(filename, styleId) {\n      citeprocProvider.addStyle(styleId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/styles/' + filename + '.csl').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n  }\n\n})();\n\nangular.module(\"sdaAdmin\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<md-content flex layout=column> <navbar title=\\\"Editorial Tools\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" ui-view=sidebar layout=column> <form layout=row flex=none> <md-input-container flex> <label for=searchQuery>Search</label> <md-icon>search</md-icon> <input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required> </md-input-container> </form> <md-content flex> <div ng-if=vm.loading layout=row layout-align=center> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"> <md-subheader>People</md-subheader> <md-list> <md-list-item ng-repeat=\\\"person in vm.peopleResults.items\\\" ui-sref=\\\"editor.person({id: person.id})\\\"> <div class=md-list-item-text ng-bind-html=person.label></div> </md-list-item> </md-list> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"> <md-subheader>Works</md-subheader> <md-list> <md-list-item ng-repeat=\\\"work in vm.worksResults.items\\\" ui-sref=\\\"editor.work({workId: work.id})\\\"> <div class=md-list-item-text ng-bind-html=work.label></div> </md-list-item> </md-list> </div> </md-content> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Article\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createArticle($event)> <md-tooltip md-direction=left>New Article</md-tooltip> <md-icon>description</md-icon> </md-button> <md-button aria-label=\\\"New Person\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createPerson($event)> <md-tooltip md-direction=left>New Person</md-tooltip> <md-icon>person</md-icon> </md-button> <md-button aria-label=\\\"New Work\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createWork($event)> <md-tooltip md-direction=left>New Book</md-tooltip> <md-icon>book</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view=main></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/person/person-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Biographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=name layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Canonical Name</h2> </div> </md-toolbar> <div class=name> <name-editor ng-model=vm.person.name flex></name-editor> </div> </section> <section class=alt-names layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Alternate Names</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addName()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=name layout=row ng-repeat=\\\"name in vm.person.altNames\\\"> <md-input-container> <label>role</label> <md-select ng-model=name.role> <md-option ng-repeat=\\\"role in vm.nameRoles\\\" value={{role.value}}> {{role.label}} </md-option> </md-select> </md-input-container> <name-editor ng-model=name flex></name-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteName(name)> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/person/person.html\",\"<div layout=row layout-padding flex=noshrink> <div flex=60> <section class=\\\"content names\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h1 class=content-heading>{{vm.person.name.label}}</h1> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBioInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <div ng-if=\\\"vm.person.altNames && vm.person.altNames.length > 0\\\"> <p>Other names:</p> <ul> <li ng-repeat=\\\"name in vm.person.altNames\\\">{{name.label}}</li> </ul> </div> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.person.summary ng-bind-html=vm.person.summary></p> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div flex=40> <section class=\\\"content birth\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Birth</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'birth\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.birth.date.description>{{vm.person.birth.date.description}}</span> <span class=location ng-if=vm.person.birth.location>in {{vm.person.birth.location}}</span> </p> <p ng-bind-html=vm.person.birth.description ng-if=vm.person.birth.description></p> </section> <section class=\\\"content death\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Death</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'death\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.death.date.description>{{vm.person.death.date.description}}</span> <span class=location ng-if=vm.person.death.location>in {{vm.person.death.location}}</span> </p> <p ng-bind-html=vm.person.death.description ng-if=vm.person.death.description></p> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.person.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button aria-label=\\\"Create Biography\\\" class=md-icon-button ng-click=\\\"vm.createBiography($event, vm.person)\\\"> <md-icon>assignment_ind</md-icon> <md-tooltip md-direction=top>Create Biography</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this person\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deletePerson($event, vm.person)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/task/show.html\",\"<md-content flex layout=column> <div class=task-info> <span class=label>{{vm.task.label}}</span> <span class=description>{{vm.task.description}}</span> </div> <md-input-container> <label>Search</label> <md-icon>search</md-icon> <input type=search ng-model=filter ng-change=vm.search(filter)> </md-input-container> <md-content flex> <div layout=row layout-align=\\\"center center\\\" ng-if=vm.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-repeat=\\\"stageId in vm.stageOrder\\\" ng-if=vm.worklists[stageId]> <md-subheader>{{vm.workflow.stages[stageId].label}}</md-subheader> <md-list> <md-list-item ng-repeat=\\\"item in vm.worklists[stageId].items | filter : filter | limitTo : 20\\\" ng-mouseover=\\\"item.hover = true\\\" ng-mouseout=\\\"item.hover = false\\\" ng-click=\\\"vm.focusItem(item, $event)\\\"> <span ng-bind-html=item.label></span> <span flex></span> <md-button class=md-exclude ng-repeat=\\\"transition in vm.workflow.stages[stageId].transitions\\\" ng-click=\\\"vm.transition(item, transition, $event)\\\" ng-show=item.hover> <span>{{transition.label}}</span> </md-button> </md-list-item> </md-list> </div> </md-content> </md-content>\");\n$templateCache.put(\"app/task/task.html\",\"<md-content flex layout=column> <navbar title=\\\"Task Management Dashboard\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <div ng-if=vm.loading flex layout=row layout-align=\\\"center center\\\"> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <md-list ng-if=!vm.loading> <md-list-item ng-repeat=\\\"task in vm.tasks\\\" ui-sref=\\\"task.show({ taskId: task.id })\\\"> {{ task.label }} </md-list-item> </md-list> </md-sidenav> <md-content flex layout=column ui-view> <div layout=row layout-padding layout-margin layout-align=\\\"center center\\\"> <div class=md-headline>Please select a task from the sidebar.</div> </div> </md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/work/edition-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=vm.edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/edition.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li>{{vm.edition.editionName}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.edition.authors && vm.edition.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.edition.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.edition.publicationInfo> <span ng-if=vm.edition.publicationInfo.place> <span class=place>{{vm.edition.publicationInfo.place}}</span>: </span> <span ng-if=vm.edition.publicationInfo.publisher> <span class=publisher>{{vm.edition.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.edition.publicationInfo.date> <time class=date datetime={{vm.edition.publicationInfo.date.calendar}}>{{vm.edition.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.edition.summary ng-bind-html=vm.edition.summary></p> </section> <section class=\\\"content volumes\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addVolume($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"volume in vm.edition.volumes\\\" ui-sref=\\\"editor.volume({workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id})\\\"> <span>Volume {{volume.volumeNumber}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteVolume(volume, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.edition.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToWork(copy) aria-label=\\\"copy to parent work\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Work</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/volume-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=vm.volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/volume.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li><a ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: vm.edition.id})\\\">{{vm.edition.editionName}}</a></li> <li>Volume {{vm.volume.volumeNumber}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.volume.authors && vm.volume.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.volume.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.volume.publicationInfo> <span ng-if=vm.volume.publicationInfo.place> <span class=place>{{vm.volume.publicationInfo.place}}</span>: </span> <span ng-if=vm.volume.publicationInfo.publisher> <span class=publisher>{{vm.volume.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.volume.publicationInfo.date> <time class=date datetime={{vm.volume.publicationInfo.date.calendar}}>{{vm.volume.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.volume.summary ng-bind-html=vm.volume.summary></p> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.volume.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToEdition(copy) aria-label=\\\"copy to parent edition\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Edition</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/work-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/work.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li>{{vm.bcTitle.title}}{{vm.bcTitle && vm.bcTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.bcTitle.subtitle}}</li> </ol> </nav> <div layout=row layout-padding flex=noshrink> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.work.authors && vm.work.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.work.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.work.summary ng-bind-html=vm.work.summary></p> </section> <section class=\\\"content editions\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addEdition($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"edition in vm.work.editions\\\" ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: edition.id})\\\"> <span>{{edition.editionName}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteEdition(edition, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.work.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.work.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button class=md-icon-button aria-label=\\\"Create Book Review\\\" ng-click=\\\"vm.createBookReview($event, vm.work)\\\"> <md-icon>assignment</md-icon> <md-tooltip md-direction=top>Create Book Review</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this work\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deleteWork($event, vm.work)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/creator-field.html\",\"<div layout=row layout-margin> <md-input-container> <label>Role</label> <md-select ng-model=$ctrl.creator.creatorType ng-disabled=\\\"!$ctrl.roles || $ctrl.roles.length == 0\\\"> <md-option ng-value=role.role ng-repeat=\\\"role in $ctrl.roles\\\">{{role.label}}</md-option> </md-select> </md-input-container> <md-input-container ng-if=verbatim flex> <label>Name</label> <input type=text ng-model=$ctrl.creator.name> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>First Name</label> <input type=text ng-model=$ctrl.creator.firstName> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>Last Name</label> <input type=text ng-model=$ctrl.creator.lastName> </md-input-container> <div layout=column layout-align=\\\"center center\\\"> <md-button ng-show=verbatim ng-click=\\\"verbatim = false\\\" class=md-icon-button aria-label=\\\"First/Last Names\\\"> <md-icon>people</md-icon> <md-tooltip>First/Last Names</md-tooltip> </md-button> <md-button ng-hide=verbatim ng-click=\\\"verbatim = true\\\" class=md-icon-button aria-label=\\\"Single Name\\\"> <md-icon>domain</md-icon> <md-tooltip>Single Name</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/editor.html\",\"<div layout=column flex> <div layout=row layout-margin> <md-autocomplete md-search-text=$ctrl.itemTypeSearchText md-items=\\\"type in $ctrl.types | filter: {label: $ctrl.itemTypeSearchText}\\\" md-item-text=type.label md-selected-item=$ctrl.itemType md-selected-item-change=$ctrl.selectType($ctrl.itemType) md-min-length=0 md-floating-label=\\\"Item Type\\\" required> <md-item-template> <span md-highlight-text=$ctrl.itemTypeSearchText md-highlight-flags=^i>{{type.label}}</span> </md-item-template> </md-autocomplete> </div> <div layout=row ng-repeat=\\\"creator in $ctrl.item.creators\\\" layout-align=\\\"start center\\\"> <zotero-creator-field creator=creator roles=$ctrl.roles flex></zotero-creator-field> <md-button ng-click=\\\"$ctrl.item.creators.splice($index+1, 0, {})\\\" class=md-icon-button aria-label=\\\"New Creator\\\"> <md-icon>add</md-icon> <md-tooltip>New</md-tooltip> </md-button> <md-button ng-disabled=\\\"$ctrl.item.creators.length <= 1\\\" ng-click=\\\"$ctrl.item.creators.splice($index, 1)\\\" class=\\\"md-icon-button md-warn\\\" aria-label=\\\"Delete Creator\\\"> <md-icon>remove</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </div> <div layout=row layout-margin ng-repeat=\\\"field in $ctrl.fields\\\"> <md-input-container flex> <label>{{field.label}}</label> <input type=text ng-model=$ctrl.item[field.id]> </md-input-container> </div> <div ng-if=!$ctrl.itemType layout-margin> <p>Please select an item type first.</p> </div> </div>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-edit-dialog.html\",\"<md-dialog aria-label=\\\"Edit Citation\\\" flex=50 layout=column> <form ng-cloak> <md-toolbar> <div class=md-toolbar-tools> <h2>Edit Citation</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon aria-label=Cancel>close</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class=md-dialog-content> <citation-editor references=vm.references citation=vm.citation></citation-editor> </div> </md-dialog-content> <md-dialog-actions layout=row> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-editor.html\",\"<div class=citation-editor-layout layout=column flex> <div class=citation-editor-container ng-hide=$ctrl.zoteroItem layout=column flex> <div layout=row layout-wrap> <div layout=row layout-align=\\\"start center\\\" layout-margin class=md-whiteframe-2dp ng-repeat=\\\"item in $ctrl.citation.items\\\"> <span ng-bind-html=item.label></span> <md-button class=md-icon-button aria-label=Edit ng-click=$ctrl.edit(item)> <md-icon>edit</md-icon> <md-tooltip>Edit Item</md-tooltip> </md-button> <md-button class=\\\"md-icon-button md-warn\\\" aria-label=Remove ng-click=\\\"$ctrl.citation.items.splice($index, 1)\\\"> <md-icon>remove</md-icon> <md-tooltip>Remove Item</md-tooltip> </md-button> </div> </div> <div layout=column> <md-autocomplete md-autoselect md-floating-label=\\\"Referenced Item\\\" md-selected-item=$ctrl.selectedBiblioItem md-selected-item-change=$ctrl.selectBiblioItem($ctrl.selectedBiblioItem) md-search-text=$ctrl.searchText md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-delay=200 md-require-match required> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found> No matches found. <md-button ng-click=$ctrl.createZoteroItem($event)>Create</md-button> </md-not-found> </md-autocomplete> <div layout=row> <md-input-container> <label>Locator Type</label> <md-select ng-model=$ctrl.activeCitationItem.locatorType> <md-option></md-option> <md-option ng-repeat=\\\"type in $ctrl.locatorTypes\\\" ng-value=type>{{type}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label>Locator</label> <input type=text ng-model=$ctrl.activeCitationItem.locator> </md-input-container> </div> <md-checkbox ng-model=$ctrl.activeCitationItem.suppressAuthor> Suppress Author Name in In-Text Citation </md-checkbox> </div> <div layout=row layout-align=end> <md-button class=md-raised ng-click=$ctrl.addCitationItem($ctrl.activeCitationItem)> Save Item </md-button> </div> </div> <div class=zotero-item-editor-container ng-if=$ctrl.zoteroItem layout=row flex> <div layout=column> <md-button class=md-icon-button ng-click=$ctrl.cancelZoteroItem($event)> <md-icon>cancel</md-icon> <md-tooltip md-direction=right>Cancel New Item</md-tooltip> </md-button> <md-button class=md-icon-button ng-click=\\\"$ctrl.saveZoteroItem($event, $ctrl.zoteroItem)\\\"> <md-icon>check_circle</md-icon> <md-tooltip md-direction=right>Save and Cite Item</md-tooltip> </md-button> </div> <zotero-editor item=$ctrl.zoteroItem flex></zotero-editor> </div> </div>\");\n$templateCache.put(\"app/components/ckeditor-footnotes/footnote-edit-dialog.html\",\"<md-bottom-sheet aria-label=\\\"Insert Footnote\\\" layout=column> <md-toolbar> <div class=md-toolbar-tools> <h2>Insert Footnote</h2> <span flex></span> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </div> </md-toolbar> <div ng-if=vm.references ng-model=vm.footnote.content ckeditor ckeditor-bibliography=vm.references></div> <div ng-if=!vm.references ng-model=vm.footnote.content ckeditor></div> </md-bottom-sheet>\");\n$templateCache.put(\"app/components/date-editor/date-editor.html\",\"<div layout=row> <md-input-container flex> <label>date</label> <input type=text ng-model=date.description> </md-input-container> <md-input-container flex> <label>ISO-8601 date</label> <input type=datetime ng-model=date.calendar ng-change=\\\"calendarAutoSet = false\\\"> </md-input-container> </div>\");\n$templateCache.put(\"app/components/navbar/navbar.html\",\"<md-toolbar> <div class=md-toolbar-tools> <md-button ng-if=$ctrl.sidenavId class=\\\"md-accent md-icon-button\\\" ng-click=$ctrl.toggleSidenav($ctrl.sidenavId) title=\\\"toggle menu\\\" hide-gt-sm> <md-icon>menu</md-icon> </md-button> <img class=logo src=assets/images/sda-logo-light.png> <h2> <span>{{$ctrl.title}}</span><!-- make this change based on page --> </h2> <span flex></span> <md-button ui-sref=editor>People and Works</md-button> <md-button ui-sref=article>Article</md-button> <md-button ui-sref=task>Tasks</md-button> </div> </md-toolbar>\");\n$templateCache.put(\"app/components/see-also-editor/see-also-editor.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.seeAlso\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load links from the server. </div> </div> <div layout=column ng-if=\\\"!$ctrl.loading && $ctrl.seeAlso\\\"> <md-list ng-if=\\\"!($ctrl.seeAlso.links | empty)\\\"> <div ng-repeat=\\\"(type, targets) in $ctrl.seeAlso.links\\\"><!-- The type key is a machine identifier (e.g. \\'trc.entries.bibliographic\\')\\n      <md-subheader>{{type}}</md-subheader> --> <md-list-item ng-repeat=\\\"target in targets\\\" ng-click=\\\"$ctrl.openLink($event, target)\\\"> <span ng-bind-html=target.label></span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" aria-label=\\\"delete link\\\" ng-click=\\\"$ctrl.deleteLink($event, target)\\\"> <md-icon>delete</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </md-list-item> </div> </md-list> <div ng-if=\\\"$ctrl.seeAlso.links | empty\\\"> No links added. Add one below. </div> <form layout=row novalidate name=newLink ng-submit=$ctrl.createLink($ctrl.selectedItem)> <md-autocomplete md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-search-text=$ctrl.searchText md-selected-item=$ctrl.selectedItem md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"add link\\\" md-select-on-match md-match-case-insensitive flex> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete> <md-button type=submit class=md-icon-button ng-disabled=!$ctrl.selectedItem> <md-icon>add</md-icon> <md-tooltip>Add Link</md-tooltip> </md-button> </form> </div>\");\n$templateCache.put(\"app/components/summary-edit-dialog/summary-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Summary Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content><!-- material-compliant padding not used since WYSIWYG text editor *is* the UI --> <summary-editor ng-model=vm.summary></summary-editor> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/summary-editor/summary-editor.html\",\"<div ckeditor ng-model=summary></div>\");\n$templateCache.put(\"app/zotero/test/test.html\",\"<div layout=column flex> <md-content> <zotero-editor item=vm.item types=vm.types></zotero-editor> </md-content> </div>\");\n$templateCache.put(\"app/admin/editors/articles/article-editor.html\",\"<div flex layout=column layout-padding><!-- title editor bar --> <md-content layout=row> <md-input-container flex=60 layout-sm=column layout-align=\\\"begin end\\\"> <label>Title</label> <input type=text ng-model=vm.article.title> </md-input-container> <section flex=40 layout=row layout-sm=column layout-align=\\\"end center\\\" layout-wrap> <md-button class=md-raised ng-click=vm.cancel()>Cancel</md-button> <md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button> </section> </md-content><!-- TODO add space for authors --><!-- TODO add save button and auto-save --><!-- TODO add sidebar for notes, biblio, links, etc --> <div id=article_editor flex layout=column> <div ng-model=vm.article.body ckeditor=vm.editor.config ckeditor-bibliography=vm.references ckeditor-footnotes=vm.article.footnotes> </div> <md-tabs flex> <md-tab label=Abstract> <div ckeditor=vm.abstractEditor.config ng-model=vm.article.abstract></div> </md-tab> <md-tab label=Bibliography> <bibliography refs=vm.references style-id=mla></bibliography> </md-tab> <md-tab label=Footnotes> <div class=footnotes ng-repeat=\\\"footnote in vm.article.footnotes\\\" layout=row> <div class=footnote ng-bind-html=footnote.content flex></div> <md-button class=md-icon-button aria-label=\\\"edit footnote\\\" ng-click=\\\"vm.editFootnote($event, footnote)\\\"> <md-icon>edit</md-icon> <md-tooltip>Edit Footnote</md-tooltip> </md-button> </div> </md-tab> <md-tab label=\\\"See Also\\\"> <see-also-editor source-token=vm.article.ref.token></see-also-editor> </md-tab> </md-tabs> </div><!-- TODO how to make this fill all available space --> </div>\");\n$templateCache.put(\"app/admin/editors/articles/article.html\",\"<md-content flex layout=column> <navbar title=Articles sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <md-tabs flex> <md-tab> <md-tab-label> <md-icon>format_list_bulleted</md-icon> <md-tooltip md-direction=bottom>Thematic Overviews</md-tooltip> </md-tab-label> <md-tab-body> <tree-categorization-editor scope-id=sda scheme=overviews> </tree-categorization-editor> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>book</md-icon> <md-tooltip md-direction=bottom>Book Reviews</md-tooltip> </md-tab-label> <md-tab-body> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>person</md-icon> <md-tooltip md-direction=bottom>Biographies</md-tooltip> </md-tab-label> <md-tab-body> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>school</md-icon> <md-tooltip md-direction=bottom>Scholarly Articles</md-tooltip> </md-tab-label> <md-tab-body> </md-tab-body> </md-tab> </md-tabs> </md-sidenav> <md-content flex layout=column ui-view></md-content> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Article\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createArticle($event)> <md-tooltip md-direction=left>New Article</md-tooltip> <md-icon>description</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-content> </md-content>\");\n$templateCache.put(\"app/admin/editors/articles/thematic-overview.html\",\"<div id=thematic_overviews> <script type=text/ng-template id=treeCategoryEntry.html><div class=\\\"category-node\\\" layout=\\\"row\\\" layout-align=\\\"start center\\\">\\n     <!--  Display label for the category node-->\\n     <span ng-if=\\\"node.entryRef == null\\\" class=\\\"node-label\\\">{{ node.label }}</span>\\n     <a ui-sref=\\\"article.edit({id:node.entryRef.id})\\\" ng-if=\\\"node.entryRef != null\\\" class=\\\"node-label\\\">{{ node.label }}</a>\\n\\n     <!-- push buttons to edge -->\\n     <span flex></span>\\n\\n     <!-- node action menu -->\\n     <md-menu class=\\\"action\\\">\\n       <!-- activate handle -->\\n       <md-button ng-click=\\\"$mdOpenMenu($event)\\\" class=\\\"md-icon-button\\\">\\n         <md-icon>arrow_drop_down</md-icon>\\n       </md-button>\\n\\n       <md-menu-content>\\n         <!-- Associate/Remove  -->\\n         <md-menu-item>\\n           <md-button ng-if=\\\"node.entryRef.id == null\\\"\\n                      ng-click=\\\"vm.handleAssociateEntry($event, node)\\\">\\n             <md-icon>add_circle_outline</md-icon>\\n             Create Article\\n           </md-button>\\n           <md-button ng-if=\\\"node.entryRef.id != null\\\"\\n                      ng-click=\\\"vm.handleRemoveEntry($event, node)\\\">\\n             <md-icon>remove_circle_outline</md-icon>\\n             Remove Article\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleCreateChild($event, node)\\\">\\n             <!-- Will create a child node at the end of this list. User can drag to re-arrange -->\\n             <md-icon>create_new_folder</md-icon>\\n             Create Sub-Category\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleDeleteNode($event, node, parent)\\\">\\n             <!-- Will delete this node, all children and associated articles. If leaf node,\\n             displays delete instead of delete sweep. Prompts user to confirm. -->\\n             <md-icon>delete{{ node.children.length == 0 ? \\'\\' : \\'_sweep\\' }}</md-icon>\\n             Remove Category\\n           </md-button>\\n         </md-menu-item>\\n       </md-menu-content>\\n     </md-menu>\\n   </div>\\n\\n   <ol ng-if=\\\"node.children.length > 0\\\">\\n     <li ng-repeat=\\\"node in node.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = $parent.$parent.node\\\"></li>\\n   </ol></script> <ol> <li ng-repeat=\\\"node in vm.overviews.root.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = vm.overviews.root\\\"></li> </ol> <div layout=row layout-align=\\\"center center\\\"><!-- TODO need additional styling --> <md-button ng-click=\\\"vm.handleCreateChild($event, vm.overviews.root)\\\" class=md-raised aria-label=\\\"create category\\\">Create Category</md-button> </div> </div>\");\n$templateCache.put(\"app/person/components/event-editor/event-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex> <label>location</label> <input type=text ng-model=event.location> </md-input-container> <date-editor ng-model=event.date flex></date-editor> </div> <div layout=row layout-padding> <div flex> <h2>Description</h2> <div flex ckeditor ng-model=event.description></div> </div> </div> </div>\");\n$templateCache.put(\"app/person/components/event-edit-dialog/event-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Event Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <event-editor ng-model=vm.event flex></event-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/task/components/edition-editor/edition-editor.html\",\"<div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.titles.push({})> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=edition.summary flex></summary-editor> </section> <section class=volumes> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createVolume()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=volume layout=column layout-margin ng-repeat=\\\"volume in vm.volumes\\\" ng-class=\\\"{\\'md-whiteframe-2dp\\': !volume.focused, \\'md-whiteframe-8dp\\': volume.focused}\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"volume.focused = !volume.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>Volume {{volume.model.volumeNumber}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteVolume($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=volume.focused> <volume-editor ng-model=volume.model flex></volume-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in edition.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor/work-editor.html\",\"<section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.titles.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Summary</h2> </div> </md-toolbar> <summary-editor ng-model=work.summary flex></summary-editor> </section> <section class=editions> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createEdition()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=edition layout=column layout-margin ng-repeat=\\\"edition in vm.editions\\\" ng-class=\\\"{ \\'md-whiteframe-2dp\\': !edition.focused, \\'md-whiteframe-8dp\\': edition.focused }\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"edition.focused = !edition.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>{{edition.model.editionName}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteEdition($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=edition.focused> <edition-editor ng-model=edition.model flex></edition-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in work.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/person/components/name-editor/name-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex=10> <label>title</label> <input type=text ng-model=name.title> </md-input-container> <md-input-container flex=30> <label>given</label> <input type=text ng-model=name.givenName> </md-input-container> <md-input-container flex=20> <label>middle</label> <input type=text ng-model=name.middleName> </md-input-container> <md-input-container flex=30> <label>family</label> <input type=text ng-model=name.familyName> </md-input-container> <md-input-container flex=10> <label>suffix</label> <input type=text ng-model=name.suffix> </md-input-container> </div> <md-input-container> <label>display label</label> <input type=text ng-model=name.label required> </md-input-container> </div>\");\n$templateCache.put(\"app/task/components/work-editor-item/work-editor-item.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=!vm.loaded> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=vm.loaded> <work-editor ng-model=vm.work></work-editor> </div>\");\n$templateCache.put(\"app/work/components/author-ref-editor/author-ref-editor.html\",\"<div layout=column> <div layout=row> <md-autocomplete required md-items=\\\"item in vm.authorRoles\\\" md-item-text=role md-min-length=0 md-search-text=ref.role md-selected-item-change=\\\"ref.role = item\\\" md-floating-label=role> <md-item-template> <span md-highlight-text=ref.role>{{item}}</span> </md-item-template> </md-autocomplete> <md-input-container flex> <label>first name</label> <input type=text ng-model=ref.firstName> </md-input-container> <md-input-container flex> <label>last name</label> <input type=text ng-model=ref.lastName> </md-input-container> </div> <div layout=row> <md-autocomplete flex md-items=\\\"person in vm.getResults(vm.linkAuthorSearchText)\\\" md-item-text=person.label md-search-text=vm.linkAuthorSearchText md-search-text-change=vm.searchPeople(vm.linkAuthorSearchText) md-selected-item-change=vm.setLinkedAuthor(person) md-floating-label=\\\"linked author\\\"> <span md-highlight-text=vm.linkAuthorSearchText>{{person.label}}</span> </md-autocomplete> </div> </div>\");\n$templateCache.put(\"app/task/components/volume-editor/volume-editor.html\",\"<div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <h2>Publication Information</h2> <publication-info-editor ng-model=volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <h2 layout=row> <span flex>Titles</span> <md-button class=md-icon-button ng-click=volume.titles.push({})> <md-icon>add</md-icon>  </md-button></h2> <div class=title layout=row ng-repeat=\\\"title in volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <h2 layout=row> <span flex>Authors</span> <md-button class=md-icon-button ng-click=volume.authors.push({})> <md-icon>add</md-icon> </md-button> </h2> <div class=author layout=row ng-repeat=\\\"author in volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=volume.summary flex></summary-editor> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=volume.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in volume.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/work/components/copy-editor/copy-editor.html\",\"<ng-form name=copyForm layout=column flex> <md-input-container> <label for=title>Title</label> <input type=text name=title id=title ng-model=copy.title> </md-input-container> <div layout=row> <md-input-container> <label for=type>Type</label> <md-select name=type id=type ng-model=copy.type required ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> <md-option ng-repeat=\\\"handler in vm.refHandlers\\\" value={{handler.id}}>{{handler.display}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label for=url>URL</label> <input type=url name=url id=url ng-model=copyUrl ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> </md-input-container> </div> <ul class=\\\"properties properties-inline\\\"> <li ng-repeat=\\\"(key, value) in copy.properties\\\"> <span class=label>{{key}}</span> <span class=value>{{value}}</span> </li> </ul> <md-input-container> <label for=rights>Description of Rights</label> <input type=text name=rights id=rights ng-model=copy.rights> </md-input-container> <h3>Summary</h3> <summary-editor ng-model=copy.summary flex></summary-editor> </ng-form>\");\n$templateCache.put(\"app/work/components/publication-info-editor/publication-info-editor.html\",\"<div layout=row> <md-input-container flex> <label>publisher</label> <input type=text ng-model=pubInfo.publisher> </md-input-container> <md-input-container flex> <label>location</label> <input type=text ng-model=pubInfo.place> </md-input-container> <date-editor ng-model=pubInfo.date flex></date-editor> </div>\");\n$templateCache.put(\"app/work/components/copy-edit-dialog/copy-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Digital Copy Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <copy-editor ng-model=vm.copy></copy-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/relationships/relationships.html\",\"<div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Relationships</h2> <span flex></span> <md-button class=md-icon-button ng-click=$ctrl.addRelationship($event) ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups\\\"> <md-icon>add</md-icon> </md-button> </div> <div ng-repeat=\\\"type in $ctrl.typeGroups\\\" ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups.length > 0\\\"> <h3 class=content-heading>{{type.label}}</h3> <md-list><!-- TODO: clicking on relationship should open that relationship in an editor; clicking on an anchor should go to the linked item --> <md-list-item ng-repeat=\\\"reln in type.relationships\\\" ng-click=\\\"$ctrl.openRelationship($event, reln)\\\"> <span ng-repeat=\\\"anchor in reln.anchors\\\" ng-bind-html=anchor.label></span> <md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"$ctrl.deleteRelationship($event, reln)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </div> <div ng-if=\\\"$ctrl.typeGroups && $ctrl.typeGroups.length == 0\\\"> No relationships to display. </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.typeGroups\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load relationships from the server. </div> </div> <div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div>\");\n$templateCache.put(\"app/work/components/reln-edit-dialog/reln-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Relationship Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form name=relationship ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content layout=column> <md-input-container> <label>type</label> <md-select name=type ng-model=vm.selectedType required> <md-option ng-repeat=\\\"type in vm.types\\\" ng-value=type> {{type.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.type.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <md-autocomplete md-items=\\\"work in vm.search(vm.searchText)\\\" md-search-text=vm.searchText md-selected-item=vm.selectedWork md-selected-item-change=vm.selectWork(work) md-item-text=\\\"work.label | stripTags\\\" md-require-match md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"search works\\\" md-select-on-match md-match-case-insensitive> <md-item-template> <span ng-bind-html=work.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete> <md-input-container ng-if=\\\"vm.anchors.length > 1\\\"> <label>target</label> <md-select name=target ng-model=vm.selectedAnchor required> <md-option ng-repeat=\\\"anchor in vm.anchors\\\" ng-value=anchor> {{anchor.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.target.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <div class=summary> <h2>Summary</h2> <div ckeditor ng-model=vm.description></div> </div> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/title-editor/title-editor.html\",\"<div layout=row> <md-input-container> <label>type</label> <md-select ng-model=title.type required> <md-option value=bibliographic>bibliographic</md-option> <md-option value=canonical>canonical</md-option> <md-option value=short>short</md-option> </md-select> </md-input-container> <md-input-container flex> <label>title</label> <input type=text ng-model=title.title required> <div ng-switch=title.type> <small ng-switch-when=bibliographic>the full title as published on the work</small> <small ng-switch-when=canonical>title by which the work is commonly known in the academic realm</small> <small ng-switch-when=short>shortened title coloquially used by the public</small> </div> </md-input-container> <md-input-container flex> <label>subtitle</label> <input type=text ng-model=title.subtitle> </md-input-container> </div>\");}]);"],"sourceRoot":"/source/"}