{"version":3,"sources":["scripts/app.js"],"names":["angular","module","workEditorDirective","WorkEditorController","$scope","worksRepo","_","activate","work","editions","forEach","edition","vm","push","model","focused","createEdition","titles","cloneDeep","authors","otherAuthors","deleteEdition","ix","splice","this","$inject","directive","restrict","templateUrl","scope","controller","controllerAs","volumeEditorDirective","volume","titleEditorDirective","title","publicationInfoEditorDirective","pubInfo","editionEditorDirective","EditionEditorController","volumes","createVolume","publicationInfo","deleteVolume","copyEditorDirective","copy","CopyEditorController","addHandler","HathiTrustRefHandler","GoogleBooksRefHandler","InternetArchiveRefHandler","handler","refHandlers","id","parseProperties","type","url","properties","copyForm","$setValidity","setProperties","handle","parsed","parseUrl","seq","path","substr","lastIndexOf","pageNo","fragment","match","length","makePropertiesObject","toString","src","display","hostname","query","urlappend","subquery","parseQueryString","htid","section","printsec","page","pg","parser","document","createElement","href","protocol","host","port","pathname","search","hash","sep","isString","flags","indexOf","kvpairs","split","pair","key","value","decodeURIComponent","URIError","hasOwnProperty","isArray","authorRefEditorDirective","AuthorRefEditorController","peopleRepo","ref","authorId","author","get","$promise","then","linkAuthorSearchText","name","label","setLinkedAuthor","person","getResults","resultSet","items","authorRoles","workspaceRepositoryProvider","vwise","workspaceRepositoryFactory","panelContentMediatorRegistry","$http","$q","NgWorkspaceRepository","provider","declare","$get","mediatorRegistry","WorkspaceRepository","call","workspaces","Cache","panels","prototype","Object","create","createWorkspace","UUID","uuid4","workspace","Workspace","when","saveWorkspace","TypeError","getWorkspace","reject","Error","createPanel","mediator","content","repo","panel","Panel","p","savePanel","getPanel","workspaceId","panelId","workPanelDirective","linkFunc","getTitle","workId","link","volumePanelDirective","getEdition","editionId","editionPanelDirective","personPanelDirective","at","NAME_KEYS","map","n","trim","filter","identity","join","worksContentMediatorFactory","Mediator","PanelContentMediator","loadWork","matches","obj","initPanelData","unmarshall","dto","marshall","panelData","getTemplate","factory","volumesContentMediatorFactory","loadVolume","volumeId","getVolume","peopleContentMediatorFactory","loadPerson","passthruContentMediatorFactory","panelContentMediatorRegistryFactory","PanelContentMediatorRegistry","noteContentMediatorFactory","editionsContentMediatorFactory","loadEdition","internetArchiveContentMediatorFactory","hathitrustContentMediatorFactory","googleBooksContentMediatorFactory","vwisePanel","$compile","$el","attrs","$eval","panelScope","$new","vprops","$watch","color","r","parseInt","g","b","foreground","calculateForeground","template","contentMediator","contentArea","find","html","contents","Math","pow","lum","iaReader","$sce","trustAsResourceUrl","replace","hathitrustReader","params","ui","queryString","READER_URL","workEditorItemDirective","$log","error","WorkEditorItemController","loaded","nameEditorDirective","eventEditorDirective","event","ArticleEditorController","articlesRepo","info","save","debug","article","body","cancel","alert","editor","config","toolbarGroups","groups","removeButtons","format_tags","summaryEditorDirective","summary","SummaryEditDialogController","$mdDialog","close","hide","dateEditorDirective","date","ShowWorkController","$state","$stateParams","relationshipsRepo","$mdToast","$timeout","bcTitle","relationshipsPromise","loadRelationships","all","loading","getCurrentUri","relationships","currentUri","normalizeRelationships","editBibInfo","$event","dialog","targetEvent","locals","dialogPromise","show","updatedWork","extend","saveWork","showSavedToast","editSummary","updatedSummary","addEdition","prompt","textContent","placeholder","ok","savePromise","editionName","saveEdition","go","confirm","addCopy","editCopy","copies","updatedCopy","deleteCopy","openRelationship","relationship","entity","entities","refParams","addRelationship","createRelationship","updatedRelationship","deleteRelationship","confirmPromise","deletePromise","toast","simple","position","WorkEditDialogController","addAuthor","field","authorRef","deleteAuthor","addTitle","deleteTitle","ShowVolumeController","getWork","workTitle","updatedVolume","saveVolume","VolumeEditDialogController","RelationshipEditDialogController","types","getTypes","target","createAnchor","targetEntities","self","entryUris","relatedEntities","descriptionMimeType","rawTypes","defineProperty","identifier","reverse","isDirected","reverseTitle","results","setType","typeId","isReverse","swap","selectWork","workProxy","targets","workUri","uri","subtitle","editionUri","editionTitle","volumeUri","volumeTitle","volumeNumber","selectedTarget","setTarget","selectedType","searchText","ShowEditionController","updatedEdition","addVolume","EditionEditDialogController","CopyEditDialogController","WorkspaceController","workspaceRepository","$mdSidenav","hotkeys","text","bindTo","add","combo","description","callback","sidebarFocused","searchQuery","element","focus","toggle","createNotePanel","tagAll","arr","peopleResults","worksResults","property","panelDragged","evt","xPosition","left","yPosition","max","top","savePanelPosition","setPosition","activatePanel","resizePanel","width","helper","height","$apply","savePanelSize","setSize","stopPropagation","closePanel","remove","thingDropped","itemScope","draggable","item","offsetX","context","contentMediators","findContentMediators","contentP","panelP","set","x","y","note","workspaceClicked","ctrlKey","clientX","clientY","activeItems","debounce","runBlock","peopleContentMediator","worksContentMediator","editionsContentMediator","volumesContentMediator","googleBooksContentMediator","hathitrustContentMediator","internetArchiveContentMediator","noteContentMediator","passthruContentMediator","register","run","constant","googleBooksApiProvider","configure","preventLoad","worksRepoProvider","worksRepoFactory","$resource","findAll","restResource","q","isUndefined","adaptWork","editionResource","adaptEdition","volumeResource","adaptVolume","createWork","arguments","apply","$update","$save","deleteWork","dataItem","adaptCommon","toLowerCase","role","getTitleByTypePreference","reduce","found","update","method","getAll","tasksRepoProvider","tasksRepoFactory","getTask","taskId","workflow","workflowResource","task","getItems","stageId","options","itemResource","stage","start","transition","sourceStage","targetStage","result","itemId","comments","resp","articlesRepoProvider","articlesRepoFactory","relationshipsRepoProvider","relationshipsRepoFactory","typesCache","force","typeResource","tcPromise","getType","reln","relnResource","adaptRelationship","createProvenance","provenance","adaptProvenance","anchor","adaptAnchor","findById","queryOpts","direction","off","saveRelationship","response","creatorUris","normalizedRelationships","some","targetField","flattened","concat","resolveEntityUri","relnsByTypeDir","fwd","rev","typeGroups","dirs","group","ENTITY_URI","exec","makeVolumeEntity","makeEditionEntity","makeWorkEntity","peopleRepoProvider","peopleRepoFactory","createPerson","adaptPerson","createMeta","meta","adaptMeta","createName","adaptName","createEvent","adaptEvent","createDateDescription","dateDescription","savePerson","personId","deletePerson","altNames","birth","death","links","trcPersonEditorDirective","PersonEditorController","addName","newName","removeName","addEvent","newEvent","removeEvent","trcNameEditorDirective","NameEditorController","roles","trcEventEditorDirective","TaskController","tasksRepo","worklistPromises","stages","worklistPromise","fetchStage","openMenu","focusItem","stopImmediatePropagation","entityId","transitionItem","updatedItem","worklists","stageOrder","slideToggle","el","attr","duration","slideToggleDuration","active","stop","slideDown","slideUp","ShowPersonController","editBioInfo","updatedPerson","editEvent","updatedEvent","PersonEditDialogController","deleteName","nameRoles","EventEditDialogController","MainController","API","loadGoogleBooks","googleBooksScriptLoader","load","transport","v","language","$window","$document","getScriptUrl","includeScript","omitOptions","omit","k","scriptId","scriptElem","getElementById","parentNode","removeChild","round","random","appendTo","isGoogleBooksLoaded","isDefined","google","books","deferred","defer","resolve","promise","randomizedFunctionName","usedConfiguration","manualLoad","undefined","googleBookReader","googleBooksApi","googleBooksApiManualLoader","viewer","DefaultViewer","$on","resize","service","routerConfig","$stateProvider","$urlRouterProvider","state","views","main","otherwise","moment","$logProvider","$mdThemingProvider","debugEnabled","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","$templateCache","put"],"mappings":"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","file":"scripts/app-1fdf7a04db.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb', [\n      'ngAnimate',\n      'ngCookies',\n      // 'ngTouch',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ckeditor',\n      'ngMaterial',\n      'ngDragDrop',\n      'slideToggle',\n      'trcWorks',\n      'trcTasks',\n      'trcBio',\n      'trcReln',\n      'trcArticles',\n      'vwise'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('workEditor', workEditorDirective);\n\n  /** @ngInject */\n  function workEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/work-editor/work-editor.html',\n      scope: {\n        work: '=ngModel'\n      },\n      controller: WorkEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function WorkEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.editions = [];\n\n      vm.createEdition = createEdition;\n      vm.deleteEdition = deleteEdition;\n\n      activate();\n\n      function activate() {\n        $scope.work.editions.forEach(function (edition) {\n          vm.editions.push({\n            model: edition,\n            focused: false\n          });\n        });\n      }\n\n      function createEdition() {\n        var edition = worksRepo.createEdition();\n        edition.titles = _.cloneDeep($scope.work.titles);\n        edition.authors = _.cloneDeep($scope.work.authors);\n        edition.otherAuthors = _.cloneDeep($scope.work.otherAuthors);\n\n        $scope.work.editions.push(edition);\n        vm.editions.push({\n          model: edition,\n          focused: true\n        });\n      }\n\n      function deleteEdition(ix) {\n        vm.editions.splice(ix, 1);\n        $scope.work.editions.splice(ix, 1);\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('volumeEditor', volumeEditorDirective);\n\n  /** @ngInject */\n  function volumeEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/volume-editor/volume-editor.html',\n      scope: {\n        volume: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('titleEditor', titleEditorDirective);\n\n  /** @ngInject */\n  function titleEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/title-editor/title-editor.html',\n      scope: {\n        title: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('publicationInfoEditor', publicationInfoEditorDirective);\n\n  /** @ngInject */\n  function publicationInfoEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/publication-info-editor/publication-info-editor.html',\n      scope: {\n        pubInfo: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('editionEditor', editionEditorDirective);\n\n  /** @ngInject */\n  function editionEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/edition-editor/edition-editor.html',\n      scope: {\n        edition: '=ngModel'\n      },\n      controller: EditionEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function EditionEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.volumes = [];\n\n      vm.createVolume = createVolume;\n      vm.deleteVolume = deleteVolume;\n\n      activate();\n\n      function activate() {\n        $scope.edition.volumes.forEach(function (volume) {\n          vm.volumes.push({\n            model: volume,\n            focused: false\n          });\n        });\n      }\n\n      function createVolume() {\n        var volume = worksRepo.createVolume();\n        volume.titles = _.cloneDeep($scope.edition.titles);\n        volume.authors = _.cloneDeep($scope.edition.authors);\n        volume.otherAuthors = _.cloneDeep($scope.edition.otherAuthors);\n        volume.publicationInfo = _.cloneDeep($scope.edition.publicationInfo);\n\n        $scope.edition.volumes.push(volume);\n        vm.volumes.push({\n          model: volume,\n          focused: true\n        });\n      }\n\n      function deleteVolume(ix) {\n        vm.volumes.splice(ix, 1);\n        $scope.edition.volumes.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('copyEditor', copyEditorDirective);\n\n  /** @ngInject */\n  function copyEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/copy-editor/copy-editor.html',\n      scope: {\n        copy: '=ngModel'\n      },\n      controller: CopyEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function CopyEditorController($scope) {\n    var vm = this;\n\n    vm.refHandlers = {};\n    vm.setProperties = parseProperties;\n\n    activate();\n\n    function activate() {\n      addHandler(HathiTrustRefHandler());\n      addHandler(GoogleBooksRefHandler());\n      addHandler(InternetArchiveRefHandler());\n    }\n\n    function addHandler(handler) {\n      vm.refHandlers[handler.id] = handler;\n    }\n\n    function parseProperties(type, url) {\n      if (vm.refHandlers[type]) {\n        $scope.copy.properties = vm.refHandlers[type](url);\n      }\n\n      $scope.copyForm.url.$setValidity(type, $scope.copy.properties != null);\n    }\n  }\n\n  // https://archive.org/details/essayinanswertom00adamiala\n  // <iframe src='https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n7/mode/1up' width='480px' height='430px' frameborder='0' ></iframe>\n  // TODO add support for resources from OpenLibrary\n  // https://openlibrary.org/books/OL7186607M/An_essay_in_answer_to_Mr._Hume's_Essay_on_miracles.\n\n  /**\n   * A reference parse handler to support digital copies from the Internet\n   * Archive.\n   */\n  function InternetArchiveRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var seq;\n      var id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1)\n      var pageNo = parsed.fragment.match(/page\\/([^\\/]+)/);\n      if (pageNo && pageNo.length >= 2) {\n        seq = pageNo[1];\n      }\n\n      return makePropertiesObject(parsed.toString(), id, seq);\n    }\n\n    handle.id = 'internetarchive';\n    handle.display = 'Internet Archive';\n\n    /**\n     * Constructs an object literal that represents the stored-properties\n     * to associate with an InternetArchive digital copy.\n     *\n     * @param  {string} src The source URL from which the properties were parsed.\n     * @param  {string} id  The identifier used to uniquely reference a\n     *                      particular digial copy at the Internet Archive.\n     * @param  {string} seq The sequence number that identifies the page to be\n     *                      used as the initial page of this digital copy.\n     * @return {object}     The object literal of properties to be associated\n     *                      with this digital copy.\n     */\n    function makePropertiesObject(src, id, seq) {\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: src,\n        id: id,\n        seq: seq\n      };\n    }\n\n    return handle;\n  }\n\n  function HathiTrustRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      switch (parsed.hostname) {\n        case 'babel.hathitrust.org':\n          id = parsed.query.id;\n          seq = parsed.query.seq;\n          break;\n\n        case 'hdl.handle.net':\n          id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1);\n\n          if (!parsed.query.urlappend) {\n            break;\n          }\n\n          var subquery = parseQueryString(parsed.query.urlappend);\n          if (!subquery) {\n            break;\n          }\n          seq = subquery.seq;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        htid: id,\n        seq: seq\n      };\n    }\n\n    handle.id = 'hathitrust';\n    handle.display = 'HathiTrust';\n\n    return handle;\n  }\n\n  function GoogleBooksRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      switch (parsed.hostname) {\n        case 'books.google.com':\n          var id = parsed.query.id;\n          var section = parsed.query.printsec;\n          var page = parsed.query.pg;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        id: id,\n        section: section,\n        page: page\n      };\n    }\n\n    handle.id = 'googlebooks';\n    handle.display = 'Google Books';\n\n    return handle;\n  }\n\n  /**\n   * Parses a URL string into its components\n   *\n   * @param  {string} url\n   * @return {URL}\n   */\n  function parseUrl(url) {\n    if (!url) {\n      return null;\n    }\n\n    // eslint-disable-next-line angular/document-service\n    var parser = document.createElement('a');\n    parser.href = url;\n\n    return {\n      toString: function() {\n        return url;\n      },\n      protocol: parser.protocol,\n      host: parser.host,\n      hostname: parser.hostname,\n      port: parser.port,\n      path: parser.pathname,\n      query: parseQueryString(parser.search),\n      fragment: parser.hash\n    };\n  }\n\n  /**\n   * Parses a query string into key/value pairs\n   *\n   * @param {string} query\n   * @return {object.<string,any>}\n   */\n  function parseQueryString(query, sep) {\n    if (!query || !angular.isString(query)) {\n      return {};\n    }\n\n    // remove leading '?'\n    if (query[0] === '?') {\n      query = query.substr(1);\n    }\n\n    // attempt to auto-detect separator\n    if (!sep) {\n      // auto-detection \"bitmask\"\n      // 0 = none detected -- prefer '&'\n      // 1 = only ';' detected -- use it\n      // 2 = only '&' detected -- use it\n      // 3 = both detected -- prefer '&'\n      var flags = (query.indexOf(';') >= 0 ? 1 : 0) + (query.indexOf('&') >= 0 ? 2 : 0);\n      sep = flags === 1 ? ';' : '&';\n    }\n\n    var parsed = {};\n\n    var kvpairs = query.split(sep);\n    kvpairs.forEach(function (pair) {\n      var ix = pair.indexOf('=');\n      var key = pair;\n      var value = null;\n\n      if (!key) {\n        return;\n      }\n\n      if (ix >= 0) {\n        key = pair.substr(0, ix);\n        value = pair.substr(ix + 1);\n      }\n\n      try {\n        key = decodeURIComponent(key);\n        value = decodeURIComponent(value);\n      } catch (URIError) {\n        return;\n      }\n\n      // TODO: handle key array/map notation\n\n      if (parsed.hasOwnProperty(key)) {\n        // convert repeated keys into an array\n        if (angular.isArray(parsed[key])) {\n          parsed[key].push(value);\n        } else {\n          parsed[key] = [parsed[key], value];\n        }\n      } else {\n        parsed[key] = value;\n      }\n    });\n\n    return parsed;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('authorRefEditor', authorRefEditorDirective);\n\n  /** @ngInject */\n  function authorRefEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/author-ref-editor/author-ref-editor.html',\n      scope: {\n        ref: '=ngModel'\n      },\n      controller: AuthorRefEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function AuthorRefEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.linkAuthorSearchText = '';\n      vm.authorRoles = [\n        'author',\n        'editor',\n        'translator',\n        'other'\n      ];\n\n      vm.setLinkedAuthor = setLinkedAuthor;\n      vm.getResults = getResults;\n\n      activate();\n\n      function activate() {\n        if ($scope.ref.authorId) {\n          var author = peopleRepo.get($scope.ref.authorId);\n          author.$promise.then(function () {\n            vm.linkAuthorSearchText = author.name.label;\n          })\n        }\n      }\n\n      function setLinkedAuthor(person) {\n        $scope.ref.authorId = person.id;\n      }\n\n      function getResults(query) {\n        var resultSet = peopleRepo.search(query);\n        return resultSet.$promise.then(function () {\n          return resultSet.items;\n        });\n      }\n\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise', [\n      'google.books',\n      'cfp.hotkeys',\n      'trcWorks',\n      'trcBio'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .provider('workspaceRepository', workspaceRepositoryProvider);\n\n  /** @ngInject */\n  function workspaceRepositoryProvider(vwise) {\n    var NgWorkspaceRepository = declare(vwise);\n\n    var provider = {\n      url: '/api/vwise',\n      $get: workspaceRepositoryFactory\n    };\n\n    return provider;\n\n    /** @ngInject */\n    function workspaceRepositoryFactory(panelContentMediatorRegistry, $http, $q) {\n      return new NgWorkspaceRepository(panelContentMediatorRegistry, provider.url, $http, $q);\n    }\n  }\n\n  /**\n   * Declares and returns the NgWorkspaceRepository class.\n   * Required protoypical inheritance of vwise.WorkspaceRepository makes this class definition verbose but necessary.\n   * Ideally (and eventually) this should be done as an ES6 class in a separate file and loaded via an import statement.\n   * @param  {vwise} vwise\n   * @return {Class.<NgWorkspaceRepository>}\n   */\n  function declare(vwise) {\n    /**\n     * Angularized Workspace Repository; makes use of $http, and $q services (must be injected at construction)\n     * @class\n     * @extends {vwise.WorkspaceRepository}\n     */\n    function NgWorkspaceRepository(mediatorRegistry, url, $http, $q) {\n      vwise.WorkspaceRepository.call(this, mediatorRegistry);\n\n      // injected services and configuration options\n      this.$http = $http;\n      this.$q = $q;\n      this.url = url;\n\n      /**\n       * A cache for storing loaded workspace instances\n       * @type {vwis.Cache.<Promise.<Workspace>}\n       */\n      this.workspaces = new vwise.Cache;\n\n      /**\n      * A cache for storing loaded panel instances\n      * @type {vwis.Cache.<Promise.<Panel>}\n      */\n      this.panels = new vwise.Cache;\n    }\n\n    NgWorkspaceRepository.prototype = Object.create(vwise.WorkspaceRepository.prototype);\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.createWorkspace = function createWorkspace(title) {\n      var id = vwise.UUID.uuid4();\n      var workspace = new vwise.Workspace(id, this);\n\n      if (title) {\n        workspace.title = title;\n      }\n\n      this.workspaces[workspace.id] = workspace;\n      return this.$q.when(workspace);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.saveWorkspace = function saveWorkspace(workspace) {\n      if (!(workspace instanceof vwise.Workspace)) {\n        throw new TypeError('expected instance of Workspace');\n      }\n\n      this.workspaces[workspace.id] = workspace;\n      return this.$q.when(workspace);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.getWorkspace = function getWorkspace(id) {\n      return this.workspaces[id] ? this.$q.when(this.workspaces[id]) : this.$q.reject(new Error('workspace not found'));\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.createPanel = function createPanel(mediator, workspace, content) {\n      var id = vwise.UUID.uuid4();\n      var repo = this;\n      var panel = new vwise.Panel(id, mediator, workspace, content, function (p) {\n        repo.savePanel(p);\n      });\n\n      this.panels[panel.id] = panel;\n      return this.$q.when(panel);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.savePanel = function savePanel(panel) {\n      if (!(panel instanceof vwise.Panel)) {\n        throw new TypeError('expected instance of Panel');\n      }\n\n      this.panels[panel.id] = panel;\n      return this.$q.when(panel);\n    };\n\n    /**\n     * @inheritdoc\n     */\n    NgWorkspaceRepository.prototype.getPanel = function getPanel(workspaceId, panelId) {\n      return this.panels[panelId] ? this.$q.when(this.panels[panelId]) : this.$q.reject(new Error('panel not found'));\n    };\n\n    return NgWorkspaceRepository;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('workPanel', workPanelDirective);\n\n  /** @ngInject */\n  function workPanelDirective(worksRepo) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/work-panel/work-panel.html',\n      scope: {\n        work: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.title = worksRepo.getTitle(scope.work.titles);\n\n      scope.work.editions.forEach(function (edition) {\n        edition.type = 'edition';\n        edition.workId = scope.work.id;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('volumePanel', volumePanelDirective);\n\n  /** @ngInject */\n  function volumePanelDirective(worksRepo) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/work-panel/volume-panel.html',\n      scope: {\n        volume: '=',\n        workId: '@',\n        editionId: '@'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.title = worksRepo.getTitle(scope.volume.titles);\n\n      scope.edition = worksRepo.getEdition(scope.workId, scope.editionId);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('editionPanel', editionPanelDirective);\n\n  /** @ngInject */\n  function editionPanelDirective(worksRepo) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/work-panel/edition-panel.html',\n      scope: {\n        edition: '=',\n        workId: '@'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.title = worksRepo.getTitle(scope.edition.titles);\n\n      scope.edition.volumes.forEach(function (volume) {\n        volume.type = 'volume';\n        volume.workId = scope.workId;\n        volume.editionId = scope.edition.id;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('personPanel', personPanelDirective);\n\n  var NAME_KEYS = ['title', 'givenName', 'middleName', 'familyName', 'suffix'];\n\n  /** @ngInject */\n  function personPanelDirective(_) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/vwise/components/person-panel/person-panel.html',\n      scope: {\n        person: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      var name = scope.person.name;\n\n      scope.name = name.label || _.at(name, NAME_KEYS)\n        .map(function (n) { return n.trim(); })\n        .filter(_.identity)\n        .join(' ');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('worksContentMediator', worksContentMediatorFactory);\n\n  /** @ngInject */\n  function worksContentMediatorFactory(vwise, worksRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'works', 'Works Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'work' && obj.id;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadWork(obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadWork(dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'work',\n        id: panelData.id\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<work-panel work=\"content\" flex layout=\"column\"></work-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadWork(id) {\n      var work = worksRepo.get(id);\n      return work.$promise;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('volumesContentMediator', volumesContentMediatorFactory);\n\n  /** @ngInject */\n  function volumesContentMediatorFactory(vwise, worksRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'volumes', 'Volumes Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'volume' && obj.id && obj.workId && obj.editionId;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadVolume(obj.workId, obj.editionId, obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadVolume(dto.workId, dto.editionId, dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'volume',\n        id: panelData.id,\n        workId: panelData.workId,\n        editionId: panelData.editionId\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<volume-panel volume=\"content\" edition-id=\"{{content.editionId}}\" work-id=\"{{content.workId}}\" flex layout=\"column\"></volume-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadVolume(workId, editionId, volumeId) {\n      var volume = worksRepo.getVolume(workId, editionId, volumeId);\n      return volume.$promise.then(function () {\n        volume.workId = workId;\n        volume.editionId = editionId;\n        return volume;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('peopleContentMediator', peopleContentMediatorFactory);\n\n  /** @ngInject */\n  function peopleContentMediatorFactory(vwise, peopleRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'people', 'People Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'person' && obj.id;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadPerson(obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadPerson(dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'person',\n        id: panelData.id\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<person-panel person=\"content\" flex layout=\"column\"></person-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadPerson(id) {\n      var person = peopleRepo.get(id);\n      return person.$promise;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('passthruContentMediator', passthruContentMediatorFactory);\n\n  /** @ngInject */\n  function passthruContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'passthru', 'Pass-Through Debug Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches() {\n      return true;\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('panelContentMediatorRegistry', panelContentMediatorRegistryFactory);\n\n  /** @ngInject */\n  function panelContentMediatorRegistryFactory(vwise) {\n    return new vwise.PanelContentMediatorRegistry();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('noteContentMediator', noteContentMediatorFactory);\n\n  /** @ngInject */\n  function noteContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'notes', 'Note Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.hasOwnProperty('note');\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<div ng-model=\"content.note\" contenteditable flex></div>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('editionsContentMediator', editionsContentMediatorFactory);\n\n  /** @ngInject */\n  function editionsContentMediatorFactory(vwise, worksRepo) {\n\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'editions', 'Editions Content Mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'edition' && obj.id && obj.workId;\n    };\n\n    Mediator.prototype.initPanelData = function initPanelData(obj) {\n      return loadEdition(obj.workId, obj.id);\n    };\n\n    Mediator.prototype.unmarshall = function unmarshall(dto) {\n      return loadEdition(dto.workId, dto.id);\n    };\n\n    Mediator.prototype.marshall = function marshall(panelData) {\n      var dto = {\n        type: 'edition',\n        id: panelData.id,\n        workId: panelData.workId\n      };\n\n      return dto;\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<edition-panel edition=\"content\" work-id=\"{{content.workId}}\" flex layout=\"column\"></edition-panel>'\n    };\n\n    return new Mediator();\n\n\n    function loadEdition(workId, editionId) {\n      var edition = worksRepo.getEdition(workId, editionId);\n      return edition.$promise.then(function () {\n        edition.workId = workId;\n        return edition;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('internetArchiveContentMediator', internetArchiveContentMediatorFactory);\n\n  /** @ngInject */\n  function internetArchiveContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'ia-reader', 'Internet Archive Digital Copy mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'internetarchive';\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<ia-reader properties=\"content.properties\" flex></ia-reader>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('hathitrustContentMediator', hathitrustContentMediatorFactory);\n\n  /** @ngInject */\n  function hathitrustContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'ht-reader', 'HathiTrust Digital Copy mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'hathitrust';\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<hathitrust-reader properties=\"content.properties\" flex></hathitrust-reader>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .factory('googleBooksContentMediator', googleBooksContentMediatorFactory);\n\n  /** @ngInject */\n  function googleBooksContentMediatorFactory(vwise) {\n    function Mediator() {\n      vwise.PanelContentMediator.call(this, 'gb-reader', 'Google Books Digital Copy mediator');\n    }\n\n    Mediator.prototype = Object.create(vwise.PanelContentMediator.prototype);\n\n    Mediator.prototype.matches = function matches(obj) {\n      return obj.type && obj.type === 'googlebooks';\n    };\n\n    Mediator.prototype.getTemplate = function getTemplate() {\n      return '<google-book-reader properties=\"content.properties\" flex></google-book-reader>'\n    };\n\n    return new Mediator();\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .directive('vwisePanel', vwisePanel);\n\n  /** @ngInject */\n  function vwisePanel ($compile) {\n    var directive = {\n      restrict: 'A',\n      templateUrl: 'app/vwise/components/panel/panel.html',\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc($scope, $el, attrs) {\n      var panel = $scope.$eval(attrs.vwisePanel);\n      if (!panel) {\n        throw new Error('no panel provided');\n      }\n\n      var panelScope = $scope.$new(true);\n      panelScope.content = panel.content;\n      panelScope.vprops = panel.vprops;\n\n      panelScope.$watch('vprops.background', function (color) {\n        var match = color.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);\n\n        if (!match) {\n          return;\n        }\n\n        // Foreground calculation from http://stackoverflow.com/a/3943023\n\n        // calculate luminance coefficient\n        // see https://en.wikipedia.org/wiki/Luma_(video)#Rec._601_luma_versus_Rec._709_luma_coefficients\n        var r = parseInt(match[1], 16) / 255;\n        var g = parseInt(match[2], 16) / 255;\n        var b = parseInt(match[3], 16) / 255;\n\n        panel.vprops.foreground = calculateForeground(r, g, b);\n      });\n\n      var template = panel.contentMediator.getTemplate();\n\n      var contentArea = $el.find('.content');\n      contentArea.html(template);\n      $compile(contentArea.contents())(panelScope);\n    }\n  }\n\n  function calculateForeground(r, g, b) {\n    r = (r <= 0.03928) ? r / 12.92 : Math.pow((r + 0.055) / 1.055, 2.4);\n    g = (g <= 0.03928) ? g / 12.92 : Math.pow((g + 0.055) / 1.055, 2.4);\n    b = (b <= 0.03928) ? b / 12.92 : Math.pow((b + 0.055) / 1.055, 2.4);\n\n    var lum = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n\n    // set contrast color based on W3C recommendations\n    // see https://www.w3.org/TR/WCAG20/\n\n    // panel.vprops.foreground = (lum > 0.179) ? '#000000' : '#ffffff';\n    // adjusted so that #808080 is the transition point between FG colors\n    return (lum > 0.215) ? 'rgba(0,0,0,0.87)' : 'rgba(255,255,255,0.87)';\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('vwise')\n      .directive('iaReader', iaReader);\n\n   /** @ngInject */\n   function iaReader($sce) {\n      var directive = {\n         restrict: 'E',\n         template: '<iframe ng-src=\"{{src}}\">',\n         replace: true,\n         link: linkFunc,\n         scope: {\n            properties: '='\n         }\n      };\n\n      return directive;\n\n      function linkFunc(scope) {\n        scope.$watch('properties', function(properties) {\n           // TODO add page link\n            //  <iframe class=\"reader flex\" src=\"https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n5/mode/2up\" frameborder=\"0\"></iframe>\n           scope.src = $sce.trustAsResourceUrl('https://archive.org/stream/' + properties.id + '?ui=embed#mode/2up');\n        });\n      }\n   }\n\n})();\n\n(function () {\n   'use strict';\n\n   var READER_URL = 'https://babel.hathitrust.org/cgi/pt';\n\n   angular\n      .module('vwise')\n      .directive('hathitrustReader', hathitrustReader);\n\n   /** @ngInject */\n   function hathitrustReader($sce, _) {\n      var directive = {\n         restrict: 'E',\n         template: '<iframe ng-src=\"{{src}}\">',\n         replace: true,\n         link: linkFunc,\n         scope: {\n            properties: '='\n         }\n      };\n\n      return directive;\n\n      function linkFunc(scope) {\n         scope.$watch('properties', function (properties) {\n            var params = {\n               id: properties.htid,\n               ui: 'embed'\n            };\n\n            if (properties.seq) {\n               params.seq = properties.seq;\n            }\n\n            var queryString = _.map(params, function (value, key) {\n               return key + '=' + value;\n            }).join(';');\n\n            var url = READER_URL + '?' + queryString;\n\n            scope.src = $sce.trustAsResourceUrl(url);\n         });\n      }\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('workEditorItem', workEditorItemDirective);\n\n  /** @ngInject */\n  function workEditorItemDirective($log) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/task/components/work-editor/work-editor-item.html',\n      link: linkFunc,\n      scope: {\n        id: '=id'\n      },\n      controller: WorkEditorItemController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc($scope) {\n      if (!$scope.id) {\n        $log.error('missing required attribute \"id\"');\n      }\n    }\n\n    /** @ngInject */\n    function WorkEditorItemController($scope, worksRepo) {\n      var vm = this;\n\n      vm.loaded = false;\n\n      activate();\n\n      function activate() {\n        if ($scope.id) {\n          vm.work = worksRepo.get($scope.id);\n          vm.work.$promise.then(function () {\n            vm.loaded = true;\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('nameEditor', nameEditorDirective);\n\n  /** @ngInject */\n  function nameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/name-editor/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('eventEditor', eventEditorDirective);\n\n  /** @ngInject */\n  function eventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/event-editor/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('ArticleEditorController', ArticleEditorController);\n\n  /** @ngInject */\n  function ArticleEditorController(articlesRepo, $log) {\n    var vm = this;\n    vm.save = save;\n    vm.cancel = cancel;\n    vm.body = \"test\";\n\n    vm.editor = {\n      config: {\n        toolbarGroups: [\n          { name: 'styles', groups: [ 'styles' ] },\n          { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n          { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n          { name: 'links', groups: [ 'links' ] },\n          { name: 'insert', groups: [ 'insert' ] },\n          { name: 'clipboard', groups: [ 'undo', 'clipboard' ] },\n          { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n        ],\n\n        removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles',\n\n        // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n        format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address'\n      }\n    };\n\n    vm.article = {\n      body: \"Click here to edit article\"\n    }\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo)\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n     function save() {\n      //  alert(vm.article.body);\n      $log.debug(vm.article.body);\n     }\n\n     function cancel() {\n       alert('cancel');\n     }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('summaryEditor', summaryEditorDirective);\n\n  /** @ngInject */\n  function summaryEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/summary-editor/summary-editor.html',\n      scope: {\n        summary: '=ngModel',\n        config: {\n          // FIXME set up minimal toolbar and restrict HTML content\n          toolbarGroups: [\n            { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n            { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n            { name: 'links', groups: [ 'links' ] },\n            { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n          ],\n\n          removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles'\n        }\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('SummaryEditDialogController', SummaryEditDialogController);\n\n  /** @ngInject */\n  function SummaryEditDialogController($mdDialog, summary) {\n    var vm = this;\n\n    vm.summary = summary;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.summary);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .directive('dateEditor', dateEditorDirective);\n\n  /** @ngInject */\n  function dateEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/date-editor/date-editor.html',\n      scope: {\n        date: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('ShowWorkController', ShowWorkController);\n\n  /** @ngInject */\n  function ShowWorkController($state, $stateParams, worksRepo, relationshipsRepo, $mdDialog, $mdToast, $q, $timeout) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.title = null;\n    vm.relationships = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addEdition = addEdition;\n    vm.deleteEdition = deleteEdition;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n\n      vm.work = worksRepo.get(workId);\n\n      vm.work.$promise.then(function () {\n        vm.bcTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n        vm.title = worksRepo.getTitle(vm.work.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      var relationshipsPromise = loadRelationships();\n\n      $q.all([vm.work.$promise, relationshipsPromise]).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function getCurrentUri() {\n      var workId = $stateParams.workId;\n      return 'works/' + workId;\n    }\n\n    function loadRelationships() {\n      vm.relationships = [];\n      var currentUri = getCurrentUri();\n      var relationships = relationshipsRepo.search(currentUri);\n      return relationships.$promise.then(function () {\n        vm.relationships = relationshipsRepo.normalizeRelationships(relationships, currentUri, worksRepo);\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          work: angular.copy(vm.work)\n        },\n        controller: 'WorkEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedWork) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.work, updatedWork);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.work.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.work.summary = updatedSummary;\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n    }\n\n    function addEdition($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Edition')\n        .textContent('Please provide a name for the new edition.')\n        .placeholder('edition name')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (editionName) {\n        var edition = worksRepo.createEdition();\n        edition.editionName = editionName;\n        edition.titles = angular.copy(vm.work.titles);\n        edition.authors = angular.copy(vm.work.authors);\n        edition.otherAuthors = angular.copy(vm.work.otherAuthors);\n\n        vm.work.editions.push(edition);\n\n        // resolve to the created edition when save is successful\n        return worksRepo.saveEdition(vm.work.id, edition);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (edition) {\n        $state.go('editor.edition', { workId: vm.work.id, editionId: edition.id });\n      });\n    }\n\n    function deleteEdition(edition, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this edition?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.editions.indexOf(edition);\n          if (ix >= 0) {\n            vm.work.editions.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.work.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/copy-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          copy: angular.copy(copy)\n        },\n        controller: 'CopyEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.work.copies.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast);\n          }\n        });\n    }\n\n    function openRelationship(relationship) {\n      // HACK just working with first entity\n      var entity = relationship.entities[0];\n      $state.go('editor.' + entity.type, entity.refParams);\n    }\n\n    function addRelationship($event) {\n      var relationship = relationshipsRepo.createRelationship();\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/relationship-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          relationship: angular.copy(relationship),\n          currentUri: getCurrentUri()\n        },\n        controller: 'RelationshipEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (updatedRelationship) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(relationship, updatedRelationship);\n\n        return relationshipsRepo.save(relationship);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function () {\n        // HACK give relationship a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n\n    }\n\n    function deleteRelationship(relationship, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      var deletePromise = confirmPromise.then(function () {\n        return relationshipsRepo.delete(relationship.id);\n      });\n\n      deletePromise.then(showSavedToast);\n\n      deletePromise.then(function () {\n        // HACK give relationship a chance to be deleted from the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('WorkEditDialogController', WorkEditDialogController);\n\n  /** @ngInject */\n  function WorkEditDialogController($mdDialog, work) {\n    var vm = this;\n\n    vm.work = work;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.work);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.work[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.work[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.work[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.work.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.work.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.work.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('ShowVolumeController', ShowVolumeController);\n\n  /** @ngInject */\n  function ShowVolumeController($state, $stateParams, worksRepo, relationshipsRepo, _, $mdDialog, $mdToast, $q, $timeout) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.volume = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId\n      var editionId = $stateParams.editionId;\n      var volumeId = $stateParams.volumeId;\n\n      vm.work = worksRepo.getWork(workId);\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      vm.volume = worksRepo.getVolume(workId, editionId, volumeId);\n\n      vm.work.$promise.then(function () {\n        vm.workTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n      });\n\n      vm.volume.$promise.then(function () {\n        vm.title = worksRepo.getTitle(vm.volume.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      var relationshipsPromise = loadRelationships();\n\n      $q.all([vm.work.$promise, vm.edition.$promise, vm.volume.$promise, relationshipsPromise]).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function getCurrentUri() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n      var volumeId = $stateParams.volumeId;\n      return 'works/' + workId + '/editions/' + editionId + '/volumes/' + volumeId;\n    }\n\n    function loadRelationships() {\n\n      vm.relationships = [];\n      var currentUri = getCurrentUri();\n      var relationships = relationshipsRepo.search(currentUri);\n      relationships.$promise.then(function () {\n        vm.relationships = relationshipsRepo.normalizeRelationships(relationships, currentUri, worksRepo);\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/volume-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          volume: angular.copy(vm.volume)\n        },\n        controller: 'VolumeEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedVolume) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.volume, updatedVolume);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.volume.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.volume.summary = updatedSummary;\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.volume.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/copy-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          copy: angular.copy(copy)\n        },\n        controller: 'CopyEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.volume.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.volume.copies.splice(ix, 1);\n            worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast);\n          }\n        });\n    }\n\n    function openRelationship(relationship) {\n      // HACK just working with first entity\n      var entity = relationship.entities[0];\n      $state.go('editor.' + entity.type, entity.refParams);\n    }\n\n    function addRelationship($event) {\n      var relationship = relationshipsRepo.createRelationship();\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/relationship-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          relationship: angular.copy(relationship),\n          currentUri: getCurrentUri()\n        },\n        controller: 'RelationshipEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (updatedRelationship) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(relationship, updatedRelationship);\n\n        return relationshipsRepo.save(relationship);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function deleteRelationship(relationship, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      var deletePromise = confirmPromise.then(function () {\n        return relationshipsRepo.delete(relationship.id);\n      });\n\n      deletePromise.then(showSavedToast);\n\n      deletePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('VolumeEditDialogController', VolumeEditDialogController);\n\n  /** @ngInject */\n  function VolumeEditDialogController($mdDialog, volume) {\n    var vm = this;\n\n    vm.volume = volume;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.volume);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.volume[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.volume[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.volume[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.volume.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.volume.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.volume.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('RelationshipEditDialogController', RelationshipEditDialogController);\n\n  /** @ngInject */\n  function RelationshipEditDialogController($mdDialog, worksRepo, relationshipsRepo, currentUri, relationship) {\n    var vm = this;\n\n    vm.relationship = relationship;\n    vm.types = [];\n    vm.selectedType = null;\n    vm.targets = [];\n    vm.selectedTarget = null;\n    vm.searchText = '';\n    vm.isReverse = false;\n\n    vm.getResults = getResults;\n    vm.selectWork = selectWork;\n    vm.setType = setType;\n    vm.setTarget = setTarget;\n    vm.close = close;\n    vm.cancel = cancel;\n\n    activate();\n\n    function activate() {\n      vm.types = getTypes();\n\n      vm.target = relationshipsRepo.createAnchor();\n      vm.relationship.targetEntities = [vm.target];\n\n      var self = relationshipsRepo.createAnchor();\n      self.entryUris = [currentUri];\n      vm.relationship.relatedEntities = [self];\n\n      vm.relationship.descriptionMimeType = 'text/html';\n    }\n\n    function getTypes() {\n      var rawTypes = relationshipsRepo.getTypes();\n      var types = [];\n\n      Object.defineProperty(types, '$promise', {\n        value: rawTypes.$promise\n      });\n\n      rawTypes.$promise.then(function () {\n        angular.forEach(rawTypes, function (type) {\n          types.push({\n            id: type.identifier,\n            label: type.title,\n            reverse: false\n          });\n\n          if (type.isDirected) {\n            types.push({\n              id: type.identifier,\n              label: type.reverseTitle,\n              reverse: true\n            });\n          }\n        });\n      });\n\n      return types;\n    }\n\n    function getResults(query) {\n      var results = worksRepo.search(query);\n      return results.$promise.then(function () {\n        return results.items;\n      });\n    }\n\n    function setType(type) {\n      vm.relationship.typeId = type.id;\n      if (vm.isReverse && !type.reverse || !vm.isReverse && type.reverse) {\n        var swap = vm.relationship.relatedEntities;\n        vm.relationship.relatedEntities = vm.relationship.targetEntities;\n        vm.relationship.targetEntities = swap;\n      }\n      vm.isReverse = type.reverse;\n    }\n\n    function selectWork(workProxy) {\n      vm.targets = [];\n\n      if (!workProxy) {\n        return;\n      }\n\n      var work = worksRepo.getWork(workProxy.id);\n\n      work.$promise.then(function () {\n        var workUri = 'works/' + work.id;\n        var workTitle = worksRepo.getTitle(work.titles, ['short', 'canonical', 'bibliographic']);\n\n        vm.targets.push({\n          uri: workUri,\n          label: workTitle.title + (workTitle.subtitle ? ': ' + workTitle.subtitle : '')\n        });\n\n        work.editions.forEach(function (edition) {\n          var editionUri = workUri + '/editions/' + edition.id;\n          var editionTitle = worksRepo.getTitle(edition.titles, ['short', 'canonical', 'bibliographic']);\n\n          vm.targets.push({\n            uri: editionUri,\n            label: editionTitle.title + (editionTitle.subtitle ? ': ' + editionTitle.subtitle : '') + '. ' + edition.editionName\n          });\n\n          edition.volumes.forEach(function (volume) {\n            var volumeUri = editionUri + '/volumes/' + volume.id;\n            var volumeTitle = worksRepo.getTitle(volume.titles, ['short', 'canonical', 'bibliographic']);\n\n            vm.targets.push({\n              uri: volumeUri,\n              label: volumeTitle.title + (volumeTitle.subtitle ? ': ' + volumeTitle.subtitle : '') + '. ' + edition.editionName + '. Volume ' + volume.volumeNumber\n            });\n          });\n        });\n\n        vm.selectedTarget = vm.targets[0];\n        setTarget(vm.selectedTarget);\n      });\n    }\n\n    function setTarget(target) {\n      vm.target.entryUris = target && target.uri ? [target.uri] : [];\n    }\n\n    function close() {\n      $mdDialog.hide(vm.relationship);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('ShowEditionController', ShowEditionController);\n\n  /** @ngInject */\n  function ShowEditionController($state, $stateParams, worksRepo, relationshipsRepo, _, $mdDialog, $mdToast, $q, $timeout) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addVolume = addVolume;\n    vm.deleteVolume = deleteVolume;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n\n      vm.work = worksRepo.getWork(workId);\n      vm.edition = worksRepo.getEdition(workId, editionId);\n\n      vm.work.$promise.then(function () {\n        vm.workTitle = worksRepo.getTitle(vm.work.titles, ['short', 'canonical', 'bibliographic']);\n      });\n\n      vm.edition.$promise.then(function () {\n        vm.title = worksRepo.getTitle(vm.edition.titles, ['canonical', 'bibliographic', 'short']);\n      });\n\n      var relationshipsPromise = loadRelationships();\n\n      $q.all([vm.work.$promise, vm.edition.$promise, relationshipsPromise]).then(function (){\n        vm.loading = false;\n      });\n    }\n\n    function getCurrentUri() {\n      var workId = $stateParams.workId;\n      var editionId = $stateParams.editionId;\n\n      return 'works/' + workId + '/editions/' + editionId;\n    }\n\n    function loadRelationships() {\n\n      vm.relationships = [];\n      var currentUri = getCurrentUri();\n      var relationships = relationshipsRepo.search(currentUri);\n      relationships.$promise.then(function () {\n        vm.relationships = relationshipsRepo.normalizeRelationships(relationships, currentUri, worksRepo);\n      });\n    }\n\n    function editBibInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/edition-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          edition: angular.copy(vm.edition)\n        },\n        controller: 'EditionEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedEdition) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.edition, updatedEdition);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.edition.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.edition.summary = updatedSummary;\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n    }\n\n    function addVolume($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Volume')\n        .textContent('Please provide a number for the new volume.')\n        .placeholder('volume number')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (volumeNumber) {\n        var volume = worksRepo.createVolume();\n        volume.volumeNumber = volumeNumber;\n        volume.titles = angular.copy(vm.edition.titles);\n        volume.authors = angular.copy(vm.edition.authors);\n        volume.otherAuthors = angular.copy(vm.edition.otherAuthors);\n        volume.publicationInfo = angular.copy(vm.edition.publicationInfo);\n\n        vm.edition.volumes.push(volume);\n\n        return worksRepo.saveVolume(vm.work.id, vm.edition.id, volume);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (volume) {\n        $state.go('editor.volume', { workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id });\n      });\n    }\n\n    function deleteVolume(volume, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this volume?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.volumes.indexOf(volume);\n          if (ix >= 0) {\n            vm.edition.volumes.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.edition.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/copy-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          copy: angular.copy(copy)\n        },\n        controller: 'CopyEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.edition.copies.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast);\n          }\n        });\n    }\n\n    function openRelationship(relationship) {\n      // HACK just working with first entity\n      var entity = relationship.entities[0];\n      $state.go('editor.' + entity.type, entity.refParams);\n    }\n\n    function addRelationship($event) {\n      var relationship = relationshipsRepo.createRelationship();\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/relationship-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          relationship: angular.copy(relationship),\n          currentUri: getCurrentUri()\n        },\n        controller: 'RelationshipEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (updatedRelationship) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(relationship, updatedRelationship);\n\n        return relationshipsRepo.save(relationship);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function deleteRelationship(relationship, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      var deletePromise = confirmPromise.then(function () {\n        return relationshipsRepo.delete(relationship.id);\n      });\n\n      deletePromise.then(showSavedToast);\n\n      deletePromise.then(function () {\n        // HACK give relationships a chance to save on the server\n        $timeout(loadRelationships, 1000);\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('EditionEditDialogController', EditionEditDialogController);\n\n  /** @ngInject */\n  function EditionEditDialogController($mdDialog, edition) {\n    var vm = this;\n\n    vm.edition = edition;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.edition);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.edition[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.edition[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.edition[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.edition.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.edition.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.edition.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('CopyEditDialogController', CopyEditDialogController);\n\n  /** @ngInject */\n  function CopyEditDialogController($mdDialog, copy) {\n    var vm = this;\n\n    vm.copy = copy;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.copy);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .controller('WorkspaceController', WorkspaceController);\n\n  /** @ngInject */\n  function WorkspaceController(vwise, panelContentMediatorRegistry, workspaceRepository, $log, $scope, $timeout, $mdSidenav, hotkeys, _, $q, peopleRepo, worksRepo) {\n    var vm = this;\n\n    vm.workspace = new vwise.Workspace('test', workspaceRepository);\n\n    vm.items = [];\n    vm.activeItems = [];\n    vm.searchQuery = '';\n    vm.sidebarFocused = true;\n\n    vm.panelDragged = panelDragged;\n    vm.savePanelPosition = savePanelPosition;\n    vm.thingDropped = thingDropped;\n    vm.workspaceClicked = workspaceClicked;\n    vm.resizePanel = resizePanel;\n    vm.savePanelSize = savePanelSize;\n    vm.activatePanel = activatePanel;\n    vm.closePanel = closePanel;\n\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      [1,2,3,4].forEach(function (n) {\n        vm.items.push({\n          id: 'panel' + n,\n          label: 'Item ' + n,\n          text: 'This is the text content for item #' + n\n        });\n      });\n\n      hotkeys.bindTo($scope)\n        .add({\n          combo: 'ctrl+\\\\',\n          description: 'Toggle Sidebar',\n          callback: function () {\n            vm.sidebarFocused = !vm.sidebarFocused;\n          }\n        })\n        .add({\n          combo: '/',\n          description: 'Search',\n          callback: function () {\n            vm.searchQuery = '';\n            if (vm.sidebarFocused) {\n              $timeout(function () {\n                // prevent key event from typing in field\n                angular.element('#searchQuery').focus();\n              });\n            } else {\n              $mdSidenav('left').toggle();\n            }\n          }\n        })\n        .add({\n          combo: 'n',\n          description: 'Create a new note panel',\n          callback: function () {\n            createNotePanel(100, 100);\n          }\n        });\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      // TODO delegate to registered external search/content providers\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      function tagAll(key, value) {\n        return function (arr) {\n          arr.forEach(function (obj) {\n            obj[key] = value;\n          });\n          return arr;\n        };\n      }\n\n      $q.all([\n        vm.peopleResults.$promise.then(_.property('items')).then(tagAll('type', 'person')),\n        vm.worksResults.$promise.then(_.property('items')).then(tagAll('type', 'work'))\n      ])\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    /**\n     * Drag callback for when a panel is moved\n     * @param {Event}  evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel}  panel VWISE Panel instance being moved\n     */\n    function panelDragged(evt, ui, panel) {\n      panel.vprops.xPosition = ui.position.left;\n      panel.vprops.yPosition = Math.max(0, ui.position.top);\n    }\n\n    /**\n     * Drag callback for when a panel has been dropped after moving\n     * @param {Event} evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel} panel VWISE Panel instance being moved\n     */\n    function savePanelPosition(evt, ui, panel) {\n      // TODO: jQuery UI supports 'containment' option...\n      var top = Math.max(0, ui.position.top);\n\n      $log.debug('saving panel position at', [ui.position.left, top]);\n\n      panel.setPosition(ui.position.left, top);\n      activatePanel(panel);\n    }\n\n    /**\n     * Drag callback for when a panel's resize handle is moved\n     * @param {Event}  evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel}  panel VWISE Panel instance being resized\n     */\n    function resizePanel(evt, ui, panel) {\n      var width = ui.position.left + ui.helper.width();\n      var height = ui.position.top + ui.helper.height();\n\n      $scope.$apply(function () {\n        panel.vprops.width = Math.max(0, width);\n        panel.vprops.height = Math.max(0, height);\n      });\n    }\n\n    /**\n     * Drag callback for when a panel's resize handle has been dropped\n     * @param {Event}  evt   DOM event\n     * @param {Object} ui    jQuery UI draggable callback data\n     * @param {Panel}  panel VWISE Panel instance being resized\n     */\n    function savePanelSize(evt, ui, panel) {\n      var width = ui.position.left + ui.helper.width();\n      var height = ui.position.top + ui.helper.height();\n\n      $log.debug('saving panel size at', [width, height]);\n\n      $scope.$apply(function () {\n        panel.setSize(Math.max(0, width), Math.max(0, height));\n      })\n    }\n\n    /**\n     * Raises a panel to the top of the workspace stack\n     * @param {Panel} panel\n     * @param {Event} evt\n     */\n    function activatePanel(panel, evt) {\n      panel.activate();\n\n      if (evt && evt.stopPropagation) {\n        evt.stopPropagation();\n      }\n    }\n\n    /**\n     * Removes a panel from the workspace\n     * @param {Panel} panel\n     */\n    function closePanel(panel) {\n      panel.remove();\n    }\n\n    /**\n     * Drop callback for when something is droppen on the workspace content ariea\n     * @param  {Event}  evt DOM Event\n     * @param  {Object} ui  jQuery UI draggable callback data\n     */\n    function thingDropped(evt, ui) {\n      // get scope of object that was dropped\n      var itemScope = ui.draggable.scope();\n\n      // here's the data object of the panel we want to create\n      // scope variable is bound by ng-repeat on md-list in md-sidenav (see workspace.html)\n      var item = itemScope.item;\n\n      // if no item is available (e.g. if a panel was dropped)\n      if (!item) {\n        return;\n      }\n\n      var offsetX = angular.element('.md-sidenav-left').width();\n\n      var context = {\n        xPosition: ui.position.left - offsetX,\n        yPosition: ui.position.top\n      };\n\n      // who is capable of handling the dropped item\n      var contentMediators = panelContentMediatorRegistry.findContentMediators(item, context);\n      $log.debug('found ' + contentMediators.length + ' matching content mediator(s).');\n      var mediator = contentMediators.length > 0 ? contentMediators[0] : null;\n\n      if (!mediator) {\n        return;\n      }\n\n      var contentP = mediator.initPanelData(item, context);\n      var panelP = contentP.then(function (content) {\n        return vm.workspace.createPanel(mediator, content);\n      });\n\n      // set initial panel attributes\n      panelP.then(function (panel) {\n        $log.debug('created new panel');\n        panel.setPosition(context.xPosition, context.yPosition);\n        panel.setSize(600, 400);\n        panel.set('background', '#ffffff');\n      });\n    }\n\n    /**\n     * Creates a new note panel at the desired position\n     * @param {integer} x\n     * @param {integer} y\n     */\n    function createNotePanel(x, y) {\n      var note = {\n        note: ''\n      };\n\n      var context = {\n        xPosition: x,\n        yPosition: y\n      };\n\n      var contentMediators = panelContentMediatorRegistry.findContentMediators(note, context);\n      var mediator = contentMediators.length > 0 ? contentMediators[0] : null;\n      vm.workspace.createPanel(mediator, note).then(function (panel) {\n        panel.setPosition(context.xPosition, context.yPosition);\n      });\n    }\n\n    function workspaceClicked(evt) {\n      var offsetX = angular.element('.md-sidenav-left').width();\n\n      if (evt.ctrlKey) {\n        createNotePanel(evt.clientX - offsetX, evt.clientY);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock(panelContentMediatorRegistry, peopleContentMediator, worksContentMediator, editionsContentMediator, volumesContentMediator, googleBooksContentMediator, hathitrustContentMediator, internetArchiveContentMediator, noteContentMediator, passthruContentMediator) {\n    panelContentMediatorRegistry.register(peopleContentMediator);\n    panelContentMediatorRegistry.register(worksContentMediator);\n    panelContentMediatorRegistry.register(editionsContentMediator);\n    panelContentMediatorRegistry.register(volumesContentMediator);\n    panelContentMediatorRegistry.register(googleBooksContentMediator);\n    panelContentMediatorRegistry.register(hathitrustContentMediator);\n    panelContentMediatorRegistry.register(internetArchiveContentMediator);\n    panelContentMediatorRegistry.register(noteContentMediator);\n    panelContentMediatorRegistry.register(passthruContentMediator);\n  }\n\n})();\n\n/*global vwise:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .constant('vwise', vwise);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('vwise')\n    .config(config);\n\n  /** @ngInject */\n  function config(googleBooksApiProvider) {\n    googleBooksApiProvider.configure({ preventLoad: true });\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcWorks', [\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcWorks')\n    .provider('worksRepo', worksRepoProvider);\n\n  /**\n   * This functionality is already being implemented as a standalone trc-biblio module. The code is\n   * used here as an interim until the Bower build/dependency workflow has been finalized.\n   *\n   * @return {angular.provider}\n   */\n  function worksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/works';\n    provider.$get = worksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function worksRepoFactory($resource, _) {\n      var restResource = $resource(provider.url + '/:workId', { workId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var editionResource = $resource(provider.url + '/:workId/editions/:editionId', { editionId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var volumeResource = $resource(provider.url + '/:workId/editions/:editionId/volumes/:volumeId', { volumeId: '@id' }, {\n        update: {\n          method: 'PUT'\n        }\n      });\n\n      var repo = {};\n      repo.getAll = findAll;\n      repo.search = search;\n      repo.get = getWork;\n      repo.getWork = getWork;\n      repo.getEdition = getEdition;\n      repo.getVolume = getVolume;\n      repo.create = createWork;\n      repo.createWork = createWork;\n      repo.createEdition = createEdition;\n      repo.createVolume = createVolume;\n      repo.save = save;\n      repo.saveWork = saveWork;\n      repo.saveEdition = saveEdition;\n      repo.saveVolume = saveVolume;\n      repo.delete = deleteWork;\n      repo.getTitle = getTitleByTypePreference;\n      return repo;\n\n      /**\n       * Retrieves a listing of all works\n       *\n       * @return {WorkProxy[]}\n       */\n      function findAll() {\n        return search('');\n      }\n\n      /**\n       * Search for works by query\n       *\n       * @return {SearchResultSet}\n       */\n      function search(query) {\n        return restResource.get({ q: query, max: 50 });\n      }\n\n      /**\n       * Retrieves a work object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Work.$promise.\n       *\n       * @param {string} workId\n       * @return {Work}\n       */\n      function getWork(workId) {\n        if (angular.isUndefined(workId)) {\n          throw new TypeError('Invalid ID provided to getWork');\n        }\n\n        var work = restResource.get({ workId: workId });\n\n        work.$promise.then(adaptWork);\n\n        return work;\n      }\n\n      /**\n       * Retrieves an edition object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Edition.$promise.\n       *\n       * @param {string} workId\n       * @param {string} editionId\n       * @return {Edition}\n       */\n      function getEdition(workId, editionId) {\n        if (angular.isUndefined(workId) || angular.isUndefined(editionId)) {\n          throw new TypeError('Invalid IDs provided to getEdition');\n        }\n\n        var edition = editionResource.get({ workId: workId, editionId: editionId });\n\n        edition.$promise.then(adaptEdition);\n\n        return edition;\n      }\n\n      /**\n       * Retrieves a volume object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promis is available on Volume.$promise.\n       *\n       * @param {string} workId\n       * @param {string} editionId\n       * @param {string} volumeId\n       * @return {Volume}\n       */\n      function getVolume(workId, editionId, volumeId) {\n        if (angular.isUndefined(workId) || angular.isUndefined(editionId) || angular.isUndefined(volumeId)) {\n          throw new TypeError('Invalid IDs provided to getVolume');\n        }\n\n        var volume = volumeResource.get({ workId: workId, editionId: editionId, volumeId: volumeId });\n\n        volume.$promise.then(adaptVolume);\n\n        return volume;\n      }\n\n      /**\n       * Creates a new work instance\n       *\n       * @return {Work}\n       */\n      function createWork() {\n        var work = new restResource();\n        adaptWork(work);\n        work.titles.push({});\n        work.authors.push({});\n        return work;\n      }\n\n      /**\n       * Creates a new edition instance\n       *\n       * @return {Edition}\n       */\n      function createEdition() {\n        var edition = new editionResource();\n        return adaptEdition(edition);\n      }\n\n      /**\n       * Creates a new volume instance\n       *\n       * @return {Volume}\n       */\n      function createVolume() {\n        var volume = new volumeResource();\n        return adaptVolume(volume);\n      }\n\n      /**\n       * Dispatch method for saving works, editions, and volumes\n       *\n       * @deprecated use saveWork, saveEdition, or saveVolume directly\n       * @return {Promise}\n       */\n      function save() {\n        switch (arguments.length) {\n          case 1: return saveWork.apply(null, arguments);\n          case 2: return saveEdition.apply(null, arguments);\n          case 3: return saveVolume.apply(null, arguments);\n        }\n        throw new TypeError('Unexpected arguments to worksRepo#save');\n      }\n\n      /**\n       * Saves a work instance back to the server\n       *\n       * @param {Work} work\n       * @return {Promise.<Work>}\n       */\n      function saveWork(work) {\n        if (!(work instanceof restResource)) {\n          throw new Error('work was not created by this repo');\n        }\n\n        // ngResource automatically updates the model to reflect any server changes (e.g. setting IDs for the work/edtions/volumes/copies).\n        return work.id\n          ? work.$update()\n          : work.$save();\n      }\n\n      /**\n       * Saves an edition instance back to the server\n       *\n       * @param  {string} workId\n       * @param  {Edition} edition\n       * @return {Promise.<Edition>}\n       */\n      function saveEdition(workId, edition) {\n        if (!workId) {\n          throw new Error('no work id provided');\n        }\n\n        if (!(edition instanceof editionResource)) {\n          throw new Error('edition was not created by this repo');\n        }\n\n        return edition.id\n          ? edition.$update({ workId: workId })\n          : edition.$save({ workId: workId });\n      }\n\n      /**\n       * Saves a volume instance back to the server\n       *\n       * @param  {string} workId\n       * @param  {string} editionId\n       * @param  {Volume} volume\n       * @return {Promise.<Volume>}\n       */\n      function saveVolume(workId, editionId, volume) {\n        if (!workId) {\n          throw new Error('no work id provided');\n        }\n\n        if (!editionId) {\n          throw new Error('no edition id provided');\n        }\n\n        if (!(volume instanceof volumeResource)) {\n          throw new Error('volume was not created by this repo');\n        }\n\n        return volume.id\n          ? volume.$update({ workId: workId, editionId: editionId })\n          : volume.$save({ workId: workId, editionId: editionId });\n      }\n\n      /**\n       * Deletes a work instance from the server\n       *\n       * @param  {string} id\n       */\n      function deleteWork(workId) {\n        var dataItem = restResource.delete({ id: workId });\n        return dataItem.$promise;\n      }\n\n      /**\n       * Ensure that aggregate fields common to all work/edition/volume entities exist and are formatted correctly\n       *\n       * @param  {Work|Edition|Volume} entity\n       * @return {Work|Edition|Volume}\n       */\n      function adaptCommon(entity) {\n        if (!entity.titles) {\n          entity.titles = [];\n        } else {\n          entity.titles.forEach(function (title) {\n            title.type = title.type.toLowerCase();\n          });\n        }\n\n        if (!entity.authors) {\n          entity.authors = [];\n        } else {\n          entity.authors.forEach(function (author) {\n            author.role = author.role.toLowerCase();\n          });\n        }\n\n        if (!entity.otherAuthors) {\n          entity.otherAuthors = [];\n        } else {\n          entity.otherAuthors.forEach(function (author) {\n            author.role = author.role.toLowerCase();\n          });\n        }\n\n        if (!entity.copies) {\n          entity.copies = [];\n        }\n\n        return entity;\n      }\n\n      /**\n       * Ensure that work aggregate fields exist and are formatted correctly\n       *\n       * @param  {Work} work\n       * @return {Work}\n       */\n      function adaptWork(work) {\n        adaptCommon(work);\n\n        if (!work.editions) {\n          work.editions = [];\n        } else {\n          work.editions.forEach(adaptEdition);\n        }\n\n        return work;\n      }\n\n      /**\n       * Ensure that edition aggregate fields exist and are formatted correctly\n       *\n       * @param  {Edition} edition\n       * @return {Edition}\n       */\n      function adaptEdition(edition) {\n        adaptCommon(edition);\n\n        if (!edition.volumes) {\n          edition.volumes = [];\n        } else {\n          edition.volumes.forEach(adaptVolume);\n        }\n\n        return edition;\n      }\n\n      /**\n       * Ensure that volume aggregate fields exist and are formatted correctly\n       *\n       * @param  {Volume} volume\n       * @return {Volume}\n       */\n      function adaptVolume(volume) {\n        adaptCommon(volume);\n\n        return volume;\n      }\n\n      /**\n       * Retrieves the first available title of the given type or falsey if no title can be found.\n       * If multiple types are given, returns the title corresponding to the first type for which a title is found.\n       *\n       * @param  {Title[]}         titles\n       * @param  {string|string[]} types\n       * @return {Title}\n       */\n      function getTitleByTypePreference(titles, types) {\n        if (angular.isUndefined(types)) {\n          types = ['short', 'canonical', 'bibliographic'];\n        } else if (!angular.isArray(types)) {\n          types = [types];\n        }\n\n        return types.reduce(function (found, type) {\n          return found || _.find(titles, { type: type });\n        }, null);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * @typedef {object} Workflow\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {object.<string, WorkflowStage>} stages\n * @property {string} status\n */\n\n/**\n * @typedef {object} WorkflowStage\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {boolean} isFinal\n * @property {WorkflowStageTransition[]} transitions\n */\n\n/**\n * @typedef {object} WorkflowStageTransition\n * @property {string} sourceStage\n * @property {string} targetStage\n * @property {string} label\n */\n\n/**\n * @typedef {object} Worklist\n * @property {string} groupId\n * @property {string} label\n * @property {integer} itemCount\n * @property {integer} start\n * @property {integer} max\n * @property {WorkItem[]} items\n */\n\n/**\n * @typedef {object} WorkItem\n * @property {string} itemId\n * @property {string} type\n * @property {string} entityId\n * @property {string} label\n * @property {object.<string,string>} properties\n * @property {string} stage\n * @property {string} task\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks')\n    .provider('tasksRepo', tasksRepoProvider);\n\n  /**\n   * @return {angular.provider}\n   */\n  function tasksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/tasks';\n    provider.$get = tasksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function tasksRepoFactory($resource) {\n      var workflowResource = $resource(provider.url + '/:taskId/workflow', { taskId: 'copies' });\n      var itemResource = $resource(provider.url + '/:taskId/items/:itemId', { taskId: 'copies', itemId: '@itemId' });\n\n      var repo = {};\n      repo.get = getTask;\n      repo.getItems = getItems;\n      repo.transition = transition;\n      return repo;\n\n      /**\n       * Retrieves a listing of all tasks\n       *\n       * @param  {string} [taskId=copies]\n       * @return {GroupedTaskList}\n       */\n      function getTask(taskId) {\n        taskId = taskId || 'copies';\n\n        var workflow = workflowResource.get({ taskId: taskId });\n\n        var task = {\n          $promise: workflow.$promise.then(function () {\n            return task;\n          }),\n          workflow: workflow,\n          getItems: function (stageId, options) {\n            return getItems(taskId, stageId, options);\n          }\n        };\n\n        return task;\n      }\n\n      /**\n       * Gets items from the task endpoint for a given stage\n       *\n       * @param  {string}  [taskId=copies]  Task ID\n       * @param  {string}  stageId          Workflow stage for which to get items\n       * @param  {object}  options\n       * @param  {integer} [options.start]  Starting index\n       * @param  {integer} [options.max]    Maximum number of items to fetch per page\n       * @return {Worklist}\n       */\n      function getItems(taskId, stageId, options) {\n        options = options || {};\n        return itemResource.get({\n          taskId: taskId,\n          stage: stageId,\n          start: options.start,\n          max: options.max\n        });\n      }\n\n      /**\n       * Transition an item from its current stage to a target stage\n       *\n       * @param  {WorkItem}                item   Work item instance\n       * @param  {WorkflowStageTransition} transition Target workflow stage\n       * @return {WorkItem}                       Updated work item instance\n       */\n      function transition(item, transition) {\n        if (item.stage !== transition.sourceStage) {\n          throw new Error('Transition (' + transition.sourceStage + ' -> ' + transition.targetStage + ') is not valid for item currently in stage ' + item.stage);\n        }\n\n        var result = itemResource.save({\n          itemId: item.itemId\n        }, {\n          stage: transition.targetStage,\n          // NOTE comments are not saved yet\n          comments: null\n        });\n\n        // propagate updates to the original item\n        result.$promise.then(function (resp) {\n          angular.extend(item, resp);\n        });\n\n        return result;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcArticles', [\n      'ngResource'\n    ]);\n\n})();\n\n// TODO add JSDoc for the various classes that will be defined\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcArticles')\n    .provider('articlesRepo', articlesRepoProvider);\n\n  function articlesRepoProvider() {\n    var provider = {};\n    provider.url = '/api/articles';\n    provider.$get = articlesRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function articlesRepoFactory($q, $resource) {\n      var articleResource = $resource(provider.url + '/:id', { id: '@identifier' });\n\n      var repo = {};\n\n      // REPO API DEFN goes here\n      return repo;\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcReln', [\n      'ngResource'\n    ]);\n\n})();\n\n// NOTE: this entire API model *WILL* eventually change\n\n/**\n * @typedef Relationship\n * @type {object}\n * @property {string}     id                  - A unique identifier for this relationship\n * @property {string}     typeId              - The ID of the RelationshipType of this relationship\n * @property {string}     description         - A detailed description of this relationship\n * @property {string}     descriptionMimeType - MIME type string of the description\n * @property {Provenance} provenance          - Metadata about the relationship record\n * @property {Anchor[]}   relatedEntities     - A set of \"source\" anchors\n * @property {Anchor[]}   targetEntities      - A set of \"target\" anchors\n */\n\n/**\n * @typedef RelationshipType\n * @type {object}\n * @property {string}  identifier   - A unique identifier for this type\n * @property {string}  title        - A label to display for this type\n * @property {string}  reverseTitle - If this type is directed, the label to display for reverse relationships\n * @property {string}  description  - A more detailed description of this type\n * @property {boolean} isDirected   - Whether this type is directed (true) or undirected (false)\n */\n\n/**\n * @typedef Provenance\n * @type {object}\n * @property {string[]} creatorUris  - URIs to people/authors of this relationship\n * @property {string}   dateCreated  - an ISO 8601 date representation of when the record was created\n * @property {string}   dateModified - an ISO 8601 date representation of when the record was last modified\n */\n\n/**\n * @typedef Anchor\n * @type {object}\n * @property {string[]} entryUris[] - URIs to work/edition/volume\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcReln')\n    .provider('relationshipsRepo', relationshipsRepoProvider);\n\n  function relationshipsRepoProvider() {\n    var provider = {};\n    provider.url = '/api/relationships';\n    provider.$get = relationshipsRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function relationshipsRepoFactory($q, $resource) {\n      var typeResource = $resource(provider.url + '/types/:id', { id: '@identifier' });\n      var relnResource = $resource(provider.url + '/:id', { id: '@id' }, {\n        update: { method: 'PUT' }\n      });\n\n      var typesCache = null;\n\n      var repo = {};\n      repo.getTypes = getTypes;\n      repo.getType = getType;\n      repo.createRelationship = createRelationship;\n      repo.createProvenance = createProvenance;\n      repo.createAnchor = createAnchor;\n      repo.get = findById;\n      repo.search = search;\n      repo.save = saveRelationship;\n      repo.delete = deleteRelationship;\n      repo.normalizeRelationships = normalizeRelationships;\n      return repo;\n\n      /**\n       * Fetches relationship types from the server, caching them in the process.\n       * The returned array will be populated when the request resolves.\n       * The underlying promise is available on the $promise property.\n       *\n       * @param  {object} options\n       * @param  {boolean} options.force Discard cache (if set) and refetch\n       * @return {object.<string,RelationshipType>}\n       */\n      function getTypes(options) {\n        options = options || {};\n\n        if (!typesCache || options.force) {\n          var types = typeResource.query();\n\n          typesCache = {};\n\n          var tcPromise = types.$promise.then(function () {\n            types.forEach(function (type) {\n              typesCache[type.identifier] = type;\n            });\n            return typesCache;\n          });\n\n          // add $promise as a non-enumerable property\n          Object.defineProperty(typesCache, '$promise', {\n            value: tcPromise\n          });\n        }\n\n        return typesCache;\n      }\n\n      /**\n       * Fetches a type by ID\n       *\n       * @param  {string} id\n       * @return {Promise.<RelationshipType>}\n       */\n      function getType(id) {\n        var types = getTypes();\n\n        return types.$promise.then(function (types) {\n          return types[id];\n        });\n      }\n\n      /**\n       * Creates a new empty relationship instance\n       *\n       * @return {Relationship}\n       */\n      function createRelationship() {\n        var reln = new relnResource();\n        return adaptRelationship(reln);\n      }\n\n      /**\n       * Creates a new empty provenance model\n       *\n       * @return {Provenance}\n       */\n      function createProvenance() {\n        var provenance = {};\n        return adaptProvenance(provenance);\n      }\n\n      /**\n       * Creates a new empty anchor model\n       *\n       * @return {Anchor}\n       */\n      function createAnchor() {\n        var anchor = {};\n        return adaptAnchor(anchor);\n      }\n\n      /**\n       * Retrieves a relationship from the server by ID.\n       * The returned model will be populated once the request succeeds.\n       * The underlying promise can be accessed via the $promise property.\n       *\n       * @param  {string} id\n       * @return {Relationship}\n       */\n      function findById(id) {\n        return relnResource.get({ id: id });\n      }\n\n      /**\n       * Find all relationships matching the given criteria.\n       * @param  {object|string} options\n       * @property {string} options.uri (default if options is a string)\n       * @property {string} options.typeId\n       * @property {string} options.direction \"from\" (out-relationships), \"to\" (in-relationships), or \"any\"\n       * @property {integer} options.start\n       * @property {integer} options.max\n       * @return {Relationship[]}\n       */\n      function search(options) {\n        if (!options) {\n          throw new Error('no options provided')\n        }\n\n        if (angular.isString(options)) {\n          // treat single string as an entity URL\n          options = { uri: options };\n        }\n\n        var queryOpts = {};\n\n        if (options.uri) {\n          queryOpts.entity = options.uri;\n        }\n\n        if (options.typeId) {\n          queryOpts.type = options.typeId;\n        }\n\n        if (options.direction) {\n          queryOpts.direction = options.direction;\n        }\n\n        if (options.start) {\n          queryOpts.off = options.start;\n        }\n\n        if (options.max) {\n          queryOpts.max = options.max;\n        }\n\n        return relnResource.query(queryOpts);\n      }\n\n      /**\n       * Saves a relationship back to the server.\n       *\n       * @param  {Relationship} reln\n       * @return {Promise} resolves on successful save\n       */\n      function saveRelationship(reln) {\n        if (!(reln instanceof relnResource)) {\n          throw new Error('Relationship was not created by this repo');\n        }\n\n        return reln.id\n          ? reln.$update()\n          : reln.$save();\n      }\n\n      /**\n       * Deletes a relationship from the server via the REST API.\n       *\n       * @param  {string} id\n       * @return {Promise} resolves on success\n       */\n      function deleteRelationship(id) {\n        var response = relnResource.delete({ id: id });\n        return response.$promise\n      }\n\n      /**\n       * Ensures aggregate fields on a relationship are set appropriately\n       *\n       * @param  {Relationship} reln\n       * @return {Relationship}\n       */\n      function adaptRelationship(reln) {\n        if (!reln.provenance) {\n          reln.provenance = createProvenance();\n        }\n\n        if (!reln.relatedEntities) {\n          reln.relatedEntities = [];\n        }\n\n        if (!reln.targetEntities) {\n          reln.targetEntities = [];\n        }\n\n        return reln;\n      }\n\n      /**\n       * Ensures aggregate fields on a provenance model are set appropriately\n       *\n       * @param  {Provenance} provenance\n       * @return {Provenance}\n       */\n      function adaptProvenance(provenance) {\n        if (!provenance.creatorUris) {\n          provenance.creatorUris = [];\n        }\n\n        return provenance;\n      }\n\n      /**\n       * Ensures aggregate fields on an anchor model are set appropriately\n       *\n       * @param  {Anchor} anchor\n       * @return {Anchor}\n       */\n      function adaptAnchor(anchor) {\n        if (!anchor.entryUris) {\n          anchor.entryUris = [];\n        }\n\n        return anchor;\n      }\n\n      /**\n       * Normalizes relationships into type groups that are more suitable for display in the UI\n       *\n       * @param  {Relationship[]} relationships\n       * @return {TypeGroup[]}\n       */\n      function normalizeRelationships(relationships, currentUri, worksRepo) {\n        var normalizedRelationships = relationships.map(function (relationship) {\n          var typeId = relationship.typeId;\n\n          var isReverse = relationship.targetEntities.some(function (anchor) {\n            return anchor.entryUris.some(function (uri) {\n              return uri === currentUri;\n            });\n          });\n\n          var targetField = isReverse ? 'relatedEntities' : 'targetEntities';\n\n          var entities = relationship[targetField]\n          .map(function (anchor) {\n            return anchor.entryUris;\n          })\n          .reduce(function (flattened, arr) {\n            return flattened.concat(arr);\n          }, [])\n          .map(function (uri) {\n            return resolveEntityUri(uri, worksRepo);\n          });\n\n          return {\n            id: relationship.id,\n            typeId: typeId,\n            reverse: isReverse,\n            description: relationship.description,\n            entities: entities\n          };\n        });\n\n        var relnsByTypeDir = {};\n\n        normalizedRelationships.forEach(function (relationship) {\n          var typeId = relationship.typeId;\n\n          if (!relnsByTypeDir.hasOwnProperty(typeId)) {\n            relnsByTypeDir[typeId] = {\n              fwd: [],\n              rev: []\n            };\n          }\n\n          relnsByTypeDir[typeId][relationship.reverse ? 'rev' : 'fwd'].push(relationship);\n        });\n\n        var typeGroups = [];\n\n        angular.forEach(relnsByTypeDir, function (dirs, typeId) {\n          getType(typeId).then(function (type) {\n            if (type.isDirected) {\n              // add forward group\n              if (dirs.fwd.length > 0) {\n                typeGroups.push({\n                  label: type.title,\n                  relationships: dirs.fwd\n                });\n              }\n\n              // add reverse group\n              if (dirs.rev.length > 0) {\n                typeGroups.push({\n                  label: type.reverseTitle,\n                  relationships: dirs.rev\n                });\n              }\n            } else {\n              // combine forward/reverse and add as a single group\n              var group = dirs.fwd.concat(dirs.rev);\n              if (group.length > 0) {\n                typeGroups.push({\n                  label: type.title,\n                  relationships: group\n                });\n              }\n            }\n          });\n        });\n\n        return typeGroups;\n      }\n\n      function resolveEntityUri(uri, worksRepo) {\n        var ENTITY_URI = /^works\\/([^\\/]+)(?:\\/editions\\/([^\\/]+)(?:\\/volumes\\/([^\\/]+))?)?$/i;\n        var match = ENTITY_URI.exec(uri);\n\n        if (!match) {\n          return null;\n        }\n\n        if (match[1] && match[2] && match[3]) {\n          return makeVolumeEntity(match[1], match[2], match[3], worksRepo);\n        } else if (match[1] && match[2]) {\n          return makeEditionEntity(match[1], match[2], worksRepo);\n        } else if (match[1]) {\n          return makeWorkEntity(match[1], worksRepo);\n        }\n\n        return null;\n      }\n    }\n\n    function makeVolumeEntity(workId, editionId, volumeId, worksRepo) {\n      var edition = worksRepo.getEdition(workId, editionId);\n      var volume = worksRepo.getVolume(workId, editionId, volumeId);\n\n      var entity = {\n        type: 'volume',\n        refParams: {\n          workId: workId,\n          editionId: editionId,\n          volumeId: volumeId\n        },\n        entity: volume\n      };\n\n      volume.$promise.then(function () {\n        var title = worksRepo.getTitle(volume.titles, ['short', 'canonical', 'bibliographic']);\n        if (title) {\n          entity.label = title.title + (title.subtitle ? ': ' + title.subtitle : '');\n        }\n\n        edition.$promise.then(function () {\n          entity.label += ' ' + edition.editionName + ' Volume ' + volume.volumeNumber;\n        }, function () {\n          entity.label += ' [Unknown edition] ' + volume.volumeNumber;\n        });\n      });\n\n      return entity;\n    }\n\n    function makeEditionEntity(workId, editionId, worksRepo) {\n      var edition = worksRepo.getEdition(workId, editionId);\n\n      var entity = {\n        type: 'edition',\n        refParams: {\n          workId: workId,\n          editionId: editionId\n        },\n        entity: edition\n      };\n\n      edition.$promise.then(function () {\n        var title = worksRepo.getTitle(edition.titles, ['short', 'canonical', 'bibliographic']);\n        if (title) {\n          entity.label = title.title + (title.subtitle ? ': ' + title.subtitle : '') + ' ' + edition.editionName;\n        }\n      });\n\n      return entity;\n    }\n\n    function makeWorkEntity(workId, worksRepo) {\n      var work = worksRepo.getWork(workId);\n\n      var entity = {\n        type: 'work',\n        refParams: {\n          workId: workId\n        },\n        entity: work\n      };\n\n      work.$promise.then(function () {\n        var title = worksRepo.getTitle(work.titles, ['short', 'canonical', 'bibliographic']);\n        if (title) {\n          entity.label = title.title + (title.subtitle ? ': ' + title.subtitle : '');\n        }\n      });\n\n      return entity;\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * Data model representing a person returned by the TRC REST API\n * @typedef Person\n * @type {object}\n * @property {string}           id       - a unique identifier for this person; assigned upon creation\n * @property {EntryMeta}        meta     - metadata about the record and its history in the system\n * @property {PersonName}       name     - primary name used to identify this person\n * @property {PersonName[]}     altNames - other names by which this person is known\n * @property {?HistoricalEvent} birth    - the date and location this person was born; may be null if unknown\n * @property {?HistoricalEvent} death    - the date and location this person was born; may be null if unknown or still alive\n * @property {string}           summary  - an HTML summary of the person and his or her significance\n */\n\n/**\n * Simplified, lightweight representation of a person for use in search results\n * @typedef Person\n * @type {object}\n * @property {string}     id             - a unique identifier for the person\n * @property {EntryMeta}  meta           - metadata about the record and its history in the system\n * @property {PersonName} name           - structured name representation\n * @property {string}     label          - formatted name to display\n * @property {string}     summaryExcerpt - a leading excerpt from the full summary\n */\n\n/**\n * Metadata about a TRC entry\n * @typedef EntryMeta\n * @type {object}\n * @property {string}                      slug         - a short, unique identifier intended to be more human-readable than the id\n * @property {integer}                     version      - a monotonically increasing version number incremented on each change\n * @property {object.<string, SimpleLink>} links        - links to related resources; keyed by link role\n * @property {string}                      lastModified - ISO 8601 timestamp of the last modification date\n */\n\n/**\n * Container for linking to related entities\n * @typedef SimpleLink\n * @type {object}\n * @property {string} uri  - a URI representing the linked item\n * @property {string} type - MIME type of the related linked item\n */\n\n/**\n * Structured form of a person's name\n * @typedef PersonName\n * @type {object}\n * @property {string} role        - clarifies the use of this name\n * @property {string} label       - a simple representation of this name for display purposes\n * @property {?string} title      - title of address\n * @property {?string} givenName  - given or first name\n * @property {?string} middleName - middle name\n * @property {?string} familyName - family or last name\n * @property {?string} suffix     - a suffix (e.g. 'Jr' or 'III')\n */\n\n/**\n * Event with a date/time, location, and descriptive information\n * @typedef HistoricalEvent\n * @type {object}\n * @property {string}          id          - a unique identifier for this event\n * @property {string}          title       - a brief title of the event for display purposes\n * @property {string}          description - a detailed summary of the event\n * @property {string}          location    - the location in which the event took place\n * @property {DateDescription} date        - the date the event took place\n */\n\n/**\n * Container for encapsulating human-readable and machine-readable forms of a date.\n * @typedef DateDescription\n * @type {object}\n * @property {string} calendar    - machine-readable ISO 8601 timestamp\n * @property {string} description - human-readable description of this date\n */\n\n/**\n * Container for search results\n * @typedef PersonSearchResultSet\n * @type {object}\n * @property {SimplePerson[]} items  - search results\n * @property {string}         qs     - query string that gives the current set of search results\n * @property {?string}        qsNext - query string that gives next set of search results or null if this is the last set\n * @property {?string}        qsPrev - query string that gives preceding set of search results or null if this is the first set\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .provider('peopleRepo', peopleRepoProvider);\n\n\n  function peopleRepoProvider() {\n    var provider = {};\n    provider.url = '/api/people';\n    provider.$get = peopleRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function peopleRepoFactory($q, $resource) {\n      var restResource = $resource(provider.url + '/:id', null, {\n        'update': { method: 'PUT' }\n      });\n\n      var repo = {};\n      repo.create = createPerson;\n      repo.createName = createName;\n      repo.createEvent = createEvent;\n      repo.get = findById;\n      repo.search = search;\n      repo.save = savePerson;\n      repo.delete = deletePerson;\n      return repo;\n\n      /**\n       * Creates a new empty person instance.\n       *\n       * @return {Person}\n       */\n      function createPerson() {\n        var person = new restResource();\n        return adaptPerson(person);\n      }\n\n      /**\n       * Creates a new empty entry metadata instance\n       *\n       * @return {EntryMeta}\n       */\n      function createMeta() {\n        var meta = {};\n        return adaptMeta(meta);\n      }\n\n      /**\n       * Creates a new empty name instance\n       *\n       * @return {PersonName}\n       */\n      function createName() {\n        var name = {};\n        return adaptName(name);\n      }\n\n      /**\n       * Creates a new historical event instance\n       *\n       * @return {HistoricalEvent}\n       */\n      function createEvent() {\n        var evt = {};\n        return adaptEvent(evt);\n      }\n\n      /**\n       * Creates a date/description instance\n       *\n       * @return {DateDescription}\n       */\n      function createDateDescription() {\n        var dateDescription = {};\n        return dateDescription;\n      }\n\n      /**\n       * Retrieves a person object by identifier.\n       *\n       * A proxy object will be returned immediately, and its properties will be populated after the\n       * request succeeds. If fine-grained asynchronous handling, etc. is required, the request's\n       * promise is available on Person.$promise.\n       *\n       * @param  {string} id\n       * @return {Person}\n       */\n      function findById(id) {\n        return restResource.get({ id: id });\n      }\n\n      /**\n       * Retrieves a serch result set of people who match the given query.\n       *\n       * @param {string} query\n       * @return {PersonSearchResultSet}\n       */\n      function search(query) {\n        return restResource.get({ q: query });\n      }\n\n      /**\n       * Saves a person model to the REST API.\n       *\n       * If no ID is provided on the person model, the API will create save the model as a new\n       * person. Otherwise, the API will attempt to update the existing person model with that ID.\n       *\n       * @param {Person} person\n       * @return {Promise.<Person>} - resolves to the saved person on success\n       */\n      function savePerson(person) {\n        var response;\n        if (person.id) {\n          response = restResource.update({ id: person.id }, person);\n        } else {\n          response = restResource.save(null, person);\n        }\n\n        return response.$promise.then(function (personId) {\n          person.id = personId.id;\n          return person;\n        });\n      }\n\n      /**\n       * Deletes a person on the server via the REST API.\n       *\n       * @param {Person|string} idOrPerson\n       * @return {Promise} - resolves on success\n       */\n      function deletePerson(id) {\n        var response = restResource.delete({ id: id });\n        return response.$promise;\n      }\n\n      /**\n       * Populates a person with aggregate fields\n       *\n       * @param  {Person} person\n       * @return {Person}\n       */\n      function adaptPerson(person) {\n        if (!person.meta) {\n          person.meta = createMeta();\n        } else {\n          adaptMeta(person.meta);\n        }\n\n        if (!person.name) {\n          person.name = createName();\n        } else {\n          adaptName(person.name);\n        }\n\n        if (!person.altNames) {\n          person.altNames = [];\n        } else {\n          person.altNames.forEach(adaptName);\n        }\n\n        if (!person.birth) {\n          person.birth = createEvent();\n        } else {\n          adaptEvent(person.birth);\n        }\n\n        if (!person.death) {\n          person.death = createEvent();\n        } else {\n          adaptEvent(person.death);\n        }\n\n        return person\n      }\n\n      /**\n       * Ensure that entry metadata aggregate fields exist and are formatted correctly.\n       *\n       * @param  {EntryMeta} meta\n       * @return {EntryMeta}\n       */\n      function adaptMeta(meta) {\n        if (!meta.links) {\n          meta.links = {};\n        }\n\n        return meta;\n      }\n\n      /**\n       * Ensure that name aggregate fields exist and are formatted correctly\n       * @param  {PersonName} name\n       * @return {PersonName}\n       */\n      function adaptName(name) {\n        // no aggregate fields yet...\n        return name;\n      }\n\n      /**\n       * Ensure that event aggregate fields exist and are formatted correctly.\n       *\n       * @param  {HistoricalEvent} evt\n       * @return {HistoricalEvent}\n       */\n      function adaptEvent(evt) {\n        if (!evt.date) {\n          evt.date = createDateDescription();\n        }\n\n        return evt;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcPersonEditor', trcPersonEditorDirective);\n\n  /** @ngInject */\n  function trcPersonEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/person-editor.html',\n      scope: {\n        person: '=ngModel'\n      },\n      controller: PersonEditorController,\n      controllerAs: 'personEditor'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function PersonEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.addName = addName;\n      vm.removeName = removeName;\n      vm.addEvent = addEvent;\n      vm.removeEvent = removeEvent;\n\n      /**\n       * Adds a name to the current person model.\n       */\n      function addName() {\n        var newName = peopleRepo.createName();\n        $scope.person.altNames.push(newName);\n      }\n\n      /**\n       * Removes the name at the specified index from the current person model.\n       *\n       * @param {integer} ix\n       */\n      function removeName(ix) {\n        $scope.person.altNames.splice(ix, 1);\n      }\n\n      /**\n       * Adds an event to the current person model.\n       *\n       * @param {string} key - 'birth' or 'death'\n       */\n      function addEvent(key) {\n        var newEvent = peopleRepo.createEvent();\n        $scope.person[key] = newEvent;\n      }\n\n      /**\n       * Removes the event from the current person model.\n       *\n       * @param {string} key - 'birth' or 'death'\n       */\n      function removeEvent(key) {\n        $scope.person[key] = null;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcNameEditor', trcNameEditorDirective);\n\n  /** @ngInject */\n  function trcNameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      },\n      controller: NameEditorController,\n      controllerAs: 'nameEditor'\n    };\n\n    return directive;\n\n    function NameEditorController() {\n      var vm = this;\n\n      vm.roles = [\n        { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n      ];\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcBio')\n    .directive('trcEventEditor', trcEventEditorDirective);\n\n  /** @ngInject */\n  function trcEventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/trc-bio/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('TaskController', TaskController);\n\n  /** @ngInject */\n  function TaskController($state, $mdSidenav, tasksRepo, $q) {\n    var vm = this;\n\n    // HACK this will eventually be made available on the workflow data model itself.\n    vm.stageOrder = [\n      'pinned',\n      'review',\n      'inprogress',\n      'pending',\n      'deferred'\n    ];\n\n    vm.loading = true;\n    vm.worklists = {};\n    vm.task = null;\n\n    vm.openMenu = openMenu;\n    vm.focusItem = focusItem;\n    vm.transition = transitionItem;\n\n    activate();\n\n    function activate() {\n      vm.task = tasksRepo.get();\n\n      vm.task.$promise.then(function (task) {\n        var worklistPromises = [];\n\n        angular.forEach(task.workflow.stages, function (stage) {\n          var worklistPromise = fetchStage(task, stage.id);\n          worklistPromises.push(worklistPromise);\n        });\n\n        $q.all(worklistPromises).then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function focusItem(item, $event) {\n      $event.stopImmediatePropagation();\n\n      // TODO resolve handler based on item.type\n      $state.go('editor.work', { workId: item.entityId });\n    }\n\n    function transitionItem(item, transition, $event) {\n      $event.stopImmediatePropagation();\n\n      var updatedItem = tasksRepo.transition(item, transition);\n      updatedItem.$promise.then(function () {\n        fetchStage(vm.task, transition.sourceStage);\n        fetchStage(vm.task, transition.targetStage);\n      });\n    }\n\n    function fetchStage(task, stageId) {\n      var group = task.getItems(stageId, { max: 9999 });\n\n      group.$promise.then(function () {\n        vm.worklists[stageId] = group.items.length > 0 ? group : null;\n      });\n\n      return group.$promise;\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('slideToggle', []);\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('slideToggle')\n      .directive('slideToggle', slideToggle);\n\n   /** @ngInject */\n   function slideToggle() {\n      var directive = {\n         restrict: 'A',\n         scope: {\n            active: '=slideToggle'\n         },\n         link: linkFunc\n      };\n\n      return directive;\n\n      function linkFunc(scope, el, attr) {\n         var duration = parseInt(attr.slideToggleDuration) || 200;\n         scope.$watch('active', function (active) {\n            if (active) {\n               el.stop().slideDown(duration);\n            } else {\n               el.stop().slideUp(duration);\n            }\n         })\n      }\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('ShowPersonController', ShowPersonController);\n\n  /** @ngInject */\n  function ShowPersonController(peopleRepo, $stateParams, $mdDialog, $mdToast) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.person = null;\n\n    vm.editBioInfo = editBioInfo;\n    vm.editEvent = editEvent;\n    vm.editSummary = editSummary;\n\n    activate();\n\n    function activate() {\n      vm.person = peopleRepo.get($stateParams.id);\n    }\n\n    function editBioInfo($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          person: angular.copy(vm.person)\n        },\n        controller: 'PersonEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedPerson) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person, updatedPerson);\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editEvent(field, $event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/event-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation\n          event: angular.copy(vm.person[field])\n        },\n        controller: 'EventEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedEvent) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person[field], updatedEvent);\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          // create a copy for manipulation (even if it is just a string)\n          summary: angular.copy(vm.person.summary)\n        },\n        controller: 'SummaryEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.person.summary = updatedSummary;\n\n        peopleRepo.save(vm.person).then(showSavedToast);\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('PersonEditDialogController', PersonEditDialogController);\n\n  /** @ngInject */\n  function PersonEditDialogController(peopleRepo, $mdDialog, person) {\n    var vm = this;\n\n    vm.person = person;\n    vm.nameRoles = [\n        // { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n    ]\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addName = addName;\n    vm.deleteName = deleteName;\n\n    function close() {\n      $mdDialog.hide(vm.person);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addName() {\n      var name = peopleRepo.createName();\n      vm.person.altNames.push(name);\n    }\n\n    function deleteName(name) {\n      var ix = vm.person.altNames.indexOf(name);\n      if (ix >= 0) {\n        vm.person.altNames.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('EventEditDialogController', EventEditDialogController);\n\n  /** @ngInject */\n  function EventEditDialogController($mdDialog, event) {\n    var vm = this;\n\n    vm.event = event;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.event);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController(worksRepo, peopleRepo, $state, $stateParams, $mdSidenav, _, $q, $mdDialog, $mdToast) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.searchQuery = '';\n\n    vm.openMenu = openMenu;\n    vm.createPerson = createPerson;\n    vm.createWork = createWork;\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      if ($stateParams.q) {\n        vm.searchQuery = $stateParams.q;\n        search(vm.searchQuery);\n      }\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      $q.all([\n        vm.peopleResults.$promise,\n        vm.worksResults.$promise\n      ])\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function createArticle($event) {\n\n    }\n    \n    function createPerson($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: peopleRepo.create()\n        },\n        controller: 'PersonEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (person) {\n        return peopleRepo.save(person);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (person) {\n        $state.go('editor.person', { id: person.id });\n      });\n    }\n\n    function createWork($event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: worksRepo.createWork()\n        },\n        controller: 'WorkEditDialogController',\n        controllerAs: 'vm'\n      };\n\n      var dialogPromise = $mdDialog.show(dialog);\n\n      var savePromise = dialogPromise.then(function (work) {\n        return worksRepo.saveWork(work);\n      });\n\n      savePromise.then(showSavedToast);\n\n      savePromise.then(function (work) {\n        $state.go('editor.work', { workId: work.id });\n      });\n    }\n\n    function showSavedToast() {\n      var toast = $mdToast.simple()\n        .textContent('Saved')\n        .position('bottom right');\n\n      return $mdToast.show(toast);\n    }\n  }\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books', []);\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .provider('googleBooksApi', googleBooksApiProvider);\n\n   function googleBooksApiProvider() {\n      var API = {};\n\n      API.options = {\n         transport: 'https',\n         v: 0,\n         language: 'en',\n         preventLoad: false\n      };\n\n      API.configure = configure;\n      API.$get = loadGoogleBooks;\n\n      return API;\n\n      function configure(options) {\n         angular.extend(API.options, options);\n      }\n\n      /** @ngInject */\n      function loadGoogleBooks(googleBooksScriptLoader) {\n         return googleBooksScriptLoader.load(API.options);\n      }\n   }\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .factory('googleBooksScriptLoader', googleBooksScriptLoader);\n\n   /** @ngInject */\n   function googleBooksScriptLoader($window, $document, $q, _) {\n      var scriptId = undefined;\n      var usedConfiguration = undefined;\n\n      return {\n         load: load,\n         manualLoad: manualLoad\n      };\n\n      /**\n       * Get script URL for loading Google Books API\n       *\n       * @param {object} options\n       * @return {string}\n       */\n      function getScriptUrl(options) {\n         if (options.transport === 'auto') {\n            return '//www.google.com/books/api.js?';\n         } else {\n            return options.transport + '://www.google.com/books/api.js?';\n         }\n      }\n\n      function includeScript(options) {\n         var omitOptions = ['transport', 'preventLoad', 'randomizedFunctionName'];\n\n         var query = _.map(_.omit(options, omitOptions), function (v, k) { return k + '=' + v });\n\n         if (scriptId) {\n            var scriptElem = $document.getElementById(scriptId)\n            scriptElem.parentNode.removeChild(scriptElem);\n         } else {\n            scriptId = 'gbooks_load_' + Math.round(Math.random() * 1000);\n         }\n\n         query = query.join('&');\n         angular.element('<script>', {\n            id: scriptId,\n            type: 'text/javascript',\n            src: getScriptUrl(options) + query\n         }).appendTo(angular.element('body'));\n      }\n\n      function isGoogleBooksLoaded() {\n         return angular.isDefined($window.google) && angular.isDefined($window.google.books);\n      }\n\n      function load(options) {\n         var deferred = $q.defer();\n\n         if (isGoogleBooksLoaded()) {\n            deferred.resolve($window.google.books);\n            return deferred.promise;\n         }\n\n         var randomizedFunctionName = 'onGoogleBooksReady' + Math.round(Math.random() * 1000);\n         options.callback = randomizedFunctionName;\n\n         $window[randomizedFunctionName] = function () {\n            $window[randomizedFunctionName] = null;\n            deferred.resolve($window.google.books);\n         }\n\n         if (!options.preventLoad) {\n            includeScript(options);\n         }\n\n         usedConfiguration = options;\n         usedConfiguration.randomizedFunctionName = randomizedFunctionName;\n\n         return deferred.promise;\n      }\n\n      function manualLoad() {\n         var config = usedConfiguration;\n\n         if (!isGoogleBooksLoaded()) {\n            includeScript(config);\n         } else if ($window[config.randomizedFunctionName]) {\n            $window[config.randomizedFunctionName]();\n         }\n      }\n   }\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .directive('googleBookReader', googleBookReader);\n\n   /** @ngInject */\n   function googleBookReader(googleBooksApi, googleBooksApiManualLoader) {\n      var directive = {\n         restrict: 'E',\n         link: linkFunc,\n         scope: {\n            properties: '='\n         }\n      };\n\n      return directive;\n\n      function linkFunc(scope, el) {\n         googleBooksApiManualLoader.load();\n         googleBooksApi.then(function (books) {\n            var viewer = new books.DefaultViewer(el.get(0));\n\n            scope.$watch('properties', function (properties) {\n               viewer.load(properties.id);\n            });\n\n            scope.$on('resize', function () {\n               viewer.resize();\n            });\n         });\n      }\n   }\n\n})();\n\n/**\n * Inspired by https://github.com/angular-ui/angular-google-maps/blob/f7c17e4336344afe9c31ca8b8a1e200e268f4979/src/coffee/providers/map-loader.coffee\n */\n(function () {\n   'use strict';\n\n   angular\n      .module('google.books')\n      .service('googleBooksApiManualLoader', googleBooksApiManualLoader);\n\n   /** @ngInject */\n   function googleBooksApiManualLoader(googleBooksScriptLoader) {\n      var API = {};\n\n      API.load = load;\n\n      return API;\n\n      function load() {\n         googleBooksScriptLoader.manualLoad();\n      }\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('editor', {\n        url: '/?q',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'vm'\n      })\n\n      .state('editor.article', {\n        url: 'articles/:id',\n        views: {\n          main: {\n            templateUrl: 'app/admin/editors/articles/article.html',\n            controller: 'ArticleEditorController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.person', {\n        url: 'people/:id',\n        views: {\n          main: {\n            templateUrl: 'app/person/person.html',\n            controller: 'ShowPersonController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('editor.work', {\n        url: 'works/:workId',\n        views: {\n          main: {\n            templateUrl: 'app/work/work.html',\n            controller: 'ShowWorkController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.edition', {\n        url: 'works/:workId/editions/:editionId',\n        views: {\n          main: {\n            templateUrl: 'app/work/edition.html',\n            controller: 'ShowEditionController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.volume', {\n        url: 'works/:workId/editions/:editionId/volumes/:volumeId',\n        views: {\n          main: {\n            templateUrl: 'app/work/volume.html',\n            controller: 'ShowVolumeController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('vwise', {\n        url: '/vwise',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      })\n\n      .state('task', {\n        url: '/task',\n        templateUrl: 'app/task/task.html',\n        controller: 'TaskController',\n        controllerAs: 'vm'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdminWeb')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, /* toastrConfig, */ $mdThemingProvider, tasksRepoProvider, worksRepoProvider, peopleRepoProvider, relationshipsRepoProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n\n\n    tasksRepoProvider.url = '/api/catalog/v1/tasks';\n    worksRepoProvider.url = '/api/catalog/works';\n    peopleRepoProvider.url = '/api/catalog/people';\n    relationshipsRepoProvider.url = '/api/catalog/relationships';\n  }\n\n})();\n\nangular.module(\"sdaAdminWeb\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<md-content flex layout=column><md-toolbar><div class=md-toolbar-tools><md-button class=\\\"md-accent md-icon-button\\\" ng-click=vm.openMenu() title=\\\"toggle menu\\\" hide-gt-sm><md-icon>menu</md-icon></md-button><h2><span>SDA Admin</span></h2><span flex></span><ul><li>Tasks</li><li>People</li><li>Articles</li></ul></div></md-toolbar><md-content flex layout=row><md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" ui-view=sidebar layout=column><form layout=row flex=none><md-input-container flex><label for=searchQuery>Search</label><md-icon>search</md-icon><input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required></md-input-container></form><md-content flex><div ng-if=vm.loading layout=row layout-align=center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"><md-subheader>People</md-subheader><md-list><md-list-item ng-repeat=\\\"person in vm.peopleResults.items\\\" ui-sref=\\\"editor.person({id: person.id})\\\"><div class=md-list-item-text><span>{{person.label}}</span></div></md-list-item></md-list></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"><md-subheader>Works</md-subheader><md-list><md-list-item ng-repeat=\\\"work in vm.worksResults.items\\\" ui-sref=\\\"editor.work({workId: work.id})\\\"><div class=md-list-item-text><span>{{work.label}}</span></div></md-list-item></md-list></div></md-content></md-sidenav><md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right\\\"><md-fab-trigger><md-button aria-label=New... class=md-fab><md-icon>add</md-icon></md-button></md-fab-trigger><md-fab-actions><md-button aria-label=\\\"New Article\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createArticle($event)><md-tooltip md-direction=left>New Article</md-tooltip><md-icon>description</md-icon></md-button><md-button aria-label=\\\"New Person\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createPerson($event)><md-tooltip md-direction=left>New Person</md-tooltip><md-icon>person</md-icon></md-button><md-button aria-label=\\\"New Work\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createWork($event)><md-tooltip md-direction=left>New Book</md-tooltip><md-icon>book</md-icon></md-button></md-fab-actions></md-fab-speed-dial><md-content flex layout=column ui-view=main></md-content></md-content></md-content>\");\n$templateCache.put(\"app/person/event-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Event Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><event-editor ng-model=vm.event flex></event-editor></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/person/person-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Biographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><section class=name layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Canonical Name</h2></div></md-toolbar><div class=name><name-editor ng-model=vm.person.name flex></name-editor></div></section><section class=alt-names layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Alternate Names</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addName()><md-icon>add</md-icon></md-button></div></md-toolbar><div class=name layout=row ng-repeat=\\\"name in vm.person.altNames\\\"><md-input-container><label>role</label><md-select ng-model=name.role><md-option ng-repeat=\\\"role in vm.nameRoles\\\" value={{role.value}}>{{role.label}}</md-option></md-select></md-input-container><name-editor ng-model=name flex></name-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteName(name)><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/person/person.html\",\"<div layout=row layout-padding><div flex=60><section class=\\\"content names\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h1 class=content-heading>{{vm.person.name.label}}</h1><span flex></span><md-button class=md-icon-button ng-click=vm.editBioInfo($event)><md-icon>edit</md-icon></md-button></div><div ng-if=\\\"vm.person.altNames && vm.person.altNames.length > 0\\\"><p>Other names:</p><ul><li ng-repeat=\\\"name in vm.person.altNames\\\">{{name.label}}</li></ul></div></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.person.summary ng-bind-html=vm.person.summary></p></section></div><div flex=40><section class=\\\"content birth\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Birth</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'birth\\', $event)\\\"><md-icon>edit</md-icon></md-button></div><p><span class=description ng-if=vm.person.birth.date.description>{{vm.person.birth.date.description}}</span> <span class=location ng-if=vm.person.birth.location>in {{vm.person.birth.location}}</span></p><p ng-bind-html=vm.person.birth.description ng-if=vm.person.birth.description></p></section><section class=\\\"content death\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Death</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'death\\', $event)\\\"><md-icon>edit</md-icon></md-button></div><p><span class=description ng-if=vm.person.death.date.description>{{vm.person.death.date.description}}</span> <span class=location ng-if=vm.person.death.location>in {{vm.person.death.location}}</span></p><p ng-bind-html=vm.person.death.description ng-if=vm.person.death.description></p></section></div></div>\");\n$templateCache.put(\"app/trc-bio/event-editor.html\",\"<div class=form-group><label class=control-label for=event-title>Title</label><input type=text id=event-title name=event-title class=\\\"form-control event-title\\\" ng-model=event.title></div><div class=form-group><label class=control-label for=event-description>Description</label><textarea id=event-description name=event-description class=\\\"form-control event-description\\\" ng-model=event.description></textarea></div><div class=form-group><label class=control-label for=event-location>Location</label><input type=text id=event-location name=event-location class=\\\"form-control event-location\\\" ng-model=event.location></div><div class=form-group><label class=control-label for=event-date>Date</label><input type=text id=event-date name=event-date class=\\\"form-control event-date\\\" ng-model=event.date.description><!-- TODO add datepicker --></div>\");\n$templateCache.put(\"app/trc-bio/name-editor.html\",\"<div class=form-group class=name-role><label class=control-label for=name-role>Role</label><select id=name-role name=name-role class=\\\"form-control name-role\\\" ng-model=name.role><option ng-repeat=\\\"role in nameEditor.roles\\\" value={{role.value}}>{{role.label}}</option></select></div><div class=form-group class=name-structure><label class=control-label>Structured Name</label><input type=text class=name-title placeholder=title ng-model=name.title> <input type=text class=name-given placeholder=given ng-model=name.givenName> <input type=text class=name-middle placeholder=middle ng-model=name.middleName> <input type=text class=name-family placeholder=family ng-model=name.familyName> <input type=text class=name-suffix placeholder=suffix ng-model=name.suffix></div><div class=form-group class=name-label><label for=label>Display Label</label><input type=text placeholder=label ng-model=name.label></div>\");\n$templateCache.put(\"app/trc-bio/person-editor.html\",\"<div class=form-group><label for=person-name>Primary Name</label><trc-name-editor id=person-name ng-model=person.name></trc-name-editor></div><div class=form-group><label for=person-altnames>Alternate Names</label><div ng-repeat=\\\"name in person.altNames\\\"><trc-name-editor id=person-altnames ng-model=name></trc-name-editor><button ng-click=personEditor.removeName($index)>&minus;</button></div><button ng-click=personEditor.addName()>+</button></div><div class=form-group><label for=person-birth>Birth</label><div ng-if=person.birth><trc-event-editor id=person-birth ng-model=person.birth></trc-event-editor><button ng-click=\\\"personEditor.removeEvent(\\'birth\\')\\\">&minus;</button></div><div ng-if=!person.birth><button ng-click=\\\"personEditor.addEvent(\\'birth\\')\\\">+</button></div></div><div class=form-group><label for=person-death>Death</label><div ng-if=person.death><trc-event-editor id=person-death ng-model=person.death></trc-event-editor><button ng-click=\\\"personEditor.removeEvent(\\'death\\')\\\">&minus;</button></div><div ng-if=!person.death><button ng-click=\\\"personEditor.addEvent(\\'death\\')\\\">+</button></div></div><div class=form-group><label class=control-label for=person-summary>Summary</label><textarea id=person-summary name=person-summary class=\\\"form-control person-summary\\\" ng-model=person.summary></textarea></div>\");\n$templateCache.put(\"app/task/task.html\",\"<md-content flex layout=column><md-toolbar><div class=md-toolbar-tools><md-button class=\\\"md-accent md-icon-button\\\" ng-click=vm.openMenu() title=\\\"toggle menu\\\" hide-gt-sm><md-icon>menu</md-icon></md-button><img class=logo src=assets/images/sda-logo-light.png><h2><span>Task Management Dashboard</span></h2><span flex></span> <img class=ox-brand src=assets/images/ox-brand-rect.png alt=\\\"University of Oxford\\\" hide-xs></div></md-toolbar><md-content flex layout=row><md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\">Left Sidebar</md-sidenav><md-content flex layout=column><md-content flex layout=column><md-input-container><label>Search</label><md-icon>search</md-icon><input type=search ng-model=filter ng-change=vm.search(filter)></md-input-container><md-content flex><div layout=row layout-align=\\\"center center\\\" ng-if=vm.loading><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-repeat=\\\"stageId in vm.stageOrder\\\" ng-if=vm.worklists[stageId]><md-subheader>{{vm.task.workflow.stages[stageId].label}}</md-subheader><md-list><md-list-item ng-repeat=\\\"item in vm.worklists[stageId].items | filter : filter | limitTo : 20\\\" ng-mouseover=\\\"item.hover = true\\\" ng-mouseout=\\\"item.hover = false\\\" ng-click=\\\"vm.focusItem(item, $event)\\\"><span ng-bind-html=item.label></span> <span flex></span><md-button class=md-exclude ng-repeat=\\\"transition in vm.task.workflow.stages[stageId].transitions\\\" ng-click=\\\"vm.transition(item, transition, $event)\\\" ng-show=item.hover><span>{{transition.label}}</span></md-button></md-list-item></md-list></div></md-content></md-content></md-content></md-content></md-content>\");\n$templateCache.put(\"app/vwise/workspace.html\",\"<div layout=row flex><md-sidenav md-component-id=left class=md-sidenav-left layout=column md-is-locked-open=vm.sidebarFocused><form layout=row flex=none><md-input-container flex><label for=searchQuery>Search</label><md-icon>search</md-icon><input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required md-sidenav-focus></md-input-container></form><md-content flex><div ng-if=vm.loading layout=row layout-align=center><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"><md-subheader>People</md-subheader><md-list><md-list-item ng-repeat=\\\"item in vm.peopleResults.items\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text><span>{{item.label}}</span></div></md-list-item></md-list></div><div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"><md-subheader>Works</md-subheader><md-list><md-list-item ng-repeat=\\\"item in vm.worksResults.items\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text><span>{{item.label}}</span></div></md-list-item></md-list></div></md-content></md-sidenav><div flex jqyoui-droppable=\\\"{stack: true, onDrop:\\'vm.thingDropped()\\'}\\\" data-drop=true class=workspace ng-click=vm.workspaceClicked($event)><div ng-repeat=\\\"panel in vm.workspace.panelStack track by panel.id\\\" class=panel ng-style={left:panel.vprops.xPosition,top:panel.vprops.yPosition,width:panel.vprops.width,height:panel.vprops.height,background:panel.vprops.background,color:panel.vprops.foreground} jqyoui-draggable=\\\"{onDrag:\\'vm.panelDragged(panel)\\',onStop:\\'vm.savePanelPosition(panel)\\'}\\\" ng-click=\\\"vm.activatePanel(panel, $event)\\\" data-jqyoui-options=\\\"{handle:\\'.drag-handle\\'}\\\" data-drag=true vwise-panel=panel layout=column></div></div></div>\");\n$templateCache.put(\"app/work/copy-edit-dialog.html\",\"<md-dialog flex=50><md-toolbar><div class=md-toolbar-tools><h3>Digital Copy Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><copy-editor ng-model=vm.copy></copy-editor></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/edition-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Bibliographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><div layout=row><md-input-container flex><label>edition name</label><input type=text ng-model=vm.edition.editionName required></md-input-container></div><section class=publication layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Publication Information</h2></div></md-toolbar><publication-info-editor ng-model=vm.edition.publicationInfo flex></publication-info-editor></section><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addTitle($event)><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in vm.edition.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in vm.edition.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=\\\"authors other-authors\\\" layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Other Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'otherAuthors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=\\\"author other-author\\\" layout=row ng-repeat=\\\"author in vm.edition.otherAuthors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'otherAuthors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/edition.html\",\"<nav layout=row layout-padding><ol class=breadcrumbs flex><li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li><li>{{vm.edition.editionName}}</li></ol></nav><div layout=row layout-padding><div layout=column flex=60><section class=\\\"content citation\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliographic Information</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibInfo($event)><md-icon>edit</md-icon></md-button></div><p><span class=authors ng-if=\\\"vm.edition.authors && vm.edition.authors.length > 0\\\"><span class=author ng-repeat=\\\"author in vm.edition.authors\\\"><span ng-if=author.authorId><a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span><span ng-if=!author.authorId>{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span></span></span><span class=title ng-if=vm.title>{{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span><span class=publication ng-if=vm.edition.publicationInfo><span ng-if=vm.edition.publicationInfo.place><span class=place>{{vm.edition.publicationInfo.place}}</span>: </span><span ng-if=vm.edition.publicationInfo.publisher><span class=publisher>{{vm.edition.publicationInfo.publisher}}</span>, </span><span ng-if=vm.edition.publicationInfo.date><time class=date datetime={{vm.edition.publicationInfo.date.calendar}}>{{vm.edition.publicationInfo.date.description}}</time>.</span></span></p></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.edition.summary ng-bind-html=vm.edition.summary></p></section><section class=\\\"content volumes\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Volumes</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addVolume($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"volume in vm.edition.volumes\\\" ui-sref=\\\"editor.volume({workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id})\\\"><span>Volume {{volume.volumeNumber}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteVolume(volume, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div><div layout=column flex=40><section class=\\\"content references\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Relationships</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addRelationship($event)><md-icon>add</md-icon></md-button></div><div ng-repeat=\\\"type in vm.relationships\\\"><h3 class=content-heading>{{type.label}}</h3><md-list><md-list-item ng-repeat=\\\"relationship in type.relationships\\\" ng-click=vm.openRelationship(relationship)><span ng-repeat=\\\"entity in relationship.entities\\\">{{entity.label}}.</span><md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"vm.deleteRelationship(relationship, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></div></section><section class=\\\"content copies\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addCopy($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"copy in vm.edition.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"><span>{{copy.title}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div></div>\");\n$templateCache.put(\"app/work/relationship-edit-dialog.html\",\"<md-dialog flex=50><md-toolbar><div class=md-toolbar-tools><h3>Relationship Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form name=relationship ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content layout=column><md-input-container><label>type</label><md-select name=type ng-model=vm.selectedType ng-change=vm.setType(vm.selectedType) required><md-option ng-repeat=\\\"type in vm.types\\\" ng-value=type>{{type.label}}</md-option></md-select><div class=errors ng-messages=relationship.type.$error ng-if=relationship.$dirty><div ng-message=required>Required</div></div></md-input-container><md-autocomplete md-items=\\\"work in vm.getResults(vm.searchText)\\\" md-item-text=work.label md-search-text=vm.searchText md-selected-item-change=vm.selectWork(work) placeholder=\\\"search works\\\" required><md-item-template><span md-highlight=vm.searchText md-highlight-flags=^i>{{work.label}}</span></md-item-template></md-autocomplete><md-input-container ng-if=\\\"vm.targets && vm.targets.length > 1\\\"><label>target</label><md-select name=target ng-model=vm.selectedTarget ng-change=vm.setTarget(vm.selectedTarget) required><md-option ng-repeat=\\\"target in vm.targets\\\" ng-value=target>{{target.label}}</md-option></md-select><div class=errors ng-messages=relationship.target.$error ng-if=relationship.$dirty><div ng-message=required>Required</div></div></md-input-container><div class=summary><h2>Summary</h2><div ckeditor ng-model=vm.relationship.description></div></div></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/volume-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Bibliographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><div layout=row><md-input-container flex><label>volume number</label><input type=text ng-model=vm.volume.volumeNumber required></md-input-container></div><section class=publication layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Publication Information</h2></div></md-toolbar><publication-info-editor ng-model=vm.volume.publicationInfo></publication-info-editor></section><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addTitle($event)><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in vm.volume.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in vm.volume.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=\\\"authors other-authors\\\" layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Other Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'otherAuthors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=\\\"author other-author\\\" layout=row ng-repeat=\\\"author in vm.volume.otherAuthors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'otherAuthors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/volume.html\",\"<nav layout=row layout-padding><ol class=breadcrumbs flex><li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li><li><a ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: vm.edition.id})\\\">{{vm.edition.editionName}}</a></li><li>Volume {{vm.volume.volumeNumber}}</li></ol></nav><div layout=row layout-padding><div layout=column flex=60><section class=\\\"content citation\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliographic Information</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibInfo($event)><md-icon>edit</md-icon></md-button></div><p><span class=authors ng-if=\\\"vm.volume.authors && vm.volume.authors.length > 0\\\"><span class=author ng-repeat=\\\"author in vm.volume.authors\\\"><span ng-if=author.authorId><a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span><span ng-if=!author.authorId>{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span></span></span><span class=title ng-if=vm.title>{{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span><span class=publication ng-if=vm.volume.publicationInfo><span ng-if=vm.volume.publicationInfo.place><span class=place>{{vm.volume.publicationInfo.place}}</span>: </span><span ng-if=vm.volume.publicationInfo.publisher><span class=publisher>{{vm.volume.publicationInfo.publisher}}</span>, </span><span ng-if=vm.volume.publicationInfo.date><time class=date datetime={{vm.volume.publicationInfo.date.calendar}}>{{vm.volume.publicationInfo.date.description}}</time>.</span></span></p></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.volume.summary ng-bind-html=vm.volume.summary></p></section></div><div layout=column flex=40><section class=\\\"content references\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Relationships</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addRelationship($event)><md-icon>add</md-icon></md-button></div><div ng-repeat=\\\"type in vm.relationships\\\"><h3 class=content-heading>{{type.label}}</h3><md-list><md-list-item ng-repeat=\\\"relationship in type.relationships\\\" ng-click=vm.openRelationship(relationship)><span ng-repeat=\\\"entity in relationship.entities\\\">{{entity.label}}.</span><md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"vm.deleteRelationship(relationship, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></div></section><section class=\\\"content copies\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addCopy($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"copy in vm.volume.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"><span>{{copy.title}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div></div>\");\n$templateCache.put(\"app/work/work-edit-dialog.html\",\"<md-dialog flex=80><md-toolbar><div class=md-toolbar-tools><h3>Bibliographic Information Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><div class=md-dialog-content><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addTitle($event)><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in vm.work.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in vm.work.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=\\\"authors other-authors\\\" layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Other Authors</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'otherAuthors\\', $event)\\\"><md-icon>add</md-icon></md-button></div></md-toolbar><div class=\\\"author other-author\\\" layout=row ng-repeat=\\\"author in vm.work.otherAuthors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'otherAuthors\\', author, $event)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section></div></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/work/work.html\",\"<nav layout=row layout-padding><ol class=breadcrumbs flex><li>{{vm.bcTitle.title}}{{vm.bcTitle && vm.bcTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.bcTitle.subtitle}}</li></ol></nav><div layout=row layout-padding><div layout=column flex=60><section class=\\\"content citation\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Bibliographic Information</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editBibInfo($event)><md-icon>edit</md-icon></md-button></div><p><span class=authors ng-if=\\\"vm.work.authors && vm.work.authors.length > 0\\\"><span class=author ng-repeat=\\\"author in vm.work.authors\\\"><span ng-if=author.authorId><a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span><span ng-if=!author.authorId>{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span></span></span><span class=title ng-if=vm.title>{{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}.</span></p></section><section class=\\\"content summary\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Summary</h2><span flex></span><md-button class=md-icon-button ng-click=vm.editSummary($event)><md-icon>edit</md-icon></md-button></div><p ng-if=vm.work.summary ng-bind-html=vm.work.summary></p></section><section class=\\\"content editions\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Editions</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addEdition($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"edition in vm.work.editions\\\" ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: edition.id})\\\"><span>{{edition.editionName}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteEdition(edition, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div><div layout=column flex=40><section class=\\\"content references\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Relationships</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addRelationship($event)><md-icon>add</md-icon></md-button></div><div ng-repeat=\\\"type in vm.relationships\\\"><h3 class=content-heading>{{type.label}}</h3><md-list><md-list-item ng-repeat=\\\"relationship in type.relationships\\\" ng-click=vm.openRelationship(relationship)><span ng-repeat=\\\"entity in relationship.entities\\\">{{entity.label}}.</span><md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"vm.deleteRelationship(relationship, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></div></section><section class=\\\"content copies\\\"><div class=toolbar layout=row layout-align=\\\"start center\\\"><h2 class=content-heading>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=vm.addCopy($event)><md-icon>add</md-icon></md-button></div><md-list><md-list-item ng-repeat=\\\"copy in vm.work.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"><span>{{copy.title}}</span><md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"><md-icon>delete</md-icon></md-button></md-list-item></md-list></section></div></div>\");\n$templateCache.put(\"app/components/summary-edit-dialog/summary-edit-dialog.html\",\"<md-dialog flex=50><md-toolbar><div class=md-toolbar-tools><h3>Summary Editor</h3><span flex></span><md-button class=md-icon-button ng-click=vm.cancel()><md-icon>close</md-icon></md-button></div></md-toolbar><form ng-submit=vm.close()><md-dialog-content><!-- material-compliant padding not used since WYSIWYG text editor *is* the UI --><summary-editor ng-model=vm.summary></summary-editor></md-dialog-content><md-dialog-actions><md-button ng-click=vm.cancel()>Cancel</md-button><md-button class=md-primary type=submit>Done</md-button></md-dialog-actions></form></md-dialog>\");\n$templateCache.put(\"app/components/date-editor/date-editor.html\",\"<div layout=row><md-input-container flex><label>date</label><input type=text ng-model=date.description></md-input-container><md-input-container flex><label>ISO-8601 date</label><input type=datetime ng-model=date.calendar></md-input-container></div>\");\n$templateCache.put(\"app/components/summary-editor/summary-editor.html\",\"<div ckeditor ng-model=summary></div>\");\n$templateCache.put(\"app/admin/editors/articles/article.html\",\"<form flex layout=column layout-padding><!-- title editor bar --><md-content layout=row><md-input-container flex=60 layout-sm=column layout-align=\\\"begin end\\\"><label>Title</label><input type=text ng-model=vm.article.title></md-input-container><section flex=40 layout=row layout-sm=column layout-align=\\\"end center\\\" layout-wrap><md-button class=md-raised ng-click=vm.cancel()>Cancel</md-button><md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button></section></md-content><!-- TODO add space for authors --><!-- TODO add save button and auto-save --><!-- TODO add sidebar for notes, biblio, links, etc --><div ckeditor=vm.editor.config ng-model=vm.article.body>Click here to edit article</div><!-- TODO how to make this fill all available space --></form>\");\n$templateCache.put(\"app/person/components/event-editor/event-editor.html\",\"<div layout=column><div layout=row><md-input-container flex><label>location</label><input type=text ng-model=event.location></md-input-container><date-editor ng-model=event.date flex></date-editor></div><div layout=row layout-padding><div flex><h2>Description</h2><div flex ckeditor ng-model=event.description></div></div></div></div>\");\n$templateCache.put(\"app/person/components/name-editor/name-editor.html\",\"<div layout=column><div layout=row><md-input-container flex=10><label>title</label><input type=text ng-model=name.title></md-input-container><md-input-container flex=30><label>given</label><input type=text ng-model=name.givenName></md-input-container><md-input-container flex=20><label>middle</label><input type=text ng-model=name.middleName></md-input-container><md-input-container flex=30><label>family</label><input type=text ng-model=name.familyName></md-input-container><md-input-container flex=10><label>suffix</label><input type=text ng-model=name.suffix></md-input-container></div><md-input-container><label>display label</label><input type=text ng-model=name.label required></md-input-container></div>\");\n$templateCache.put(\"app/task/components/work-editor/work-editor-item.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=!vm.loaded><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div ng-if=vm.loaded><work-editor ng-model=vm.work></work-editor></div>\");\n$templateCache.put(\"app/vwise/components/panel/panel.html\",\"<div class=drag-handle ng-style=\\\"{background: panel.vprops.background}\\\" layout=row><span flex></span> <input type=color ng-model=panel.vprops.background> <button class=close ng-click=vm.closePanel(panel)>&times;</button></div><div class=content flex layout=column></div><div class=resize-handle jqyoui-draggable=\\\"{onDrag:\\'vm.resizePanel(panel)\\',onStop:\\'vm.savePanelSize(panel)\\'}\\\" data-drag=true></div>\");\n$templateCache.put(\"app/vwise/components/person-panel/person-panel.html\",\"<div class=panel-person flex layout=column><h1><span class=name>{{name}}</span></h1><md-tabs flex><md-tab ng-if=person.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=person.summary></div></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/vwise/components/work-panel/edition-panel.html\",\"<div class=panel-edition flex layout=column><h1><span class=authors><span class=author ng-repeat=\\\"author in edition.authors\\\">{{author.lastName}}. </span></span><span class=title>{{title.title}}<span ng-if=title.subtitle>: {{title.subtitle}}</span>.</span> <span class=edition-name>{{edition.editionName}}.</span></h1><md-tabs flex><md-tab ng-if=edition.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=edition.summary></div></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body>Coming soon...</md-tab-body></md-tab><md-tab ng-if=\\\"edition.volumes.length > 0\\\"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in edition.volumes\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>Volume {{item.volumeNumber}} ({{item.publicationInfo.date.description}})</div></md-list-item></md-list></md-tab-body></md-tab><md-tab ng-if=\\\"edition.copies.length > 0\\\"><md-tab-label><md-icon>book</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in edition.copies\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.title}}</div></md-list-item></md-list></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/vwise/components/work-panel/volume-panel.html\",\"<div class=panel-volume flex layout=column><h1><span class=authors><span class=author ng-repeat=\\\"author in volume.authors\\\">{{author.lastName}}. </span></span><span class=title>{{title.title}}<span ng-if=title.subtitle>: {{title.subtitle}}</span>.</span> <span class=edition-name>{{edition.editionName}}.</span> <span class=volume-name>Volume {{volume.volumeNumber}}.</span></h1><md-tabs flex><md-tab ng-if=volume.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=volume.summary></div></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body>Coming soon...</md-tab-body></md-tab><md-tab ng-if=\\\"volume.copies.length > 0\\\"><md-tab-label><md-icon>book</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in volume.copies\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.title}}</div></md-list-item></md-list></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/vwise/components/work-panel/work-panel.html\",\"<div class=panel-work flex layout=column><h1><span class=authors><span class=author ng-repeat=\\\"author in work.authors\\\">{{author.lastName}}. </span></span><span class=title>{{title.title}}<span ng-if=title.subtitle>: {{title.subtitle}}</span>.</span></h1><md-tabs flex><md-tab ng-if=work.summary><md-tab-label><md-icon>subject</md-icon></md-tab-label><md-tab-body><div class=summary ng-bind-html=work.summary></div></md-tab-body></md-tab><md-tab><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body>Coming soon...</md-tab-body></md-tab><md-tab ng-if=\\\"work.editions.length > 0\\\"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in work.editions\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.editionName}} ({{item.publicationInfo.date.description}})</div></md-list-item></md-list></md-tab-body></md-tab><md-tab ng-if=\\\"work.copies.length > 0\\\"><md-tab-label><md-icon>book</md-icon></md-tab-label><md-tab-body><md-list><md-list-item ng-repeat=\\\"item in work.copies\\\" jqyoui-draggable={animate:false} data-jqyoui-options=\\\"{revert:\\'invalid\\',helper:\\'clone\\',appendTo:\\'body\\'}\\\" data-drag=true><div class=md-list-item-text>{{item.title}}</div></md-list-item></md-list></md-tab-body></md-tab></md-tabs></div>\");\n$templateCache.put(\"app/work/components/author-ref-editor/author-ref-editor.html\",\"<div layout=column><div layout=row><md-autocomplete required md-items=\\\"item in vm.authorRoles\\\" md-item-text=role md-min-length=0 md-search-text=ref.role md-selected-item-change=\\\"ref.role = item\\\" md-floating-label=role><md-item-template><span md-highlight-text=ref.role>{{item}}</span></md-item-template></md-autocomplete><md-input-container flex><label>first name</label><input type=text ng-model=ref.firstName></md-input-container><md-input-container flex><label>last name</label><input type=text ng-model=ref.lastName></md-input-container></div><div layout=row><md-autocomplete flex md-items=\\\"person in vm.getResults(vm.linkAuthorSearchText)\\\" md-item-text=person.label md-search-text=vm.linkAuthorSearchText md-search-text-change=vm.searchPeople(vm.linkAuthorSearchText) md-selected-item-change=vm.setLinkedAuthor(person) md-floating-label=\\\"linked author\\\"><span md-highlight-text=vm.linkAuthorSearchText>{{person.label}}</span></md-autocomplete></div></div>\");\n$templateCache.put(\"app/work/components/copy-editor/copy-editor.html\",\"<ng-form name=copyForm layout=column flex><md-input-container><label for=title>Title</label><input type=text name=title id=title ng-model=copy.title></md-input-container><div layout=row><md-input-container><label for=type>Type</label><md-select name=type id=type ng-model=copy.type required ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"><md-option ng-repeat=\\\"handler in vm.refHandlers\\\" value={{handler.id}}>{{handler.display}}</md-option></md-select></md-input-container><md-input-container flex><label for=url>URL</label><input type=url name=url id=url ng-model=copyUrl ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"></md-input-container></div><ul class=\\\"properties properties-inline\\\"><li ng-repeat=\\\"(key, value) in copy.properties\\\"><span class=label>{{key}}</span> <span class=value>{{value}}</span></li></ul><md-input-container><label for=rights>Description of Rights</label><input type=text name=rights id=rights ng-model=copy.rights></md-input-container><h3>Summary</h3><summary-editor ng-model=copy.summary flex></summary-editor></ng-form>\");\n$templateCache.put(\"app/work/components/edition-editor/edition-editor.html\",\"<div layout=row><md-input-container flex><label>edition name</label><input type=text ng-model=edition.editionName required></md-input-container></div><section class=publication layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Publication Information</h2></div></md-toolbar><publication-info-editor ng-model=edition.publicationInfo flex></publication-info-editor></section><section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=edition.titles.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in edition.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.titles.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=edition.authors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in edition.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.authors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=\\\"authors other-authors\\\" layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Other Authors</h2><span flex></span><md-button class=md-icon-button ng-click=edition.otherAuthors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=\\\"author other-author\\\" layout=row ng-repeat=\\\"author in edition.otherAuthors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.otherAuthors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=summary><h2>Summary</h2><summary-editor ng-model=edition.summary flex></summary-editor></section><section class=volumes><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Volumes</h2><span flex></span><md-button class=md-icon-button ng-click=vm.createVolume()><md-icon>add</md-icon></md-button></div></md-toolbar><md-whiteframe class=volume layout=column layout-margin ng-repeat=\\\"volume in vm.volumes\\\" ng-class=\\\"{\\'md-whiteframe-2dp\\': !volume.focused, \\'md-whiteframe-8dp\\': volume.focused}\\\"><h3 layout=row><div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"volume.focused = !volume.focused\\\"><md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon><span>Volume {{volume.model.volumeNumber}}</span> <span flex></span></div><md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteVolume($index)><md-icon>delete</md-icon></md-button></h3><div slide-toggle=volume.focused><volume-editor ng-model=volume.model flex></volume-editor></div></md-whiteframe></section><section class=copies><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=edition.copies.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=copy layout=column ng-repeat=\\\"copy in edition.copies\\\"><div layout=row><copy-editor ng-model=copy flex></copy-editor><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.copies.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></div></div></section>\");\n$templateCache.put(\"app/work/components/publication-info-editor/publication-info-editor.html\",\"<div layout=row><md-input-container flex><label>publisher</label><input type=text ng-model=pubInfo.publisher></md-input-container><md-input-container flex><label>location</label><input type=text ng-model=pubInfo.place></md-input-container><date-editor ng-model=pubInfo.date flex></date-editor></div>\");\n$templateCache.put(\"app/work/components/title-editor/title-editor.html\",\"<div layout=row><md-input-container><label>type</label><md-select ng-model=title.type required><md-option value=bibliographic>bibliographic</md-option><md-option value=canonical>canonical</md-option><md-option value=short>short</md-option></md-select></md-input-container><md-input-container flex><label>title</label><input type=text ng-model=title.title required><div ng-switch=title.type><small ng-switch-when=bibliographic>the full title as published on the work</small> <small ng-switch-when=canonical>title by which the work is commonly known in the academic realm</small> <small ng-switch-when=short>shortened title coloquially used by the public</small></div></md-input-container><md-input-container flex><label>subtitle</label><input type=text ng-model=title.subtitle></md-input-container></div>\");\n$templateCache.put(\"app/work/components/volume-editor/volume-editor.html\",\"<div layout=row><md-input-container flex><label>volume number</label><input type=text ng-model=volume.volumeNumber required></md-input-container></div><section class=publication layout=column><h2>Publication Information</h2><publication-info-editor ng-model=volume.publicationInfo></publication-info-editor></section><section class=titles layout=column><h2 layout=row><span flex>Titles</span><md-button class=md-icon-button ng-click=volume.titles.push({})><md-icon>add</md-icon></md-button></h2><div class=title layout=row ng-repeat=\\\"title in volume.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.titles.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><h2 layout=row><span flex>Authors</span><md-button class=md-icon-button ng-click=volume.authors.push({})><md-icon>add</md-icon></md-button></h2><div class=author layout=row ng-repeat=\\\"author in volume.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.authors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=\\\"authors other-authors\\\" layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Other Authors</h2><span flex></span><md-button class=md-icon-button ng-click=volume.otherAuthors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=\\\"author other-author\\\" layout=row ng-repeat=\\\"author in volume.otherAuthors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.otherAuthors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=summary><h2>Summary</h2><summary-editor ng-model=volume.summary flex></summary-editor></section><section class=copies><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=volume.copies.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=copy layout=column ng-repeat=\\\"copy in volume.copies\\\"><div layout=row><copy-editor ng-model=copy flex></copy-editor><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.copies.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></div></div></section>\");\n$templateCache.put(\"app/work/components/work-editor/work-editor.html\",\"<section class=titles layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Titles</h2><span flex></span><md-button class=md-icon-button ng-click=work.titles.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=title layout=row ng-repeat=\\\"title in work.titles\\\"><title-editor ng-model=title flex></title-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.titles.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=authors layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Authors</h2><span flex></span><md-button class=md-icon-button ng-click=work.authors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=author layout=row ng-repeat=\\\"author in work.authors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.authors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=\\\"authors other-authors\\\" layout=column><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Other Authors</h2><span flex></span><md-button class=md-icon-button ng-click=work.otherAuthors.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=\\\"author other-author\\\" layout=row ng-repeat=\\\"author in work.otherAuthors\\\"><author-ref-editor ng-model=author flex></author-ref-editor><md-input-container><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.otherAuthors.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></md-input-container></div></section><section class=summary><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Summary</h2></div></md-toolbar><summary-editor ng-model=work.summary flex></summary-editor></section><section class=editions><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Editions</h2><span flex></span><md-button class=md-icon-button ng-click=vm.createEdition()><md-icon>add</md-icon></md-button></div></md-toolbar><md-whiteframe class=edition layout=column layout-margin ng-repeat=\\\"edition in vm.editions\\\" ng-class=\\\"{ \\'md-whiteframe-2dp\\': !edition.focused, \\'md-whiteframe-8dp\\': edition.focused }\\\"><h3 layout=row><div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"edition.focused = !edition.focused\\\"><md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon><span>{{edition.model.editionName}}</span> <span flex></span></div><md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteEdition($index)><md-icon>delete</md-icon></md-button></h3><div slide-toggle=edition.focused><edition-editor ng-model=edition.model flex></edition-editor></div></md-whiteframe></section><section class=copies><md-toolbar class=md-hue-3><div class=md-toolbar-tools><h2>Digital Copies</h2><span flex></span><md-button class=md-icon-button ng-click=work.copies.push({})><md-icon>add</md-icon></md-button></div></md-toolbar><div class=copy layout=column ng-repeat=\\\"copy in work.copies\\\"><div layout=row><copy-editor ng-model=copy flex></copy-editor><md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.copies.splice($index, 1)\\\"><md-icon>delete</md-icon></md-button></div></div></section>\");}]);"],"sourceRoot":"/source/"}