{"version":3,"sources":["scripts/app.js"],"names":["angular","module","ArticleTypeSearchController","$log","articlesRepo","search","query","vm","results","type","activate","this","$inject","component","templateUrl","bindings","controller","ArticleAuthorEditorController","author","titleEditorDirective","directive","restrict","scope","title","relnEditDialogFactory","$mdDialog","showDialog","$event","dialog","targetEvent","RelationshipEditDialogController","controllerAs","show","$filter","worksRepo","relnRepo","types","getTypes","rawTypes","typesP","$promise","then","forEach","push","id","identifier","label","directed","isDirected","reverse","reverseTitle","Object","defineProperty","value","items","selectWork","proxy","anchors","baseLabel","stripTags","baseToken","ref","token","selectedAnchor","createAnchor","work","getWork","editions","edition","editionLabel","editionName","editionId","volumes","volume","volumeLabel","volumeNumber","volumeId","close","hide","typeId","selectedType","target","description","cancel","searchText","selectedWork","factory","publicationInfoEditorDirective","pubInfo","RelationshipsController","$scope","$state","$timeout","sdaToast","_","relnEditDialog","openRelationship","reln","anchor","state","params","TypeId","WORK","workId","properties","PERSON","ARTICLE","go","error","addRelationship","relationship","createRelationship","dialogPromise","relnInfo","targets","related","saveP","save","success","loadRelationships","deleteRelationship","confirm","textContent","ok","confirmPromise","deleteP","$watch","newAnchor","loading","relns","typeGroupsP","typeGroups","normalizeRelationships","copyEditorDirective","copy","CopyEditorController","addHandler","HathiTrustRefHandler","GoogleBooksRefHandler","InternetArchiveRefHandler","handler","refHandlers","parseProperties","url","copyForm","$setValidity","setProperties","handle","parsed","parseUrl","seq","path","substr","pageNo","fragment","match","length","makePropertiesObject","src","display","hostname","lastIndexOf","urlappend","subquery","parseQueryString","htid","section","printsec","page","pg","parser","document","createElement","href","toString","protocol","host","port","pathname","hash","sep","isString","flags","indexOf","kvpairs","split","pair","ix","key","decodeURIComponent","URIError","hasOwnProperty","isArray","copyEditDialogFactory","locals","CopyEditDialogController","authorRefEditorDirective","AuthorRefEditorController","peopleRepo","authorId","get","linkAuthorSearchText","name","setLinkedAuthor","person","getResults","resultSet","authorRoles","workEditorItemDirective","linkFunc","WorkEditorItemController","loaded","link","workEditorDirective","WorkEditorController","model","focused","createEdition","titles","cloneDeep","authors","deleteEdition","splice","volumeEditorDirective","editionEditorDirective","EditionEditorController","createVolume","publicationInfo","deleteVolume","nameEditorDirective","eventEditDialogFactory","event","EventEditDialogController","eventEditorDirective","treeCategorizationEditor","scopeId","scheme","TreeCategorizationController","$q","categorizationService","info","repo","getScopedRepo","overviews","handleAssociateEntry","node","linkArticle","article","nodes","reference","openEditor","values","create","articlePromise","linkPromise","all","handleRemoveEntry","handleCreateChild","parent","onCreate","newCategoryDialog","prompt","placeholder","handleDeleteNode","msg","removeCatgorizationDialog","htmlContent","remove","ArticleEditorSectionController","createArticle","titlePromise","savePromise","ArticleEditorController","$stateParams","footnoteEditDialog","refsRepoFactory","references","refsRepo","refsPromise","cleanArticleHandler","$watchCollection","cleanRefsHandler","editFootnote","footnote","newFootnote","newReferences","createRefCollection","promise","ckeditor","footnoteEditor","footnotes","updatedReferences","merge","compact","obj","cleanReferences","cleanFootnotes","refsRepoUrl","getReferencesEndpoint","getRepo","abstractEditor","config","extend","CKEDITOR_CONFIG","removeButtons","join","editor","toolbar","format_tags","extraPlugins","mathJaxLib","ZoteroTestController","item","summaryEditDialogFactory","summary","SummaryEditDialogController","summaryEditorDirective","toolbarGroups","groups","stripTagsFilter","html","String","replace","filter","slideToggle","beforeAddClass","element","className","done","NG_HIDE_CLASS","slideUp","removeClass","slideDown","animation","SeeAlsoEditorController","seeAlsoRepo","trcSearch","createLink","alreadyLinked","clearLinkForm","sourceToken","source","seeAlso","links","openLink","deleteLink","confirmP","combineSearchResults","newToken","some","existing","selectedItem","flatMap","UNIFIED_SEARCH_KEYS","map","SdaToastProvider","SdaToastFactory","$mdToast","showSuccessToast","message","options","opts","toastClass","makeToast","showInfoToast","showErrorToast","hideDelay","provider","defaultOptions","toast","simple","position","action","$get","NavbarController","$mdSidenav","toggleSidenav","toggle","sidenavId","guessDateFactory","moment","guessDate","str","INFER_FORMATS","emptyFilterFactory","isEmpty","dateEditorDirective","calendarAutoSet","dateDescription","date","calendar","format","DataContainerController","watch","fn","unregister","listeners","set","newValue","footnoteEditDialogFactory","$mdBottomSheet","FootnoteEditDialogController","clickOutsideToClose","ckeditorConfig","ckeditorFootnotesDirective","$document","el","attrs","requires","insertFootnoteCommand","fire","FOOTNOTE_COMMAND_NAME","command","createFootnote","backlinkId","anchorIdPrefix","ckeditorBibliography","$eval","ctrl","insertHtml","ckeditorFootnotesAnchorIdPrefix","instance","scopeValueExpr","ckeditorFootnotes","addCommand","async","allowedContent","requiredContent","exec","ui","addButton","require","ckeditorBibliographyDirective","refsRenderer","citationEditDialog","insertCitationCommand","CITATION_COMMAND_NAME","newReference","citation","createCitation","citations","render","rendered","refs","CitationEditorController","zotero","account","getUserAccount","ZOTERO_USER_ACCOUNT_ID","ZOTERO_USER_ACCOUNT_API_KEY","groupP","when","getGroup","ZOTERO_GROUP_ID","groupLibraryP","group","getLibrary","Error","warn","library","resultsP","searchItems","adaptedResultsP","adaptItem","wrapItem","zItem","createBiblioItem","creators","adaptCreator","meta","pick","fields","omit","zCreator","role","creatorType","firstName","lastName","labelP","renderBiblioItem","addCitationItem","citationItem","referencedBibItem","bibliography","renderCitationItemLabel","clearForm","selectBiblioItem","itemContainer","activeCitationItem","editCitationItem","biblioItem","biblioItemContainer","selectedBiblioItem","renderedP","createZoteroItem","zoteroItem","cancelZoteroItem","saveZoteroItem","zItemP","saveItem","biblioItemP","itemContainerP","locatorTypes","LOCATOR_TYPES","edit","CitationEditDialogFactory","CitationEditDialogController","ZoteroEditorController","getItemTypes","typeFilter","field","selectType","itemType","roles","fieldsP","getFields","creatorRolesP","getCreatorRoles","itemTypeSearchText","ZoteroCreatorFieldController","creator","ZoteroFactory","getDefaultBaseUrl","toJson","ShowWorkController","workEditDialog","copyEditDialog","summaryEditDialog","workPromise","bcTitle","getTitle","getWorkLabel","refsEndpointUrl","editBibInfo","updatedWork","saveWork","showSavedToast","editSummary","updatedSummary","editBibliography","addEdition","saveEdition","addCopy","editCopy","copies","updatedCopy","deleteCopy","deleteWork","workLabel","subtitle","confirmDialog","createBookReviewArticle","articleTitleDialog","initialValue","titleP","articleP","createLinked","relationships","createBookReview","workEditDialogFactory","WorkEditDialogController","addAuthor","authorRef","deleteAuthor","addTitle","deleteTitle","ShowVolumeController","volumeEditDialog","extractTitle","workTitle","getEdition","editionPromise","getVolume","volumePromise","getVolumeLabel","preference","biblioObject","updatedVolume","saveVolume","copyToEdition","origCopy","newCopy","volumeEditDialogFactory","VolumeEditDialogController","ShowEditionController","editionEditDialog","getEditionLabel","updatedEdition","addVolume","copyToWork","editionEditDialogFactory","EditionEditDialogController","tasksRepoProvider","tasksRepoFactory","$resource","getAllTasks","taskResource","getTask","taskId","getWorkflow","workflowResource","getItems","stageId","itemResource","stage","start","max","transition","sourceStage","targetStage","result","itemId","comments","resp","TaskController","tasksRepo","tasks","tasksPromise","openMenu","ShowTaskController","task","taskPromise","makeErrorHandler","workflow","workflowPromise","worklistPromise","loadWorklist","focusItem","stopImmediatePropagation","entityId","transitionItem","updatedItem","refreshPromise","fetchStage","worklistPromises","stages","worklists","stageOrder","ShowPersonController","personEditDialog","eventEditDialog","personId","personRefsUrl","editBioInfo","updatedPerson","editEvent","updatedEvent","deletePerson","nameLabel","createBiographyArticle","createBiography","personEditDialogFactory","PersonEditDialogController","addName","createName","altNames","deleteName","nameRoles","MainController","q","searchQuery","peopleResults","worksResults","createPerson","createWork","debounce","$mdThemingProvider","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","runBlock","trcAuth","isAuthenticated","loginGuest","debug","run","routerConfig","$stateProvider","$urlRouterProvider","views","main","otherwise","constant","$logProvider","$httpProvider","worksRepoProvider","peopleRepoProvider","articlesRepoProvider","relnRepoProvider","categorizationServiceProvider","seeAlsoRepoProvider","trcSearchProvider","trcAuthProvider","trcAuthInterceptorProvider","debugEnabled","API_PREFIX","loginUrl","loginGuestUrl","RegExp","interceptors","cslConfig","citeprocProvider","refsRendererProvider","addLocale","filename","localeId","supplier","$http","res","data","addStyle","styleId","typemapUrl","CSL_LOCALES","CSL_STYLES","en-US","mla","chicago","$templateCache","put"],"mappings":"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","file":"scripts/app-5b7554e978.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ckeditor',\n      'ngMaterial',\n      'trcCore',\n      'trcBiblio',\n      'trcTasks',\n      'trcBio',\n      'trcReln',\n      'trcRefs',\n      'trcArticles',\n      'zotero',\n      'accounts'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('articleTypeSearch', {\n      templateUrl: 'app/admin/editors/articles/components/article-type-search/article-type-search.html',\n      bindings: {\n        type: '@'\n      },\n      controller: ArticleTypeSearchController\n    });\n\n  /** @ngInject */\n  function ArticleTypeSearchController($log, articlesRepo) {\n    var vm = this;\n\n    vm.search = search;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    /**\n     * Populates controller search results with the results of the given query for this component's article type\n     *\n     * @param {string} query\n     */\n    function search(query) {\n      vm.results = articlesRepo.search(query, { type: vm.type });\n    }\n\n    // PRIVATE METHODS\n\n    /**\n     * Activator; called when the component has been initialized\n     */\n    function activate() {\n      search('');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('articleAuthorEditor', {\n      templateUrl: 'app/admin/editors/articles/components/article-author-editor/article-author-editor.html',\n      controller: ArticleAuthorEditorController,\n      bindings: {\n        author: '='\n      }\n    });\n\n  /** @ngInject */\n  function ArticleAuthorEditorController() {\n    var vm = this;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    // PRIVATE METHODS\n\n    function activate() {}\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('titleEditor', titleEditorDirective);\n\n  /** @ngInject */\n  function titleEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/title-editor/title-editor.html',\n      scope: {\n        title: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('relnEditDialog', relnEditDialogFactory);\n\n  /** @ngInject */\n  function relnEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event) {\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/reln-edit-dialog/reln-edit-dialog.html',\n        controller: RelationshipEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n\n    }\n  }\n\n  /** @ngInject */\n  function RelationshipEditDialogController($filter, $mdDialog, worksRepo, relnRepo) {\n    var stripTags = $filter('stripTags');\n    var vm = this;\n\n    vm.description = null;\n\n    vm.types = null;\n    vm.selectedType = null;\n\n    vm.searchText = null;\n    vm.selectedWork = null;\n\n    vm.anchors = null;\n    vm.selectedAnchor = null;\n\n    vm.search = search;\n    vm.selectWork = selectWork;\n    vm.close = close;\n    vm.cancel = cancel;\n\n    activate();\n\n    function activate() {\n      vm.types = getTypes();\n    }\n\n    function getTypes() {\n      var rawTypes = relnRepo.getTypes();\n      var types = [];\n\n      var typesP = rawTypes.$promise.then(function () {\n        angular.forEach(rawTypes, function (type) {\n          types.push({\n            id: type.identifier,\n            label: type.title,\n            directed: type.isDirected,\n            reverse: false\n          });\n\n          if (type.isDirected) {\n            types.push({\n              id: type.identifier,\n              label: type.reverseTitle,\n              directed: type.isDirected,\n              reverse: true\n            });\n          }\n        });\n\n        return types;\n      });\n\n\n      Object.defineProperty(types, '$promise', {\n        value: typesP\n      });\n\n      return types;\n    }\n\n    function search(query) {\n      var results = worksRepo.search(query);\n      return results.$promise.then(function () {\n        return results.items;\n      });\n    }\n\n    function selectWork(proxy) {\n      vm.anchors = [];\n\n      if (!proxy) {\n        return;\n      }\n\n      var baseLabel = stripTags(proxy.label);\n      var baseToken = proxy.ref.token;\n\n      // create default anchor for top-level work\n      vm.selectedAnchor = relnRepo.createAnchor(baseLabel, baseToken);\n      vm.anchors.push(vm.selectedAnchor);\n\n      var work = worksRepo.getWork(proxy.id);\n      work.$promise.then(function () {\n        work.editions.forEach(function (edition) {\n          // create anchor for each edition\n          var editionLabel = baseLabel + '. ' + edition.editionName;\n          vm.anchors.push(relnRepo.createAnchor(editionLabel, baseToken, {\n            editionId: [edition.id]\n          }));\n\n          edition.volumes.forEach(function (volume) {\n            // create anchor for each volume\n            var volumeLabel = editionLabel + '. Volume ' + volume.volumeNumber;\n            vm.anchors.push(relnRepo.createAnchor(volumeLabel, baseToken, {\n              editionId: [edition.id],\n              volumeId: [volume.id]\n            }));\n          });\n        });\n      });\n    }\n\n    function close() {\n      $mdDialog.hide({\n        typeId: vm.selectedType.id,\n        directed: vm.selectedType.directed,\n        reverse: vm.selectedType.reverse,\n        target: vm.selectedAnchor,\n        description: vm.description\n      });\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('publicationInfoEditor', publicationInfoEditorDirective);\n\n  /** @ngInject */\n  function publicationInfoEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/publication-info-editor/publication-info-editor.html',\n      scope: {\n        pubInfo: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('relationships', {\n      templateUrl: 'app/work/components/relationships/relationships.html',\n      bindings: {\n        anchor: '<'\n      },\n      controller: RelationshipsController\n    });\n\n  // emulation of an enum\n  // HACK: this code is copied from the see-also-editor component\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n\n  /** @ngInject */\n  function RelationshipsController($scope, $state, $timeout, $mdDialog, sdaToast, _, relnRepo, relnEditDialog) {\n    var vm = this;\n\n    vm.typeGroups = null;\n\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    function openRelationship($event, reln) {\n      // HACK: only using first anchor\n      var anchor = reln.anchors[0];\n\n      var state = null;\n      var params = {};\n\n      switch(anchor.ref.type) {\n        case TypeId.WORK:\n          state = 'editor.work';\n          params.workId = anchor.ref.id;\n\n          if (anchor.properties.editionId) {\n            state = 'editor.edition';\n            params.editionId = anchor.properties.editionId;\n          }\n\n          if (anchor.properties.editionId && anchor.properties.volumeId) {\n            state = 'editor.volume';\n            params.volumeId = anchor.properties.volumeId;\n          }\n\n          break;\n        case TypeId.PERSON:\n          state = 'editor.person';\n          params.id = anchor.ref.id;\n          break;\n        case TypeId.ARTICLE:\n          state = 'article.edit';\n          params.id = anchor.ref.id;\n          break;\n        default:\n          break;\n      }\n\n      if (!state) {\n        sdaToast.error('I don\\'t know how to follow that link.');\n      } else {\n        $state.go(state, params);\n      }\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialogPromise = relnEditDialog.show($event);\n      dialogPromise.then(function (relnInfo) {\n        relationship.typeId = relnInfo.typeId;\n        relationship.description = relnInfo.description;\n\n        /*\n        determine fields in which to place anchors...\n\n        directed | reverse || destination for self anchor | destination for selected anchor\n        ---------|---------||-----------------------------|--------------------------------\n        NO       | *       || \"related\"                   | \"related\"\n        YES      | YES     || \"targets\"                   | \"related\"\n        YES      | NO      || \"related\"                   | \"targets\"\n         */\n        if (!relnInfo.directed) {\n          relationship.related.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else if (relnInfo.reverse) {\n          relationship.targets.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else {\n          relationship.related.push(vm.anchor);\n          relationship.targets.push(relnInfo.target);\n        }\n\n        var saveP = relnRepo.save(relationship);\n        saveP.then(function () {\n          sdaToast.success('Saved.');\n          // HACK give relationship a chance to save on the server\n          $timeout(loadRelationships, 1000);\n        }, function () {\n          sdaToast.error('Unable to save relationship');\n        });\n      });\n\n    }\n\n    function deleteRelationship($event, reln) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      confirmPromise.then(function () {\n        var deleteP = relnRepo.delete(reln.id);\n\n        deleteP.then(function () {\n          sdaToast.success('Relationship deleted.');\n          // HACK give relationship a chance to be deleted from the server\n          $timeout(loadRelationships, 1000);\n        }, function () {\n          sdaToast.error('Unable to delete relationship');\n        });\n      });\n    }\n\n    // PRIVATE METHODS\n\n    function activate() {\n      $scope.$watch('$ctrl.anchor', function (newAnchor) {\n        if (!newAnchor) {\n          return;\n        }\n\n        loadRelationships();\n      });\n    }\n\n    /**\n     * Loads relationships from the repository using the currently bound anchor.\n     * @return {Promise.<TypeGroup[]>}\n     */\n    function loadRelationships() {\n      vm.loading = true;\n      var relns = relnRepo.search(vm.anchor.ref, vm.anchor.properties);\n\n      var typeGroupsP = relns.$promise.then(function () {\n        vm.typeGroups = relnRepo.normalizeRelationships(relns, vm.anchor.ref);\n        return vm.typeGroups.$promise;\n      })\n\n      typeGroupsP.catch(function () {\n        sdaToast.error('Unable to load relationship data from the server');\n      }).then(function () {\n        vm.loading = false;\n      });\n\n\n      return typeGroupsP;\n    }\n  }\n\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('copyEditor', copyEditorDirective);\n\n  /** @ngInject */\n  function copyEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/copy-editor/copy-editor.html',\n      scope: {\n        copy: '=ngModel'\n      },\n      controller: CopyEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function CopyEditorController($scope) {\n    var vm = this;\n\n    vm.refHandlers = {};\n    vm.setProperties = parseProperties;\n\n    activate();\n\n    function activate() {\n      addHandler(HathiTrustRefHandler());\n      addHandler(GoogleBooksRefHandler());\n      addHandler(InternetArchiveRefHandler());\n    }\n\n    function addHandler(handler) {\n      vm.refHandlers[handler.id] = handler;\n    }\n\n    function parseProperties(type, url) {\n      if (vm.refHandlers[type]) {\n        $scope.copy.properties = vm.refHandlers[type](url);\n      }\n\n      $scope.copyForm.url.$setValidity(type, $scope.copy.properties != null);\n    }\n  }\n\n  // https://archive.org/details/essayinanswertom00adamiala\n  // <iframe src='https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n7/mode/1up' width='480px' height='430px' frameborder='0' ></iframe>\n  // TODO add support for resources from OpenLibrary\n  // https://openlibrary.org/books/OL7186607M/An_essay_in_answer_to_Mr._Hume's_Essay_on_miracles.\n\n  /**\n   * A reference parse handler to support digital copies from the Internet\n   * Archive.\n   */\n  function InternetArchiveRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      if (parsed.path.substr(0, 8) === '/stream/') {\n        id = parsed.path.substr(8);\n\n        var pageNo = parsed.fragment.match(/page\\/([^\\/]+)/);\n        if (pageNo && pageNo.length >= 2) {\n          seq = pageNo[1];\n        }\n      }\n\n      return makePropertiesObject(url, id, seq);\n    }\n\n    handle.id = 'internetarchive';\n    handle.display = 'Internet Archive';\n\n    /**\n     * Constructs an object literal that represents the stored-properties\n     * to associate with an InternetArchive digital copy.\n     *\n     * @param  {string} src The source URL from which the properties were parsed.\n     * @param  {string} id  The identifier used to uniquely reference a\n     *                      particular digial copy at the Internet Archive.\n     * @param  {string} seq The sequence number that identifies the page to be\n     *                      used as the initial page of this digital copy.\n     * @return {object}     The object literal of properties to be associated\n     *                      with this digital copy.\n     */\n    function makePropertiesObject(src, id, seq) {\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: src,\n        id: id,\n        seq: seq\n      };\n    }\n\n    return handle;\n  }\n\n  function HathiTrustRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      switch (parsed.hostname) {\n        case 'babel.hathitrust.org':\n          id = parsed.query.id;\n          seq = parsed.query.seq;\n          break;\n\n        case 'hdl.handle.net':\n          id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1);\n\n          if (!parsed.query.urlappend) {\n            break;\n          }\n\n          var subquery = parseQueryString(parsed.query.urlappend);\n          if (!subquery) {\n            break;\n          }\n          seq = subquery.seq;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        htid: id,\n        seq: seq\n      };\n    }\n\n    handle.id = 'hathitrust';\n    handle.display = 'HathiTrust';\n\n    return handle;\n  }\n\n  function GoogleBooksRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      switch (parsed.hostname) {\n        case 'books.google.com':\n          var id = parsed.query.id;\n          var section = parsed.query.printsec;\n          var page = parsed.query.pg;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        id: id,\n        section: section,\n        page: page\n      };\n    }\n\n    handle.id = 'googlebooks';\n    handle.display = 'Google Books';\n\n    return handle;\n  }\n\n  /**\n   * Parses a URL string into its components\n   *\n   * @param  {string} url\n   * @return {URL}\n   */\n  function parseUrl(url) {\n    if (!url) {\n      return null;\n    }\n\n    // eslint-disable-next-line angular/document-service\n    var parser = document.createElement('a');\n    parser.href = url;\n\n    return {\n      toString: function() {\n        return url;\n      },\n      protocol: parser.protocol,\n      host: parser.host,\n      hostname: parser.hostname,\n      port: parser.port,\n      path: parser.pathname,\n      query: parseQueryString(parser.search),\n      fragment: parser.hash\n    };\n  }\n\n  /**\n   * Parses a query string into key/value pairs\n   *\n   * @param {string} query\n   * @return {object.<string,any>}\n   */\n  function parseQueryString(query, sep) {\n    if (!query || !angular.isString(query)) {\n      return {};\n    }\n\n    // remove leading '?'\n    if (query[0] === '?') {\n      query = query.substr(1);\n    }\n\n    // attempt to auto-detect separator\n    if (!sep) {\n      // auto-detection \"bitmask\"\n      // 0 = none detected -- prefer '&'\n      // 1 = only ';' detected -- use it\n      // 2 = only '&' detected -- use it\n      // 3 = both detected -- prefer '&'\n      var flags = (query.indexOf(';') >= 0 ? 1 : 0) + (query.indexOf('&') >= 0 ? 2 : 0);\n      sep = flags === 1 ? ';' : '&';\n    }\n\n    var parsed = {};\n\n    var kvpairs = query.split(sep);\n    kvpairs.forEach(function (pair) {\n      var ix = pair.indexOf('=');\n      var key = pair;\n      var value = null;\n\n      if (!key) {\n        return;\n      }\n\n      if (ix >= 0) {\n        key = pair.substr(0, ix);\n        value = pair.substr(ix + 1);\n      }\n\n      try {\n        key = decodeURIComponent(key);\n        value = decodeURIComponent(value);\n      } catch (URIError) {\n        return;\n      }\n\n      // TODO: handle key array/map notation\n\n      if (parsed.hasOwnProperty(key)) {\n        // convert repeated keys into an array\n        if (angular.isArray(parsed[key])) {\n          parsed[key].push(value);\n        } else {\n          parsed[key] = [parsed[key], value];\n        }\n      } else {\n        parsed[key] = value;\n      }\n    });\n\n    return parsed;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('copyEditDialog', copyEditDialogFactory);\n\n  /** @ngInject */\n  function copyEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, copy) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/copy-edit-dialog/copy-edit-dialog.html',\n        locals: {\n          copy: copy\n        },\n        controller: CopyEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function CopyEditDialogController($mdDialog, copy) {\n    var vm = this;\n\n    vm.copy = copy;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.copy);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('authorRefEditor', authorRefEditorDirective);\n\n  /** @ngInject */\n  function authorRefEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/author-ref-editor/author-ref-editor.html',\n      scope: {\n        ref: '=ngModel'\n      },\n      controller: AuthorRefEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function AuthorRefEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.linkAuthorSearchText = '';\n      vm.authorRoles = [\n        'author',\n        'editor',\n        'translator',\n        'other'\n      ];\n\n      vm.setLinkedAuthor = setLinkedAuthor;\n      vm.getResults = getResults;\n\n      activate();\n\n      function activate() {\n        if ($scope.ref.authorId) {\n          var author = peopleRepo.get($scope.ref.authorId);\n          author.$promise.then(function () {\n            vm.linkAuthorSearchText = author.name.label;\n          })\n        }\n      }\n\n      function setLinkedAuthor(person) {\n        $scope.ref.authorId = person.id;\n      }\n\n      function getResults(query) {\n        var resultSet = peopleRepo.search(query);\n        return resultSet.$promise.then(function () {\n          return resultSet.items;\n        });\n      }\n\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditorItem', workEditorItemDirective);\n\n  /** @ngInject */\n  function workEditorItemDirective($log) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/task/components/work-editor-item/work-editor-item.html',\n      link: linkFunc,\n      scope: {\n        id: '=id'\n      },\n      controller: WorkEditorItemController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc($scope) {\n      if (!$scope.id) {\n        $log.error('missing required attribute \"id\"');\n      }\n    }\n\n    /** @ngInject */\n    function WorkEditorItemController($scope, worksRepo) {\n      var vm = this;\n\n      vm.loaded = false;\n\n      activate();\n\n      function activate() {\n        if ($scope.id) {\n          vm.work = worksRepo.getWork($scope.id);\n          vm.work.$promise.then(function () {\n            vm.loaded = true;\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditor', workEditorDirective);\n\n  /** @ngInject */\n  function workEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/work-editor/work-editor.html',\n      scope: {\n        work: '=ngModel'\n      },\n      controller: WorkEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function WorkEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.editions = [];\n\n      vm.createEdition = createEdition;\n      vm.deleteEdition = deleteEdition;\n\n      activate();\n\n      function activate() {\n        $scope.work.editions.forEach(function (edition) {\n          vm.editions.push({\n            model: edition,\n            focused: false\n          });\n        });\n      }\n\n      function createEdition() {\n        var edition = worksRepo.createEdition();\n        edition.titles = _.cloneDeep($scope.work.titles);\n        edition.authors = _.cloneDeep($scope.work.authors);\n\n        $scope.work.editions.push(edition);\n        vm.editions.push({\n          model: edition,\n          focused: true\n        });\n      }\n\n      function deleteEdition(ix) {\n        vm.editions.splice(ix, 1);\n        $scope.work.editions.splice(ix, 1);\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('volumeEditor', volumeEditorDirective);\n\n  /** @ngInject */\n  function volumeEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/volume-editor/volume-editor.html',\n      scope: {\n        volume: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('editionEditor', editionEditorDirective);\n\n  /** @ngInject */\n  function editionEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/edition-editor/edition-editor.html',\n      scope: {\n        edition: '=ngModel'\n      },\n      controller: EditionEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function EditionEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.volumes = [];\n\n      vm.createVolume = createVolume;\n      vm.deleteVolume = deleteVolume;\n\n      activate();\n\n      function activate() {\n        $scope.edition.volumes.forEach(function (volume) {\n          vm.volumes.push({\n            model: volume,\n            focused: false\n          });\n        });\n      }\n\n      function createVolume() {\n        var volume = worksRepo.createVolume();\n        volume.titles = _.cloneDeep($scope.edition.titles);\n        volume.authors = _.cloneDeep($scope.edition.authors);\n        volume.publicationInfo = _.cloneDeep($scope.edition.publicationInfo);\n\n        $scope.edition.volumes.push(volume);\n        vm.volumes.push({\n          model: volume,\n          focused: true\n        });\n      }\n\n      function deleteVolume(ix) {\n        vm.volumes.splice(ix, 1);\n        $scope.edition.volumes.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('nameEditor', nameEditorDirective);\n\n  /** @ngInject */\n  function nameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/name-editor/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('eventEditDialog', eventEditDialogFactory);\n\n  /** @ngInject */\n  function eventEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/components/event-edit-dialog/event-edit-dialog.html',\n        locals: {\n          event: event\n        },\n        controller: EventEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EventEditDialogController($mdDialog, event) {\n    var vm = this;\n\n    vm.event = event;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.event);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('eventEditor', eventEditorDirective);\n\n  /** @ngInject */\n  function eventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/event-editor/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('sdaAdmin')\n      .directive('treeCategorizationEditor', treeCategorizationEditor);\n\n   /** @ngInject */\n   function treeCategorizationEditor() {\n      var directive = {\n         restrict: 'E',\n         templateUrl: 'app/admin/editors/articles/thematic-overview.html',\n         scope: {\n           scopeId: \"@\",\n           scheme: \"@\"\n          //  need param to indicate whether this categorization owns related entrties\n         },\n         controller: TreeCategorizationController,\n         controllerAs: 'vm'\n      };\n\n      return directive;\n   }\n\n   // NOTE this needs to move toward being a more general puropose control\n\n   /** @ngInject */\n   function TreeCategorizationController($scope, $log, $mdDialog, sdaToast, $state, $q,\n     articlesRepo, categorizationService) {\n\n     var vm = this;\n     var repo = null;\n\n     // TODO need to allow actions to be pluggable\n     vm.handleAssociateEntry = handleAssociateEntry;\n     vm.handleRemoveEntry = handleRemoveEntry;\n     vm.handleCreateChild = handleCreateChild;\n     vm.handleDeleteNode = handleDeleteNode;\n\n     activate();\n\n     //'overviews'\n     function activate() {\n       $log.info(\"Loading article editor\", articlesRepo);\n       repo = categorizationService.getScopedRepo($scope.scopeId);\n       // TODO need to handle case when this fails to load. Display throbber pending load\n       vm.overviews = repo.get($scope.scheme);\n     }\n\n     // TODO allow edit labels\n\n     /* ================================\n      * API METHODS\n      * ================================ */\n      function handleAssociateEntry($event, node) {\n        $log.info(\"creating article\");\n        // TODO need to offer option of create or link\n        // TODO magic string\n\n        var type = 'thematic';\n        var title = node.label;\n\n        // TODO  display prompt dialog, allow entry of title, selection of type (but not)\n        // TODO error handling!!\n        var article = articlesRepo.create(type, title);\n        var articlePromise = articlesRepo.save(article);\n        var linkPromise = articlePromise.then(linkArticle);\n\n        $q.all({\n          article: articlePromise,\n          ref: linkPromise\n        }).then(openEditor);\n\n        function linkArticle(article) {\n          var ref = repo.nodes.link(node, article.reference);\n          return ref.$promise;\n        }\n\n        function openEditor(values) {\n          $state.go(\"article.edit\", {\n            id: values.article.id\n          });\n        }\n        // TODO creates article and (once created) associates\n        //      that article with this node in the hierarchy.\n        //      On completion, opens that article in the editor.\n      }\n\n      function handleRemoveEntry($event, node) {\n        $log.info(\"Removing entry\", node);\n\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      If OK, removes the associated entry from this node\n        //      and then deletes the article.\n\n      }\n\n      /**\n       * Handler to be invoked to create a new category with an hierarchical\n       * categorization.\n       *\n       * @param  {event} $event  The event that triggered this request.\n       * @param  {object} parent The parent node on which the child should be created.\n       * @return {[type]}        [description]\n       */\n      function handleCreateChild($event, parent) {\n        $log.info(parent);\n\n        var newCategoryDialog = $mdDialog.prompt({\n          title: \"Enter Category Label\",\n          // TODO add description\n          placeholder: 'new category',\n          ok: \"Create\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(newCategoryDialog)\n                 .then(onCreate);\n\n        function onCreate(label) {\n          $log.info(\"Creating category \" + label);\n\n          repo.nodes.create(parent, label);\n        }\n      }\n\n      function handleDeleteNode($event, node, parent) {\n        $log.info(node);\n\n        var title = \"Delete category '\" + node.label + \"'\";\n        var msg = \"<p>This will delete the selected category, \" + node.label + \", \" +\n                  \"its sub-categories and all associated articles.\" +\n                  \"<em>This action cannot be undone.</em></p>\" +\n                  \"<p>Permanently delete this category?</p>\";\n        var removeCatgorizationDialog = $mdDialog.confirm({\n          title: title,\n          htmlContent: msg,\n          ok: \"Delete\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(removeCatgorizationDialog).then(function() {\n           // TODO dispaly success/failure toasts\n           repo.nodes.remove(node, true, parent).then(function () {\n             return sdaToast.success('category deleted');\n           }, function () {\n             return sdaToast.error('unable to delete category');\n           });\n         });\n\n\n        function deleteNode() {\n        }\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      Recursively removes all articles associated with descendants\n        //      Removes this categorization entry (and children)\n      }\n\n      /* ================================\n       * PRIVATE METHODS\n       * ================================ */\n\n       function getChildren(node) {\n         if (node.childIds.length != node.chilren.length) {\n           throw new Error(\"Lazy loading of children not yet supported.\");\n         }\n\n         return $q.when(node.chilren);\n       }\n\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n// TODO admin-page-articles\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorSectionController', ArticleEditorSectionController);\n\n  /** @ngInject */\n  function ArticleEditorSectionController($state, $mdDialog, sdaToast, articlesRepo) {\n    var vm = this;\n\n    vm.createArticle = createArticle;\n\n    activate();\n\n    function activate() {\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n\n    /**\n     * Creates a new article of the given type and opens that article in the editor\n     *\n     * @param {Event} $event\n     * @param {string} type\n     * @return {Promise.<Article>} Resolves after the article has been created and saved on the server\n     */\n    function createArticle($event, type) {\n      var dialog = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Article')\n        .textContent('Please provide a title for the new article.')\n        .placeholder('title')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var titlePromise = $mdDialog.show(dialog);\n\n      titlePromise.then(function (title) {\n        var article = articlesRepo.create(type, title);\n        var savePromise = articlesRepo.save(article);\n\n        savePromise.then(function (article) {\n          $state.go('article.edit', { id: article.id });\n          sdaToast.success('Article created successfully');\n        }, function () {\n          sdaToast.error('Unable to create article');\n        });\n\n        return savePromise;\n      });\n\n    }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorController', ArticleEditorController);\n\n  var CKEDITOR_CONFIG = {\n    /*\n    toolbarGroups: [\n      { name: 'styles', groups: [ 'styles' ] },\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n      { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n      { name: 'colors', groups: [ 'colors' ] },\n      { name: 'links', groups: [ 'links' ] },\n      { name: 'insert', groups: [ 'insert' ] },\n      { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },\n      { name: 'forms', groups: [ 'forms' ] },\n      { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },\n      { name: 'tools', groups: [ 'tools' ] },\n      { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },\n      { name: 'others', groups: [ 'others' ] },\n    ],\n    */\n\n    toolbar: [\n      { name: 'styles', items: [ 'Styles', 'Format' ] },\n      { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike', '-', 'Subscript', 'Superscript', '-', 'RemoveFormat' ] },\n      { name: 'paragraph', items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote' ] },\n      { name: 'links', items: [ 'Link', 'Unlink', 'Anchor' ] },\n      { name: 'insert', items: [ 'Citation', 'Footnote', '-', 'Image', 'Table', 'HorizontalRule', 'SpecialChar', 'Mathjax' ] },\n      { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ] },\n      { name: 'editing', items: [ 'Scayt' ] },\n      { name: 'tools', items: [ 'Maximize' ] },\n      { name: 'document', items: [ 'Source' ] }\n    ],\n\n    // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n    format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address',\n\n    extraPlugins: 'mathjax',\n\n    mathJaxLib: '//cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-MML-AM_CHTML'\n  };\n\n  /** @ngInject */\n  function ArticleEditorController($q, $log, $stateParams, $scope, footnoteEditDialog, sdaToast, articlesRepo, refsRepoFactory) {\n    var refsRepoUrl = articlesRepo.getReferencesEndpoint($stateParams.id);\n    var refsRepo = refsRepoFactory.getRepo(refsRepoUrl);\n\n    var vm = this;\n\n    vm.save = save;\n\n    vm.abstractEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'HorizontalRule',\n          'Maximize',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.footnoteEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Footnote',\n          'HorizontalRule',\n          'Maximize',\n          'Source',\n        ].join(',')\n      })\n    };\n\n    vm.editor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editFootnote = editFootnote;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo)\n\n      vm.article = articlesRepo.get($stateParams.id);\n      var articlePromise = vm.article.$promise;\n      articlePromise.then(function (article) {\n        // ensure article has at least 1 author\n        if (article.authors.length === 0) {\n          article.authors.push({});\n        }\n      });\n\n      vm.references = refsRepo.get();\n      var refsPromise = vm.references.$promise;\n\n      $q.all([articlePromise, refsPromise]).then(function () {\n        // start watching for opportunities to remove unused citations and footnotes\n        $scope.$watch('vm.article.body', cleanArticleHandler);\n        $scope.$watchCollection('vm.article.footnotes', cleanRefsHandler);\n      }, function () {\n        return sdaToast.error('Failed to load data from the server');\n      });\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n     function save() {\n       return $q.all([\n         articlesRepo.save(vm.article),\n         refsRepo.save(vm.references)\n       ]).then(function () {\n         sdaToast.success('Saved');\n       }, function () {\n         sdaToast.error('Unable to save article.');\n       });\n     }\n\n     /**\n      * Displays a bottom sheet to edit an existing footnote.\n      * Delegates to the edit dialog in ckeditor-footnotes component, which should probably be refactored elsewhere.\n      * @param  {MouseEvent} $event\n      * @param  {Footnote} footnote\n      */\n     function editFootnote($event, footnote) {\n       var newFootnote = angular.copy(footnote);\n       var newReferences = refsRepoFactory.createRefCollection();\n\n       var promise = footnoteEditDialog.show($event, newFootnote, {\n         references: newReferences,\n         ckeditor: vm.footnoteEditor\n       });\n\n       promise.then(function () {\n         vm.article.footnotes[newFootnote.id] = newFootnote;\n\n         // update bibliography\n         var updatedReferences = refsRepoFactory.merge(vm.references, refsRepoFactory.compact(newReferences));\n         angular.merge(vm.references, updatedReferences);\n       });\n     }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n\n     function cleanRefsHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanReferences(vm.article, vm.references);\n       vm.references = refsRepo.compact(vm.references);\n     }\n\n     function cleanArticleHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanFootnotes(vm.article, vm.article.footnotes);\n       cleanRefsHandler(obj);\n     }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero', [\n      'ngAnimate',\n      'ngAria',\n      'ngMaterial',\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .controller('ZoteroTestController', ZoteroTestController);\n\n  /** @ngInject */\n  function ZoteroTestController() {\n    var vm = this;\n\n    vm.item = {};\n\n    vm.types = [];\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('summaryEditDialog', summaryEditDialogFactory);\n\n  /** @ngInject */\n  function summaryEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, summary) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          summary: summary\n        },\n        controller: SummaryEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function SummaryEditDialogController($mdDialog, summary) {\n    var vm = this;\n\n    vm.summary = summary;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.summary);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('summaryEditor', summaryEditorDirective);\n\n  /** @ngInject */\n  function summaryEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/summary-editor/summary-editor.html',\n      scope: {\n        summary: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.config = {\n        // FIXME set up minimal toolbar and restrict HTML content\n        toolbarGroups: [\n          { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n          { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n          { name: 'links', groups: [ 'links' ] },\n          { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n        ],\n\n        removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles'\n      };\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('stripTags', stripTagsFilter);\n\n  function stripTagsFilter() {\n    return stripTags;\n  }\n\n  function stripTags(html) {\n    return html ? String(html).replace(/<[^>]+>/gm, '') : '';\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .animation('.slide', slideToggle);\n\n  function slideToggle() {\n    var NG_HIDE_CLASS = 'ng-hide';\n\n    return {\n      beforeAddClass: beforeAddClass,\n      removeClass: removeClass\n    };\n\n    function beforeAddClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.slideUp(done);\n      }\n    }\n\n    function removeClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.hide().slideDown(done);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('seeAlsoEditor', {\n      templateUrl: 'app/components/see-also-editor/see-also-editor.html',\n      bindings: {\n        sourceToken: '<'\n      },\n      controller: SeeAlsoEditorController\n    });\n\n  // emulation of an enum\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n  var UNIFIED_SEARCH_KEYS = ['people', 'works', 'articles'];\n\n  /** @ngInject */\n  function SeeAlsoEditorController($scope, $state, $mdDialog, sdaToast, _, seeAlsoRepo, trcSearch) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.seeAlso = null;\n\n    vm.searchText = null;\n    vm.selectedItem = null;\n\n    vm.createLink = createLink;\n    vm.openLink = openLink;\n    vm.deleteLink = deleteLink;\n    vm.search = search;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    /**\n     * Creates a new see-also link with the current token as the source\n     * and the given anchor as the target.\n     * @param {Anchor} anchor\n     */\n    function createLink(anchor) {\n      if (!anchor) {\n        return;\n      }\n\n      if (alreadyLinked(anchor)) {\n        sdaToast.info('Item has already been linked.');\n        clearLinkForm();\n        return;\n      }\n\n      var link = seeAlsoRepo.create(vm.sourceToken, anchor.token);\n\n      link.$promise.then(function () {\n        // HACK: link to target comes back as source field\n        var anchor = link.source;\n        if (!vm.seeAlso.links.hasOwnProperty(anchor.type)) {\n          vm.seeAlso.links[anchor.type] = [];\n        }\n\n        vm.seeAlso.links[anchor.type].push(anchor);\n\n        clearLinkForm();\n\n        sdaToast.success('Link created');\n      }, function () {\n        sdaToast.error('Unable to create link');\n      });\n    }\n\n    /**\n     * Redirects the browser to the editor page for the item referenced by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function openLink($event, anchor) {\n      switch(anchor.type) {\n        case TypeId.WORK:\n          $state.go('editor.work', { workId: anchor.id });\n          break;\n        case TypeId.PERSON:\n          $state.go('editor.person', { id: anchor.id });\n          break;\n        case TypeId.ARTICLE:\n          $state.go('article.edit', { id: anchor.id });\n          break;\n        default:\n          sdaToast.error('I don\\'t know how to follow that link.');\n          break;\n      }\n    }\n\n    /**\n     * Reoves the see-also link targeted by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function deleteLink($event, anchor) {\n      var dialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        htmlContent: 'Are you sure you want to delete this link?' + anchor.label,\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmP = $mdDialog.show(dialog);\n\n      confirmP.then(function () {\n        var deleteP = seeAlsoRepo.delete(vm.sourceToken, anchor.token);\n\n        deleteP.then(function () {\n          sdaToast.success('Link deleted');\n          var ix = vm.seeAlso.links[anchor.type].indexOf(anchor);\n          if (ix >= 0) {\n            vm.seeAlso.links[anchor.type].splice(ix, 1);\n          }\n        }, function () {\n          sdaToast.error('Unable to delete link');\n        })\n      });\n    }\n\n    /**\n     * Searches all entries matching the provided query.\n     * @param  {string} query\n     * @return {Promise.<Anchor[]>}\n     */\n    function search(query) {\n      var results = trcSearch.search(query);\n      return results.$promise.then(combineSearchResults, function () {\n        sdaToast.error('Unable to load search results');\n      });\n    }\n\n    // PRIVATE METHODS\n\n    /**\n     * Initializes controller state\n     */\n    function activate() {\n      $scope.$watch('$ctrl.sourceToken', function (newToken) {\n        if (!newToken) {\n          return;\n        }\n\n        vm.loading = true;\n        vm.seeAlso = seeAlsoRepo.get(newToken);\n        vm.seeAlso.$promise.then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    /**\n     * Determines whether the proided anchor has already been linked with the current token.\n     * @param {Anchor} anchor\n     * @return {boolean}\n     */\n    function alreadyLinked(anchor) {\n      return vm.seeAlso.links.hasOwnProperty(anchor.type) && vm.seeAlso.links[anchor.type].some(function (existing) {\n        return existing.token === anchor.token;\n      });\n    }\n\n    /**\n     * Clears the new link input form.\n     */\n    function clearLinkForm() {\n      vm.searchText = null;\n      vm.selectedItem = null;\n    }\n\n    /**\n     * Combines unified search results into a homogeneous list of anchors.\n     * @param {UnifiedSearchResult} results\n     * @return {Anchor[]}\n     */\n    function combineSearchResults(results) {\n      return _.flatMap(UNIFIED_SEARCH_KEYS, function (key) {\n        return results.results[key].map(function (item) {\n          return {\n            label: item.label || item.title,  // article search results don't have a 'label' attribute\n            type: item.ref.type,\n            token: item.ref.token\n          };\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .provider('sdaToast', SdaToastProvider);\n\n  // TODO: this service appears to accomplish the same goal as $mdToast.addPreset\n  //       perhaps this service should be replaced with custom $mdToast presets\n\n  function SdaToastProvider() {\n    var provider = {};\n\n    provider.defaultOptions = {\n      position: 'bottom right',\n      hideDelay: 3000\n    };\n\n    provider.$get = SdaToastFactory\n\n    return provider;\n\n    /** @ngInject */\n    function SdaToastFactory($mdToast) {\n      var sdaToast = {\n        success: showSuccessToast,\n        info: showInfoToast,\n        error: showErrorToast\n      }\n\n      return sdaToast;\n\n      function showSuccessToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-success' + (options && options.toastClass ? ' ' + options.toastClass : '')\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function showInfoToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-info' + (options && options.toastClass ? ' ' + options.toastClass : '')\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function showErrorToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-error' + (options && options.toastClass ? ' ' + options.toastClass : ''),\n          hideDelay: false\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function makeToast(message, options) {\n        var opts = angular.merge({}, provider.defaultOptions, options);\n\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .toastClass(opts.toastClass)\n          .position(opts.position)\n          .hideDelay(opts.hideDelay);\n\n        if (!opts.hideDelay || opts.action) {\n          toast.action(opts.action || 'Dismiss')\n        }\n\n        return toast;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('navbar', {\n      templateUrl: 'app/components/navbar/navbar.html',\n      bindings: {\n        title: '@',\n        sidenavId: '@?'\n      },\n      controller: NavbarController\n    });\n\n  /** @ngInject */\n  function NavbarController($mdSidenav) {\n    var vm = this;\n\n    vm.toggleSidenav = toggleSidenav;\n\n    activate();\n\n    function activate() {\n\n    }\n\n    function toggleSidenav(id) {\n      $mdSidenav(id).toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  /**\n  * Formats ranked by precedence to check for when parsing date strings.\n  *\n  * NOTE: dashes can be any number of non-alphanumeric characters, so 'DD-MM-YYYY' parses\n  *       '02/02/2015', '02.02.2015', '02:02,2015', and '02*#!02   ^^^2015' into '02-02-2015'\n  *\n  * @type {Array}\n  */\n  var INFER_FORMATS = [\n    // year\n    'YYYY',             // e.g. 2015\n\n    // month year\n    'MMMM-YYYY',        // e.g. February 2015\n    'MMM-YYYY',         // e.g. Feb. 2015\n    'MM-YYYY',          // e.g. 02/2015\n    'M-YYYY',           // e.g. 2/2015\n\n    // year month\n    'YYYY-MMMM',        // e.g. 2015 February\n    'YYYY-MMM',         // e.g. 2015 Feb.\n    'YYYY-MM',          // e.g. 2015-02\n    'YYYY-M',           // e.g. 2015-2\n\n    // month day year\n    'MMMM-DD-YYYY',     // e.g. February 02, 2015\n    'MMM-DD-YYYY',      // e.g. Feb. 02, 2015\n    'MM-DD-YYYY',       // e.g. 02/02/2015\n    'M-DD-YYYY',        // e.g. 2/02/2015\n    'MMMM-D-YYYY',      // e.g. February 2, 2015\n    'MMM-D-YYYY',       // e.g. Feb. 2, 2015\n    'MM-D-YYYY',        // e.g. 02-2-2015\n    'M-D-YYYY',         // e.g. 2/2/2015\n\n    // day month year\n    'DD-MMMM-YYYY',     // e.g. 02 February 2015\n    'DD-MMM-YYYY',      // e.g. 02 Feb. 2015\n    'DD-MM-YYYY',       // e.g. 02/02/2015\n    'DD-M-YYYY',        // e.g. 02/2/2015\n    'D-MMMM-YYYY',      // e.g. 2 February 2015\n    'D-MMM-YYYY',       // e.g. 2 Feb. 2015\n    'D-MM-YYYY',        // e.g. 2/02/2015\n    'D-M-YYYY',         // e.g. 2/2/2015\n\n    // year month day\n    'YYYY-MM-DD',       // e.g. 2015-02-02\n    'YYYY-M-D'          // e.g. 2015-2-2\n  ];\n\n  angular\n    .module('sdaAdmin')\n    .factory('guessDate', guessDateFactory);\n\n  /** @ngInject */\n  function guessDateFactory(moment) {\n    return guessDate;\n\n    /**\n     * Parse a date string into a Moment.\n     *\n     * See moment.js\n     *\n     * @param  {string} str Date string to parse\n     * @return {Moment}     Parsed moment\n     */\n    function guessDate(str) {\n        return moment(str, INFER_FORMATS);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('empty', emptyFilterFactory);\n\n  /** @ngInject */\n  function emptyFilterFactory(_) {\n    return _.isEmpty;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('dateEditor', dateEditorDirective);\n\n  /** @ngInject */\n  function dateEditorDirective(guessDate) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/date-editor/date-editor.html',\n      scope: {\n        date: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      // indicates whether the current value in the date.calendar field was automatically set\n      scope.calendarAutoSet = false;\n\n      scope.$watch('date.description', function (dateDescription) {\n        if (dateDescription && (!scope.date.calendar || scope.calendarAutoSet)) {\n          scope.date.calendar = guessDate(dateDescription).format('YYYY-MM-DD');\n          scope.calendarAutoSet = true;\n        }\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('DataContainerController', DataContainerController);\n\n\n  /** @ngInject */\n  function DataContainerController() {\n    var vm = this;\n    var listeners = [];\n\n    vm.watch = watch;\n    vm.set = set;\n    vm.value = null;\n\n    /**\n     * Attach a listener to watch for value changes\n     * @param  {Function} fn listener callback\n     * @return {Function} unregister function\n     */\n    function watch(fn) {\n      listeners.push(fn);\n      fn(vm.value);\n      return unregister;\n\n      function unregister() {\n        var ix = listeners.indexOf(fn);\n        if (ix >= 0) {\n          listeners.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Updates internal value\n     * @param {*} newValue\n     */\n    function set(newValue) {\n      if (vm.value === newValue) {\n        return;\n      }\n\n      vm.value = newValue;\n\n      listeners.forEach(function (fn) {\n        fn(newValue);\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('footnoteEditDialog', footnoteEditDialogFactory);\n\n  /** @ngInject */\n  function footnoteEditDialogFactory($mdBottomSheet) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, footnote, options) {\n      var opts = angular.merge({}, options);\n\n      var config = {\n        templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n        controller: FootnoteEditDialogController,\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          footnote: footnote,\n          references: opts.references,\n          ckeditorConfig: opts.ckeditor\n        }\n      };\n\n      return $mdBottomSheet.show(config);\n    }\n  }\n\n  /** @ngInject */\n  function FootnoteEditDialogController($mdBottomSheet, footnote, references, ckeditorConfig) {\n    var vm = this;\n\n    vm.footnote = footnote;\n    vm.references = references;\n    vm.ckeditorConfig = ckeditorConfig;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdBottomSheet.hide();\n    }\n\n    function cancel() {\n      $mdBottomSheet.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorFootnotes', ckeditorFootnotesDirective);\n\n  /** @ngInject */\n  function ckeditorFootnotesDirective($document, footnoteEditDialog, articlesRepo, refsRepoFactory) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorFootnotes', '?ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var anchorIdPrefix = attrs.ckeditorFootnotesAnchorIdPrefix || 'fn_anchor_';\n\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n      var ckeditorBibliography = requires[2];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorFootnotes;\n\n      // capture footnotes reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (footnotes) {\n        if (ctrl.value !== footnotes) {\n          ctrl.set(footnotes);\n        }\n      });\n\n      var FOOTNOTE_COMMAND_NAME = 'insertFootnote';\n      editor.addCommand(FOOTNOTE_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        requiredContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        exec: insertFootnoteCommand\n      });\n\n      editor.ui.addButton('Footnote', {\n        label: 'Insert Footnote',\n        command: FOOTNOTE_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertFootnoteCommand(editor) {\n        var command = this;\n\n        // create a new footnote object to edit.\n        var newFootnote = articlesRepo.createFootnote();\n        newFootnote.backlinkId = anchorIdPrefix + newFootnote.id;\n\n        var newReferences = ckeditorBibliography ? refsRepoFactory.createRefCollection() : null;\n\n        var promise = footnoteEditDialog.show(null, newFootnote, {\n          references: newReferences,\n          // TODO: allow footnote ckeditor to be configured\n          ckeditor: scope.$eval(attrs.ckeditor)\n        });\n\n        promise.then(function () {\n          ctrl.value[newFootnote.id] = newFootnote;\n\n          // update bibliography if provided\n          if (newReferences && ckeditorBibliography) {\n            var updatedReferences = refsRepoFactory.merge(ckeditorBibliography.value, refsRepoFactory.compact(newReferences));\n            angular.merge(ckeditorBibliography.value, updatedReferences);\n          }\n\n          editor.insertHtml('<sup contenteditable=\"false\" class=\"footnote\" id=\"' + newFootnote.backlinkId + '\" data-footnote=\"' + newFootnote.id + '\">#</sup>');\n          done();\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: FOOTNOTE_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorBibliography', ckeditorBibliographyDirective);\n\n  /** @ngInject */\n  function ckeditorBibliographyDirective($mdDialog, $document, refsRepoFactory, refsRenderer, citationEditDialog) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorBibliography;\n\n      // capture bibliography reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (refs) {\n        if (ctrl.value !== refs) {\n          ctrl.set(refs);\n        }\n      });\n\n      var CITATION_COMMAND_NAME = 'insertCitation';\n      editor.addCommand(CITATION_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'cite[id,contenteditable]',\n        requiredContent: 'cite[id,contenteditable]',\n        exec: insertCitationCommand\n      });\n\n      editor.ui.addButton('Citation', {\n        label: 'Insert Citation',\n        command: CITATION_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertCitationCommand(editor) {\n        var command = this;\n\n        // create citation object with its own ref collection for editing\n        var newReference = refsRepoFactory.createRefCollection();\n        var citation = refsRepoFactory.createCitation();\n        newReference.citations[citation.id] = citation;\n\n        citationEditDialog.show(newReference).then(function () {\n          var updatedReferences = refsRepoFactory.merge(ctrl.value, refsRepoFactory.compact(newReference));\n          angular.merge(ctrl.value, updatedReferences);\n\n          refsRenderer.render('mla', newReference).then(function (rendered) {\n            var label = rendered.citations[citation.id];\n            editor.insertHtml('<cite id=\"' + citation.id + '\" contenteditable=\"false\">' + label + '</cite>')\n            done();\n          });\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: CITATION_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n/**\n * @typedef ItemContainer\n * @type {object}\n * @property {string} id\n * @property {string} label\n * @property {BiblioItem} item\n */\n\n(function () {\n  'use strict';\n\n  var LOCATOR_TYPES = [\n    'book', 'chapter', 'column', 'figure', 'folio', 'issue', 'line', 'note', 'opus', 'page',\n    'paragraph', 'part', 'section', 'sub verbo', 'verse', 'volume'\n  ];\n\n  var ZOTERO_USER_ACCOUNT_ID = '2536190';\n  var ZOTERO_USER_ACCOUNT_API_KEY = '3A4q05BNg0h0bHKJkpoCi1Oa';\n  var ZOTERO_GROUP_ID = '381134';\n\n  angular\n    .module('sdaAdmin')\n    .component('citationEditor', {\n      templateUrl: 'app/components/citation-edit-dialog/citation-editor.html',\n      controller: CitationEditorController,\n      bindings: {\n        references: '=',\n        citation: '='\n      }\n    });\n\n  /** @ngInject */\n  function CitationEditorController($filter, $q, $log, $mdDialog, zotero, _, sdaToast, refsRepoFactory, refsRenderer) {\n    var vm = this;\n\n    // referenced item autocomplete models\n    vm.selectedBiblioItem = null;\n    vm.searchText = '';\n\n    vm.locatorTypes = LOCATOR_TYPES;\n\n    vm.activeCitationItem = {};\n\n    vm.groupLibraryP = null;\n\n    vm.zoteroItem = null\n\n    vm.search = search;\n    vm.addCitationItem = addCitationItem;\n    vm.selectBiblioItem = selectBiblioItem;\n    vm.edit = editCitationItem;\n    vm.createZoteroItem = createZoteroItem;\n    vm.cancelZoteroItem = cancelZoteroItem;\n    vm.saveZoteroItem = saveZoteroItem;\n\n    var stripTags = $filter('stripTags');\n\n    activate();\n\n    function activate() {\n      var account = zotero.getUserAccount(ZOTERO_USER_ACCOUNT_ID, ZOTERO_USER_ACCOUNT_API_KEY);\n\n      // account.getGroup and account.getLibrary return native Promises.\n      // we wrap them in $q promises for consistency\n      var groupP = $q.when(account.getGroup(ZOTERO_GROUP_ID));\n      vm.groupLibraryP = groupP.then(function (group) {\n        return $q.when(account.getLibrary(group));\n      });\n\n      if (!vm.citation) {\n        throw new Error('no citation provided');\n      }\n\n      if (!vm.references.citations[vm.citation.id]) {\n        $log.warn('Citation is not a member of the provided reference collection. Adding to collection...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      } else if (vm.references.citations[vm.citation.id] !== vm.citation) {\n        $log.warn('provided citation does not match citation in reference collection. Overriding...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      }\n    }\n\n    /**\n     * Provides autocomplete items\n     * @param  {string} query\n     * @return {Promise.<ItemContainer[]>}\n     */\n    function search(query) {\n      return vm.groupLibraryP.then(function (library) {\n        // library.searchItems returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        var resultsP = $q.when(library.searchItems(query))\n\n        var adaptedResultsP = resultsP.then(function (items) {\n          return $q.all(items.map(adaptItem).map(wrapItem));\n        });\n\n        adaptedResultsP.catch(function () {\n          sdaToast.error('Unable to load search results.');\n        });\n\n        return adaptedResultsP;\n      });\n    }\n\n    /**\n     * Adapts a ZoteroItem for use in the autocomplete field and citation metadata\n     * @param  {ZoteroItem} zItem\n     * @return {BiblioItem}\n     */\n    function adaptItem(zItem) {\n      var id = 'zotero/' + zItem.library.id + '/' + zItem.id;\n\n      var item = refsRepoFactory.createBiblioItem(id);\n      item.type = zItem.type;\n      item.creators = zItem.properties.creators.map(adaptCreator);\n\n      // NOTE: this omits a lot of metadata fields... need to decide what other metadata (if any) to keep.\n\n      item.meta = angular.extend(\n        _.pick(zItem.meta, ['creatorSummary', 'parsedDate']),\n        _.pick(zItem.properties, ['key', 'dateAdded', 'dateModified'])\n      );\n\n      item.fields = _.omit(zItem.properties, [\n        // these properties are extracted to the top-level item\n        'creators', 'itemType',\n        // these properties are extracted to metadata\n        'key', 'dateAdded', 'dateModified',\n        // these properties are just forgotten\n        'version', 'collections', 'tags', 'relations'\n      ]);\n\n      return item;\n    }\n\n    /**\n     * Adapts a Zotero creator for use in the BiblioItem TRC-local type\n     * @param  {ZoteraCreator}\n     * @return {Creator}\n     */\n    function adaptCreator(zCreator) {\n      return {\n        role: zCreator.creatorType,\n        firstName: zCreator.firstName,\n        lastName: zCreator.lastName,\n        name: zCreator.name\n      };\n    }\n\n    /**\n     * Wraps a BiblioItem for use in the autocomplete field and citation metadata\n     * @param  {BiblioItem} item\n     * @return {Promise.<ItemContainer>}\n     */\n    function wrapItem(item) {\n      var labelP = refsRenderer.renderBiblioItem('mla', item);\n\n      return labelP.then(function (label) {\n        return {\n          id: item.id,\n          label: label,\n          item: item\n        };\n      });\n    }\n\n    /**\n     * Appends the given citation item to the citation\n     * @return {CitationItem}\n     */\n    function addCitationItem(citationItem) {\n      if (vm.citation.items.indexOf(citationItem) < 0) {\n        // new item\n        vm.citation.items.push(citationItem);\n      } else {\n        // edited existing item in-place\n      }\n\n      // set/update label\n      var referencedBibItem = vm.references.bibliography[citationItem.id];\n      renderCitationItemLabel(citationItem, referencedBibItem).then(function (label) {\n        citationItem.label = label;\n      });\n\n      // clear active item and start editing a new one\n      clearForm();\n    }\n\n    /**\n     * Sets the current citation item's referent id to the given item's id and\n     * adds the given item to the bibliography\n     * @param {ItemContainer} itemContainer\n     */\n    function selectBiblioItem(itemContainer) {\n      if (itemContainer) {\n        vm.activeCitationItem.id = itemContainer.id;\n        vm.references.bibliography[itemContainer.id] = itemContainer.item;\n      } else {\n        vm.activeCitationItem.id = null;\n      }\n    }\n\n    /**\n     * Sets the given citation item as the item being actively edited\n     * @param {CitationItem} item\n     */\n    function editCitationItem(citationItem) {\n      var biblioItem = vm.references.bibliography[citationItem.id];\n      return wrapItem(biblioItem).then(function (biblioItemContainer) {\n        vm.activeCitationItem = citationItem;\n        vm.selectedBiblioItem = biblioItemContainer;\n        vm.searchText = stripTags(vm.selectedBiblioItem.label);\n      });\n    }\n\n    /**\n     * Resets the model behind the citation item form\n     */\n    function clearForm() {\n      vm.activeCitationItem = {};\n      vm.searchText = '';\n      vm.selectedBiblioItem = null;\n    }\n\n    /**\n     * Renders a label for a single citation item\n     * @praam {CitationItem} citationItem\n     * @param {ZoteroItem} biblioItem Corresponding bibliographic item\n     * @return {Promise.<string>}\n     */\n    function renderCitationItemLabel(citationItem, biblioItem) {\n      // create a singleton citation for the citation item\n      var citation = refsRepoFactory.createCitation();\n      citation.items.push(citationItem);\n\n      // create a singleton reference for the singleton citation\n      var reference = refsRepoFactory.createRefCollection();\n      reference.citations[citation.id] = citation;\n      reference.bibliography[citationItem.id] = biblioItem;\n\n      var renderedP = refsRenderer.render('mla', reference);\n\n      return renderedP.then(function (rendered) {\n        return rendered.citations[citation.id];\n      });\n    }\n\n    function createZoteroItem() {\n      vm.zoteroItem = {};\n    }\n\n    function cancelZoteroItem() {\n      vm.zoteroItem = null;\n    }\n\n    function saveZoteroItem($event, item) {\n      var zItemP = vm.groupLibraryP.then(function (library) {\n        // library.saveItem returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        return $q.when(library.saveItem(item));\n      });\n\n      var biblioItemP = zItemP.then(adaptItem);\n\n      var itemContainerP = biblioItemP.then(wrapItem);\n\n      itemContainerP.then(function (item) {\n        vm.selectedBiblioItem = item;\n        selectBiblioItem(item);\n        vm.searchText = stripTags(item.label);\n        vm.zoteroItem = null;\n      }, function () {\n        sdaToast.error('Unable to save zotero data');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('citationEditDialog', CitationEditDialogFactory);\n\n  /** @ngInject */\n  function CitationEditDialogFactory($mdDialog, _, refsRepoFactory) {\n    return {\n      show: show\n    };\n\n    /**\n     * Displays the edit dialog.\n     * @param  {ReferenceCollection} references\n     * @param  {Citation} [citation]\n     * @param  {MouseEvent} [$event]\n     * @return {Promise.<ReferenceCollection>}\n     */\n    function show(references, citation, $event) {\n      if (!citation) {\n        var citations = _.values(references.citations);\n\n        if (citations.length === 0) {\n          citation = refsRepoFactory.createCitation();\n          references.citations[citation.id] = citation;\n        } else {\n          citation = citations[0];\n        }\n      } else if (angular.isString(citation)) {\n        citation = references.citations[citation];\n      }\n\n      if (!citation) {\n        throw new Error('Unable to find a suitable citation. Please pass one explicitly or check that the reference collection is not malformed');\n      }\n\n      var config = {\n        targetEvent: $event,\n        templateUrl: 'app/components/citation-edit-dialog/citation-edit-dialog.html',\n        controller: 'CitationEditDialogController',\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          references: references,\n          citation: citation\n        }\n      };\n\n      return $mdDialog.show(config).then(function () {\n        return references;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('CitationEditDialogController', CitationEditDialogController);\n\n  /** @ngInject */\n  function CitationEditDialogController($mdDialog, references, citation) {\n    var vm = this;\n\n    vm.references = references;\n    vm.citation = citation;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdDialog.hide();\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroEditor', {\n      templateUrl: 'app/zotero/editor.html',\n      controller: ZoteroEditorController,\n      bindings: {\n        item: '=',\n        typeFilter: '<types'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroEditorController($q, sdaToast, zotero) {\n    var vm = this;\n\n    vm.itemTypeSearchText = '';\n    vm.itemType = null;\n\n    vm.types = [];\n    vm.fields = [];\n    vm.roles = [];\n\n    vm.selectType = selectType;\n\n    activate();\n\n    function activate() {\n      zotero.getItemTypes().then(function (types) {\n        vm.types = (vm.typeFilter && vm.typeFilter.length > 0)\n          ? types.filter(function (field) {\n              return vm.typeFilter.indexOf(field.id) >= 0;\n            })\n          : types;\n      }, function () {\n        sdaToast.error('Unable to load item type info');\n      });\n\n      if (!vm.item.creators) {\n        vm.item.creators = [{}];\n      }\n\n      if (vm.item.creators.length === 0) {\n        vm.item.creators.push({});\n      }\n    }\n\n    function selectType(itemType) {\n      if (!itemType) {\n        vm.item.itemType = null;\n        vm.fields = [];\n        vm.roles = [];\n        return;\n      }\n\n      vm.item.itemType = itemType.id;\n\n      var fieldsP = itemType.getFields()\n      fieldsP.then(function (fields) {\n        vm.fields = fields;\n      });\n\n      var creatorRolesP = itemType.getCreatorRoles();\n      creatorRolesP.then(function (roles) {\n        vm.roles = roles;\n      });\n\n      $q.all([fieldsP, creatorRolesP]).catch(function () {\n        sdaToast.error('Unable to load data for the \"' + itemType.label + '\" type.');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroCreatorField', {\n      templateUrl: 'app/zotero/creator-field.html',\n      controller: ZoteroCreatorFieldController,\n      bindings: {\n        creator: '=',\n        roles: '<'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroCreatorFieldController() {\n  }\n\n})();\n\n/*global zotero:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .factory('zotero', ZoteroFactory);\n\n  /** @ngInject */\n  function ZoteroFactory() {\n    return new zotero(zotero.getDefaultBaseUrl(), angular.toJson);\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowWorkController', ShowWorkController);\n\n  /** @ngInject */\n  function ShowWorkController($state, $stateParams, worksRepo, relnRepo, refsRepoFactory, articlesRepo, $mdDialog, sdaToast, $q, workEditDialog, copyEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.title = null;\n    vm.relationships = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.addEdition = addEdition;\n    vm.deleteEdition = deleteEdition;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.createBookReview = createBookReviewArticle;\n    vm.deleteWork = deleteWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise.then(function () {\n        vm.bcTitle = worksRepo.getTitle(vm.work.titles);\n        vm.title = worksRepo.getTitle(vm.work.titles, ['canonical', 'bibliographic', 'short']);\n        vm.anchor = relnRepo.createAnchor(worksRepo.getWorkLabel(vm.work), vm.work.ref.token);\n      });\n\n      var refsEndpointUrl = worksRepo.getReferencesEndpoint(workId);\n      refsRepo = refsRepoFactory.getRepo(refsEndpointUrl);\n      vm.references = refsRepo.get();\n      var refsPromise = vm.references.$promise;\n\n      $q.all([workPromise, refsPromise])\n        .catch(function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = workEditDialog.show($event, angular.copy(vm.work));\n\n      dialogPromise.then(function (updatedWork) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.work, updatedWork);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.work.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.work.summary = updatedSummary;\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addEdition($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Edition')\n        .textContent('Please provide a name for the new edition.')\n        .placeholder('edition name')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (editionName) {\n        var edition = worksRepo.createEdition();\n        edition.editionName = editionName;\n        edition.titles = angular.copy(vm.work.titles);\n        edition.authors = angular.copy(vm.work.authors);\n\n        vm.work.editions.push(edition);\n\n        // resolve to the created edition when save is successful\n        return worksRepo.saveEdition(vm.work.id, edition);\n      });\n\n      savePromise.then(showSavedToast, showErrorToast);\n\n      savePromise.then(function (edition) {\n        $state.go('editor.edition', { workId: vm.work.id, editionId: edition.id });\n      });\n    }\n\n    function deleteEdition(edition, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this edition?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.editions.indexOf(edition);\n          if (ix >= 0) {\n            vm.work.editions.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.work.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.work.copies.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function deleteWork($event, work) {\n      var title = worksRepo.getTitle(vm.work.titles);\n      var workLabel = title ? '\"' + title.title + (title.subtitle ? ': ' + title.subtitle : '') + '\"' : 'this work';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + workLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return worksRepo.delete(work)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        $state.go('editor');\n        return sdaToast.success(workLabel + ' has been deleted.');\n      }\n\n      function showErrorToast() {\n        return sdaToast.error('Unable to delete ' + workLabel);\n      }\n    }\n\n    function createBookReviewArticle($event, work) {\n      var title = worksRepo.getTitle(work.titles);\n\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Book Review',\n        textContent: 'You are creating a new article attached to this work. Please enter a title for this article.',\n        initialValue: title ? title.title + (title.subtitle ? ': ' + title.subtitle : '') : '[untitled work]',\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('book-review', title, work.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          return sdaToast.error('Unable to create article.');\n        });\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('workEditDialog', workEditDialogFactory);\n\n  /** @ngInject */\n  function workEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, work) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: work\n        },\n        controller: WorkEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function WorkEditDialogController($mdDialog, work) {\n    var vm = this;\n\n    vm.work = work;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.work);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.work[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.work[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.work[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.work.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.work.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.work.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowVolumeController', ShowVolumeController);\n\n  /** @ngInject */\n  function ShowVolumeController($stateParams, worksRepo, relnRepo, $mdDialog, sdaToast, $q, volumeEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.volume = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToEdition = copyToEdition;\n\n    activate();\n\n    function activate() {\n\n      var workId = $stateParams.workId\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise\n        .then(extractTitle(['short', 'canonical', 'bibliographic']))\n        .then(function (title) { vm.workTitle = title; });\n\n      var editionId = $stateParams.editionId;\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      var editionPromise = vm.edition.$promise;\n\n      var volumeId = $stateParams.volumeId;\n      vm.volume = worksRepo.getVolume(workId, editionId, volumeId);\n      var volumePromise = vm.volume.$promise;\n      volumePromise\n        .then(extractTitle(['canonical', 'bibliographic', 'short']))\n        .then(function (title) { vm.title = title; });\n\n      $q.all([workPromise, editionPromise, volumePromise])\n        .then(function () {\n          vm.anchor = relnRepo.createAnchor(worksRepo.getVolumeLabel(vm.volume, vm.edition.editionName), vm.work.ref.token, {\n            editionId: [vm.edition.id],\n            volumeId: [vm.volume.id]\n          });\n        }, function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function extractTitle(preference) {\n      return function (biblioObject) {\n        return worksRepo.getTitle(biblioObject.titles, preference);\n      };\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = volumeEditDialog.show($event, angular.copy(vm.volume));\n\n      dialogPromise.then(function (updatedVolume) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.volume, updatedVolume);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.volume.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.volume.summary = updatedSummary;\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.volume.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.volume.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.volume.copies.splice(ix, 1);\n            worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function copyToEdition(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var edition = worksRepo.getEdition(vm.work.id, vm.edition.id);\n      edition.$promise.then(function () {\n        edition.copies.push(newCopy);\n        return worksRepo.saveEdition(vm.work.id, edition);\n      }).then(showSavedToast, showErrorToast);\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('volumeEditDialog', volumeEditDialogFactory);\n\n  /** @ngInject */\n  function volumeEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, volume) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/volume-edit-dialog.html',\n        locals: {\n          volume: volume\n        },\n        controller: VolumeEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function VolumeEditDialogController($mdDialog, volume) {\n    var vm = this;\n\n    vm.volume = volume;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.volume);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.volume[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.volume[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.volume[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.volume.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.volume.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.volume.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowEditionController', ShowEditionController);\n\n  /** @ngInject */\n  function ShowEditionController($state, $stateParams, worksRepo, relnRepo, $mdDialog, sdaToast, $q, editionEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addVolume = addVolume;\n    vm.deleteVolume = deleteVolume;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToWork = copyToWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise\n        .then(extractTitle(['short', 'canonical', 'bibliographic']))\n        .then(function (title) { vm.workTitle = title; });\n\n      var editionId = $stateParams.editionId;\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      var editionPromise = vm.edition.$promise;\n      editionPromise\n        .then(extractTitle(['canonical', 'bibliographic', 'short']))\n        .then(function (title) { vm.title = title; });\n\n      $q.all([workPromise, editionPromise])\n        .then(function (){\n          vm.anchor = relnRepo.createAnchor(worksRepo.getEditionLabel(vm.edition), vm.work.ref.token, {\n            editionId: [vm.edition.id]\n          });\n        }, function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n\n    }\n\n    function extractTitle(preference) {\n      return function (biblioObject) {\n        return worksRepo.getTitle(biblioObject.titles, preference);\n      };\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = editionEditDialog.show($event, angular.copy(vm.edition));\n\n      dialogPromise.then(function (updatedEdition) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.edition, updatedEdition);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.edition.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.edition.summary = updatedSummary;\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addVolume($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Volume')\n        .textContent('Please provide a number for the new volume.')\n        .placeholder('volume number')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (volumeNumber) {\n        var volume = worksRepo.createVolume();\n        volume.volumeNumber = volumeNumber;\n        volume.titles = angular.copy(vm.edition.titles);\n        volume.authors = angular.copy(vm.edition.authors);\n        volume.publicationInfo = angular.copy(vm.edition.publicationInfo);\n\n        vm.edition.volumes.push(volume);\n\n        return worksRepo.saveVolume(vm.work.id, vm.edition.id, volume);\n      });\n\n      savePromise.then(showSavedToast, showErrorToast);\n\n      savePromise.then(function (volume) {\n        $state.go('editor.volume', { workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id });\n      });\n    }\n\n    function deleteVolume(volume, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this volume?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.volumes.indexOf(volume);\n          if (ix >= 0) {\n            vm.edition.volumes.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.edition.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.edition.copies.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function copyToWork(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var work = worksRepo.getWork(vm.work.id);\n      work.$promise.then(function () {\n        work.copies.push(newCopy);\n        return worksRepo.saveWork(work);\n      }).then(showSavedToast, showErrorToast);\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('editionEditDialog', editionEditDialogFactory);\n\n  /** @ngInject */\n  function editionEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, edition) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/edition-edit-dialog.html',\n        locals: {\n          edition: edition\n        },\n        controller: EditionEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EditionEditDialogController($mdDialog, edition) {\n    var vm = this;\n\n    vm.edition = edition;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.edition);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.edition[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.edition[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.edition[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.edition.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.edition.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.edition.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * @typedef {object} Workflow\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {object.<string, WorkflowStage>} stages\n * @property {string} status\n */\n\n/**\n * @typedef {object} WorkflowStage\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {boolean} isFinal\n * @property {WorkflowStageTransition[]} transitions\n */\n\n/**\n * @typedef {object} WorkflowStageTransition\n * @property {string} sourceStage\n * @property {string} targetStage\n * @property {string} label\n */\n\n/**\n * @typedef {object} Worklist\n * @property {string} groupId\n * @property {string} label\n * @property {integer} itemCount\n * @property {integer} start\n * @property {integer} max\n * @property {WorkItem[]} items\n */\n\n/**\n * @typedef {object} WorkItem\n * @property {string} itemId\n * @property {string} type\n * @property {string} entityId\n * @property {string} label\n * @property {object.<string,string>} properties\n * @property {string} stage\n * @property {string} task\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks')\n    .provider('tasksRepo', tasksRepoProvider);\n\n  /**\n   * @return {angular.provider}\n   */\n  function tasksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/tasks';\n    provider.$get = tasksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function tasksRepoFactory($resource) {\n      var taskResource = $resource(provider.url + '/:taskId', { taskId: '@id' });\n      var workflowResource = $resource(provider.url + '/:taskId/workflow');\n      var itemResource = $resource(provider.url + '/:taskId/items/:itemId', { itemId: '@itemId' });\n\n      var repo = {};\n      repo.getTask = getTask;\n      repo.getWorkflow = getWorkflow;\n      repo.all = getAllTasks;\n      repo.getItems = getItems;\n      repo.transition = transition;\n      return repo;\n\n      /**\n       * Retrieves a listing of all tasks\n       *\n       * @return {Task[]}\n       */\n      function getAllTasks() {\n        return taskResource.query();\n      }\n\n      /**\n       * Retrieves a task by id\n       *\n       * @param  {string} taskId\n       * @return {GroupedTaskList}\n       */\n      function getTask(taskId) {\n        return taskResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Retrieves a workflow by task id\n       * @param  {string} taskId\n       * @return {Workflow}\n       */\n      function getWorkflow(taskId) {\n        return workflowResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Gets items from the task endpoint for a given stage\n       *\n       * @param  {string}  [taskId]  Task ID\n       * @param  {string}  stageId          Workflow stage for which to get items\n       * @param  {object}  options\n       * @param  {integer} [options.start]  Starting index\n       * @param  {integer} [options.max]    Maximum number of items to fetch per page\n       * @return {Worklist}\n       */\n      function getItems(taskId, stageId, options) {\n        options = options || {};\n        return itemResource.get({\n          taskId: taskId,\n          stage: stageId,\n          start: options.start,\n          max: options.max\n        });\n      }\n\n      /**\n       * Transition an item from its current stage to a target stage\n       *\n       * @param  {WorkItem}                item   Work item instance\n       * @param  {WorkflowStageTransition} transition Target workflow stage\n       * @return {WorkItem}                       Updated work item instance\n       */\n      function transition(taskId, item, transition) {\n        if (item.stage !== transition.sourceStage) {\n          throw new Error('Transition (' + transition.sourceStage + ' -> ' + transition.targetStage + ') is not valid for item currently in stage ' + item.stage);\n        }\n\n        var result = itemResource.save({\n          taskId: taskId,\n          itemId: item.itemId\n        }, {\n          stage: transition.targetStage,\n          // NOTE comments are not saved yet\n          comments: null\n        });\n\n        // propagate updates to the original item\n        result.$promise.then(function (resp) {\n          angular.extend(item, resp);\n        });\n\n        return result;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('TaskController', TaskController);\n\n  /** @ngInject */\n  function TaskController($mdSidenav, sdaToast, tasksRepo) {\n    var vm = this;\n\n    vm.loading = false;\n\n    vm.openMenu = openMenu;\n\n    activate();\n\n    function activate() {\n      vm.loading = true;\n      vm.tasks = tasksRepo.all();\n      var tasksPromise = vm.tasks.$promise;\n\n      tasksPromise.catch(function () {\n        sdaToast.error('Unable to load tasks from server');\n      }).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowTaskController', ShowTaskController);\n\n  /** @ngInject */\n  function ShowTaskController($state, $stateParams, $mdSidenav, tasksRepo, $q, sdaToast) {\n    var vm = this;\n\n    // HACK this will eventually be made available on the workflow data model itself.\n    vm.stageOrder = [\n      'pinned',\n      'inprogress',\n      'review',\n      'pending',\n      'deferred'\n    ];\n\n    vm.loading = true;\n    vm.worklists = {};\n    vm.task = null;\n\n    vm.focusItem = focusItem;\n    vm.transition = transitionItem;\n\n    activate();\n\n    function activate() {\n      vm.taskId = $stateParams.taskId;\n\n      vm.task = tasksRepo.getTask(vm.taskId);\n      var taskPromise = vm.task.$promise;\n      taskPromise.catch(makeErrorHandler('Unable to load task data from the server.'));\n\n      vm.workflow = tasksRepo.getWorkflow(vm.taskId);\n      var workflowPromise = vm.workflow.$promise;\n      workflowPromise.catch(makeErrorHandler('Unable to load workflow data from the server.'));\n\n      var worklistPromise = workflowPromise.then(loadWorklist);\n      worklistPromise.catch(makeErrorHandler('Unable to load worklist data from the server.'));\n\n      worklistPromise.then(function () {\n        vm.loading = false;\n      });\n    }\n\n    /**\n     * Opens the given item in the work editor\n     *\n     * @param {WorkItem} item\n     * @param {Event} $event\n     */\n    function focusItem(item, $event) {\n      $event.stopImmediatePropagation();\n\n      // TODO resolve handler based on item.type\n      $state.go('editor.work', { workId: item.entityId });\n    }\n\n    /**\n     * Applies the given transition to the given item, moving it from its current stage (presumably transition.sourceStage)\n     * to the stage identified by transition.targetStage\n     *\n     * @param {WorkItem} item\n     * @param {WorkflowStageTransition} transition\n     * @param {Event} $event\n     */\n    function transitionItem(item, transition, $event) {\n      $event.stopImmediatePropagation();\n\n      var updatedItem = tasksRepo.transition(vm.taskId, item, transition);\n\n      updatedItem.$promise.then(function () {\n        var refreshPromise = $q.all([\n          fetchStage(transition.sourceStage),\n          fetchStage(transition.targetStage)\n        ]);\n\n        refreshPromise.then(function () {\n          sdaToast.success('\"' + transition.label + '\" applied successfully');\n        }, function () {\n          sdaToast.error('Unable to refresh worklist after transition');\n        });\n\n        return refreshPromise;\n      }, function () {\n        sdaToast.error('Unable to \"' + transition.label + '\" item');\n      });\n    }\n\n    /**\n     * Populates all stages of the given workflow\n     *\n     * @param {Workflow} workflow\n     * @return Promise.<Worklist[]>\n     */\n    function loadWorklist(workflow) {\n      var worklistPromises = [];\n\n      angular.forEach(workflow.stages, function (stage) {\n        var worklistPromise = fetchStage(stage.id);\n        worklistPromises.push(worklistPromise);\n      });\n\n      return $q.all(worklistPromises);\n    }\n\n    /**\n     * Fetches the worklist items for the workflow stage with the given id\n     *\n     * @param {string} id\n     * @return {Promise.<Worklist>}\n     */\n    function fetchStage(stageId) {\n      var group = tasksRepo.getItems(vm.taskId, stageId, { max: 9999 });\n\n      group.$promise.then(function () {\n        vm.worklists[stageId] = group.items.length > 0 ? group : null;\n      });\n\n      return group.$promise;\n    }\n\n    /**\n     * Makes an error handler to display the given message in an error toast\n     *\n     * @param {string} message\n     * @return {makeErrorHandler~showErrorToast}\n     */\n    function makeErrorHandler(message) {\n      return showErrorToast;\n\n      /**\n       * Shows an error toast, returning a promise that resolves when the toast is dismissed\n       *\n       * @return {Promise}\n       */\n      function showErrorToast() {\n        return sdaToast.error(message);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowPersonController', ShowPersonController);\n\n  /** @ngInject */\n  function ShowPersonController(peopleRepo, refsRepoFactory, articlesRepo, $log, $state, $stateParams, $mdDialog, sdaToast, _, personEditDialog, eventEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.person = null;\n\n    vm.editBioInfo = editBioInfo;\n    vm.editEvent = editEvent;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.createBiography = createBiographyArticle;\n    vm.deletePerson = deletePerson;\n\n    activate();\n\n    function activate() {\n      var personId = $stateParams.id;\n\n      var personRefsUrl = peopleRepo.getReferencesEndpoint(personId);\n      refsRepo = refsRepoFactory.getRepo(personRefsUrl);\n\n      vm.person = peopleRepo.get(personId);\n      vm.references = refsRepo.get();\n\n      vm.references.$promise.then(function () {\n        var citations = _.values(vm.references.citations);\n\n        if (citations.length === 0) {\n          vm.citation = refsRepo.createCitation();\n          vm.references.citations[vm.citation.id] = vm.citation;\n        } else {\n          if (citations.length > 1) {\n            $log.warn('reference collection contains ' + citations.length + ' citations');\n          }\n          vm.citation = citations[0];\n        }\n      })\n    }\n\n    function editBioInfo($event) {\n      var dialogPromise = personEditDialog.show($event, angular.copy(vm.person));\n\n      dialogPromise.then(function (updatedPerson) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person, updatedPerson);\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editEvent(field, $event) {\n      var dialogPromise = eventEditDialog.show($event, angular.copy(vm.person[field]));\n\n      dialogPromise.then(function (updatedEvent) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person[field], updatedEvent);\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.person.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.person.summary = updatedSummary;\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        var savePromise = refsRepo.save(vm.references);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function deletePerson($event, person) {\n      var nameLabel = person.name.label ? '\"' + person.name.label + '\"' : 'this person';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + nameLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return peopleRepo.delete(person)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        $state.go('editor');\n        return sdaToast.success(nameLabel + ' has been deleted.');\n      }\n\n      function showErrorToast() {\n        return sdaToast.error('Unable to delete ' + nameLabel);\n      }\n    }\n\n    function createBiographyArticle($event, person) {\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Biography',\n        textContent: 'You are creating a new article attached to this person. Please enter a title for this article.',\n        initialValue: person.name.label,\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('biography', title, person.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          return sdaToast.error('Unable to create article.');\n        });\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('personEditDialog', personEditDialogFactory);\n\n  /** @ngInject */\n  function personEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, person) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: person\n        },\n        controller: PersonEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function PersonEditDialogController(peopleRepo, $mdDialog, person) {\n    var vm = this;\n\n    vm.person = person;\n    vm.nameRoles = [\n        // { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n    ]\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addName = addName;\n    vm.deleteName = deleteName;\n\n    function close() {\n      $mdDialog.hide(vm.person);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addName() {\n      var name = peopleRepo.createName();\n      vm.person.altNames.push(name);\n    }\n\n    function deleteName(name) {\n      var ix = vm.person.altNames.indexOf(name);\n      if (ix >= 0) {\n        vm.person.altNames.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController(worksRepo, peopleRepo, $state, $stateParams, $mdSidenav, _, $q, personEditDialog, workEditDialog, sdaToast) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.searchQuery = '';\n\n    vm.openMenu = openMenu;\n    vm.createPerson = createPerson;\n    vm.createWork = createWork;\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      if ($stateParams.q) {\n        vm.searchQuery = $stateParams.q;\n        search(vm.searchQuery);\n      }\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      $q.all([\n        vm.peopleResults.$promise,\n        vm.worksResults.$promise\n      ])\n        .then(function () {\n          vm.loading = false;\n        }, function () {\n          sdaToast.error('Unable to load data from the server');\n        });\n    }\n\n    function createPerson($event) {\n      var person = peopleRepo.create();\n      var dialogPromise = personEditDialog.show($event, person)\n\n      dialogPromise.then(function (person) {\n        var savePromise = peopleRepo.save(person);\n\n        savePromise.then(showSavedToast, showErrorToast);\n\n        savePromise.then(function (person) {\n          $state.go('editor.person', { id: person.id });\n        });\n\n        return savePromise;\n      });\n\n    }\n\n    function createWork($event) {\n      var work = worksRepo.createWork();\n      var dialogPromise = workEditDialog.show($event, work);\n\n      dialogPromise.then(function (work) {\n        var savePromise = worksRepo.saveWork(work);\n\n        savePromise.then(showSavedToast, showErrorToast);\n\n        savePromise.then(function (work) {\n          $state.go('editor.work', { workId: work.id });\n        });\n\n        return savePromise;\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved.');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save.')\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($mdThemingProvider) {\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log, trcAuth) {\n    if (!trcAuth.isAuthenticated()) {\n      trcAuth.loginGuest();\n    }\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('editor', {\n        url: '/?q',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'vm'\n      })\n\n      .state('editor.person', {\n        url: 'people/:id',\n        views: {\n          main: {\n            templateUrl: 'app/person/person.html',\n            controller: 'ShowPersonController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('editor.work', {\n        url: 'works/:workId',\n        views: {\n          main: {\n            templateUrl: 'app/work/work.html',\n            controller: 'ShowWorkController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.edition', {\n        url: 'works/:workId/editions/:editionId',\n        views: {\n          main: {\n            templateUrl: 'app/work/edition.html',\n            controller: 'ShowEditionController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.volume', {\n        url: 'works/:workId/editions/:editionId/volumes/:volumeId',\n        views: {\n          main: {\n            templateUrl: 'app/work/volume.html',\n            controller: 'ShowVolumeController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('article', {\n        url: '/articles',\n        templateUrl: 'app/admin/editors/articles/article.html',\n        controller: 'ArticleEditorSectionController',\n        controllerAs: 'vm'\n      })\n\n      .state('article.edit', {\n        url: '/:id',\n        templateUrl: 'app/admin/editors/articles/article-editor.html',\n        controller: 'ArticleEditorController',\n        controllerAs: 'vm'\n      })\n\n      .state('task', {\n        url: '/task',\n        templateUrl: 'app/task/task.html',\n        controller: 'TaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('task.show', {\n        url: '/:taskId',\n        templateUrl: 'app/task/show.html',\n        controller: 'ShowTaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('vwise', {\n        url: '/vwise/:workspaceId',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      })\n\n      .state('zotero', {\n        url: '/zotero',\n        templateUrl: 'app/zotero/test/test.html',\n        controller: 'ZoteroTestController',\n        controllerAs: 'vm'\n      });\n\n\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, $httpProvider,\n                  tasksRepoProvider,\n                  worksRepoProvider,\n                  peopleRepoProvider,\n                  articlesRepoProvider,\n                  relnRepoProvider,\n                  categorizationServiceProvider,\n                  seeAlsoRepoProvider,\n                  trcSearchProvider,\n                  trcAuthProvider,\n                  trcAuthInterceptorProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // API endpoints\n    var API_PREFIX = '/api/catalog';\n\n    tasksRepoProvider.url = API_PREFIX + '/v1/tasks';\n    worksRepoProvider.url = API_PREFIX + '/works';\n    peopleRepoProvider.url = API_PREFIX + '/people';\n    articlesRepoProvider.url = API_PREFIX + '/entries/articles';\n    relnRepoProvider.url = API_PREFIX + '/relationships';\n    categorizationServiceProvider.url = API_PREFIX + '/categorizations';\n    seeAlsoRepoProvider.url = API_PREFIX + '/seealso';\n    trcSearchProvider.url = API_PREFIX + '/search';\n\n    // authentication\n    trcAuthProvider.loginUrl = API_PREFIX + '/accounts/auth';\n    trcAuthProvider.loginGuestUrl = API_PREFIX + '/accounts/authguest';\n    trcAuthInterceptorProvider.url = new RegExp('^' + API_PREFIX, 'i');\n    $httpProvider.interceptors.push('trcAuthInterceptor');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(cslConfig);\n\n  var CSL_LOCALES = {\n    'en-US': 'en-US'\n  };\n\n  var CSL_STYLES = {\n    mla: 'modern-language-association',\n    chicago: 'chicago-author-date'\n  };\n\n  /** @ngInject */\n  function cslConfig(citeprocProvider, refsRendererProvider) {\n    refsRendererProvider.typemapUrl = '/assets/typemap/zotero-csl.json';\n    angular.forEach(CSL_LOCALES, addLocale);\n    angular.forEach(CSL_STYLES, addStyle);\n\n    function addLocale(filename, localeId) {\n      citeprocProvider.addLocale(localeId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/locales/locales-' + filename + '.xml').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n\n    function addStyle(filename, styleId) {\n      citeprocProvider.addStyle(styleId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/styles/' + filename + '.csl').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n  }\n\n})();\n\nangular.module(\"sdaAdmin\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<md-content flex layout=column> <navbar title=\\\"Editorial Tools\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" ui-view=sidebar layout=column> <form layout=row flex=none> <md-input-container flex> <label for=searchQuery>Search</label> <md-icon>search</md-icon> <input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required> </md-input-container> </form> <md-content flex> <div ng-if=vm.loading layout=row layout-align=center> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"> <md-subheader>People</md-subheader> <md-list> <md-list-item ng-repeat=\\\"person in vm.peopleResults.items\\\" ui-sref=\\\"editor.person({id: person.id})\\\"> <div class=md-list-item-text ng-bind-html=person.label></div> </md-list-item> </md-list> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"> <md-subheader>Works</md-subheader> <md-list> <md-list-item ng-repeat=\\\"work in vm.worksResults.items\\\" ui-sref=\\\"editor.work({workId: work.id})\\\"> <div class=md-list-item-text ng-bind-html=work.label></div> </md-list-item> </md-list> </div> </md-content> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Person\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createPerson($event)> <md-tooltip md-direction=left>New Person</md-tooltip> <md-icon>person</md-icon> </md-button> <md-button aria-label=\\\"New Work\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createWork($event)> <md-tooltip md-direction=left>New Book</md-tooltip> <md-icon>book</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view=main></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/person/person-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Biographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=name layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Canonical Name</h2> </div> </md-toolbar> <div class=name> <name-editor ng-model=vm.person.name flex></name-editor> </div> </section> <section class=alt-names layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Alternate Names</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addName()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=name layout=row ng-repeat=\\\"name in vm.person.altNames\\\"> <md-input-container> <label>role</label> <md-select ng-model=name.role> <md-option ng-repeat=\\\"role in vm.nameRoles\\\" value={{role.value}}> {{role.label}} </md-option> </md-select> </md-input-container> <name-editor ng-model=name flex></name-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteName(name)> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/person/person.html\",\"<div layout=row layout-padding flex=noshrink> <div flex=60> <section class=\\\"content names\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h1 class=content-heading>{{vm.person.name.label}}</h1> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBioInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <div ng-if=\\\"vm.person.altNames && vm.person.altNames.length > 0\\\"> <p>Other names:</p> <ul> <li ng-repeat=\\\"name in vm.person.altNames\\\">{{name.label}}</li> </ul> </div> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.person.summary ng-bind-html=vm.person.summary></p> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div flex=40> <section class=\\\"content birth\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Birth</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'birth\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.birth.date.description>{{vm.person.birth.date.description}}</span> <span class=location ng-if=vm.person.birth.location>in {{vm.person.birth.location}}</span> </p> <p ng-bind-html=vm.person.birth.description ng-if=vm.person.birth.description></p> </section> <section class=\\\"content death\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Death</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'death\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.death.date.description>{{vm.person.death.date.description}}</span> <span class=location ng-if=vm.person.death.location>in {{vm.person.death.location}}</span> </p> <p ng-bind-html=vm.person.death.description ng-if=vm.person.death.description></p> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.person.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button aria-label=\\\"Create Biography\\\" class=md-icon-button ng-click=\\\"vm.createBiography($event, vm.person)\\\"> <md-icon>assignment_ind</md-icon> <md-tooltip md-direction=top>Create Biography</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this person\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deletePerson($event, vm.person)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/task/show.html\",\"<md-content flex layout=column> <div class=task-info> <span class=label>{{vm.task.label}}</span> <span class=description>{{vm.task.description}}</span> </div> <md-input-container> <label>Search</label> <md-icon>search</md-icon> <input type=search ng-model=filter ng-change=vm.search(filter)> </md-input-container> <md-content flex> <div layout=row layout-align=\\\"center center\\\" ng-if=vm.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-repeat=\\\"stageId in vm.stageOrder\\\" ng-if=vm.worklists[stageId]> <md-subheader>{{vm.workflow.stages[stageId].label}}</md-subheader> <md-list> <md-list-item ng-repeat=\\\"item in vm.worklists[stageId].items | filter : filter | limitTo : 20\\\" ng-mouseover=\\\"item.hover = true\\\" ng-mouseout=\\\"item.hover = false\\\" ng-click=\\\"vm.focusItem(item, $event)\\\"> <span ng-bind-html=item.label></span> <span flex></span> <md-button class=md-exclude ng-repeat=\\\"transition in vm.workflow.stages[stageId].transitions\\\" ng-click=\\\"vm.transition(item, transition, $event)\\\" ng-show=item.hover> <span>{{transition.label}}</span> </md-button> </md-list-item> </md-list> </div> </md-content> </md-content>\");\n$templateCache.put(\"app/task/task.html\",\"<md-content flex layout=column> <navbar title=\\\"Task Management Dashboard\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <div ng-if=vm.loading flex layout=row layout-align=\\\"center center\\\"> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <md-list ng-if=!vm.loading> <md-list-item ng-repeat=\\\"task in vm.tasks\\\" ui-sref=\\\"task.show({ taskId: task.id })\\\"> {{ task.label }} </md-list-item> </md-list> </md-sidenav> <md-content flex layout=column ui-view> <div layout=row layout-padding layout-margin layout-align=\\\"center center\\\"> <div class=md-headline>Please select a task from the sidebar.</div> </div> </md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/work/edition-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=vm.edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/edition.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li>{{vm.edition.editionName}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.edition.authors && vm.edition.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.edition.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.edition.publicationInfo> <span ng-if=vm.edition.publicationInfo.place> <span class=place>{{vm.edition.publicationInfo.place}}</span>: </span> <span ng-if=vm.edition.publicationInfo.publisher> <span class=publisher>{{vm.edition.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.edition.publicationInfo.date> <time class=date datetime={{vm.edition.publicationInfo.date.calendar}}>{{vm.edition.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.edition.summary ng-bind-html=vm.edition.summary></p> </section> <section class=\\\"content volumes\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addVolume($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"volume in vm.edition.volumes\\\" ui-sref=\\\"editor.volume({workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id})\\\"> <span>Volume {{volume.volumeNumber}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteVolume(volume, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.edition.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToWork(copy) aria-label=\\\"copy to parent work\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Work</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/volume-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=vm.volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/volume.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li><a ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: vm.edition.id})\\\">{{vm.edition.editionName}}</a></li> <li>Volume {{vm.volume.volumeNumber}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.volume.authors && vm.volume.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.volume.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.volume.publicationInfo> <span ng-if=vm.volume.publicationInfo.place> <span class=place>{{vm.volume.publicationInfo.place}}</span>: </span> <span ng-if=vm.volume.publicationInfo.publisher> <span class=publisher>{{vm.volume.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.volume.publicationInfo.date> <time class=date datetime={{vm.volume.publicationInfo.date.calendar}}>{{vm.volume.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.volume.summary ng-bind-html=vm.volume.summary></p> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.volume.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToEdition(copy) aria-label=\\\"copy to parent edition\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Edition</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/work-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/work.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li>{{vm.bcTitle.title}}{{vm.bcTitle && vm.bcTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.bcTitle.subtitle}}</li> </ol> </nav> <div layout=row layout-padding flex=noshrink> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.work.authors && vm.work.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.work.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.work.summary ng-bind-html=vm.work.summary></p> </section> <section class=\\\"content editions\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addEdition($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"edition in vm.work.editions | orderBy:\\'publicationInfo.date.calendar\\'\\\" ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: edition.id})\\\"> <pre>{{edition.publicationInfo.date.calendar|json}}</pre> <span>{{edition.editionName}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteEdition(edition, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.work.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.work.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button class=md-icon-button aria-label=\\\"Create Book Review\\\" ng-click=\\\"vm.createBookReview($event, vm.work)\\\"> <md-icon>assignment</md-icon> <md-tooltip md-direction=top>Create Book Review</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this work\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deleteWork($event, vm.work)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/creator-field.html\",\"<div layout=row layout-margin> <md-input-container> <label>Role</label> <md-select ng-model=$ctrl.creator.creatorType ng-disabled=\\\"!$ctrl.roles || $ctrl.roles.length == 0\\\"> <md-option ng-value=role.role ng-repeat=\\\"role in $ctrl.roles\\\">{{role.label}}</md-option> </md-select> </md-input-container> <md-input-container ng-if=verbatim flex> <label>Name</label> <input type=text ng-model=$ctrl.creator.name> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>First Name</label> <input type=text ng-model=$ctrl.creator.firstName> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>Last Name</label> <input type=text ng-model=$ctrl.creator.lastName> </md-input-container> <div layout=column layout-align=\\\"center center\\\"> <md-button ng-show=verbatim ng-click=\\\"verbatim = false\\\" class=md-icon-button aria-label=\\\"First/Last Names\\\"> <md-icon>people</md-icon> <md-tooltip>First/Last Names</md-tooltip> </md-button> <md-button ng-hide=verbatim ng-click=\\\"verbatim = true\\\" class=md-icon-button aria-label=\\\"Single Name\\\"> <md-icon>domain</md-icon> <md-tooltip>Single Name</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/editor.html\",\"<div layout=column flex> <div layout=row layout-margin> <md-autocomplete md-search-text=$ctrl.itemTypeSearchText md-items=\\\"type in $ctrl.types | filter: {label: $ctrl.itemTypeSearchText}\\\" md-item-text=type.label md-selected-item=$ctrl.itemType md-selected-item-change=$ctrl.selectType($ctrl.itemType) md-min-length=0 md-floating-label=\\\"Item Type\\\" required> <md-item-template> <span md-highlight-text=$ctrl.itemTypeSearchText md-highlight-flags=^i>{{type.label}}</span> </md-item-template> </md-autocomplete> </div> <div layout=row ng-repeat=\\\"creator in $ctrl.item.creators\\\" layout-align=\\\"start center\\\"> <zotero-creator-field creator=creator roles=$ctrl.roles flex></zotero-creator-field> <md-button ng-click=\\\"$ctrl.item.creators.splice($index+1, 0, {})\\\" class=md-icon-button aria-label=\\\"New Creator\\\"> <md-icon>add</md-icon> <md-tooltip>New</md-tooltip> </md-button> <md-button ng-disabled=\\\"$ctrl.item.creators.length <= 1\\\" ng-click=\\\"$ctrl.item.creators.splice($index, 1)\\\" class=\\\"md-icon-button md-warn\\\" aria-label=\\\"Delete Creator\\\"> <md-icon>remove</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </div> <div layout=row layout-margin ng-repeat=\\\"field in $ctrl.fields\\\"> <md-input-container flex> <label>{{field.label}}</label> <input type=text ng-model=$ctrl.item[field.id]> </md-input-container> </div> <div ng-if=!$ctrl.itemType layout-margin> <p>Please select an item type first.</p> </div> </div>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-edit-dialog.html\",\"<md-dialog aria-label=\\\"Edit Citation\\\" flex=50 layout=column> <form ng-cloak> <md-toolbar> <div class=md-toolbar-tools> <h2>Edit Citation</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon aria-label=Cancel>close</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class=md-dialog-content> <citation-editor references=vm.references citation=vm.citation></citation-editor> </div> </md-dialog-content> <md-dialog-actions layout=row> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-editor.html\",\"<div class=citation-editor-layout layout=column flex> <div class=citation-editor-container ng-hide=$ctrl.zoteroItem layout=column flex> <div layout=row layout-wrap> <div layout=row layout-align=\\\"start center\\\" layout-margin class=md-whiteframe-2dp ng-repeat=\\\"item in $ctrl.citation.items\\\"> <span ng-bind-html=item.label></span> <md-button class=md-icon-button aria-label=Edit ng-click=$ctrl.edit(item)> <md-icon>edit</md-icon> <md-tooltip>Edit Item</md-tooltip> </md-button> <md-button class=\\\"md-icon-button md-warn\\\" aria-label=Remove ng-click=\\\"$ctrl.citation.items.splice($index, 1)\\\"> <md-icon>remove</md-icon> <md-tooltip>Remove Item</md-tooltip> </md-button> </div> </div> <div layout=column> <md-autocomplete md-autoselect md-floating-label=\\\"Referenced Item\\\" md-selected-item=$ctrl.selectedBiblioItem md-selected-item-change=$ctrl.selectBiblioItem($ctrl.selectedBiblioItem) md-search-text=$ctrl.searchText md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-delay=200 md-require-match required> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found> No matches found. <md-button ng-click=$ctrl.createZoteroItem($event)>Create</md-button> </md-not-found> </md-autocomplete> <div layout=row> <md-input-container> <label>Locator Type</label> <md-select ng-model=$ctrl.activeCitationItem.locatorType> <md-option></md-option> <md-option ng-repeat=\\\"type in $ctrl.locatorTypes\\\" ng-value=type>{{type}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label>Locator</label> <input type=text ng-model=$ctrl.activeCitationItem.locator> </md-input-container> </div> <md-checkbox ng-model=$ctrl.activeCitationItem.suppressAuthor> Suppress Author Name in In-Text Citation </md-checkbox> </div> <div layout=row layout-align=end> <md-button class=md-raised ng-click=$ctrl.addCitationItem($ctrl.activeCitationItem)> Save Item </md-button> </div> </div> <div class=zotero-item-editor-container ng-if=$ctrl.zoteroItem layout=row flex> <div layout=column> <md-button class=md-icon-button ng-click=$ctrl.cancelZoteroItem($event)> <md-icon>cancel</md-icon> <md-tooltip md-direction=right>Cancel New Item</md-tooltip> </md-button> <md-button class=md-icon-button ng-click=\\\"$ctrl.saveZoteroItem($event, $ctrl.zoteroItem)\\\"> <md-icon>check_circle</md-icon> <md-tooltip md-direction=right>Save and Cite Item</md-tooltip> </md-button> </div> <zotero-editor item=$ctrl.zoteroItem flex></zotero-editor> </div> </div>\");\n$templateCache.put(\"app/components/ckeditor-footnotes/footnote-edit-dialog.html\",\"<md-bottom-sheet aria-label=\\\"Insert Footnote\\\" layout=column> <md-toolbar> <div class=md-toolbar-tools> <h2>Insert Footnote</h2> <span flex></span> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </div> </md-toolbar> <div ng-if=vm.references ng-model=vm.footnote.content ckeditor=vm.ckeditorConfig ckeditor-bibliography=vm.references></div> <div ng-if=!vm.references ng-model=vm.footnote.content ckeditor=vm.ckeditorConfig></div> </md-bottom-sheet>\");\n$templateCache.put(\"app/components/date-editor/date-editor.html\",\"<div layout=row> <md-input-container flex> <label>date</label> <input type=text ng-model=date.description> </md-input-container> <md-input-container flex> <label>calendar date</label> <input type=datetime ng-model=date.calendar ng-change=\\\"calendarAutoSet = false\\\"> </md-input-container> </div>\");\n$templateCache.put(\"app/components/navbar/navbar.html\",\"<md-toolbar> <div class=md-toolbar-tools> <md-button ng-if=$ctrl.sidenavId class=\\\"md-accent md-icon-button\\\" ng-click=$ctrl.toggleSidenav($ctrl.sidenavId) title=\\\"toggle menu\\\" hide-gt-sm> <md-icon>menu</md-icon> </md-button> <img class=logo src=assets/images/sda-logo-light.png> <h2> <span>{{$ctrl.title}}</span><!-- make this change based on page --> </h2> <span flex></span> <md-button ui-sref=editor>People and Works</md-button> <md-button ui-sref=article>Article</md-button> <md-button ui-sref=task>Tasks</md-button> </div> </md-toolbar>\");\n$templateCache.put(\"app/components/see-also-editor/see-also-editor.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.seeAlso\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load links from the server. </div> </div> <div layout=column ng-if=\\\"!$ctrl.loading && $ctrl.seeAlso\\\"> <md-list ng-if=\\\"!($ctrl.seeAlso.links | empty)\\\"> <div ng-repeat=\\\"(type, targets) in $ctrl.seeAlso.links\\\"><!-- The type key is a machine identifier (e.g. \\'trc.entries.bibliographic\\')\\n      <md-subheader>{{type}}</md-subheader> --> <md-list-item ng-repeat=\\\"target in targets\\\" ng-click=\\\"$ctrl.openLink($event, target)\\\"> <span ng-bind-html=target.label></span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" aria-label=\\\"delete link\\\" ng-click=\\\"$ctrl.deleteLink($event, target)\\\"> <md-icon>delete</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </md-list-item> </div> </md-list> <div ng-if=\\\"$ctrl.seeAlso.links | empty\\\"> No links added. Add one below. </div> <form layout=row novalidate name=newLink ng-submit=$ctrl.createLink($ctrl.selectedItem)> <md-autocomplete md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-search-text=$ctrl.searchText md-selected-item=$ctrl.selectedItem md-selected-item-change=$ctrl.createLink($ctrl.selectedItem) md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"add link\\\" md-select-on-match md-match-case-insensitive flex> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete><!-- link creation occurs on autocomplete selected item change\\n    <md-button type=\\\"submit\\\" class=\\\"md-icon-button\\\" ng-disabled=\\\"!$ctrl.selectedItem\\\">\\n      <md-icon>add</md-icon>\\n      <md-tooltip>Add Link</md-tooltip>\\n    </md-button>\\n    --> </form> </div>\");\n$templateCache.put(\"app/components/summary-edit-dialog/summary-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Summary Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content><!-- material-compliant padding not used since WYSIWYG text editor *is* the UI --> <summary-editor ng-model=vm.summary></summary-editor> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/summary-editor/summary-editor.html\",\"<div ckeditor ng-model=summary></div>\");\n$templateCache.put(\"app/zotero/test/test.html\",\"<div layout=column flex> <md-content> <zotero-editor item=vm.item types=vm.types></zotero-editor> </md-content> </div>\");\n$templateCache.put(\"app/admin/editors/articles/article-editor.html\",\"<div flex layout=column layout-padding><!-- title editor bar --> <md-content layout=row flex=none> <md-input-container class=no-space flex> <label>Title</label> <input type=text ng-model=vm.article.title> </md-input-container> <div flex=none> <md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button> </div> </md-content> <div layout=column flex=none class=authors> <h3 layout=row> <span>Authors</span> <span flex></span> <span> <md-button class=md-icon-button aria-label=\\\"add author\\\" ng-click=vm.article.authors.push({})> <md-icon>add</md-icon> <md-tooltip>Add Author</md-tooltip> </md-button> </span> </h3> <div layout=row ng-repeat=\\\"author in vm.article.authors\\\"> <article-author-editor author=author flex></article-author-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.article.authors.splice($index, 1)\\\" ng-if=\\\"vm.article.authors.length > 1\\\"> <md-icon>delete</md-icon> <md-tooltip>Remove Author</md-tooltip> </md-button> </div> </div><!-- TODO add save button and auto-save --><!-- TODO add sidebar for notes, biblio, links, etc --> <div id=article_editor flex=noshrink layout=column> <div ng-model=vm.article.body ckeditor=vm.editor.config ckeditor-bibliography=vm.references ckeditor-footnotes=vm.article.footnotes> </div> <md-tabs flex=noshrink> <md-tab label=Abstract> <div ckeditor=vm.abstractEditor.config ng-model=vm.article.abstract></div> </md-tab> <md-tab label=Bibliography> <bibliography refs=vm.references style-id=mla></bibliography> </md-tab> <md-tab label=Footnotes> <div class=footnotes ng-repeat=\\\"footnote in vm.article.footnotes\\\" layout=row> <div class=footnote ng-bind-html=footnote.content flex></div> <md-button class=md-icon-button aria-label=\\\"edit footnote\\\" ng-click=\\\"vm.editFootnote($event, footnote)\\\"> <md-icon>edit</md-icon> <md-tooltip>Edit Footnote</md-tooltip> </md-button> </div> </md-tab> <md-tab label=\\\"See Also\\\"> <see-also-editor source-token=vm.article.ref.token></see-also-editor> </md-tab> </md-tabs> </div><!-- TODO how to make this fill all available space --> </div>\");\n$templateCache.put(\"app/admin/editors/articles/article.html\",\"<md-content flex layout=column> <navbar title=Articles sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <md-tabs flex> <md-tab> <md-tab-label> <md-icon>format_list_bulleted</md-icon> <md-tooltip md-direction=bottom>Thematic Overviews</md-tooltip> </md-tab-label> <md-tab-body> <tree-categorization-editor scope-id=sda scheme=overviews> </tree-categorization-editor> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>school</md-icon> <md-tooltip md-direction=bottom>Research Articles</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=research></article-type-search> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>book</md-icon> <md-tooltip md-direction=bottom>Book Reviews</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=book-review></article-type-search> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>person</md-icon> <md-tooltip md-direction=bottom>Biographies</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=biography></article-type-search> </md-tab-body> </md-tab> </md-tabs> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Research Article\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'research\\')\\\"> <md-tooltip md-direction=left>New Research Article</md-tooltip><!-- <md-icon>description</md-icon> --> <md-icon>school</md-icon> </md-button> <md-button aria-label=\\\"New Book Review\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'book-review\\')\\\"> <md-tooltip md-direction=left>New Book Review</md-tooltip> <md-icon>book</md-icon> </md-button> <md-button aria-label=\\\"New Biography\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'biography\\')\\\"> <md-tooltip md-direction=left>New Biography</md-tooltip> <md-icon>person</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/admin/editors/articles/thematic-overview.html\",\"<div id=thematic_overviews> <script type=text/ng-template id=treeCategoryEntry.html><div class=\\\"category-node\\\" layout=\\\"row\\\" layout-align=\\\"start center\\\">\\n     <!--  Display label for the category node-->\\n     <span ng-if=\\\"node.entryRef == null\\\" class=\\\"node-label\\\">{{ node.label }}</span>\\n     <a ui-sref=\\\"article.edit({id:node.entryRef.id})\\\" ng-if=\\\"node.entryRef != null\\\" class=\\\"node-label\\\">{{ node.label }}</a>\\n\\n     <!-- push buttons to edge -->\\n     <span flex></span>\\n\\n     <!-- node action menu -->\\n     <md-menu class=\\\"action\\\">\\n       <!-- activate handle -->\\n       <md-button ng-click=\\\"$mdOpenMenu($event)\\\" class=\\\"md-icon-button\\\">\\n         <md-icon>arrow_drop_down</md-icon>\\n       </md-button>\\n\\n       <md-menu-content>\\n         <!-- Associate/Remove  -->\\n         <md-menu-item>\\n           <md-button ng-if=\\\"node.entryRef.id == null\\\"\\n                      ng-click=\\\"vm.handleAssociateEntry($event, node)\\\">\\n             <md-icon>add_circle_outline</md-icon>\\n             Create Article\\n           </md-button>\\n           <md-button ng-if=\\\"node.entryRef.id != null\\\"\\n                      ng-click=\\\"vm.handleRemoveEntry($event, node)\\\">\\n             <md-icon>remove_circle_outline</md-icon>\\n             Remove Article\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleCreateChild($event, node)\\\">\\n             <!-- Will create a child node at the end of this list. User can drag to re-arrange -->\\n             <md-icon>create_new_folder</md-icon>\\n             Create Sub-Category\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleDeleteNode($event, node, parent)\\\">\\n             <!-- Will delete this node, all children and associated articles. If leaf node,\\n             displays delete instead of delete sweep. Prompts user to confirm. -->\\n             <md-icon>delete{{ node.children.length == 0 ? \\'\\' : \\'_sweep\\' }}</md-icon>\\n             Remove Category\\n           </md-button>\\n         </md-menu-item>\\n       </md-menu-content>\\n     </md-menu>\\n   </div>\\n\\n   <ol ng-if=\\\"node.children.length > 0\\\">\\n     <li ng-repeat=\\\"node in node.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = $parent.$parent.node\\\"></li>\\n   </ol></script> <ol> <li ng-repeat=\\\"node in vm.overviews.root.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = vm.overviews.root\\\"></li> </ol> <div layout=row layout-align=\\\"center center\\\"><!-- TODO need additional styling --> <md-button ng-click=\\\"vm.handleCreateChild($event, vm.overviews.root)\\\" class=md-raised aria-label=\\\"create category\\\">Create Category</md-button> </div> </div>\");\n$templateCache.put(\"app/person/components/event-edit-dialog/event-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Event Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <event-editor ng-model=vm.event flex></event-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/person/components/event-editor/event-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex> <label>location</label> <input type=text ng-model=event.location> </md-input-container> <date-editor ng-model=event.date flex></date-editor> </div> <div layout=row layout-padding> <div flex> <h2>Description</h2> <div flex ckeditor ng-model=event.description></div> </div> </div> </div>\");\n$templateCache.put(\"app/person/components/name-editor/name-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex=10> <label>title</label> <input type=text ng-model=name.title> </md-input-container> <md-input-container flex=30> <label>given</label> <input type=text ng-model=name.givenName> </md-input-container> <md-input-container flex=20> <label>middle</label> <input type=text ng-model=name.middleName> </md-input-container> <md-input-container flex=30> <label>family</label> <input type=text ng-model=name.familyName> </md-input-container> <md-input-container flex=10> <label>suffix</label> <input type=text ng-model=name.suffix> </md-input-container> </div> <md-input-container> <label>display label</label> <input type=text ng-model=name.label required> </md-input-container> </div>\");\n$templateCache.put(\"app/task/components/edition-editor/edition-editor.html\",\"<div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.titles.push({})> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=edition.summary flex></summary-editor> </section> <section class=volumes> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createVolume()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=volume layout=column layout-margin ng-repeat=\\\"volume in vm.volumes\\\" ng-class=\\\"{\\'md-whiteframe-2dp\\': !volume.focused, \\'md-whiteframe-8dp\\': volume.focused}\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"volume.focused = !volume.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>Volume {{volume.model.volumeNumber}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteVolume($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=volume.focused> <volume-editor ng-model=volume.model flex></volume-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in edition.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/volume-editor/volume-editor.html\",\"<div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <h2>Publication Information</h2> <publication-info-editor ng-model=volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <h2 layout=row> <span flex>Titles</span> <md-button class=md-icon-button ng-click=volume.titles.push({})> <md-icon>add</md-icon>  </md-button></h2> <div class=title layout=row ng-repeat=\\\"title in volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <h2 layout=row> <span flex>Authors</span> <md-button class=md-icon-button ng-click=volume.authors.push({})> <md-icon>add</md-icon> </md-button> </h2> <div class=author layout=row ng-repeat=\\\"author in volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=volume.summary flex></summary-editor> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=volume.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in volume.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor/work-editor.html\",\"<section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.titles.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Summary</h2> </div> </md-toolbar> <summary-editor ng-model=work.summary flex></summary-editor> </section> <section class=editions> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createEdition()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=edition layout=column layout-margin ng-repeat=\\\"edition in vm.editions | orderBy:\\'publicationInfo.date.calendar\\'\\\" ng-class=\\\"{ \\'md-whiteframe-2dp\\': !edition.focused, \\'md-whiteframe-8dp\\': edition.focused }\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"edition.focused = !edition.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>{{edition.model.editionName}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteEdition($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=edition.focused> <edition-editor ng-model=edition.model flex></edition-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in work.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor-item/work-editor-item.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=!vm.loaded> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=vm.loaded> <work-editor ng-model=vm.work></work-editor> </div>\");\n$templateCache.put(\"app/work/components/copy-edit-dialog/copy-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Digital Copy Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <copy-editor ng-model=vm.copy></copy-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/author-ref-editor/author-ref-editor.html\",\"<div layout=column> <div layout=row> <md-autocomplete required md-items=\\\"item in vm.authorRoles\\\" md-item-text=role md-min-length=0 md-search-text=ref.role md-selected-item-change=\\\"ref.role = item\\\" md-floating-label=role> <md-item-template> <span md-highlight-text=ref.role>{{item}}</span> </md-item-template> </md-autocomplete> <md-input-container flex> <label>first name</label> <input type=text ng-model=ref.firstName> </md-input-container> <md-input-container flex> <label>last name</label> <input type=text ng-model=ref.lastName> </md-input-container> </div> <div layout=row> <md-autocomplete flex md-items=\\\"person in vm.getResults(vm.linkAuthorSearchText)\\\" md-item-text=\\\"person.label | stripTags\\\" md-search-text=vm.linkAuthorSearchText md-search-text-change=vm.searchPeople(vm.linkAuthorSearchText) md-selected-item-change=vm.setLinkedAuthor(person) md-floating-label=\\\"linked author\\\"> <md-item-template> <span md-highlight-text=vm.linkAuthorSearchText ng-bind-html=person.label></span> </md-item-template> <md-not-found>No matches found.</md-not-found> </md-autocomplete> </div> </div>\");\n$templateCache.put(\"app/work/components/copy-editor/copy-editor.html\",\"<ng-form name=copyForm layout=column flex> <md-input-container> <label for=title>Title</label> <input type=text name=title id=title ng-model=copy.title> </md-input-container> <div layout=row> <md-input-container> <label for=type>Type</label> <md-select name=type id=type ng-model=copy.type required ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> <md-option ng-repeat=\\\"handler in vm.refHandlers\\\" value={{handler.id}}>{{handler.display}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label for=url>URL</label> <input type=url name=url id=url ng-model=copyUrl ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> </md-input-container> </div> <ul class=\\\"properties properties-inline\\\"> <li ng-repeat=\\\"(key, value) in copy.properties\\\"> <span class=label>{{key}}</span> <span class=value>{{value}}</span> </li> </ul> <md-input-container> <label for=rights>Description of Rights</label> <input type=text name=rights id=rights ng-model=copy.rights> </md-input-container> <h3>Summary</h3> <summary-editor ng-model=copy.summary flex></summary-editor> </ng-form>\");\n$templateCache.put(\"app/work/components/publication-info-editor/publication-info-editor.html\",\"<div layout=row> <md-input-container flex> <label>publisher</label> <input type=text ng-model=pubInfo.publisher> </md-input-container> <md-input-container flex> <label>location</label> <input type=text ng-model=pubInfo.place> </md-input-container> <date-editor ng-model=pubInfo.date flex></date-editor> </div>\");\n$templateCache.put(\"app/work/components/relationships/relationships.html\",\"<div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Relationships</h2> <span flex></span> <md-button class=md-icon-button ng-click=$ctrl.addRelationship($event) ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups\\\"> <md-icon>add</md-icon> </md-button> </div> <div ng-repeat=\\\"type in $ctrl.typeGroups\\\" ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups.length > 0\\\"> <h3 class=content-heading>{{type.label}}</h3> <md-list><!-- TODO: clicking on relationship should open that relationship in an editor; clicking on an anchor should go to the linked item --> <md-list-item ng-repeat=\\\"reln in type.relationships\\\" ng-click=\\\"$ctrl.openRelationship($event, reln)\\\"> <span ng-repeat=\\\"anchor in reln.anchors\\\" ng-bind-html=anchor.label></span> <md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"$ctrl.deleteRelationship($event, reln)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </div> <div ng-if=\\\"$ctrl.typeGroups && $ctrl.typeGroups.length == 0\\\"> No relationships to display. </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.typeGroups\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load relationships from the server. </div> </div> <div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div>\");\n$templateCache.put(\"app/work/components/reln-edit-dialog/reln-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Relationship Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form name=relationship ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content layout=column> <md-input-container> <label>type</label> <md-select name=type ng-model=vm.selectedType required> <md-option ng-repeat=\\\"type in vm.types\\\" ng-value=type> {{type.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.type.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <md-autocomplete md-items=\\\"work in vm.search(vm.searchText)\\\" md-search-text=vm.searchText md-selected-item=vm.selectedWork md-selected-item-change=vm.selectWork(work) md-item-text=\\\"work.label | stripTags\\\" md-require-match md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"search works\\\" md-select-on-match md-match-case-insensitive> <md-item-template> <span ng-bind-html=work.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete> <md-input-container ng-if=\\\"vm.anchors.length > 1\\\"> <label>target</label> <md-select name=target ng-model=vm.selectedAnchor required> <md-option ng-repeat=\\\"anchor in vm.anchors\\\" ng-value=anchor> {{anchor.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.target.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <div class=summary> <h2>Summary</h2> <div ckeditor ng-model=vm.description></div> </div> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/title-editor/title-editor.html\",\"<div layout=row> <md-input-container> <label>type</label> <md-select ng-model=title.type required> <md-option value=bibliographic>bibliographic</md-option> <md-option value=canonical>canonical</md-option> <md-option value=short>short</md-option> </md-select> </md-input-container> <md-input-container flex> <label>title</label> <input type=text ng-model=title.title required> <div ng-switch=title.type> <small ng-switch-when=bibliographic>the full title as published on the work</small> <small ng-switch-when=canonical>title by which the work is commonly known in the academic realm</small> <small ng-switch-when=short>shortened title coloquially used by the public</small> </div> </md-input-container> <md-input-container flex> <label>subtitle</label> <input type=text ng-model=title.subtitle> </md-input-container> </div>\");\n$templateCache.put(\"app/admin/editors/articles/components/article-author-editor/article-author-editor.html\",\"<div layout=column layout-gt-sm=row layout-align-gt-sm=\\\"start center\\\"> <div layout=row layout-align=\\\"start center\\\" flex-gt-sm> <md-button class=md-icon-button ng-click=\\\"$ctrl.institution = !$ctrl.institution\\\"> <md-icon>{{$ctrl.institution ? \\'person\\' : \\'domain\\'}}</md-icon> </md-button> <div layout=row flex ng-show=$ctrl.institution> <md-input-container class=no-space flex> <label>name</label> <input type=text ng-model=$ctrl.author.name> </md-input-container> </div> <div layout=row flex ng-hide=$ctrl.institution> <md-input-container class=no-space flex> <label>first name</label> <input type=text ng-model=$ctrl.author.firstname> </md-input-container> <md-input-container class=no-space flex> <label>last name</label> <input type=text ng-model=$ctrl.author.lastname> </md-input-container> </div> </div> <div layout=row flex-gt-sm> <md-input-container class=no-space flex> <label>affiliation</label> <input type=text ng-model=$ctrl.author.properties.affiliation> </md-input-container> <md-input-container class=no-space flex> <label>email</label> <input type=text ng-model=$ctrl.author.properties.email> </md-input-container> </div> </div>\");\n$templateCache.put(\"app/admin/editors/articles/components/article-type-search/article-type-search.html\",\"<div layout=column> <div layout=row flex=none> <md-input-container flex> <label>search</label> <md-icon>search</md-icon> <input type=search ng-model=$ctrl.query ng-model-options=\\\"{debounce: 300}\\\" ng-change=$ctrl.search($ctrl.query)> </md-input-container> </div> <md-list layout=column> <md-list-item ng-repeat=\\\"article in $ctrl.results.articles\\\" ui-sref=\\\"article.edit({id: article.id})\\\"> <span class=md-list-item-text>{{article.title}}</span> </md-list-item> </md-list> </div>\");}]);"],"sourceRoot":"/source/"}