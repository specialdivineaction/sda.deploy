{"version":3,"sources":["scripts/app.js"],"names":["angular","module","ArticleTypeSearchController","$log","articlesRepo","search","query","vm","results","type","activate","this","$inject","component","templateUrl","bindings","controller","ArticleAuthorEditorController","author","treeCategorizationEditor","directive","restrict","scope","scopeId","scheme","TreeCategorizationController","controllerAs","$scope","$mdDialog","sdaToast","$state","$q","categorizationService","info","repo","getScopedRepo","overviews","get","handleAssociateEntry","$event","node","linkArticle","article","ref","nodes","link","reference","$promise","openEditor","values","go","id","title","label","create","articlePromise","save","linkPromise","then","all","handleRemoveEntry","handleCreateChild","parent","onCreate","newCategoryDialog","prompt","placeholder","ok","cancel","targetEvent","show","handleDeleteNode","msg","removeCatgorizationDialog","confirm","htmlContent","remove","success","error","ArticleEditorSectionController","createArticle","dialog","textContent","titlePromise","savePromise","ArticleEditorController","$stateParams","footnoteEditDialog","refsRepoFactory","authors","length","push","references","refsRepo","refsPromise","$watch","cleanArticleHandler","$watchCollection","cleanRefsHandler","editFootnote","footnote","newFootnote","copy","newReferences","createRefCollection","promise","ckeditor","footnoteEditor","footnotes","updatedReferences","merge","compact","obj","cleanReferences","cleanFootnotes","refsRepoUrl","getReferencesEndpoint","getRepo","abstractEditor","config","extend","CKEDITOR_CONFIG","removeButtons","join","editor","toolbar","name","items","format_tags","extraPlugins","mathJaxLib","titleEditorDirective","relnEditDialogFactory","showDialog","RelationshipEditDialogController","$filter","worksRepo","relnRepo","types","getTypes","rawTypes","typesP","forEach","identifier","directed","isDirected","reverse","reverseTitle","Object","defineProperty","value","selectWork","proxy","anchors","baseLabel","stripTags","baseToken","token","selectedAnchor","createAnchor","work","getWork","editions","edition","editionLabel","editionName","editionId","volumes","volume","volumeLabel","volumeNumber","volumeId","close","hide","typeId","selectedType","target","description","searchText","selectedWork","factory","RelationshipsController","$timeout","_","relnEditDialog","openRelationship","reln","anchor","state","params","TypeId","WORK","workId","properties","PERSON","ARTICLE","addRelationship","relationship","createRelationship","dialogPromise","relnInfo","targets","related","saveP","loadRelationships","deleteRelationship","confirmPromise","deleteP","newAnchor","loading","relns","typeGroupsP","typeGroups","normalizeRelationships","publicationInfoEditorDirective","pubInfo","copyEditorDirective","CopyEditorController","addHandler","HathiTrustRefHandler","GoogleBooksRefHandler","InternetArchiveRefHandler","handler","refHandlers","parseProperties","url","copyForm","$setValidity","setProperties","handle","parsed","parseUrl","seq","path","substr","pageNo","fragment","match","makePropertiesObject","src","display","hostname","lastIndexOf","urlappend","subquery","parseQueryString","htid","section","printsec","page","pg","parser","document","createElement","href","toString","protocol","host","port","pathname","hash","sep","isString","flags","indexOf","kvpairs","split","pair","ix","key","decodeURIComponent","URIError","hasOwnProperty","isArray","copyEditDialogFactory","locals","CopyEditDialogController","authorRefEditorDirective","AuthorRefEditorController","peopleRepo","authorId","linkAuthorSearchText","setLinkedAuthor","person","getResults","resultSet","authorRoles","workEditorItemDirective","linkFunc","WorkEditorItemController","loaded","workEditorDirective","WorkEditorController","model","focused","createEdition","titles","cloneDeep","deleteEdition","splice","volumeEditorDirective","editionEditorDirective","EditionEditorController","createVolume","publicationInfo","deleteVolume","nameEditorDirective","eventEditDialogFactory","event","EventEditDialogController","eventEditorDirective","ZoteroTestController","item","summaryEditorDirective","toolbarGroups","groups","summary","summaryEditDialogFactory","SummaryEditDialogController","stripTagsFilter","html","String","replace","filter","slideToggle","beforeAddClass","element","className","done","NG_HIDE_CLASS","slideUp","removeClass","slideDown","animation","SeeAlsoEditorController","seeAlsoRepo","trcSearch","createLink","alreadyLinked","clearLinkForm","sourceToken","source","seeAlso","links","openLink","deleteLink","confirmP","combineSearchResults","newToken","some","existing","selectedItem","flatMap","UNIFIED_SEARCH_KEYS","map","SdaToastProvider","SdaToastFactory","$mdToast","showSuccessToast","message","options","opts","toastClass","makeToast","showInfoToast","showErrorToast","hideDelay","provider","defaultOptions","toast","simple","position","action","$get","NavbarController","$mdSidenav","toggleSidenav","toggle","sidenavId","guessDateFactory","moment","guessDate","str","INFER_FORMATS","emptyFilterFactory","isEmpty","dateEditorDirective","calendarAutoSet","dateDescription","date","calendar","format","DataContainerController","watch","fn","unregister","listeners","set","newValue","footnoteEditDialogFactory","$mdBottomSheet","FootnoteEditDialogController","clickOutsideToClose","ckeditorConfig","ckeditorFootnotesDirective","$document","el","attrs","requires","insertFootnoteCommand","fire","FOOTNOTE_COMMAND_NAME","command","createFootnote","backlinkId","anchorIdPrefix","ckeditorBibliography","$eval","ctrl","insertHtml","ckeditorFootnotesAnchorIdPrefix","instance","scopeValueExpr","ckeditorFootnotes","addCommand","async","allowedContent","requiredContent","exec","ui","addButton","require","CitationEditorController","zotero","refsRenderer","account","getUserAccount","ZOTERO_USER_ACCOUNT_ID","ZOTERO_USER_ACCOUNT_API_KEY","groupP","when","getGroup","ZOTERO_GROUP_ID","groupLibraryP","group","getLibrary","citation","Error","citations","warn","library","resultsP","searchItems","adaptedResultsP","adaptItem","wrapItem","zItem","createBiblioItem","creators","adaptCreator","meta","pick","fields","omit","zCreator","role","creatorType","firstName","lastName","labelP","renderBiblioItem","addCitationItem","citationItem","referencedBibItem","bibliography","renderCitationItemLabel","clearForm","selectBiblioItem","itemContainer","activeCitationItem","editCitationItem","biblioItem","biblioItemContainer","selectedBiblioItem","createCitation","renderedP","render","rendered","createZoteroItem","zoteroItem","cancelZoteroItem","saveZoteroItem","zItemP","saveItem","biblioItemP","itemContainerP","locatorTypes","LOCATOR_TYPES","edit","CitationEditDialogFactory","CitationEditDialogController","ckeditorBibliographyDirective","citationEditDialog","insertCitationCommand","CITATION_COMMAND_NAME","newReference","refs","ZoteroEditorController","getItemTypes","typeFilter","field","selectType","itemType","roles","fieldsP","getFields","creatorRolesP","getCreatorRoles","itemTypeSearchText","ZoteroCreatorFieldController","creator","ZoteroFactory","getDefaultBaseUrl","toJson","ShowWorkController","workEditDialog","copyEditDialog","summaryEditDialog","workPromise","bcTitle","getTitle","getWorkLabel","refsEndpointUrl","editBibInfo","updatedWork","saveWork","showSavedToast","editSummary","updatedSummary","editBibliography","addEdition","saveEdition","addCopy","editCopy","copies","updatedCopy","deleteCopy","deleteWork","workLabel","subtitle","confirmDialog","createBookReviewArticle","articleTitleDialog","initialValue","titleP","articleP","createLinked","relationships","createBookReview","workEditDialogFactory","WorkEditDialogController","addAuthor","authorRef","deleteAuthor","addTitle","deleteTitle","ShowVolumeController","volumeEditDialog","extractTitle","workTitle","getEdition","editionPromise","getVolume","volumePromise","getVolumeLabel","preference","biblioObject","updatedVolume","saveVolume","copyToEdition","origCopy","newCopy","volumeEditDialogFactory","VolumeEditDialogController","ShowEditionController","editionEditDialog","getEditionLabel","updatedEdition","addVolume","copyToWork","editionEditDialogFactory","EditionEditDialogController","tasksRepoProvider","tasksRepoFactory","$resource","getAllTasks","taskResource","getTask","taskId","getWorkflow","workflowResource","getItems","stageId","itemResource","stage","start","max","transition","sourceStage","targetStage","result","itemId","comments","resp","TaskController","tasksRepo","tasks","tasksPromise","openMenu","ShowTaskController","task","taskPromise","makeErrorHandler","workflow","workflowPromise","worklistPromise","loadWorklist","focusItem","stopImmediatePropagation","entityId","transitionItem","updatedItem","refreshPromise","fetchStage","worklistPromises","stages","worklists","stageOrder","ShowPersonController","personEditDialog","eventEditDialog","personId","personRefsUrl","editBioInfo","updatedPerson","editEvent","updatedEvent","deletePerson","nameLabel","createBiographyArticle","createBiography","personEditDialogFactory","PersonEditDialogController","addName","createName","altNames","deleteName","nameRoles","MainController","q","searchQuery","peopleResults","worksResults","createPerson","createWork","debounce","$mdThemingProvider","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","runBlock","trcAuth","isAuthenticated","loginGuest","debug","run","routerConfig","$stateProvider","$urlRouterProvider","views","main","otherwise","constant","$logProvider","$httpProvider","worksRepoProvider","peopleRepoProvider","articlesRepoProvider","relnRepoProvider","categorizationServiceProvider","seeAlsoRepoProvider","trcSearchProvider","trcAuthProvider","trcAuthInterceptorProvider","debugEnabled","API_PREFIX","loginUrl","loginGuestUrl","RegExp","interceptors","cslConfig","citeprocProvider","refsRendererProvider","addLocale","filename","localeId","supplier","$http","res","data","addStyle","styleId","typemapUrl","CSL_LOCALES","CSL_STYLES","en-US","mla","chicago","$templateCache","put"],"mappings":"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","file":"scripts/app-1b009551f7.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ckeditor',\n      'ngMaterial',\n      'trcCore',\n      'trcBiblio',\n      'trcTasks',\n      'trcBio',\n      'trcReln',\n      'trcRefs',\n      'trcArticles',\n      'zotero',\n      'accounts'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('articleTypeSearch', {\n      templateUrl: 'app/admin/editors/articles/components/article-type-search/article-type-search.html',\n      bindings: {\n        type: '@'\n      },\n      controller: ArticleTypeSearchController\n    });\n\n  /** @ngInject */\n  function ArticleTypeSearchController($log, articlesRepo) {\n    var vm = this;\n\n    vm.search = search;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    /**\n     * Populates controller search results with the results of the given query for this component's article type\n     *\n     * @param {string} query\n     */\n    function search(query) {\n      vm.results = articlesRepo.search(query, { type: vm.type });\n    }\n\n    // PRIVATE METHODS\n\n    /**\n     * Activator; called when the component has been initialized\n     */\n    function activate() {\n      search('');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('articleAuthorEditor', {\n      templateUrl: 'app/admin/editors/articles/components/article-author-editor/article-author-editor.html',\n      controller: ArticleAuthorEditorController,\n      bindings: {\n        author: '='\n      }\n    });\n\n  /** @ngInject */\n  function ArticleAuthorEditorController() {\n    var vm = this;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    // PRIVATE METHODS\n\n    function activate() {}\n  }\n\n})();\n\n(function () {\n   'use strict';\n\n   angular\n      .module('sdaAdmin')\n      .directive('treeCategorizationEditor', treeCategorizationEditor);\n\n   /** @ngInject */\n   function treeCategorizationEditor() {\n      var directive = {\n         restrict: 'E',\n         templateUrl: 'app/admin/editors/articles/thematic-overview.html',\n         scope: {\n           scopeId: \"@\",\n           scheme: \"@\"\n          //  need param to indicate whether this categorization owns related entrties\n         },\n         controller: TreeCategorizationController,\n         controllerAs: 'vm'\n      };\n\n      return directive;\n   }\n\n   // NOTE this needs to move toward being a more general puropose control\n\n   /** @ngInject */\n   function TreeCategorizationController($scope, $log, $mdDialog, sdaToast, $state, $q,\n     articlesRepo, categorizationService) {\n\n     var vm = this;\n     var repo = null;\n\n     // TODO need to allow actions to be pluggable\n     vm.handleAssociateEntry = handleAssociateEntry;\n     vm.handleRemoveEntry = handleRemoveEntry;\n     vm.handleCreateChild = handleCreateChild;\n     vm.handleDeleteNode = handleDeleteNode;\n\n     activate();\n\n     //'overviews'\n     function activate() {\n       $log.info(\"Loading article editor\", articlesRepo);\n       repo = categorizationService.getScopedRepo($scope.scopeId);\n       // TODO need to handle case when this fails to load. Display throbber pending load\n       vm.overviews = repo.get($scope.scheme);\n     }\n\n     // TODO allow edit labels\n\n     /* ================================\n      * API METHODS\n      * ================================ */\n      function handleAssociateEntry($event, node) {\n        $log.info(\"creating article\");\n        // TODO need to offer option of create or link\n        // TODO magic string\n\n        var type = 'thematic';\n        var title = node.label;\n\n        // TODO  display prompt dialog, allow entry of title, selection of type (but not)\n        // TODO error handling!!\n        var article = articlesRepo.create(type, title);\n        var articlePromise = articlesRepo.save(article);\n        var linkPromise = articlePromise.then(linkArticle);\n\n        $q.all({\n          article: articlePromise,\n          ref: linkPromise\n        }).then(openEditor);\n\n        function linkArticle(article) {\n          var ref = repo.nodes.link(node, article.reference);\n          return ref.$promise;\n        }\n\n        function openEditor(values) {\n          $state.go(\"article.edit\", {\n            id: values.article.id\n          });\n        }\n        // TODO creates article and (once created) associates\n        //      that article with this node in the hierarchy.\n        //      On completion, opens that article in the editor.\n      }\n\n      function handleRemoveEntry($event, node) {\n        $log.info(\"Removing entry\", node);\n\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      If OK, removes the associated entry from this node\n        //      and then deletes the article.\n\n      }\n\n      /**\n       * Handler to be invoked to create a new category with an hierarchical\n       * categorization.\n       *\n       * @param  {event} $event  The event that triggered this request.\n       * @param  {object} parent The parent node on which the child should be created.\n       * @return {[type]}        [description]\n       */\n      function handleCreateChild($event, parent) {\n        $log.info(parent);\n\n        var newCategoryDialog = $mdDialog.prompt({\n          title: \"Enter Category Label\",\n          // TODO add description\n          placeholder: 'new category',\n          ok: \"Create\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(newCategoryDialog)\n                 .then(onCreate);\n\n        function onCreate(label) {\n          $log.info(\"Creating category \" + label);\n\n          repo.nodes.create(parent, label);\n        }\n      }\n\n      function handleDeleteNode($event, node, parent) {\n        $log.info(node);\n\n        var title = \"Delete category '\" + node.label + \"'\";\n        var msg = \"<p>This will delete the selected category, \" + node.label + \", \" +\n                  \"its sub-categories and all associated articles.\" +\n                  \"<em>This action cannot be undone.</em></p>\" +\n                  \"<p>Permanently delete this category?</p>\";\n        var removeCatgorizationDialog = $mdDialog.confirm({\n          title: title,\n          htmlContent: msg,\n          ok: \"Delete\",\n          cancel: \"Cancel\",\n          targetEvent: $event\n        });\n\n        $mdDialog.show(removeCatgorizationDialog).then(function() {\n           // TODO dispaly success/failure toasts\n           repo.nodes.remove(node, true, parent).then(function () {\n             return sdaToast.success('category deleted');\n           }, function () {\n             return sdaToast.error('unable to delete category');\n           });\n         });\n\n\n        function deleteNode() {\n        }\n\n        // TODO Prompts for confirmation to notify user that changes\n        //      cannot be reverted.\n        //      Recursively removes all articles associated with descendants\n        //      Removes this categorization entry (and children)\n      }\n\n      /* ================================\n       * PRIVATE METHODS\n       * ================================ */\n\n       function getChildren(node) {\n         if (node.childIds.length != node.chilren.length) {\n           throw new Error(\"Lazy loading of children not yet supported.\");\n         }\n\n         return $q.when(node.chilren);\n       }\n\n   }\n\n})();\n\n(function () {\n  'use strict';\n\n// TODO admin-page-articles\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorSectionController', ArticleEditorSectionController);\n\n  /** @ngInject */\n  function ArticleEditorSectionController($state, $mdDialog, sdaToast, articlesRepo) {\n    var vm = this;\n\n    vm.createArticle = createArticle;\n\n    activate();\n\n    function activate() {\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n\n    /**\n     * Creates a new article of the given type and opens that article in the editor\n     *\n     * @param {Event} $event\n     * @param {string} type\n     * @return {Promise.<Article>} Resolves after the article has been created and saved on the server\n     */\n    function createArticle($event, type) {\n      var dialog = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Article')\n        .textContent('Please provide a title for the new article.')\n        .placeholder('title')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var titlePromise = $mdDialog.show(dialog);\n\n      titlePromise.then(function (title) {\n        var article = articlesRepo.create(type, title);\n        var savePromise = articlesRepo.save(article);\n\n        savePromise.then(function (article) {\n          $state.go('article.edit', { id: article.id });\n          sdaToast.success('Article created successfully');\n        }, function () {\n          sdaToast.error('Unable to create article');\n        });\n\n        return savePromise;\n      });\n\n    }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ArticleEditorController', ArticleEditorController);\n\n  var CKEDITOR_CONFIG = {\n    /*\n    toolbarGroups: [\n      { name: 'styles', groups: [ 'styles' ] },\n      { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n      { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n      { name: 'colors', groups: [ 'colors' ] },\n      { name: 'links', groups: [ 'links' ] },\n      { name: 'insert', groups: [ 'insert' ] },\n      { name: 'clipboard', groups: [ 'clipboard', 'undo' ] },\n      { name: 'forms', groups: [ 'forms' ] },\n      { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] },\n      { name: 'tools', groups: [ 'tools' ] },\n      { name: 'document', groups: [ 'mode', 'document', 'doctools' ] },\n      { name: 'others', groups: [ 'others' ] },\n    ],\n    */\n\n    toolbar: [\n      { name: 'styles', items: [ 'Styles', 'Format' ] },\n      { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike', '-', 'Subscript', 'Superscript', '-', 'RemoveFormat' ] },\n      { name: 'paragraph', items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote' ] },\n      { name: 'links', items: [ 'Link', 'Unlink', 'Anchor' ] },\n      { name: 'insert', items: [ 'Citation', 'Footnote', '-', 'Image', 'Table', 'HorizontalRule', 'SpecialChar', 'Mathjax' ] },\n      { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ] },\n      { name: 'editing', items: [ 'Scayt' ] },\n      { name: 'tools', items: [ 'Maximize' ] },\n      { name: 'document', items: [ 'Source' ] }\n    ],\n\n    // See http://docs.ckeditor.com/#!/api/CKEDITOR.config-cfg-format_tags\n    format_tags: 'p;h1;h2;h3;h4;h5;h6;pre;address',\n\n    extraPlugins: 'mathjax',\n\n    mathJaxLib: '//cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-MML-AM_CHTML'\n  };\n\n  /** @ngInject */\n  function ArticleEditorController($q, $log, $stateParams, $scope, footnoteEditDialog, sdaToast, articlesRepo, refsRepoFactory) {\n    var refsRepoUrl = articlesRepo.getReferencesEndpoint($stateParams.id);\n    var refsRepo = refsRepoFactory.getRepo(refsRepoUrl);\n\n    var vm = this;\n\n    vm.save = save;\n\n    vm.abstractEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'HorizontalRule',\n          'Maximize',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.footnoteEditor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Format',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Footnote',\n          'HorizontalRule',\n          'Maximize',\n          'Source',\n        ].join(',')\n      })\n    };\n\n    vm.editor = {\n      config: angular.extend({}, CKEDITOR_CONFIG, {\n        removeButtons: [\n          'Styles',\n          'Subscript',\n          'Superscript',\n          'Cut',\n          'Copy',\n          'Source'\n        ].join(',')\n      })\n    };\n\n    vm.editFootnote = editFootnote;\n\n    activate();\n\n    function activate() {\n      $log.info(\"Loading article editor\", articlesRepo)\n\n      vm.article = articlesRepo.get($stateParams.id);\n      var articlePromise = vm.article.$promise;\n      articlePromise.then(function (article) {\n        // ensure article has at least 1 author\n        if (article.authors.length === 0) {\n          article.authors.push({});\n        }\n      });\n\n      vm.references = refsRepo.get();\n      var refsPromise = vm.references.$promise;\n\n      $q.all([articlePromise, refsPromise]).then(function () {\n        // start watching for opportunities to remove unused citations and footnotes\n        $scope.$watch('vm.article.body', cleanArticleHandler);\n        $scope.$watchCollection('vm.article.footnotes', cleanRefsHandler);\n      }, function () {\n        return sdaToast.error('Failed to load data from the server');\n      });\n\n      /* initialization logic here */\n    }\n\n    /* ================================\n     * API METHODS\n     * ================================ */\n     function save() {\n       return $q.all([\n         articlesRepo.save(vm.article),\n         refsRepo.save(vm.references)\n       ]).then(function () {\n         sdaToast.success('Saved');\n       }, function () {\n         sdaToast.error('Unable to save article.');\n       });\n     }\n\n     /**\n      * Displays a bottom sheet to edit an existing footnote.\n      * Delegates to the edit dialog in ckeditor-footnotes component, which should probably be refactored elsewhere.\n      * @param  {MouseEvent} $event\n      * @param  {Footnote} footnote\n      */\n     function editFootnote($event, footnote) {\n       var newFootnote = angular.copy(footnote);\n       var newReferences = refsRepoFactory.createRefCollection();\n\n       var promise = footnoteEditDialog.show($event, newFootnote, {\n         references: newReferences,\n         ckeditor: vm.footnoteEditor\n       });\n\n       promise.then(function () {\n         vm.article.footnotes[newFootnote.id] = newFootnote;\n\n         // update bibliography\n         var updatedReferences = refsRepoFactory.merge(vm.references, refsRepoFactory.compact(newReferences));\n         angular.merge(vm.references, updatedReferences);\n       });\n     }\n\n    /* ================================\n     * PRIVATE METHODS\n     * ================================ */\n\n     function cleanRefsHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanReferences(vm.article, vm.references);\n       vm.references = refsRepo.compact(vm.references);\n     }\n\n     function cleanArticleHandler(obj) {\n       if (!obj) {\n         return;\n       }\n\n       articlesRepo.cleanFootnotes(vm.article, vm.article.footnotes);\n       cleanRefsHandler(obj);\n     }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('titleEditor', titleEditorDirective);\n\n  /** @ngInject */\n  function titleEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/title-editor/title-editor.html',\n      scope: {\n        title: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('relnEditDialog', relnEditDialogFactory);\n\n  /** @ngInject */\n  function relnEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event) {\n\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/reln-edit-dialog/reln-edit-dialog.html',\n        controller: RelationshipEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n\n    }\n  }\n\n  /** @ngInject */\n  function RelationshipEditDialogController($filter, $mdDialog, worksRepo, relnRepo) {\n    var stripTags = $filter('stripTags');\n    var vm = this;\n\n    vm.description = null;\n\n    vm.types = null;\n    vm.selectedType = null;\n\n    vm.searchText = null;\n    vm.selectedWork = null;\n\n    vm.anchors = null;\n    vm.selectedAnchor = null;\n\n    vm.search = search;\n    vm.selectWork = selectWork;\n    vm.close = close;\n    vm.cancel = cancel;\n\n    activate();\n\n    function activate() {\n      vm.types = getTypes();\n    }\n\n    function getTypes() {\n      var rawTypes = relnRepo.getTypes();\n      var types = [];\n\n      var typesP = rawTypes.$promise.then(function () {\n        angular.forEach(rawTypes, function (type) {\n          types.push({\n            id: type.identifier,\n            label: type.title,\n            directed: type.isDirected,\n            reverse: false\n          });\n\n          if (type.isDirected) {\n            types.push({\n              id: type.identifier,\n              label: type.reverseTitle,\n              directed: type.isDirected,\n              reverse: true\n            });\n          }\n        });\n\n        return types;\n      });\n\n\n      Object.defineProperty(types, '$promise', {\n        value: typesP\n      });\n\n      return types;\n    }\n\n    function search(query) {\n      var results = worksRepo.search(query);\n      return results.$promise.then(function () {\n        return results.items;\n      });\n    }\n\n    function selectWork(proxy) {\n      vm.anchors = [];\n\n      if (!proxy) {\n        return;\n      }\n\n      var baseLabel = stripTags(proxy.label);\n      var baseToken = proxy.ref.token;\n\n      // create default anchor for top-level work\n      vm.selectedAnchor = relnRepo.createAnchor(baseLabel, baseToken);\n      vm.anchors.push(vm.selectedAnchor);\n\n      var work = worksRepo.getWork(proxy.id);\n      work.$promise.then(function () {\n        work.editions.forEach(function (edition) {\n          // create anchor for each edition\n          var editionLabel = baseLabel + '. ' + edition.editionName;\n          vm.anchors.push(relnRepo.createAnchor(editionLabel, baseToken, {\n            editionId: [edition.id]\n          }));\n\n          edition.volumes.forEach(function (volume) {\n            // create anchor for each volume\n            var volumeLabel = editionLabel + '. Volume ' + volume.volumeNumber;\n            vm.anchors.push(relnRepo.createAnchor(volumeLabel, baseToken, {\n              editionId: [edition.id],\n              volumeId: [volume.id]\n            }));\n          });\n        });\n      });\n    }\n\n    function close() {\n      $mdDialog.hide({\n        typeId: vm.selectedType.id,\n        directed: vm.selectedType.directed,\n        reverse: vm.selectedType.reverse,\n        target: vm.selectedAnchor,\n        description: vm.description\n      });\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('relationships', {\n      templateUrl: 'app/work/components/relationships/relationships.html',\n      bindings: {\n        anchor: '<'\n      },\n      controller: RelationshipsController\n    });\n\n  // emulation of an enum\n  // HACK: this code is copied from the see-also-editor component\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n\n  /** @ngInject */\n  function RelationshipsController($scope, $state, $timeout, $mdDialog, sdaToast, _, relnRepo, relnEditDialog) {\n    var vm = this;\n\n    vm.typeGroups = null;\n\n    vm.openRelationship = openRelationship;\n    vm.addRelationship = addRelationship;\n    vm.deleteRelationship = deleteRelationship;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    function openRelationship($event, reln) {\n      // HACK: only using first anchor\n      var anchor = reln.anchors[0];\n\n      var state = null;\n      var params = {};\n\n      switch(anchor.ref.type) {\n        case TypeId.WORK:\n          state = 'editor.work';\n          params.workId = anchor.ref.id;\n\n          if (anchor.properties.editionId) {\n            state = 'editor.edition';\n            params.editionId = anchor.properties.editionId;\n          }\n\n          if (anchor.properties.editionId && anchor.properties.volumeId) {\n            state = 'editor.volume';\n            params.volumeId = anchor.properties.volumeId;\n          }\n\n          break;\n        case TypeId.PERSON:\n          state = 'editor.person';\n          params.id = anchor.ref.id;\n          break;\n        case TypeId.ARTICLE:\n          state = 'article.edit';\n          params.id = anchor.ref.id;\n          break;\n        default:\n          break;\n      }\n\n      if (!state) {\n        sdaToast.error('I don\\'t know how to follow that link.');\n      } else {\n        $state.go(state, params);\n      }\n    }\n\n    function addRelationship($event) {\n      var relationship = relnRepo.createRelationship();\n\n      var dialogPromise = relnEditDialog.show($event);\n      dialogPromise.then(function (relnInfo) {\n        relationship.typeId = relnInfo.typeId;\n        relationship.description = relnInfo.description;\n\n        /*\n        determine fields in which to place anchors...\n\n        directed | reverse || destination for self anchor | destination for selected anchor\n        ---------|---------||-----------------------------|--------------------------------\n        NO       | *       || \"related\"                   | \"related\"\n        YES      | YES     || \"targets\"                   | \"related\"\n        YES      | NO      || \"related\"                   | \"targets\"\n         */\n        if (!relnInfo.directed) {\n          relationship.related.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else if (relnInfo.reverse) {\n          relationship.targets.push(vm.anchor);\n          relationship.related.push(relnInfo.target);\n        } else {\n          relationship.related.push(vm.anchor);\n          relationship.targets.push(relnInfo.target);\n        }\n\n        var saveP = relnRepo.save(relationship);\n        saveP.then(function () {\n          sdaToast.success('Saved.');\n          // HACK give relationship a chance to save on the server\n          $timeout(loadRelationships, 1000);\n        }, function () {\n          sdaToast.error('Unable to save relationship');\n        });\n      });\n\n    }\n\n    function deleteRelationship($event, reln) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this relationship?')\n        .ok('Yes')\n        .cancel('No');\n\n      var confirmPromise = $mdDialog.show(confirm);\n      confirmPromise.then(function () {\n        var deleteP = relnRepo.delete(reln.id);\n\n        deleteP.then(function () {\n          sdaToast.success('Relationship deleted.');\n          // HACK give relationship a chance to be deleted from the server\n          $timeout(loadRelationships, 1000);\n        }, function () {\n          sdaToast.error('Unable to delete relationship');\n        });\n      });\n    }\n\n    // PRIVATE METHODS\n\n    function activate() {\n      $scope.$watch('$ctrl.anchor', function (newAnchor) {\n        if (!newAnchor) {\n          return;\n        }\n\n        loadRelationships();\n      });\n    }\n\n    /**\n     * Loads relationships from the repository using the currently bound anchor.\n     * @return {Promise.<TypeGroup[]>}\n     */\n    function loadRelationships() {\n      vm.loading = true;\n      var relns = relnRepo.search(vm.anchor.ref, vm.anchor.properties);\n\n      var typeGroupsP = relns.$promise.then(function () {\n        vm.typeGroups = relnRepo.normalizeRelationships(relns, vm.anchor.ref);\n        return vm.typeGroups.$promise;\n      })\n\n      typeGroupsP.catch(function () {\n        sdaToast.error('Unable to load relationship data from the server');\n      }).then(function () {\n        vm.loading = false;\n      });\n\n\n      return typeGroupsP;\n    }\n  }\n\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('publicationInfoEditor', publicationInfoEditorDirective);\n\n  /** @ngInject */\n  function publicationInfoEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/publication-info-editor/publication-info-editor.html',\n      scope: {\n        pubInfo: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('copyEditor', copyEditorDirective);\n\n  /** @ngInject */\n  function copyEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/copy-editor/copy-editor.html',\n      scope: {\n        copy: '=ngModel'\n      },\n      controller: CopyEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n  }\n\n  /** @ngInject */\n  function CopyEditorController($scope) {\n    var vm = this;\n\n    vm.refHandlers = {};\n    vm.setProperties = parseProperties;\n\n    activate();\n\n    function activate() {\n      addHandler(HathiTrustRefHandler());\n      addHandler(GoogleBooksRefHandler());\n      addHandler(InternetArchiveRefHandler());\n    }\n\n    function addHandler(handler) {\n      vm.refHandlers[handler.id] = handler;\n    }\n\n    function parseProperties(type, url) {\n      if (vm.refHandlers[type]) {\n        $scope.copy.properties = vm.refHandlers[type](url);\n      }\n\n      $scope.copyForm.url.$setValidity(type, $scope.copy.properties != null);\n    }\n  }\n\n  // https://archive.org/details/essayinanswertom00adamiala\n  // <iframe src='https://archive.org/stream/essayinanswertom00adamiala?ui=embed#page/n7/mode/1up' width='480px' height='430px' frameborder='0' ></iframe>\n  // TODO add support for resources from OpenLibrary\n  // https://openlibrary.org/books/OL7186607M/An_essay_in_answer_to_Mr._Hume's_Essay_on_miracles.\n\n  /**\n   * A reference parse handler to support digital copies from the Internet\n   * Archive.\n   */\n  function InternetArchiveRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      if (parsed.path.substr(0, 8) === '/stream/') {\n        id = parsed.path.substr(8);\n\n        var pageNo = parsed.fragment.match(/page\\/([^\\/]+)/);\n        if (pageNo && pageNo.length >= 2) {\n          seq = pageNo[1];\n        }\n      }\n\n      return makePropertiesObject(url, id, seq);\n    }\n\n    handle.id = 'internetarchive';\n    handle.display = 'Internet Archive';\n\n    /**\n     * Constructs an object literal that represents the stored-properties\n     * to associate with an InternetArchive digital copy.\n     *\n     * @param  {string} src The source URL from which the properties were parsed.\n     * @param  {string} id  The identifier used to uniquely reference a\n     *                      particular digial copy at the Internet Archive.\n     * @param  {string} seq The sequence number that identifies the page to be\n     *                      used as the initial page of this digital copy.\n     * @return {object}     The object literal of properties to be associated\n     *                      with this digital copy.\n     */\n    function makePropertiesObject(src, id, seq) {\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: src,\n        id: id,\n        seq: seq\n      };\n    }\n\n    return handle;\n  }\n\n  function HathiTrustRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      var id, seq;\n\n      switch (parsed.hostname) {\n        case 'babel.hathitrust.org':\n          id = parsed.query.id;\n          seq = parsed.query.seq;\n          break;\n\n        case 'hdl.handle.net':\n          id = parsed.path.substr(parsed.path.lastIndexOf('/') + 1);\n\n          if (!parsed.query.urlappend) {\n            break;\n          }\n\n          var subquery = parseQueryString(parsed.query.urlappend);\n          if (!subquery) {\n            break;\n          }\n          seq = subquery.seq;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        htid: id,\n        seq: seq\n      };\n    }\n\n    handle.id = 'hathitrust';\n    handle.display = 'HathiTrust';\n\n    return handle;\n  }\n\n  function GoogleBooksRefHandler() {\n    function handle(url) {\n      var parsed = parseUrl(url);\n      if (!parsed) {\n        return null;\n      }\n\n      switch (parsed.hostname) {\n        case 'books.google.com':\n          var id = parsed.query.id;\n          var section = parsed.query.printsec;\n          var page = parsed.query.pg;\n          break;\n      }\n\n      if (!id) {\n        return null;\n      }\n\n      return {\n        src: url,\n        id: id,\n        section: section,\n        page: page\n      };\n    }\n\n    handle.id = 'googlebooks';\n    handle.display = 'Google Books';\n\n    return handle;\n  }\n\n  /**\n   * Parses a URL string into its components\n   *\n   * @param  {string} url\n   * @return {URL}\n   */\n  function parseUrl(url) {\n    if (!url) {\n      return null;\n    }\n\n    // eslint-disable-next-line angular/document-service\n    var parser = document.createElement('a');\n    parser.href = url;\n\n    return {\n      toString: function() {\n        return url;\n      },\n      protocol: parser.protocol,\n      host: parser.host,\n      hostname: parser.hostname,\n      port: parser.port,\n      path: parser.pathname,\n      query: parseQueryString(parser.search),\n      fragment: parser.hash\n    };\n  }\n\n  /**\n   * Parses a query string into key/value pairs\n   *\n   * @param {string} query\n   * @return {object.<string,any>}\n   */\n  function parseQueryString(query, sep) {\n    if (!query || !angular.isString(query)) {\n      return {};\n    }\n\n    // remove leading '?'\n    if (query[0] === '?') {\n      query = query.substr(1);\n    }\n\n    // attempt to auto-detect separator\n    if (!sep) {\n      // auto-detection \"bitmask\"\n      // 0 = none detected -- prefer '&'\n      // 1 = only ';' detected -- use it\n      // 2 = only '&' detected -- use it\n      // 3 = both detected -- prefer '&'\n      var flags = (query.indexOf(';') >= 0 ? 1 : 0) + (query.indexOf('&') >= 0 ? 2 : 0);\n      sep = flags === 1 ? ';' : '&';\n    }\n\n    var parsed = {};\n\n    var kvpairs = query.split(sep);\n    kvpairs.forEach(function (pair) {\n      var ix = pair.indexOf('=');\n      var key = pair;\n      var value = null;\n\n      if (!key) {\n        return;\n      }\n\n      if (ix >= 0) {\n        key = pair.substr(0, ix);\n        value = pair.substr(ix + 1);\n      }\n\n      try {\n        key = decodeURIComponent(key);\n        value = decodeURIComponent(value);\n      } catch (URIError) {\n        return;\n      }\n\n      // TODO: handle key array/map notation\n\n      if (parsed.hasOwnProperty(key)) {\n        // convert repeated keys into an array\n        if (angular.isArray(parsed[key])) {\n          parsed[key].push(value);\n        } else {\n          parsed[key] = [parsed[key], value];\n        }\n      } else {\n        parsed[key] = value;\n      }\n    });\n\n    return parsed;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('copyEditDialog', copyEditDialogFactory);\n\n  /** @ngInject */\n  function copyEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, copy) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/components/copy-edit-dialog/copy-edit-dialog.html',\n        locals: {\n          copy: copy\n        },\n        controller: CopyEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function CopyEditDialogController($mdDialog, copy) {\n    var vm = this;\n\n    vm.copy = copy;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.copy);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('authorRefEditor', authorRefEditorDirective);\n\n  /** @ngInject */\n  function authorRefEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/author-ref-editor/author-ref-editor.html',\n      scope: {\n        ref: '=ngModel'\n      },\n      controller: AuthorRefEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function AuthorRefEditorController($scope, peopleRepo) {\n      var vm = this;\n\n      vm.linkAuthorSearchText = '';\n      vm.authorRoles = [\n        'author',\n        'editor',\n        'translator',\n        'other'\n      ];\n\n      vm.setLinkedAuthor = setLinkedAuthor;\n      vm.getResults = getResults;\n\n      activate();\n\n      function activate() {\n        if ($scope.ref.authorId) {\n          var author = peopleRepo.get($scope.ref.authorId);\n          author.$promise.then(function () {\n            vm.linkAuthorSearchText = author.name.label;\n          })\n        }\n      }\n\n      function setLinkedAuthor(person) {\n        $scope.ref.authorId = person.id;\n      }\n\n      function getResults(query) {\n        var resultSet = peopleRepo.search(query);\n        return resultSet.$promise.then(function () {\n          return resultSet.items;\n        });\n      }\n\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditorItem', workEditorItemDirective);\n\n  /** @ngInject */\n  function workEditorItemDirective($log) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/task/components/work-editor-item/work-editor-item.html',\n      link: linkFunc,\n      scope: {\n        id: '=id'\n      },\n      controller: WorkEditorItemController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    function linkFunc($scope) {\n      if (!$scope.id) {\n        $log.error('missing required attribute \"id\"');\n      }\n    }\n\n    /** @ngInject */\n    function WorkEditorItemController($scope, worksRepo) {\n      var vm = this;\n\n      vm.loaded = false;\n\n      activate();\n\n      function activate() {\n        if ($scope.id) {\n          vm.work = worksRepo.getWork($scope.id);\n          vm.work.$promise.then(function () {\n            vm.loaded = true;\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('workEditor', workEditorDirective);\n\n  /** @ngInject */\n  function workEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/work-editor/work-editor.html',\n      scope: {\n        work: '=ngModel'\n      },\n      controller: WorkEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function WorkEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.editions = [];\n\n      vm.createEdition = createEdition;\n      vm.deleteEdition = deleteEdition;\n\n      activate();\n\n      function activate() {\n        $scope.work.editions.forEach(function (edition) {\n          vm.editions.push({\n            model: edition,\n            focused: false\n          });\n        });\n      }\n\n      function createEdition() {\n        var edition = worksRepo.createEdition();\n        edition.titles = _.cloneDeep($scope.work.titles);\n        edition.authors = _.cloneDeep($scope.work.authors);\n\n        $scope.work.editions.push(edition);\n        vm.editions.push({\n          model: edition,\n          focused: true\n        });\n      }\n\n      function deleteEdition(ix) {\n        vm.editions.splice(ix, 1);\n        $scope.work.editions.splice(ix, 1);\n      }\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('volumeEditor', volumeEditorDirective);\n\n  /** @ngInject */\n  function volumeEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/volume-editor/volume-editor.html',\n      scope: {\n        volume: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('editionEditor', editionEditorDirective);\n\n  /** @ngInject */\n  function editionEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/work/components/edition-editor/edition-editor.html',\n      scope: {\n        edition: '=ngModel'\n      },\n      controller: EditionEditorController,\n      controllerAs: 'vm'\n    };\n\n    return directive;\n\n    /** @ngInject */\n    function EditionEditorController($scope, worksRepo, _) {\n      var vm = this;\n\n      vm.volumes = [];\n\n      vm.createVolume = createVolume;\n      vm.deleteVolume = deleteVolume;\n\n      activate();\n\n      function activate() {\n        $scope.edition.volumes.forEach(function (volume) {\n          vm.volumes.push({\n            model: volume,\n            focused: false\n          });\n        });\n      }\n\n      function createVolume() {\n        var volume = worksRepo.createVolume();\n        volume.titles = _.cloneDeep($scope.edition.titles);\n        volume.authors = _.cloneDeep($scope.edition.authors);\n        volume.publicationInfo = _.cloneDeep($scope.edition.publicationInfo);\n\n        $scope.edition.volumes.push(volume);\n        vm.volumes.push({\n          model: volume,\n          focused: true\n        });\n      }\n\n      function deleteVolume(ix) {\n        vm.volumes.splice(ix, 1);\n        $scope.edition.volumes.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('nameEditor', nameEditorDirective);\n\n  /** @ngInject */\n  function nameEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/name-editor/name-editor.html',\n      scope: {\n        name: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('eventEditDialog', eventEditDialogFactory);\n\n  /** @ngInject */\n  function eventEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, event) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/components/event-edit-dialog/event-edit-dialog.html',\n        locals: {\n          event: event\n        },\n        controller: EventEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EventEditDialogController($mdDialog, event) {\n    var vm = this;\n\n    vm.event = event;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.event);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('eventEditor', eventEditorDirective);\n\n  /** @ngInject */\n  function eventEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/person/components/event-editor/event-editor.html',\n      scope: {\n        event: '=ngModel'\n      }\n    };\n\n    return directive;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero', [\n      'ngAnimate',\n      'ngAria',\n      'ngMaterial',\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .controller('ZoteroTestController', ZoteroTestController);\n\n  /** @ngInject */\n  function ZoteroTestController() {\n    var vm = this;\n\n    vm.item = {};\n\n    vm.types = [];\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('summaryEditor', summaryEditorDirective);\n\n  /** @ngInject */\n  function summaryEditorDirective() {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/summary-editor/summary-editor.html',\n      scope: {\n        summary: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      scope.config = {\n        // FIXME set up minimal toolbar and restrict HTML content\n        toolbarGroups: [\n          { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ] },\n          { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi', 'paragraph' ] },\n          { name: 'links', groups: [ 'links' ] },\n          { name: 'editing', groups: [ 'find', 'selection', 'spellchecker', 'editing' ] }\n        ],\n\n        removeButtons: 'Subscript,Superscript,About,Cut,Copy,Maximize,Styles'\n      };\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('summaryEditDialog', summaryEditDialogFactory);\n\n  /** @ngInject */\n  function summaryEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, summary) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/components/summary-edit-dialog/summary-edit-dialog.html',\n        locals: {\n          summary: summary\n        },\n        controller: SummaryEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function SummaryEditDialogController($mdDialog, summary) {\n    var vm = this;\n\n    vm.summary = summary;\n\n    vm.close = close;\n    vm.cancel = cancel;\n\n    function close() {\n      $mdDialog.hide(vm.summary);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('stripTags', stripTagsFilter);\n\n  function stripTagsFilter() {\n    return stripTags;\n  }\n\n  function stripTags(html) {\n    return html ? String(html).replace(/<[^>]+>/gm, '') : '';\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .animation('.slide', slideToggle);\n\n  function slideToggle() {\n    var NG_HIDE_CLASS = 'ng-hide';\n\n    return {\n      beforeAddClass: beforeAddClass,\n      removeClass: removeClass\n    };\n\n    function beforeAddClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.slideUp(done);\n      }\n    }\n\n    function removeClass(element, className, done) {\n      if (className === NG_HIDE_CLASS) {\n        element.hide().slideDown(done);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('seeAlsoEditor', {\n      templateUrl: 'app/components/see-also-editor/see-also-editor.html',\n      bindings: {\n        sourceToken: '<'\n      },\n      controller: SeeAlsoEditorController\n    });\n\n  // emulation of an enum\n  var TypeId = {\n    WORK: 'trc.entries.bibliographic',\n    PERSON: 'trc.entries.biographical',\n    ARTICLE: 'trc.entries.article'\n  };\n\n  var UNIFIED_SEARCH_KEYS = ['people', 'works', 'articles'];\n\n  /** @ngInject */\n  function SeeAlsoEditorController($scope, $state, $mdDialog, sdaToast, _, seeAlsoRepo, trcSearch) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.seeAlso = null;\n\n    vm.searchText = null;\n    vm.selectedItem = null;\n\n    vm.createLink = createLink;\n    vm.openLink = openLink;\n    vm.deleteLink = deleteLink;\n    vm.search = search;\n\n    activate();\n\n    // PUBLIC METHODS\n\n    /**\n     * Creates a new see-also link with the current token as the source\n     * and the given anchor as the target.\n     * @param {Anchor} anchor\n     */\n    function createLink(anchor) {\n      if (!anchor) {\n        return;\n      }\n\n      if (alreadyLinked(anchor)) {\n        sdaToast.info('Item has already been linked.');\n        clearLinkForm();\n        return;\n      }\n\n      var link = seeAlsoRepo.create(vm.sourceToken, anchor.token);\n\n      link.$promise.then(function () {\n        // HACK: link to target comes back as source field\n        var anchor = link.source;\n        if (!vm.seeAlso.links.hasOwnProperty(anchor.type)) {\n          vm.seeAlso.links[anchor.type] = [];\n        }\n\n        vm.seeAlso.links[anchor.type].push(anchor);\n\n        clearLinkForm();\n\n        sdaToast.success('Link created');\n      }, function () {\n        sdaToast.error('Unable to create link');\n      });\n    }\n\n    /**\n     * Redirects the browser to the editor page for the item referenced by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function openLink($event, anchor) {\n      switch(anchor.type) {\n        case TypeId.WORK:\n          $state.go('editor.work', { workId: anchor.id });\n          break;\n        case TypeId.PERSON:\n          $state.go('editor.person', { id: anchor.id });\n          break;\n        case TypeId.ARTICLE:\n          $state.go('article.edit', { id: anchor.id });\n          break;\n        default:\n          sdaToast.error('I don\\'t know how to follow that link.');\n          break;\n      }\n    }\n\n    /**\n     * Reoves the see-also link targeted by the given anchor.\n     * @param {MouseEvent} $event\n     * @param {Anchor} anchor\n     */\n    function deleteLink($event, anchor) {\n      var dialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        htmlContent: 'Are you sure you want to delete this link?' + anchor.label,\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmP = $mdDialog.show(dialog);\n\n      confirmP.then(function () {\n        var deleteP = seeAlsoRepo.delete(vm.sourceToken, anchor.token);\n\n        deleteP.then(function () {\n          sdaToast.success('Link deleted');\n          var ix = vm.seeAlso.links[anchor.type].indexOf(anchor);\n          if (ix >= 0) {\n            vm.seeAlso.links[anchor.type].splice(ix, 1);\n          }\n        }, function () {\n          sdaToast.error('Unable to delete link');\n        })\n      });\n    }\n\n    /**\n     * Searches all entries matching the provided query.\n     * @param  {string} query\n     * @return {Promise.<Anchor[]>}\n     */\n    function search(query) {\n      var results = trcSearch.search(query);\n      return results.$promise.then(combineSearchResults, function () {\n        sdaToast.error('Unable to load search results');\n      });\n    }\n\n    // PRIVATE METHODS\n\n    /**\n     * Initializes controller state\n     */\n    function activate() {\n      $scope.$watch('$ctrl.sourceToken', function (newToken) {\n        if (!newToken) {\n          return;\n        }\n\n        vm.loading = true;\n        vm.seeAlso = seeAlsoRepo.get(newToken);\n        vm.seeAlso.$promise.then(function () {\n          vm.loading = false;\n        });\n      });\n    }\n\n    /**\n     * Determines whether the proided anchor has already been linked with the current token.\n     * @param {Anchor} anchor\n     * @return {boolean}\n     */\n    function alreadyLinked(anchor) {\n      return vm.seeAlso.links.hasOwnProperty(anchor.type) && vm.seeAlso.links[anchor.type].some(function (existing) {\n        return existing.token === anchor.token;\n      });\n    }\n\n    /**\n     * Clears the new link input form.\n     */\n    function clearLinkForm() {\n      vm.searchText = null;\n      vm.selectedItem = null;\n    }\n\n    /**\n     * Combines unified search results into a homogeneous list of anchors.\n     * @param {UnifiedSearchResult} results\n     * @return {Anchor[]}\n     */\n    function combineSearchResults(results) {\n      return _.flatMap(UNIFIED_SEARCH_KEYS, function (key) {\n        return results.results[key].map(function (item) {\n          return {\n            label: item.label || item.title,  // article search results don't have a 'label' attribute\n            type: item.ref.type,\n            token: item.ref.token\n          };\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .provider('sdaToast', SdaToastProvider);\n\n  // TODO: this service appears to accomplish the same goal as $mdToast.addPreset\n  //       perhaps this service should be replaced with custom $mdToast presets\n\n  function SdaToastProvider() {\n    var provider = {};\n\n    provider.defaultOptions = {\n      position: 'bottom right',\n      hideDelay: 3000\n    };\n\n    provider.$get = SdaToastFactory\n\n    return provider;\n\n    /** @ngInject */\n    function SdaToastFactory($mdToast) {\n      var sdaToast = {\n        success: showSuccessToast,\n        info: showInfoToast,\n        error: showErrorToast\n      }\n\n      return sdaToast;\n\n      function showSuccessToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-success' + (options && options.toastClass ? ' ' + options.toastClass : '')\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function showInfoToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-info' + (options && options.toastClass ? ' ' + options.toastClass : '')\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function showErrorToast(message, options) {\n        var opts = angular.merge({}, options, {\n          toastClass: 'sda-toast-error' + (options && options.toastClass ? ' ' + options.toastClass : ''),\n          hideDelay: false\n        });\n\n        return $mdToast.show(makeToast(message, opts));\n      }\n\n      function makeToast(message, options) {\n        var opts = angular.merge({}, provider.defaultOptions, options);\n\n        var toast = $mdToast.simple()\n          .textContent(message)\n          .toastClass(opts.toastClass)\n          .position(opts.position)\n          .hideDelay(opts.hideDelay);\n\n        if (!opts.hideDelay || opts.action) {\n          toast.action(opts.action || 'Dismiss')\n        }\n\n        return toast;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .component('navbar', {\n      templateUrl: 'app/components/navbar/navbar.html',\n      bindings: {\n        title: '@',\n        sidenavId: '@?'\n      },\n      controller: NavbarController\n    });\n\n  /** @ngInject */\n  function NavbarController($mdSidenav) {\n    var vm = this;\n\n    vm.toggleSidenav = toggleSidenav;\n\n    activate();\n\n    function activate() {\n\n    }\n\n    function toggleSidenav(id) {\n      $mdSidenav(id).toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  /**\n  * Formats ranked by precedence to check for when parsing date strings.\n  *\n  * NOTE: dashes can be any number of non-alphanumeric characters, so 'DD-MM-YYYY' parses\n  *       '02/02/2015', '02.02.2015', '02:02,2015', and '02*#!02   ^^^2015' into '02-02-2015'\n  *\n  * @type {Array}\n  */\n  var INFER_FORMATS = [\n    // year\n    'YYYY',             // e.g. 2015\n\n    // month year\n    'MMMM-YYYY',        // e.g. February 2015\n    'MMM-YYYY',         // e.g. Feb. 2015\n    'MM-YYYY',          // e.g. 02/2015\n    'M-YYYY',           // e.g. 2/2015\n\n    // year month\n    'YYYY-MMMM',        // e.g. 2015 February\n    'YYYY-MMM',         // e.g. 2015 Feb.\n    'YYYY-MM',          // e.g. 2015-02\n    'YYYY-M',           // e.g. 2015-2\n\n    // month day year\n    'MMMM-DD-YYYY',     // e.g. February 02, 2015\n    'MMM-DD-YYYY',      // e.g. Feb. 02, 2015\n    'MM-DD-YYYY',       // e.g. 02/02/2015\n    'M-DD-YYYY',        // e.g. 2/02/2015\n    'MMMM-D-YYYY',      // e.g. February 2, 2015\n    'MMM-D-YYYY',       // e.g. Feb. 2, 2015\n    'MM-D-YYYY',        // e.g. 02-2-2015\n    'M-D-YYYY',         // e.g. 2/2/2015\n\n    // day month year\n    'DD-MMMM-YYYY',     // e.g. 02 February 2015\n    'DD-MMM-YYYY',      // e.g. 02 Feb. 2015\n    'DD-MM-YYYY',       // e.g. 02/02/2015\n    'DD-M-YYYY',        // e.g. 02/2/2015\n    'D-MMMM-YYYY',      // e.g. 2 February 2015\n    'D-MMM-YYYY',       // e.g. 2 Feb. 2015\n    'D-MM-YYYY',        // e.g. 2/02/2015\n    'D-M-YYYY',         // e.g. 2/2/2015\n\n    // year month day\n    'YYYY-MM-DD',       // e.g. 2015-02-02\n    'YYYY-M-D'          // e.g. 2015-2-2\n  ];\n\n  angular\n    .module('sdaAdmin')\n    .factory('guessDate', guessDateFactory);\n\n  /** @ngInject */\n  function guessDateFactory(moment) {\n    return guessDate;\n\n    /**\n     * Parse a date string into a Moment.\n     *\n     * See moment.js\n     *\n     * @param  {string} str Date string to parse\n     * @return {Moment}     Parsed moment\n     */\n    function guessDate(str) {\n        return moment(str, INFER_FORMATS);\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .filter('empty', emptyFilterFactory);\n\n  /** @ngInject */\n  function emptyFilterFactory(_) {\n    return _.isEmpty;\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('dateEditor', dateEditorDirective);\n\n  /** @ngInject */\n  function dateEditorDirective(guessDate) {\n    var directive = {\n      restrict: 'E',\n      templateUrl: 'app/components/date-editor/date-editor.html',\n      scope: {\n        date: '=ngModel'\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope) {\n      // indicates whether the current value in the date.calendar field was automatically set\n      scope.calendarAutoSet = false;\n\n      scope.$watch('date.description', function (dateDescription) {\n        if (dateDescription && (!scope.date.calendar || scope.calendarAutoSet)) {\n          scope.date.calendar = guessDate(dateDescription).format('YYYY-MM-DD');\n          scope.calendarAutoSet = true;\n        }\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('DataContainerController', DataContainerController);\n\n\n  /** @ngInject */\n  function DataContainerController() {\n    var vm = this;\n    var listeners = [];\n\n    vm.watch = watch;\n    vm.set = set;\n    vm.value = null;\n\n    /**\n     * Attach a listener to watch for value changes\n     * @param  {Function} fn listener callback\n     * @return {Function} unregister function\n     */\n    function watch(fn) {\n      listeners.push(fn);\n      fn(vm.value);\n      return unregister;\n\n      function unregister() {\n        var ix = listeners.indexOf(fn);\n        if (ix >= 0) {\n          listeners.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Updates internal value\n     * @param {*} newValue\n     */\n    function set(newValue) {\n      if (vm.value === newValue) {\n        return;\n      }\n\n      vm.value = newValue;\n\n      listeners.forEach(function (fn) {\n        fn(newValue);\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('footnoteEditDialog', footnoteEditDialogFactory);\n\n  /** @ngInject */\n  function footnoteEditDialogFactory($mdBottomSheet) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, footnote, options) {\n      var opts = angular.merge({}, options);\n\n      var config = {\n        templateUrl: 'app/components/ckeditor-footnotes/footnote-edit-dialog.html',\n        controller: FootnoteEditDialogController,\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          footnote: footnote,\n          references: opts.references,\n          ckeditorConfig: opts.ckeditor\n        }\n      };\n\n      return $mdBottomSheet.show(config);\n    }\n  }\n\n  /** @ngInject */\n  function FootnoteEditDialogController($mdBottomSheet, footnote, references, ckeditorConfig) {\n    var vm = this;\n\n    vm.footnote = footnote;\n    vm.references = references;\n    vm.ckeditorConfig = ckeditorConfig;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdBottomSheet.hide();\n    }\n\n    function cancel() {\n      $mdBottomSheet.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorFootnotes', ckeditorFootnotesDirective);\n\n  /** @ngInject */\n  function ckeditorFootnotesDirective($document, footnoteEditDialog, articlesRepo, refsRepoFactory) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorFootnotes', '?ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var anchorIdPrefix = attrs.ckeditorFootnotesAnchorIdPrefix || 'fn_anchor_';\n\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n      var ckeditorBibliography = requires[2];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorFootnotes;\n\n      // capture footnotes reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (footnotes) {\n        if (ctrl.value !== footnotes) {\n          ctrl.set(footnotes);\n        }\n      });\n\n      var FOOTNOTE_COMMAND_NAME = 'insertFootnote';\n      editor.addCommand(FOOTNOTE_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        requiredContent: 'sup[id,data-footnote,contenteditable](footnote)',\n        exec: insertFootnoteCommand\n      });\n\n      editor.ui.addButton('Footnote', {\n        label: 'Insert Footnote',\n        command: FOOTNOTE_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertFootnoteCommand(editor) {\n        var command = this;\n\n        // create a new footnote object to edit.\n        var newFootnote = articlesRepo.createFootnote();\n        newFootnote.backlinkId = anchorIdPrefix + newFootnote.id;\n\n        var newReferences = ckeditorBibliography ? refsRepoFactory.createRefCollection() : null;\n\n        var promise = footnoteEditDialog.show(null, newFootnote, {\n          references: newReferences,\n          // TODO: allow footnote ckeditor to be configured\n          ckeditor: scope.$eval(attrs.ckeditor)\n        });\n\n        promise.then(function () {\n          ctrl.value[newFootnote.id] = newFootnote;\n\n          // update bibliography if provided\n          if (newReferences && ckeditorBibliography) {\n            var updatedReferences = refsRepoFactory.merge(ckeditorBibliography.value, refsRepoFactory.compact(newReferences));\n            angular.merge(ckeditorBibliography.value, updatedReferences);\n          }\n\n          editor.insertHtml('<sup contenteditable=\"false\" class=\"footnote\" id=\"' + newFootnote.backlinkId + '\" data-footnote=\"' + newFootnote.id + '\">#</sup>');\n          done();\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: FOOTNOTE_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n/**\n * @typedef ItemContainer\n * @type {object}\n * @property {string} id\n * @property {string} label\n * @property {BiblioItem} item\n */\n\n(function () {\n  'use strict';\n\n  var LOCATOR_TYPES = [\n    'book', 'chapter', 'column', 'figure', 'folio', 'issue', 'line', 'note', 'opus', 'page',\n    'paragraph', 'part', 'section', 'sub verbo', 'verse', 'volume'\n  ];\n\n  var ZOTERO_USER_ACCOUNT_ID = '2536190';\n  var ZOTERO_USER_ACCOUNT_API_KEY = '3A4q05BNg0h0bHKJkpoCi1Oa';\n  var ZOTERO_GROUP_ID = '381134';\n\n  angular\n    .module('sdaAdmin')\n    .component('citationEditor', {\n      templateUrl: 'app/components/citation-edit-dialog/citation-editor.html',\n      controller: CitationEditorController,\n      bindings: {\n        references: '=',\n        citation: '='\n      }\n    });\n\n  /** @ngInject */\n  function CitationEditorController($filter, $q, $log, $mdDialog, zotero, _, sdaToast, refsRepoFactory, refsRenderer) {\n    var vm = this;\n\n    // referenced item autocomplete models\n    vm.selectedBiblioItem = null;\n    vm.searchText = '';\n\n    vm.locatorTypes = LOCATOR_TYPES;\n\n    vm.activeCitationItem = {};\n\n    vm.groupLibraryP = null;\n\n    vm.zoteroItem = null\n\n    vm.search = search;\n    vm.addCitationItem = addCitationItem;\n    vm.selectBiblioItem = selectBiblioItem;\n    vm.edit = editCitationItem;\n    vm.createZoteroItem = createZoteroItem;\n    vm.cancelZoteroItem = cancelZoteroItem;\n    vm.saveZoteroItem = saveZoteroItem;\n\n    var stripTags = $filter('stripTags');\n\n    activate();\n\n    function activate() {\n      var account = zotero.getUserAccount(ZOTERO_USER_ACCOUNT_ID, ZOTERO_USER_ACCOUNT_API_KEY);\n\n      // account.getGroup and account.getLibrary return native Promises.\n      // we wrap them in $q promises for consistency\n      var groupP = $q.when(account.getGroup(ZOTERO_GROUP_ID));\n      vm.groupLibraryP = groupP.then(function (group) {\n        return $q.when(account.getLibrary(group));\n      });\n\n      if (!vm.citation) {\n        throw new Error('no citation provided');\n      }\n\n      if (!vm.references.citations[vm.citation.id]) {\n        $log.warn('Citation is not a member of the provided reference collection. Adding to collection...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      } else if (vm.references.citations[vm.citation.id] !== vm.citation) {\n        $log.warn('provided citation does not match citation in reference collection. Overriding...');\n        vm.references.citations[vm.citation.id] = vm.citation;\n      }\n    }\n\n    /**\n     * Provides autocomplete items\n     * @param  {string} query\n     * @return {Promise.<ItemContainer[]>}\n     */\n    function search(query) {\n      return vm.groupLibraryP.then(function (library) {\n        // library.searchItems returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        var resultsP = $q.when(library.searchItems(query))\n\n        var adaptedResultsP = resultsP.then(function (items) {\n          return $q.all(items.map(adaptItem).map(wrapItem));\n        });\n\n        adaptedResultsP.catch(function () {\n          sdaToast.error('Unable to load search results.');\n        });\n\n        return adaptedResultsP;\n      });\n    }\n\n    /**\n     * Adapts a ZoteroItem for use in the autocomplete field and citation metadata\n     * @param  {ZoteroItem} zItem\n     * @return {BiblioItem}\n     */\n    function adaptItem(zItem) {\n      var id = 'zotero/' + zItem.library.id + '/' + zItem.id;\n\n      var item = refsRepoFactory.createBiblioItem(id);\n      item.type = zItem.type;\n      item.creators = zItem.properties.creators.map(adaptCreator);\n\n      // NOTE: this omits a lot of metadata fields... need to decide what other metadata (if any) to keep.\n\n      item.meta = angular.extend(\n        _.pick(zItem.meta, ['creatorSummary', 'parsedDate']),\n        _.pick(zItem.properties, ['key', 'dateAdded', 'dateModified'])\n      );\n\n      item.fields = _.omit(zItem.properties, [\n        // these properties are extracted to the top-level item\n        'creators', 'itemType',\n        // these properties are extracted to metadata\n        'key', 'dateAdded', 'dateModified',\n        // these properties are just forgotten\n        'version', 'collections', 'tags', 'relations'\n      ]);\n\n      return item;\n    }\n\n    /**\n     * Adapts a Zotero creator for use in the BiblioItem TRC-local type\n     * @param  {ZoteraCreator}\n     * @return {Creator}\n     */\n    function adaptCreator(zCreator) {\n      return {\n        role: zCreator.creatorType,\n        firstName: zCreator.firstName,\n        lastName: zCreator.lastName,\n        name: zCreator.name\n      };\n    }\n\n    /**\n     * Wraps a BiblioItem for use in the autocomplete field and citation metadata\n     * @param  {BiblioItem} item\n     * @return {Promise.<ItemContainer>}\n     */\n    function wrapItem(item) {\n      var labelP = refsRenderer.renderBiblioItem('mla', item);\n\n      return labelP.then(function (label) {\n        return {\n          id: item.id,\n          label: label,\n          item: item\n        };\n      });\n    }\n\n    /**\n     * Appends the given citation item to the citation\n     * @return {CitationItem}\n     */\n    function addCitationItem(citationItem) {\n      if (vm.citation.items.indexOf(citationItem) < 0) {\n        // new item\n        vm.citation.items.push(citationItem);\n      } else {\n        // edited existing item in-place\n      }\n\n      // set/update label\n      var referencedBibItem = vm.references.bibliography[citationItem.id];\n      renderCitationItemLabel(citationItem, referencedBibItem).then(function (label) {\n        citationItem.label = label;\n      });\n\n      // clear active item and start editing a new one\n      clearForm();\n    }\n\n    /**\n     * Sets the current citation item's referent id to the given item's id and\n     * adds the given item to the bibliography\n     * @param {ItemContainer} itemContainer\n     */\n    function selectBiblioItem(itemContainer) {\n      if (itemContainer) {\n        vm.activeCitationItem.id = itemContainer.id;\n        vm.references.bibliography[itemContainer.id] = itemContainer.item;\n      } else {\n        vm.activeCitationItem.id = null;\n      }\n    }\n\n    /**\n     * Sets the given citation item as the item being actively edited\n     * @param {CitationItem} item\n     */\n    function editCitationItem(citationItem) {\n      var biblioItem = vm.references.bibliography[citationItem.id];\n      return wrapItem(biblioItem).then(function (biblioItemContainer) {\n        vm.activeCitationItem = citationItem;\n        vm.selectedBiblioItem = biblioItemContainer;\n        vm.searchText = stripTags(vm.selectedBiblioItem.label);\n      });\n    }\n\n    /**\n     * Resets the model behind the citation item form\n     */\n    function clearForm() {\n      vm.activeCitationItem = {};\n      vm.searchText = '';\n      vm.selectedBiblioItem = null;\n    }\n\n    /**\n     * Renders a label for a single citation item\n     * @praam {CitationItem} citationItem\n     * @param {ZoteroItem} biblioItem Corresponding bibliographic item\n     * @return {Promise.<string>}\n     */\n    function renderCitationItemLabel(citationItem, biblioItem) {\n      // create a singleton citation for the citation item\n      var citation = refsRepoFactory.createCitation();\n      citation.items.push(citationItem);\n\n      // create a singleton reference for the singleton citation\n      var reference = refsRepoFactory.createRefCollection();\n      reference.citations[citation.id] = citation;\n      reference.bibliography[citationItem.id] = biblioItem;\n\n      var renderedP = refsRenderer.render('mla', reference);\n\n      return renderedP.then(function (rendered) {\n        return rendered.citations[citation.id];\n      });\n    }\n\n    function createZoteroItem() {\n      vm.zoteroItem = {};\n    }\n\n    function cancelZoteroItem() {\n      vm.zoteroItem = null;\n    }\n\n    function saveZoteroItem($event, item) {\n      var zItemP = vm.groupLibraryP.then(function (library) {\n        // library.saveItem returns a native Promise.\n        // we wrap that in a $q promise for consistency\n        return $q.when(library.saveItem(item));\n      });\n\n      var biblioItemP = zItemP.then(adaptItem);\n\n      var itemContainerP = biblioItemP.then(wrapItem);\n\n      itemContainerP.then(function (item) {\n        vm.selectedBiblioItem = item;\n        selectBiblioItem(item);\n        vm.searchText = stripTags(item.label);\n        vm.zoteroItem = null;\n      }, function () {\n        sdaToast.error('Unable to save zotero data');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('citationEditDialog', CitationEditDialogFactory);\n\n  /** @ngInject */\n  function CitationEditDialogFactory($mdDialog, _, refsRepoFactory) {\n    return {\n      show: show\n    };\n\n    /**\n     * Displays the edit dialog.\n     * @param  {ReferenceCollection} references\n     * @param  {Citation} [citation]\n     * @param  {MouseEvent} [$event]\n     * @return {Promise.<ReferenceCollection>}\n     */\n    function show(references, citation, $event) {\n      if (!citation) {\n        var citations = _.values(references.citations);\n\n        if (citations.length === 0) {\n          citation = refsRepoFactory.createCitation();\n          references.citations[citation.id] = citation;\n        } else {\n          citation = citations[0];\n        }\n      } else if (angular.isString(citation)) {\n        citation = references.citations[citation];\n      }\n\n      if (!citation) {\n        throw new Error('Unable to find a suitable citation. Please pass one explicitly or check that the reference collection is not malformed');\n      }\n\n      var config = {\n        targetEvent: $event,\n        templateUrl: 'app/components/citation-edit-dialog/citation-edit-dialog.html',\n        controller: 'CitationEditDialogController',\n        controllerAs: 'vm',\n        clickOutsideToClose: false,\n        locals: {\n          references: references,\n          citation: citation\n        }\n      };\n\n      return $mdDialog.show(config).then(function () {\n        return references;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('CitationEditDialogController', CitationEditDialogController);\n\n  /** @ngInject */\n  function CitationEditDialogController($mdDialog, references, citation) {\n    var vm = this;\n\n    vm.references = references;\n    vm.citation = citation;\n\n    vm.done = done;\n    vm.cancel = cancel;\n\n    function done() {\n      $mdDialog.hide();\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .directive('ckeditorBibliography', ckeditorBibliographyDirective);\n\n  /** @ngInject */\n  function ckeditorBibliographyDirective($mdDialog, $document, refsRepoFactory, refsRenderer, citationEditDialog) {\n    var directive = {\n      restrict: 'A',\n      require: ['ckeditor', 'ckeditorBibliography'],\n      link: linkFunc,\n      controller: 'DataContainerController'\n    };\n\n    return directive;\n\n    function linkFunc(scope, el, attrs, requires) {\n      var ckeditor = requires[0];\n      var ctrl = requires[1];\n\n      var editor = ckeditor.instance;\n\n      var scopeValueExpr = attrs.ckeditorBibliography;\n\n      // capture bibliography reference from outer scope\n      ctrl.set(scope.$eval(scopeValueExpr));\n\n      // keep internal reference up-to-date\n      scope.$watch(scopeValueExpr, function (refs) {\n        if (ctrl.value !== refs) {\n          ctrl.set(refs);\n        }\n      });\n\n      var CITATION_COMMAND_NAME = 'insertCitation';\n      editor.addCommand(CITATION_COMMAND_NAME, {\n        async: true,\n        allowedContent: 'cite[id,contenteditable]',\n        requiredContent: 'cite[id,contenteditable]',\n        exec: insertCitationCommand\n      });\n\n      editor.ui.addButton('Citation', {\n        label: 'Insert Citation',\n        command: CITATION_COMMAND_NAME,\n        toolbar: 'insert'\n      });\n\n      function insertCitationCommand(editor) {\n        var command = this;\n\n        // create citation object with its own ref collection for editing\n        var newReference = refsRepoFactory.createRefCollection();\n        var citation = refsRepoFactory.createCitation();\n        newReference.citations[citation.id] = citation;\n\n        citationEditDialog.show(newReference).then(function () {\n          var updatedReferences = refsRepoFactory.merge(ctrl.value, refsRepoFactory.compact(newReference));\n          angular.merge(ctrl.value, updatedReferences);\n\n          refsRenderer.render('mla', newReference).then(function (rendered) {\n            var label = rendered.citations[citation.id];\n            editor.insertHtml('<cite id=\"' + citation.id + '\" contenteditable=\"false\">' + label + '</cite>')\n            done();\n          });\n        }, function () {\n          done();\n        });\n\n        function done() {\n          editor.fire('afterCommandExec', {\n            name: CITATION_COMMAND_NAME,\n            command: command\n          });\n        }\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroEditor', {\n      templateUrl: 'app/zotero/editor.html',\n      controller: ZoteroEditorController,\n      bindings: {\n        item: '=',\n        typeFilter: '<types'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroEditorController($q, sdaToast, zotero) {\n    var vm = this;\n\n    vm.itemTypeSearchText = '';\n    vm.itemType = null;\n\n    vm.types = [];\n    vm.fields = [];\n    vm.roles = [];\n\n    vm.selectType = selectType;\n\n    activate();\n\n    function activate() {\n      zotero.getItemTypes().then(function (types) {\n        vm.types = (vm.typeFilter && vm.typeFilter.length > 0)\n          ? types.filter(function (field) {\n              return vm.typeFilter.indexOf(field.id) >= 0;\n            })\n          : types;\n      }, function () {\n        sdaToast.error('Unable to load item type info');\n      });\n\n      if (!vm.item.creators) {\n        vm.item.creators = [{}];\n      }\n\n      if (vm.item.creators.length === 0) {\n        vm.item.creators.push({});\n      }\n    }\n\n    function selectType(itemType) {\n      if (!itemType) {\n        vm.item.itemType = null;\n        vm.fields = [];\n        vm.roles = [];\n        return;\n      }\n\n      vm.item.itemType = itemType.id;\n\n      var fieldsP = itemType.getFields()\n      fieldsP.then(function (fields) {\n        vm.fields = fields;\n      });\n\n      var creatorRolesP = itemType.getCreatorRoles();\n      creatorRolesP.then(function (roles) {\n        vm.roles = roles;\n      });\n\n      $q.all([fieldsP, creatorRolesP]).catch(function () {\n        sdaToast.error('Unable to load data for the \"' + itemType.label + '\" type.');\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .component('zoteroCreatorField', {\n      templateUrl: 'app/zotero/creator-field.html',\n      controller: ZoteroCreatorFieldController,\n      bindings: {\n        creator: '=',\n        roles: '<'\n      }\n    });\n\n  /** @ngInject */\n  function ZoteroCreatorFieldController() {\n  }\n\n})();\n\n/*global zotero:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('zotero')\n    .factory('zotero', ZoteroFactory);\n\n  /** @ngInject */\n  function ZoteroFactory() {\n    return new zotero(zotero.getDefaultBaseUrl(), angular.toJson);\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowWorkController', ShowWorkController);\n\n  /** @ngInject */\n  function ShowWorkController($state, $stateParams, worksRepo, relnRepo, refsRepoFactory, articlesRepo, $mdDialog, sdaToast, $q, workEditDialog, copyEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.title = null;\n    vm.relationships = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.addEdition = addEdition;\n    vm.deleteEdition = deleteEdition;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.createBookReview = createBookReviewArticle;\n    vm.deleteWork = deleteWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise.then(function () {\n        vm.bcTitle = worksRepo.getTitle(vm.work.titles);\n        vm.title = worksRepo.getTitle(vm.work.titles, ['canonical', 'bibliographic', 'short']);\n        vm.anchor = relnRepo.createAnchor(worksRepo.getWorkLabel(vm.work), vm.work.ref.token);\n      });\n\n      var refsEndpointUrl = worksRepo.getReferencesEndpoint(workId);\n      refsRepo = refsRepoFactory.getRepo(refsEndpointUrl);\n      vm.references = refsRepo.get();\n      var refsPromise = vm.references.$promise;\n\n      $q.all([workPromise, refsPromise])\n        .catch(function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = workEditDialog.show($event, angular.copy(vm.work));\n\n      dialogPromise.then(function (updatedWork) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.work, updatedWork);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.work.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.work.summary = updatedSummary;\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        refsRepo.save(vm.references).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addEdition($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Edition')\n        .textContent('Please provide a name for the new edition.')\n        .placeholder('edition name')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (editionName) {\n        var edition = worksRepo.createEdition();\n        edition.editionName = editionName;\n        edition.titles = angular.copy(vm.work.titles);\n        edition.authors = angular.copy(vm.work.authors);\n\n        vm.work.editions.push(edition);\n\n        // resolve to the created edition when save is successful\n        return worksRepo.saveEdition(vm.work.id, edition);\n      });\n\n      savePromise.then(showSavedToast, showErrorToast);\n\n      savePromise.then(function (edition) {\n        $state.go('editor.edition', { workId: vm.work.id, editionId: edition.id });\n      });\n    }\n\n    function deleteEdition(edition, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this edition?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.editions.indexOf(edition);\n          if (ix >= 0) {\n            vm.work.editions.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.work.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.work.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.work.copies.splice(ix, 1);\n            worksRepo.saveWork(vm.work).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function deleteWork($event, work) {\n      var title = worksRepo.getTitle(vm.work.titles);\n      var workLabel = title ? '\"' + title.title + (title.subtitle ? ': ' + title.subtitle : '') + '\"' : 'this work';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + workLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return worksRepo.delete(work)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        $state.go('editor');\n        return sdaToast.success(workLabel + ' has been deleted.');\n      }\n\n      function showErrorToast() {\n        return sdaToast.error('Unable to delete ' + workLabel);\n      }\n    }\n\n    function createBookReviewArticle($event, work) {\n      var title = worksRepo.getTitle(work.titles);\n\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Book Review',\n        textContent: 'You are creating a new article attached to this work. Please enter a title for this article.',\n        initialValue: title ? title.title + (title.subtitle ? ': ' + title.subtitle : '') : '[untitled work]',\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('book-review', title, work.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          return sdaToast.error('Unable to create article.');\n        });\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('workEditDialog', workEditDialogFactory);\n\n  /** @ngInject */\n  function workEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, work) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/work-edit-dialog.html',\n        locals: {\n          work: work\n        },\n        controller: WorkEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function WorkEditDialogController($mdDialog, work) {\n    var vm = this;\n\n    vm.work = work;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.work);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.work[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.work[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.work[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.work.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.work.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.work.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowVolumeController', ShowVolumeController);\n\n  /** @ngInject */\n  function ShowVolumeController($stateParams, worksRepo, relnRepo, $mdDialog, sdaToast, $q, volumeEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.volume = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToEdition = copyToEdition;\n\n    activate();\n\n    function activate() {\n\n      var workId = $stateParams.workId\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise\n        .then(extractTitle(['short', 'canonical', 'bibliographic']))\n        .then(function (title) { vm.workTitle = title; });\n\n      var editionId = $stateParams.editionId;\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      var editionPromise = vm.edition.$promise;\n\n      var volumeId = $stateParams.volumeId;\n      vm.volume = worksRepo.getVolume(workId, editionId, volumeId);\n      var volumePromise = vm.volume.$promise;\n      volumePromise\n        .then(extractTitle(['canonical', 'bibliographic', 'short']))\n        .then(function (title) { vm.title = title; });\n\n      $q.all([workPromise, editionPromise, volumePromise])\n        .then(function () {\n          vm.anchor = relnRepo.createAnchor(worksRepo.getVolumeLabel(vm.volume, vm.edition.editionName), vm.work.ref.token, {\n            editionId: [vm.edition.id],\n            volumeId: [vm.volume.id]\n          });\n        }, function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n    }\n\n    function extractTitle(preference) {\n      return function (biblioObject) {\n        return worksRepo.getTitle(biblioObject.titles, preference);\n      };\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = volumeEditDialog.show($event, angular.copy(vm.volume));\n\n      dialogPromise.then(function (updatedVolume) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.volume, updatedVolume);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.volume.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.volume.summary = updatedSummary;\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.volume.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.volume.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.volume.copies.splice(ix, 1);\n            worksRepo.saveVolume(vm.work.id, vm.edition.id, vm.volume).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function copyToEdition(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var edition = worksRepo.getEdition(vm.work.id, vm.edition.id);\n      edition.$promise.then(function () {\n        edition.copies.push(newCopy);\n        return worksRepo.saveEdition(vm.work.id, edition);\n      }).then(showSavedToast, showErrorToast);\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('volumeEditDialog', volumeEditDialogFactory);\n\n  /** @ngInject */\n  function volumeEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, volume) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/volume-edit-dialog.html',\n        locals: {\n          volume: volume\n        },\n        controller: VolumeEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function VolumeEditDialogController($mdDialog, volume) {\n    var vm = this;\n\n    vm.volume = volume;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.volume);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.volume[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.volume[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.volume[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.volume.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.volume.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.volume.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowEditionController', ShowEditionController);\n\n  /** @ngInject */\n  function ShowEditionController($state, $stateParams, worksRepo, relnRepo, $mdDialog, sdaToast, $q, editionEditDialog, copyEditDialog, summaryEditDialog) {\n    var vm = this;\n\n    vm.loading = true;\n    vm.work = null;\n    vm.workTitle = null;\n    vm.edition = null;\n    vm.title = null;\n\n    vm.editBibInfo = editBibInfo;\n    vm.editSummary = editSummary;\n    vm.addVolume = addVolume;\n    vm.deleteVolume = deleteVolume;\n    vm.addCopy = addCopy;\n    vm.editCopy = editCopy;\n    vm.deleteCopy = deleteCopy;\n    vm.copyToWork = copyToWork;\n\n    activate();\n\n    function activate() {\n      var workId = $stateParams.workId;\n      vm.work = worksRepo.getWork(workId);\n      var workPromise = vm.work.$promise;\n      workPromise\n        .then(extractTitle(['short', 'canonical', 'bibliographic']))\n        .then(function (title) { vm.workTitle = title; });\n\n      var editionId = $stateParams.editionId;\n      vm.edition = worksRepo.getEdition(workId, editionId);\n      var editionPromise = vm.edition.$promise;\n      editionPromise\n        .then(extractTitle(['canonical', 'bibliographic', 'short']))\n        .then(function (title) { vm.title = title; });\n\n      $q.all([workPromise, editionPromise])\n        .then(function (){\n          vm.anchor = relnRepo.createAnchor(worksRepo.getEditionLabel(vm.edition), vm.work.ref.token, {\n            editionId: [vm.edition.id]\n          });\n        }, function () {\n          sdaToast.error('Unable to load bibliographic entry data from server.');\n        })\n        .then(function () {\n          vm.loading = false;\n        });\n\n    }\n\n    function extractTitle(preference) {\n      return function (biblioObject) {\n        return worksRepo.getTitle(biblioObject.titles, preference);\n      };\n    }\n\n    function editBibInfo($event) {\n      var dialogPromise = editionEditDialog.show($event, angular.copy(vm.edition));\n\n      dialogPromise.then(function (updatedEdition) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.edition, updatedEdition);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.edition.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.edition.summary = updatedSummary;\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n    }\n\n    function addVolume($event) {\n      var prompt = $mdDialog.prompt()\n        .targetEvent($event)\n        .title('Create Volume')\n        .textContent('Please provide a number for the new volume.')\n        .placeholder('volume number')\n        .ok('Create')\n        .cancel('Cancel');\n\n      var dialogPromise = $mdDialog.show(prompt);\n\n      var savePromise = dialogPromise.then(function (volumeNumber) {\n        var volume = worksRepo.createVolume();\n        volume.volumeNumber = volumeNumber;\n        volume.titles = angular.copy(vm.edition.titles);\n        volume.authors = angular.copy(vm.edition.authors);\n        volume.publicationInfo = angular.copy(vm.edition.publicationInfo);\n\n        vm.edition.volumes.push(volume);\n\n        return worksRepo.saveVolume(vm.work.id, vm.edition.id, volume);\n      });\n\n      savePromise.then(showSavedToast, showErrorToast);\n\n      savePromise.then(function (volume) {\n        $state.go('editor.volume', { workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id });\n      });\n    }\n\n    function deleteVolume(volume, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this volume?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.volumes.indexOf(volume);\n          if (ix >= 0) {\n            vm.edition.volumes.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function addCopy($event) {\n      var copy = {};\n      editCopy(copy, $event).then(function () {\n        vm.edition.copies.push(copy);\n      });\n    }\n\n    function editCopy(copy, $event) {\n      var dialogPromise = copyEditDialog.show($event, angular.copy(copy));\n      dialogPromise.then(function (updatedCopy) {\n        // copy updates back to original only after dialog is positively dismised (i.e. not canceled)\n        angular.extend(copy, updatedCopy);\n\n        worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n      });\n\n      return dialogPromise;\n    }\n\n    function deleteCopy(copy, $event) {\n      var confirm = $mdDialog.confirm()\n        .targetEvent($event)\n        .title('Confirm Deletion')\n        .textContent('Are you sure you want to delete this copy?')\n        .ok('Yes')\n        .cancel('No');\n\n      $mdDialog.show(confirm)\n        .then(function () {\n          var ix = vm.edition.copies.indexOf(copy);\n          if (ix >= 0) {\n            vm.edition.copies.splice(ix, 1);\n            worksRepo.saveEdition(vm.work.id, vm.edition).then(showSavedToast, showErrorToast);\n          }\n        });\n    }\n\n    function copyToWork(origCopy) {\n      var newCopy = angular.copy(origCopy);\n      newCopy.id = null;\n\n      // HACK: make sure we have an up-to-date copy of the edition before updating it\n      var work = worksRepo.getWork(vm.work.id);\n      work.$promise.then(function () {\n        work.copies.push(newCopy);\n        return worksRepo.saveWork(work);\n      }).then(showSavedToast, showErrorToast);\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('editionEditDialog', editionEditDialogFactory);\n\n  /** @ngInject */\n  function editionEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, edition) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/work/edition-edit-dialog.html',\n        locals: {\n          edition: edition\n        },\n        controller: EditionEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function EditionEditDialogController($mdDialog, edition) {\n    var vm = this;\n\n    vm.edition = edition;\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addAuthor = addAuthor;\n    vm.deleteAuthor = deleteAuthor;\n    vm.addTitle = addTitle;\n    vm.deleteTitle = deleteTitle;\n\n    function close() {\n      $mdDialog.hide(vm.edition);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addAuthor(field) {\n      // TODO delegate creation to worksRepo\n      var authorRef = {};\n      vm.edition[field].push(authorRef);\n    }\n\n    function deleteAuthor(field, authorRef) {\n      var ix = vm.edition[field].indexOf(authorRef);\n      if (ix >= 0) {\n        vm.edition[field].splice(ix, 1);\n      }\n    }\n\n    function addTitle() {\n      // TODO delegate creation to worksRepo\n      var title = {};\n      vm.edition.titles.push(title);\n    }\n\n    function deleteTitle(title) {\n      var ix = vm.edition.titles.indexOf(title);\n      if (ix >= 0) {\n        vm.edition.titles.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks', [\n      'ngResource'\n    ]);\n\n})();\n\n/**\n * @typedef {object} Workflow\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {object.<string, WorkflowStage>} stages\n * @property {string} status\n */\n\n/**\n * @typedef {object} WorkflowStage\n * @property {string} id\n * @property {string} label\n * @property {string} description\n * @property {boolean} isFinal\n * @property {WorkflowStageTransition[]} transitions\n */\n\n/**\n * @typedef {object} WorkflowStageTransition\n * @property {string} sourceStage\n * @property {string} targetStage\n * @property {string} label\n */\n\n/**\n * @typedef {object} Worklist\n * @property {string} groupId\n * @property {string} label\n * @property {integer} itemCount\n * @property {integer} start\n * @property {integer} max\n * @property {WorkItem[]} items\n */\n\n/**\n * @typedef {object} WorkItem\n * @property {string} itemId\n * @property {string} type\n * @property {string} entityId\n * @property {string} label\n * @property {object.<string,string>} properties\n * @property {string} stage\n * @property {string} task\n */\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcTasks')\n    .provider('tasksRepo', tasksRepoProvider);\n\n  /**\n   * @return {angular.provider}\n   */\n  function tasksRepoProvider() {\n    var provider = {};\n    provider.url = '/api/tasks';\n    provider.$get = tasksRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function tasksRepoFactory($resource) {\n      var taskResource = $resource(provider.url + '/:taskId', { taskId: '@id' });\n      var workflowResource = $resource(provider.url + '/:taskId/workflow');\n      var itemResource = $resource(provider.url + '/:taskId/items/:itemId', { itemId: '@itemId' });\n\n      var repo = {};\n      repo.getTask = getTask;\n      repo.getWorkflow = getWorkflow;\n      repo.all = getAllTasks;\n      repo.getItems = getItems;\n      repo.transition = transition;\n      return repo;\n\n      /**\n       * Retrieves a listing of all tasks\n       *\n       * @return {Task[]}\n       */\n      function getAllTasks() {\n        return taskResource.query();\n      }\n\n      /**\n       * Retrieves a task by id\n       *\n       * @param  {string} taskId\n       * @return {GroupedTaskList}\n       */\n      function getTask(taskId) {\n        return taskResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Retrieves a workflow by task id\n       * @param  {string} taskId\n       * @return {Workflow}\n       */\n      function getWorkflow(taskId) {\n        return workflowResource.get({ taskId: taskId });\n      }\n\n      /**\n       * Gets items from the task endpoint for a given stage\n       *\n       * @param  {string}  [taskId]  Task ID\n       * @param  {string}  stageId          Workflow stage for which to get items\n       * @param  {object}  options\n       * @param  {integer} [options.start]  Starting index\n       * @param  {integer} [options.max]    Maximum number of items to fetch per page\n       * @return {Worklist}\n       */\n      function getItems(taskId, stageId, options) {\n        options = options || {};\n        return itemResource.get({\n          taskId: taskId,\n          stage: stageId,\n          start: options.start,\n          max: options.max\n        });\n      }\n\n      /**\n       * Transition an item from its current stage to a target stage\n       *\n       * @param  {WorkItem}                item   Work item instance\n       * @param  {WorkflowStageTransition} transition Target workflow stage\n       * @return {WorkItem}                       Updated work item instance\n       */\n      function transition(taskId, item, transition) {\n        if (item.stage !== transition.sourceStage) {\n          throw new Error('Transition (' + transition.sourceStage + ' -> ' + transition.targetStage + ') is not valid for item currently in stage ' + item.stage);\n        }\n\n        var result = itemResource.save({\n          taskId: taskId,\n          itemId: item.itemId\n        }, {\n          stage: transition.targetStage,\n          // NOTE comments are not saved yet\n          comments: null\n        });\n\n        // propagate updates to the original item\n        result.$promise.then(function (resp) {\n          angular.extend(item, resp);\n        });\n\n        return result;\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('TaskController', TaskController);\n\n  /** @ngInject */\n  function TaskController($mdSidenav, sdaToast, tasksRepo) {\n    var vm = this;\n\n    vm.loading = false;\n\n    vm.openMenu = openMenu;\n\n    activate();\n\n    function activate() {\n      vm.loading = true;\n      vm.tasks = tasksRepo.all();\n      var tasksPromise = vm.tasks.$promise;\n\n      tasksPromise.catch(function () {\n        sdaToast.error('Unable to load tasks from server');\n      }).then(function () {\n        vm.loading = false;\n      });\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowTaskController', ShowTaskController);\n\n  /** @ngInject */\n  function ShowTaskController($state, $stateParams, $mdSidenav, tasksRepo, $q, sdaToast) {\n    var vm = this;\n\n    // HACK this will eventually be made available on the workflow data model itself.\n    vm.stageOrder = [\n      'pinned',\n      'inprogress',\n      'review',\n      'pending',\n      'deferred'\n    ];\n\n    vm.loading = true;\n    vm.worklists = {};\n    vm.task = null;\n\n    vm.focusItem = focusItem;\n    vm.transition = transitionItem;\n\n    activate();\n\n    function activate() {\n      vm.taskId = $stateParams.taskId;\n\n      vm.task = tasksRepo.getTask(vm.taskId);\n      var taskPromise = vm.task.$promise;\n      taskPromise.catch(makeErrorHandler('Unable to load task data from the server.'));\n\n      vm.workflow = tasksRepo.getWorkflow(vm.taskId);\n      var workflowPromise = vm.workflow.$promise;\n      workflowPromise.catch(makeErrorHandler('Unable to load workflow data from the server.'));\n\n      var worklistPromise = workflowPromise.then(loadWorklist);\n      worklistPromise.catch(makeErrorHandler('Unable to load worklist data from the server.'));\n\n      worklistPromise.then(function () {\n        vm.loading = false;\n      });\n    }\n\n    /**\n     * Opens the given item in the work editor\n     *\n     * @param {WorkItem} item\n     * @param {Event} $event\n     */\n    function focusItem(item, $event) {\n      $event.stopImmediatePropagation();\n\n      // TODO resolve handler based on item.type\n      $state.go('editor.work', { workId: item.entityId });\n    }\n\n    /**\n     * Applies the given transition to the given item, moving it from its current stage (presumably transition.sourceStage)\n     * to the stage identified by transition.targetStage\n     *\n     * @param {WorkItem} item\n     * @param {WorkflowStageTransition} transition\n     * @param {Event} $event\n     */\n    function transitionItem(item, transition, $event) {\n      $event.stopImmediatePropagation();\n\n      var updatedItem = tasksRepo.transition(vm.taskId, item, transition);\n\n      updatedItem.$promise.then(function () {\n        var refreshPromise = $q.all([\n          fetchStage(transition.sourceStage),\n          fetchStage(transition.targetStage)\n        ]);\n\n        refreshPromise.then(function () {\n          sdaToast.success('\"' + transition.label + '\" applied successfully');\n        }, function () {\n          sdaToast.error('Unable to refresh worklist after transition');\n        });\n\n        return refreshPromise;\n      }, function () {\n        sdaToast.error('Unable to \"' + transition.label + '\" item');\n      });\n    }\n\n    /**\n     * Populates all stages of the given workflow\n     *\n     * @param {Workflow} workflow\n     * @return Promise.<Worklist[]>\n     */\n    function loadWorklist(workflow) {\n      var worklistPromises = [];\n\n      angular.forEach(workflow.stages, function (stage) {\n        var worklistPromise = fetchStage(stage.id);\n        worklistPromises.push(worklistPromise);\n      });\n\n      return $q.all(worklistPromises);\n    }\n\n    /**\n     * Fetches the worklist items for the workflow stage with the given id\n     *\n     * @param {string} id\n     * @return {Promise.<Worklist>}\n     */\n    function fetchStage(stageId) {\n      var group = tasksRepo.getItems(vm.taskId, stageId, { max: 9999 });\n\n      group.$promise.then(function () {\n        vm.worklists[stageId] = group.items.length > 0 ? group : null;\n      });\n\n      return group.$promise;\n    }\n\n    /**\n     * Makes an error handler to display the given message in an error toast\n     *\n     * @param {string} message\n     * @return {makeErrorHandler~showErrorToast}\n     */\n    function makeErrorHandler(message) {\n      return showErrorToast;\n\n      /**\n       * Shows an error toast, returning a promise that resolves when the toast is dismissed\n       *\n       * @return {Promise}\n       */\n      function showErrorToast() {\n        return sdaToast.error(message);\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('ShowPersonController', ShowPersonController);\n\n  /** @ngInject */\n  function ShowPersonController(peopleRepo, refsRepoFactory, articlesRepo, $log, $state, $stateParams, $mdDialog, sdaToast, _, personEditDialog, eventEditDialog, citationEditDialog, summaryEditDialog) {\n    var refsRepo = null;\n    var vm = this;\n\n    vm.loading = true;\n    vm.person = null;\n\n    vm.editBioInfo = editBioInfo;\n    vm.editEvent = editEvent;\n    vm.editSummary = editSummary;\n    vm.editBibliography = editBibliography;\n    vm.createBiography = createBiographyArticle;\n    vm.deletePerson = deletePerson;\n\n    activate();\n\n    function activate() {\n      var personId = $stateParams.id;\n\n      var personRefsUrl = peopleRepo.getReferencesEndpoint(personId);\n      refsRepo = refsRepoFactory.getRepo(personRefsUrl);\n\n      vm.person = peopleRepo.get(personId);\n      vm.references = refsRepo.get();\n\n      vm.references.$promise.then(function () {\n        var citations = _.values(vm.references.citations);\n\n        if (citations.length === 0) {\n          vm.citation = refsRepo.createCitation();\n          vm.references.citations[vm.citation.id] = vm.citation;\n        } else {\n          if (citations.length > 1) {\n            $log.warn('reference collection contains ' + citations.length + ' citations');\n          }\n          vm.citation = citations[0];\n        }\n      })\n    }\n\n    function editBioInfo($event) {\n      var dialogPromise = personEditDialog.show($event, angular.copy(vm.person));\n\n      dialogPromise.then(function (updatedPerson) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person, updatedPerson);\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editEvent(field, $event) {\n      var dialogPromise = eventEditDialog.show($event, angular.copy(vm.person[field]));\n\n      dialogPromise.then(function (updatedEvent) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        angular.extend(vm.person[field], updatedEvent);\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editSummary($event) {\n      var dialogPromise = summaryEditDialog.show($event, angular.copy(vm.person.summary));\n\n      dialogPromise.then(function (updatedSummary) {\n        // copy updates back to original only after dialog is positively dismissed (i.e. not canceled)\n        vm.person.summary = updatedSummary;\n\n        var savePromise = peopleRepo.save(vm.person);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function editBibliography($event) {\n      citationEditDialog.show(vm.references, null, $event).then(function () {\n        var savePromise = refsRepo.save(vm.references);\n        savePromise.then(showSavedToast, showErrorToast);\n        return savePromise;\n      });\n    }\n\n    function deletePerson($event, person) {\n      var nameLabel = person.name.label ? '\"' + person.name.label + '\"' : 'this person';\n\n      var confirmDialog = $mdDialog.confirm({\n        targetEvent: $event,\n        title: 'Confirm Deletion',\n        textContent: 'Are you sure you want to delete ' + nameLabel + '?',\n        ok: 'Yes',\n        cancel: 'No'\n      });\n\n      var confirmPromise = $mdDialog.show(confirmDialog);\n\n      return confirmPromise.then(function () {\n        return peopleRepo.delete(person)\n          .then(showSuccessToast, showErrorToast);\n      });\n\n      function showSuccessToast() {\n        $state.go('editor');\n        return sdaToast.success(nameLabel + ' has been deleted.');\n      }\n\n      function showErrorToast() {\n        return sdaToast.error('Unable to delete ' + nameLabel);\n      }\n    }\n\n    function createBiographyArticle($event, person) {\n      // prompt for article title\n      var articleTitleDialog = $mdDialog.prompt({\n        targetEvent: $event,\n        title: 'Create Biography',\n        textContent: 'You are creating a new article attached to this person. Please enter a title for this article.',\n        initialValue: person.name.label,\n        ok: 'Create',\n        cancel: 'Cancel'\n      });\n\n      var titleP = $mdDialog.show(articleTitleDialog);\n\n      titleP.then(function (title) {\n        var articleP = articlesRepo.createLinked('biography', title, person.ref.token);\n\n        // redirect to article editor\n        articleP.then(function (article) {\n          $state.go('article.edit', {\n            id: article.id\n          });\n        }, function () {\n          return sdaToast.error('Unable to create article.');\n        });\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save data.');\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .factory('personEditDialog', personEditDialogFactory);\n\n  /** @ngInject */\n  function personEditDialogFactory($mdDialog) {\n    return {\n      show: showDialog\n    };\n\n    function showDialog($event, person) {\n      var dialog = {\n        targetEvent: $event,\n        templateUrl: 'app/person/person-edit-dialog.html',\n        locals: {\n          person: person\n        },\n        controller: PersonEditDialogController,\n        controllerAs: 'vm'\n      };\n\n      return $mdDialog.show(dialog);\n    }\n  }\n\n  /** @ngInject */\n  function PersonEditDialogController(peopleRepo, $mdDialog, person) {\n    var vm = this;\n\n    vm.person = person;\n    vm.nameRoles = [\n        // { value: 'canonical', label: 'Canonical Name' },\n        { value: 'pseudonym', label: 'Pseudonym' },\n        { value: 'maiden', label: 'Maiden Name' },\n        { value: 'designation', label: 'Honorary Designation' },\n        { value: 'nickname', label: 'Nickname' },\n        { value: 'phonetic', label: 'Phonetic Name' }\n    ]\n\n    vm.close = close;\n    vm.cancel = cancel;\n    vm.addName = addName;\n    vm.deleteName = deleteName;\n\n    function close() {\n      $mdDialog.hide(vm.person);\n    }\n\n    function cancel() {\n      $mdDialog.cancel();\n    }\n\n    function addName() {\n      var name = peopleRepo.createName();\n      vm.person.altNames.push(name);\n    }\n\n    function deleteName(name) {\n      var ix = vm.person.altNames.indexOf(name);\n      if (ix >= 0) {\n        vm.person.altNames.splice(ix, 1);\n      }\n    }\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController(worksRepo, peopleRepo, $state, $stateParams, $mdSidenav, _, $q, personEditDialog, workEditDialog, sdaToast) {\n    var vm = this;\n\n    vm.loading = false;\n    vm.searchQuery = '';\n\n    vm.openMenu = openMenu;\n    vm.createPerson = createPerson;\n    vm.createWork = createWork;\n    vm.search = _.debounce(search, 300);\n\n    activate();\n\n    function activate() {\n      if ($stateParams.q) {\n        vm.searchQuery = $stateParams.q;\n        search(vm.searchQuery);\n      }\n    }\n\n    function openMenu() {\n      $mdSidenav('left').toggle();\n    }\n\n    function search(query) {\n      vm.loading = true;\n\n      vm.peopleResults = peopleRepo.search(query);\n      vm.worksResults = worksRepo.search(query);\n\n      $q.all([\n        vm.peopleResults.$promise,\n        vm.worksResults.$promise\n      ])\n        .then(function () {\n          vm.loading = false;\n        }, function () {\n          sdaToast.error('Unable to load data from the server');\n        });\n    }\n\n    function createPerson($event) {\n      var person = peopleRepo.create();\n      var dialogPromise = personEditDialog.show($event, person)\n\n      dialogPromise.then(function (person) {\n        var savePromise = peopleRepo.save(person);\n\n        savePromise.then(showSavedToast, showErrorToast);\n\n        savePromise.then(function (person) {\n          $state.go('editor.person', { id: person.id });\n        });\n\n        return savePromise;\n      });\n\n    }\n\n    function createWork($event) {\n      var work = worksRepo.createWork();\n      var dialogPromise = workEditDialog.show($event, work);\n\n      dialogPromise.then(function (work) {\n        var savePromise = worksRepo.saveWork(work);\n\n        savePromise.then(showSavedToast, showErrorToast);\n\n        savePromise.then(function (work) {\n          $state.go('editor.work', { workId: work.id });\n        });\n\n        return savePromise;\n      });\n    }\n\n    function showSavedToast() {\n      return sdaToast.success('Saved.');\n    }\n\n    function showErrorToast() {\n      return sdaToast.error('Unable to save.')\n    }\n  }\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($mdThemingProvider) {\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log, trcAuth) {\n    if (!trcAuth.isAuthenticated()) {\n      trcAuth.loginGuest();\n    }\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('editor', {\n        url: '/?q',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'vm'\n      })\n\n      .state('editor.person', {\n        url: 'people/:id',\n        views: {\n          main: {\n            templateUrl: 'app/person/person.html',\n            controller: 'ShowPersonController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('editor.work', {\n        url: 'works/:workId',\n        views: {\n          main: {\n            templateUrl: 'app/work/work.html',\n            controller: 'ShowWorkController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.edition', {\n        url: 'works/:workId/editions/:editionId',\n        views: {\n          main: {\n            templateUrl: 'app/work/edition.html',\n            controller: 'ShowEditionController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n      .state('editor.volume', {\n        url: 'works/:workId/editions/:editionId/volumes/:volumeId',\n        views: {\n          main: {\n            templateUrl: 'app/work/volume.html',\n            controller: 'ShowVolumeController',\n            controllerAs: 'vm'\n          }\n        }\n      })\n\n      .state('article', {\n        url: '/articles',\n        templateUrl: 'app/admin/editors/articles/article.html',\n        controller: 'ArticleEditorSectionController',\n        controllerAs: 'vm'\n      })\n\n      .state('article.edit', {\n        url: '/:id',\n        templateUrl: 'app/admin/editors/articles/article-editor.html',\n        controller: 'ArticleEditorController',\n        controllerAs: 'vm'\n      })\n\n      .state('task', {\n        url: '/task',\n        templateUrl: 'app/task/task.html',\n        controller: 'TaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('task.show', {\n        url: '/:taskId',\n        templateUrl: 'app/task/show.html',\n        controller: 'ShowTaskController',\n        controllerAs: 'vm'\n      })\n\n      .state('vwise', {\n        url: '/vwise/:workspaceId',\n        templateUrl: 'app/vwise/workspace.html',\n        controller: 'WorkspaceController',\n        controllerAs: 'vm'\n      })\n\n      .state('zotero', {\n        url: '/zotero',\n        templateUrl: 'app/zotero/test/test.html',\n        controller: 'ZoteroTestController',\n        controllerAs: 'vm'\n      });\n\n\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global _:false, moment:false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .constant('_', _)\n    .constant('moment', moment);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, $httpProvider,\n                  tasksRepoProvider,\n                  worksRepoProvider,\n                  peopleRepoProvider,\n                  articlesRepoProvider,\n                  relnRepoProvider,\n                  categorizationServiceProvider,\n                  seeAlsoRepoProvider,\n                  trcSearchProvider,\n                  trcAuthProvider,\n                  trcAuthInterceptorProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    // API endpoints\n    var API_PREFIX = '/api/catalog';\n\n    tasksRepoProvider.url = API_PREFIX + '/v1/tasks';\n    worksRepoProvider.url = API_PREFIX + '/works';\n    peopleRepoProvider.url = API_PREFIX + '/people';\n    articlesRepoProvider.url = API_PREFIX + '/entries/articles';\n    relnRepoProvider.url = API_PREFIX + '/relationships';\n    categorizationServiceProvider.url = API_PREFIX + '/categorizations';\n    seeAlsoRepoProvider.url = API_PREFIX + '/seealso';\n    trcSearchProvider.url = API_PREFIX + '/search';\n\n    // authentication\n    trcAuthProvider.loginUrl = API_PREFIX + '/accounts/auth';\n    trcAuthProvider.loginGuestUrl = API_PREFIX + '/accounts/authguest';\n    trcAuthInterceptorProvider.url = new RegExp('^' + API_PREFIX, 'i');\n    $httpProvider.interceptors.push('trcAuthInterceptor');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaAdmin')\n    .config(cslConfig);\n\n  var CSL_LOCALES = {\n    'en-US': 'en-US'\n  };\n\n  var CSL_STYLES = {\n    mla: 'modern-language-association',\n    chicago: 'chicago-author-date'\n  };\n\n  /** @ngInject */\n  function cslConfig(citeprocProvider, refsRendererProvider) {\n    refsRendererProvider.typemapUrl = '/assets/typemap/zotero-csl.json';\n    angular.forEach(CSL_LOCALES, addLocale);\n    angular.forEach(CSL_STYLES, addStyle);\n\n    function addLocale(filename, localeId) {\n      citeprocProvider.addLocale(localeId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/locales/locales-' + filename + '.xml').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n\n    function addStyle(filename, styleId) {\n      citeprocProvider.addStyle(styleId, supplier);\n\n      /** @ngInject */\n      function supplier($http) {\n        return $http.get('/assets/csl/styles/' + filename + '.csl').then(function (res) {\n          return res.data;\n        });\n      }\n    }\n  }\n\n})();\n\nangular.module(\"sdaAdmin\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/main.html\",\"<md-content flex layout=column> <navbar title=\\\"Editorial Tools\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" ui-view=sidebar layout=column> <form layout=row flex=none> <md-input-container flex> <label for=searchQuery>Search</label> <md-icon>search</md-icon> <input type=search name=searchQuery id=searchQuery ng-model=vm.searchQuery ng-change=vm.search(vm.searchQuery) required> </md-input-container> </form> <md-content flex> <div ng-if=vm.loading layout=row layout-align=center> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.peopleResults &amp;&amp; vm.peopleResults.items.length > 0\\\"> <md-subheader>People</md-subheader> <md-list> <md-list-item ng-repeat=\\\"person in vm.peopleResults.items\\\" ui-sref=\\\"editor.person({id: person.id})\\\"> <div class=md-list-item-text ng-bind-html=person.label></div> </md-list-item> </md-list> </div> <div ng-if=\\\"!vm.loading &amp;&amp; vm.worksResults &amp;&amp; vm.worksResults.items.length > 0\\\"> <md-subheader>Works</md-subheader> <md-list> <md-list-item ng-repeat=\\\"work in vm.worksResults.items\\\" ui-sref=\\\"editor.work({workId: work.id})\\\"> <div class=md-list-item-text ng-bind-html=work.label></div> </md-list-item> </md-list> </div> </md-content> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Person\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createPerson($event)> <md-tooltip md-direction=left>New Person</md-tooltip> <md-icon>person</md-icon> </md-button> <md-button aria-label=\\\"New Work\\\" class=\\\"md-fab md-mini\\\" ng-click=vm.createWork($event)> <md-tooltip md-direction=left>New Book</md-tooltip> <md-icon>book</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view=main></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/person/person-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Biographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=name layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Canonical Name</h2> </div> </md-toolbar> <div class=name> <name-editor ng-model=vm.person.name flex></name-editor> </div> </section> <section class=alt-names layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Alternate Names</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addName()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=name layout=row ng-repeat=\\\"name in vm.person.altNames\\\"> <md-input-container> <label>role</label> <md-select ng-model=name.role> <md-option ng-repeat=\\\"role in vm.nameRoles\\\" value={{role.value}}> {{role.label}} </md-option> </md-select> </md-input-container> <name-editor ng-model=name flex></name-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteName(name)> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/person/person.html\",\"<div layout=row layout-padding flex=noshrink> <div flex=60> <section class=\\\"content names\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h1 class=content-heading>{{vm.person.name.label}}</h1> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBioInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <div ng-if=\\\"vm.person.altNames && vm.person.altNames.length > 0\\\"> <p>Other names:</p> <ul> <li ng-repeat=\\\"name in vm.person.altNames\\\">{{name.label}}</li> </ul> </div> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.person.summary ng-bind-html=vm.person.summary></p> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div flex=40> <section class=\\\"content birth\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Birth</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'birth\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.birth.date.description>{{vm.person.birth.date.description}}</span> <span class=location ng-if=vm.person.birth.location>in {{vm.person.birth.location}}</span> </p> <p ng-bind-html=vm.person.birth.description ng-if=vm.person.birth.description></p> </section> <section class=\\\"content death\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Death</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.editEvent(\\'death\\', $event)\\\"> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=description ng-if=vm.person.death.date.description>{{vm.person.death.date.description}}</span> <span class=location ng-if=vm.person.death.location>in {{vm.person.death.location}}</span> </p> <p ng-bind-html=vm.person.death.description ng-if=vm.person.death.description></p> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.person.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button aria-label=\\\"Create Biography\\\" class=md-icon-button ng-click=\\\"vm.createBiography($event, vm.person)\\\"> <md-icon>assignment_ind</md-icon> <md-tooltip md-direction=top>Create Biography</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this person\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deletePerson($event, vm.person)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/task/show.html\",\"<md-content flex layout=column> <div class=task-info> <span class=label>{{vm.task.label}}</span> <span class=description>{{vm.task.description}}</span> </div> <md-input-container> <label>Search</label> <md-icon>search</md-icon> <input type=search ng-model=filter ng-change=vm.search(filter)> </md-input-container> <md-content flex> <div layout=row layout-align=\\\"center center\\\" ng-if=vm.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-repeat=\\\"stageId in vm.stageOrder\\\" ng-if=vm.worklists[stageId]> <md-subheader>{{vm.workflow.stages[stageId].label}}</md-subheader> <md-list> <md-list-item ng-repeat=\\\"item in vm.worklists[stageId].items | filter : filter | limitTo : 20\\\" ng-mouseover=\\\"item.hover = true\\\" ng-mouseout=\\\"item.hover = false\\\" ng-click=\\\"vm.focusItem(item, $event)\\\"> <span ng-bind-html=item.label></span> <span flex></span> <md-button class=md-exclude ng-repeat=\\\"transition in vm.workflow.stages[stageId].transitions\\\" ng-click=\\\"vm.transition(item, transition, $event)\\\" ng-show=item.hover> <span>{{transition.label}}</span> </md-button> </md-list-item> </md-list> </div> </md-content> </md-content>\");\n$templateCache.put(\"app/task/task.html\",\"<md-content flex layout=column> <navbar title=\\\"Task Management Dashboard\\\" sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <div ng-if=vm.loading flex layout=row layout-align=\\\"center center\\\"> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <md-list ng-if=!vm.loading> <md-list-item ng-repeat=\\\"task in vm.tasks\\\" ui-sref=\\\"task.show({ taskId: task.id })\\\"> {{ task.label }} </md-list-item> </md-list> </md-sidenav> <md-content flex layout=column ui-view> <div layout=row layout-padding layout-margin layout-align=\\\"center center\\\"> <div class=md-headline>Please select a task from the sidebar.</div> </div> </md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/work/edition-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=vm.edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/edition.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li>{{vm.edition.editionName}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.edition.authors && vm.edition.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.edition.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.edition.publicationInfo> <span ng-if=vm.edition.publicationInfo.place> <span class=place>{{vm.edition.publicationInfo.place}}</span>: </span> <span ng-if=vm.edition.publicationInfo.publisher> <span class=publisher>{{vm.edition.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.edition.publicationInfo.date> <time class=date datetime={{vm.edition.publicationInfo.date.calendar}}>{{vm.edition.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.edition.summary ng-bind-html=vm.edition.summary></p> </section> <section class=\\\"content volumes\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addVolume($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"volume in vm.edition.volumes\\\" ui-sref=\\\"editor.volume({workId: vm.work.id, editionId: vm.edition.id, volumeId: volume.id})\\\"> <span>Volume {{volume.volumeNumber}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteVolume(volume, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.edition.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToWork(copy) aria-label=\\\"copy to parent work\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Work</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/volume-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=vm.volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=vm.volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/volume.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li><a ui-sref=\\\"editor.work({workId: vm.work.id})\\\">{{vm.workTitle.title}}{{vm.workTitle.title && vm.workTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.workTitle.subtitle}}</a></li> <li><a ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: vm.edition.id})\\\">{{vm.edition.editionName}}</a></li> <li>Volume {{vm.volume.volumeNumber}}</li> </ol> </nav> <div layout=row layout-padding> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.volume.authors && vm.volume.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.volume.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> <span class=publication ng-if=vm.volume.publicationInfo> <span ng-if=vm.volume.publicationInfo.place> <span class=place>{{vm.volume.publicationInfo.place}}</span>: </span> <span ng-if=vm.volume.publicationInfo.publisher> <span class=publisher>{{vm.volume.publicationInfo.publisher}}</span>, </span> <span ng-if=vm.volume.publicationInfo.date> <time class=date datetime={{vm.volume.publicationInfo.date.calendar}}>{{vm.volume.publicationInfo.date.description}}</time>. </span> </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.volume.summary ng-bind-html=vm.volume.summary></p> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.volume.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button\\\" ng-click=vm.copyToEdition(copy) aria-label=\\\"copy to parent edition\\\"> <md-icon>file_upload</md-icon> <md-tooltip>Copy to Edition</md-tooltip> </md-button> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> </div> </div>\");\n$templateCache.put(\"app/work/work-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Bibliographic Information Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addTitle($event)> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in vm.work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteTitle(title, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=\\\"vm.addAuthor(\\'authors\\', $event)\\\"> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in vm.work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.deleteAuthor(\\'authors\\', author, $event)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/work.html\",\"<nav layout=row layout-padding> <ol class=breadcrumbs flex> <li>{{vm.bcTitle.title}}{{vm.bcTitle && vm.bcTitle.subtitle ? \\': \\' : \\'\\'}}{{vm.bcTitle.subtitle}}</li> </ol> </nav> <div layout=row layout-padding flex=noshrink> <div layout=column flex=60> <section class=\\\"content citation\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliographic Information</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibInfo($event)> <md-icon>edit</md-icon> </md-button> </div> <p> <span class=authors ng-if=\\\"vm.work.authors && vm.work.authors.length > 0\\\"> <span class=author ng-repeat=\\\"author in vm.work.authors\\\"> <span ng-if=author.authorId> <a ui-sref=\\\"editor.person({id: author.authorId})\\\">{{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}</a>. </span> <span ng-if=!author.authorId> {{author.lastName}}{{author.lastName && author.firstName ? \\', \\' : \\'\\'}}{{author.firstName}}. </span> </span> </span> <span class=title ng-if=vm.title> {{vm.title.title}}{{vm.title.title && vm.title.subtitle ? \\': \\' : \\'\\'}}{{vm.title.subtitle}}. </span> </p> </section> <section class=\\\"content summary\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Summary</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editSummary($event)> <md-icon>edit</md-icon> </md-button> </div> <p ng-if=vm.work.summary ng-bind-html=vm.work.summary></p> </section> <section class=\\\"content editions\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addEdition($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"edition in vm.work.editions | orderBy:\\'publicationInfo.date.calendar\\'\\\" ui-sref=\\\"editor.edition({workId: vm.work.id, editionId: edition.id})\\\"> <span>{{edition.editionName}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteEdition(edition, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content bibliography\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Bibliography</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.editBibliography($event)> <md-icon>edit</md-icon> </md-button> </div> <bibliography refs=vm.references style-id=mla></bibliography> </section> </div> <div layout=column flex=40> <relationships class=\\\"content references\\\" anchor=vm.anchor></relationships> <section class=\\\"content copies\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.addCopy($event)> <md-icon>add</md-icon> </md-button> </div> <md-list> <md-list-item ng-repeat=\\\"copy in vm.work.copies\\\" ng-click=\\\"vm.editCopy(copy, $event)\\\"> <span>{{copy.title}}</span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" ng-click=\\\"vm.deleteCopy(copy, $event)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </section> <section class=\\\"content see-also\\\"> <div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>See Also</h2> </div> <see-also-editor source-token=vm.work.ref.token></see-also-editor> </section> </div> </div> <div layout=row layout-align=end layout-margin> <div> <md-button class=md-icon-button aria-label=\\\"Create Book Review\\\" ng-click=\\\"vm.createBookReview($event, vm.work)\\\"> <md-icon>assignment</md-icon> <md-tooltip md-direction=top>Create Book Review</md-tooltip> </md-button> <md-button aria-label=\\\"Delete this work\\\" class=\\\"md-warn md-icon-button\\\" ng-click=\\\"vm.deleteWork($event, vm.work)\\\"> <md-icon>delete</md-icon> <md-tooltip md-direction=top>Delete</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/creator-field.html\",\"<div layout=row layout-margin> <md-input-container> <label>Role</label> <md-select ng-model=$ctrl.creator.creatorType ng-disabled=\\\"!$ctrl.roles || $ctrl.roles.length == 0\\\"> <md-option ng-value=role.role ng-repeat=\\\"role in $ctrl.roles\\\">{{role.label}}</md-option> </md-select> </md-input-container> <md-input-container ng-if=verbatim flex> <label>Name</label> <input type=text ng-model=$ctrl.creator.name> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>First Name</label> <input type=text ng-model=$ctrl.creator.firstName> </md-input-container> <md-input-container ng-if=!verbatim flex> <label>Last Name</label> <input type=text ng-model=$ctrl.creator.lastName> </md-input-container> <div layout=column layout-align=\\\"center center\\\"> <md-button ng-show=verbatim ng-click=\\\"verbatim = false\\\" class=md-icon-button aria-label=\\\"First/Last Names\\\"> <md-icon>people</md-icon> <md-tooltip>First/Last Names</md-tooltip> </md-button> <md-button ng-hide=verbatim ng-click=\\\"verbatim = true\\\" class=md-icon-button aria-label=\\\"Single Name\\\"> <md-icon>domain</md-icon> <md-tooltip>Single Name</md-tooltip> </md-button> </div> </div>\");\n$templateCache.put(\"app/zotero/editor.html\",\"<div layout=column flex> <div layout=row layout-margin> <md-autocomplete md-search-text=$ctrl.itemTypeSearchText md-items=\\\"type in $ctrl.types | filter: {label: $ctrl.itemTypeSearchText}\\\" md-item-text=type.label md-selected-item=$ctrl.itemType md-selected-item-change=$ctrl.selectType($ctrl.itemType) md-min-length=0 md-floating-label=\\\"Item Type\\\" required> <md-item-template> <span md-highlight-text=$ctrl.itemTypeSearchText md-highlight-flags=^i>{{type.label}}</span> </md-item-template> </md-autocomplete> </div> <div layout=row ng-repeat=\\\"creator in $ctrl.item.creators\\\" layout-align=\\\"start center\\\"> <zotero-creator-field creator=creator roles=$ctrl.roles flex></zotero-creator-field> <md-button ng-click=\\\"$ctrl.item.creators.splice($index+1, 0, {})\\\" class=md-icon-button aria-label=\\\"New Creator\\\"> <md-icon>add</md-icon> <md-tooltip>New</md-tooltip> </md-button> <md-button ng-disabled=\\\"$ctrl.item.creators.length <= 1\\\" ng-click=\\\"$ctrl.item.creators.splice($index, 1)\\\" class=\\\"md-icon-button md-warn\\\" aria-label=\\\"Delete Creator\\\"> <md-icon>remove</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </div> <div layout=row layout-margin ng-repeat=\\\"field in $ctrl.fields\\\"> <md-input-container flex> <label>{{field.label}}</label> <input type=text ng-model=$ctrl.item[field.id]> </md-input-container> </div> <div ng-if=!$ctrl.itemType layout-margin> <p>Please select an item type first.</p> </div> </div>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-edit-dialog.html\",\"<md-dialog aria-label=\\\"Edit Citation\\\" flex=50 layout=column> <form ng-cloak> <md-toolbar> <div class=md-toolbar-tools> <h2>Edit Citation</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon aria-label=Cancel>close</md-icon> </md-button> </div> </md-toolbar> <md-dialog-content> <div class=md-dialog-content> <citation-editor references=vm.references citation=vm.citation></citation-editor> </div> </md-dialog-content> <md-dialog-actions layout=row> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/citation-edit-dialog/citation-editor.html\",\"<div class=citation-editor-layout layout=column flex> <div class=citation-editor-container ng-hide=$ctrl.zoteroItem layout=column flex> <div layout=row layout-wrap> <div layout=row layout-align=\\\"start center\\\" layout-margin class=md-whiteframe-2dp ng-repeat=\\\"item in $ctrl.citation.items\\\"> <span ng-bind-html=item.label></span> <md-button class=md-icon-button aria-label=Edit ng-click=$ctrl.edit(item)> <md-icon>edit</md-icon> <md-tooltip>Edit Item</md-tooltip> </md-button> <md-button class=\\\"md-icon-button md-warn\\\" aria-label=Remove ng-click=\\\"$ctrl.citation.items.splice($index, 1)\\\"> <md-icon>remove</md-icon> <md-tooltip>Remove Item</md-tooltip> </md-button> </div> </div> <div layout=column> <md-autocomplete md-autoselect md-floating-label=\\\"Referenced Item\\\" md-selected-item=$ctrl.selectedBiblioItem md-selected-item-change=$ctrl.selectBiblioItem($ctrl.selectedBiblioItem) md-search-text=$ctrl.searchText md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-delay=200 md-require-match required> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found> No matches found. <md-button ng-click=$ctrl.createZoteroItem($event)>Create</md-button> </md-not-found> </md-autocomplete> <div layout=row> <md-input-container> <label>Locator Type</label> <md-select ng-model=$ctrl.activeCitationItem.locatorType> <md-option></md-option> <md-option ng-repeat=\\\"type in $ctrl.locatorTypes\\\" ng-value=type>{{type}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label>Locator</label> <input type=text ng-model=$ctrl.activeCitationItem.locator> </md-input-container> </div> <md-checkbox ng-model=$ctrl.activeCitationItem.suppressAuthor> Suppress Author Name in In-Text Citation </md-checkbox> </div> <div layout=row layout-align=end> <md-button class=md-raised ng-click=$ctrl.addCitationItem($ctrl.activeCitationItem)> Save Item </md-button> </div> </div> <div class=zotero-item-editor-container ng-if=$ctrl.zoteroItem layout=row flex> <div layout=column> <md-button class=md-icon-button ng-click=$ctrl.cancelZoteroItem($event)> <md-icon>cancel</md-icon> <md-tooltip md-direction=right>Cancel New Item</md-tooltip> </md-button> <md-button class=md-icon-button ng-click=\\\"$ctrl.saveZoteroItem($event, $ctrl.zoteroItem)\\\"> <md-icon>check_circle</md-icon> <md-tooltip md-direction=right>Save and Cite Item</md-tooltip> </md-button> </div> <zotero-editor item=$ctrl.zoteroItem flex></zotero-editor> </div> </div>\");\n$templateCache.put(\"app/components/ckeditor-footnotes/footnote-edit-dialog.html\",\"<md-bottom-sheet aria-label=\\\"Insert Footnote\\\" layout=column> <md-toolbar> <div class=md-toolbar-tools> <h2>Insert Footnote</h2> <span flex></span> <md-button ng-click=vm.cancel()> Cancel </md-button> <md-button ng-click=vm.done()> Save </md-button> </div> </md-toolbar> <div ng-if=vm.references ng-model=vm.footnote.content ckeditor=vm.ckeditorConfig ckeditor-bibliography=vm.references></div> <div ng-if=!vm.references ng-model=vm.footnote.content ckeditor=vm.ckeditorConfig></div> </md-bottom-sheet>\");\n$templateCache.put(\"app/components/date-editor/date-editor.html\",\"<div layout=row> <md-input-container flex> <label>date</label> <input type=text ng-model=date.description> </md-input-container> <md-input-container flex> <label>calendar date</label> <input type=datetime ng-model=date.calendar ng-change=\\\"calendarAutoSet = false\\\"> </md-input-container> </div>\");\n$templateCache.put(\"app/components/navbar/navbar.html\",\"<md-toolbar> <div class=md-toolbar-tools> <md-button ng-if=$ctrl.sidenavId class=\\\"md-accent md-icon-button\\\" ng-click=$ctrl.toggleSidenav($ctrl.sidenavId) title=\\\"toggle menu\\\" hide-gt-sm> <md-icon>menu</md-icon> </md-button> <img class=logo src=assets/images/sda-logo-light.png> <h2> <span>{{$ctrl.title}}</span><!-- make this change based on page --> </h2> <span flex></span> <md-button ui-sref=editor>People and Works</md-button> <md-button ui-sref=article>Article</md-button> <md-button ui-sref=task>Tasks</md-button> </div> </md-toolbar>\");\n$templateCache.put(\"app/components/see-also-editor/see-also-editor.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.seeAlso\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load links from the server. </div> </div> <div layout=column ng-if=\\\"!$ctrl.loading && $ctrl.seeAlso\\\"> <md-list ng-if=\\\"!($ctrl.seeAlso.links | empty)\\\"> <div ng-repeat=\\\"(type, targets) in $ctrl.seeAlso.links\\\"><!-- The type key is a machine identifier (e.g. \\'trc.entries.bibliographic\\')\\n      <md-subheader>{{type}}</md-subheader> --> <md-list-item ng-repeat=\\\"target in targets\\\" ng-click=\\\"$ctrl.openLink($event, target)\\\"> <span ng-bind-html=target.label></span> <md-button class=\\\"md-secondary md-icon-button md-warn\\\" aria-label=\\\"delete link\\\" ng-click=\\\"$ctrl.deleteLink($event, target)\\\"> <md-icon>delete</md-icon> <md-tooltip>Delete</md-tooltip> </md-button> </md-list-item> </div> </md-list> <div ng-if=\\\"$ctrl.seeAlso.links | empty\\\"> No links added. Add one below. </div> <form layout=row novalidate name=newLink ng-submit=$ctrl.createLink($ctrl.selectedItem)> <md-autocomplete md-items=\\\"item in $ctrl.search($ctrl.searchText)\\\" md-item-text=\\\"item.label | stripTags\\\" md-search-text=$ctrl.searchText md-selected-item=$ctrl.selectedItem md-selected-item-change=$ctrl.createLink($ctrl.selectedItem) md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"add link\\\" md-select-on-match md-match-case-insensitive flex> <md-item-template> <span ng-bind-html=item.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete><!-- link creation occurs on autocomplete selected item change\\n    <md-button type=\\\"submit\\\" class=\\\"md-icon-button\\\" ng-disabled=\\\"!$ctrl.selectedItem\\\">\\n      <md-icon>add</md-icon>\\n      <md-tooltip>Add Link</md-tooltip>\\n    </md-button>\\n    --> </form> </div>\");\n$templateCache.put(\"app/components/summary-edit-dialog/summary-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Summary Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content><!-- material-compliant padding not used since WYSIWYG text editor *is* the UI --> <summary-editor ng-model=vm.summary></summary-editor> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/components/summary-editor/summary-editor.html\",\"<div ckeditor ng-model=summary></div>\");\n$templateCache.put(\"app/zotero/test/test.html\",\"<div layout=column flex> <md-content> <zotero-editor item=vm.item types=vm.types></zotero-editor> </md-content> </div>\");\n$templateCache.put(\"app/person/components/event-edit-dialog/event-edit-dialog.html\",\"<md-dialog flex=80> <md-toolbar> <div class=md-toolbar-tools> <h3>Event Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <event-editor ng-model=vm.event flex></event-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/admin/editors/articles/article-editor.html\",\"<div flex layout=column layout-padding><!-- title editor bar --> <md-content layout=row flex=none> <md-input-container class=no-space flex> <label>Title</label> <input type=text ng-model=vm.article.title> </md-input-container> <div flex=none> <md-button class=\\\"md-raised md-primary\\\" ng-click=vm.save()>Save</md-button> </div> </md-content> <div layout=column flex=none class=authors> <h3 layout=row> <span>Authors</span> <span flex></span> <span> <md-button class=md-icon-button aria-label=\\\"add author\\\" ng-click=vm.article.authors.push({})> <md-icon>add</md-icon> <md-tooltip>Add Author</md-tooltip> </md-button> </span> </h3> <div layout=row ng-repeat=\\\"author in vm.article.authors\\\"> <article-author-editor author=author flex></article-author-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"vm.article.authors.splice($index, 1)\\\" ng-if=\\\"vm.article.authors.length > 1\\\"> <md-icon>delete</md-icon> <md-tooltip>Remove Author</md-tooltip> </md-button> </div> </div><!-- TODO add save button and auto-save --><!-- TODO add sidebar for notes, biblio, links, etc --> <div id=article_editor flex=noshrink layout=column> <div ng-model=vm.article.body ckeditor=vm.editor.config ckeditor-bibliography=vm.references ckeditor-footnotes=vm.article.footnotes> </div> <md-tabs flex=noshrink> <md-tab label=Abstract> <div ckeditor=vm.abstractEditor.config ng-model=vm.article.abstract></div> </md-tab> <md-tab label=Bibliography> <bibliography refs=vm.references style-id=mla></bibliography> </md-tab> <md-tab label=Footnotes> <div class=footnotes ng-repeat=\\\"footnote in vm.article.footnotes\\\" layout=row> <div class=footnote ng-bind-html=footnote.content flex></div> <md-button class=md-icon-button aria-label=\\\"edit footnote\\\" ng-click=\\\"vm.editFootnote($event, footnote)\\\"> <md-icon>edit</md-icon> <md-tooltip>Edit Footnote</md-tooltip> </md-button> </div> </md-tab> <md-tab label=\\\"See Also\\\"> <see-also-editor source-token=vm.article.ref.token></see-also-editor> </md-tab> </md-tabs> </div><!-- TODO how to make this fill all available space --> </div>\");\n$templateCache.put(\"app/admin/editors/articles/article.html\",\"<md-content flex layout=column> <navbar title=Articles sidenav-id=left></navbar> <md-content flex layout=row> <md-sidenav md-component-id=left md-is-locked-open=\\\"$mdMedia(\\'gt-sm\\')\\\" layout=column> <md-tabs flex> <md-tab> <md-tab-label> <md-icon>format_list_bulleted</md-icon> <md-tooltip md-direction=bottom>Thematic Overviews</md-tooltip> </md-tab-label> <md-tab-body> <tree-categorization-editor scope-id=sda scheme=overviews> </tree-categorization-editor> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>school</md-icon> <md-tooltip md-direction=bottom>Research Articles</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=research></article-type-search> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>book</md-icon> <md-tooltip md-direction=bottom>Book Reviews</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=book-review></article-type-search> </md-tab-body> </md-tab> <md-tab> <md-tab-label> <md-icon>person</md-icon> <md-tooltip md-direction=bottom>Biographies</md-tooltip> </md-tab-label> <md-tab-body> <article-type-search type=biography></article-type-search> </md-tab-body> </md-tab> </md-tabs> <md-fab-speed-dial md-direction=up class=\\\"md-scale md-fab-bottom-right md-fab-straddle\\\"> <md-fab-trigger> <md-button aria-label=New... class=md-fab> <md-icon>add</md-icon> </md-button> </md-fab-trigger> <md-fab-actions> <md-button aria-label=\\\"New Research Article\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'research\\')\\\"> <md-tooltip md-direction=left>New Research Article</md-tooltip><!-- <md-icon>description</md-icon> --> <md-icon>school</md-icon> </md-button> <md-button aria-label=\\\"New Book Review\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'book-review\\')\\\"> <md-tooltip md-direction=left>New Book Review</md-tooltip> <md-icon>book</md-icon> </md-button> <md-button aria-label=\\\"New Biography\\\" class=\\\"md-fab md-mini\\\" ng-click=\\\"vm.createArticle($event, \\'biography\\')\\\"> <md-tooltip md-direction=left>New Biography</md-tooltip> <md-icon>person</md-icon> </md-button> </md-fab-actions> </md-fab-speed-dial> </md-sidenav> <md-content flex layout=column ui-view></md-content> </md-content> </md-content>\");\n$templateCache.put(\"app/admin/editors/articles/thematic-overview.html\",\"<div id=thematic_overviews> <script type=text/ng-template id=treeCategoryEntry.html><div class=\\\"category-node\\\" layout=\\\"row\\\" layout-align=\\\"start center\\\">\\n     <!--  Display label for the category node-->\\n     <span ng-if=\\\"node.entryRef == null\\\" class=\\\"node-label\\\">{{ node.label }}</span>\\n     <a ui-sref=\\\"article.edit({id:node.entryRef.id})\\\" ng-if=\\\"node.entryRef != null\\\" class=\\\"node-label\\\">{{ node.label }}</a>\\n\\n     <!-- push buttons to edge -->\\n     <span flex></span>\\n\\n     <!-- node action menu -->\\n     <md-menu class=\\\"action\\\">\\n       <!-- activate handle -->\\n       <md-button ng-click=\\\"$mdOpenMenu($event)\\\" class=\\\"md-icon-button\\\">\\n         <md-icon>arrow_drop_down</md-icon>\\n       </md-button>\\n\\n       <md-menu-content>\\n         <!-- Associate/Remove  -->\\n         <md-menu-item>\\n           <md-button ng-if=\\\"node.entryRef.id == null\\\"\\n                      ng-click=\\\"vm.handleAssociateEntry($event, node)\\\">\\n             <md-icon>add_circle_outline</md-icon>\\n             Create Article\\n           </md-button>\\n           <md-button ng-if=\\\"node.entryRef.id != null\\\"\\n                      ng-click=\\\"vm.handleRemoveEntry($event, node)\\\">\\n             <md-icon>remove_circle_outline</md-icon>\\n             Remove Article\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleCreateChild($event, node)\\\">\\n             <!-- Will create a child node at the end of this list. User can drag to re-arrange -->\\n             <md-icon>create_new_folder</md-icon>\\n             Create Sub-Category\\n           </md-button>\\n         </md-menu-item>\\n\\n         <md-menu-item>\\n           <md-button ng-click=\\\"vm.handleDeleteNode($event, node, parent)\\\">\\n             <!-- Will delete this node, all children and associated articles. If leaf node,\\n             displays delete instead of delete sweep. Prompts user to confirm. -->\\n             <md-icon>delete{{ node.children.length == 0 ? \\'\\' : \\'_sweep\\' }}</md-icon>\\n             Remove Category\\n           </md-button>\\n         </md-menu-item>\\n       </md-menu-content>\\n     </md-menu>\\n   </div>\\n\\n   <ol ng-if=\\\"node.children.length > 0\\\">\\n     <li ng-repeat=\\\"node in node.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = $parent.$parent.node\\\"></li>\\n   </ol></script> <ol> <li ng-repeat=\\\"node in vm.overviews.root.children\\\" ng-include=\\\"\\'treeCategoryEntry.html\\'\\\" ng-init=\\\"parent = vm.overviews.root\\\"></li> </ol> <div layout=row layout-align=\\\"center center\\\"><!-- TODO need additional styling --> <md-button ng-click=\\\"vm.handleCreateChild($event, vm.overviews.root)\\\" class=md-raised aria-label=\\\"create category\\\">Create Category</md-button> </div> </div>\");\n$templateCache.put(\"app/person/components/event-editor/event-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex> <label>location</label> <input type=text ng-model=event.location> </md-input-container> <date-editor ng-model=event.date flex></date-editor> </div> <div layout=row layout-padding> <div flex> <h2>Description</h2> <div flex ckeditor ng-model=event.description></div> </div> </div> </div>\");\n$templateCache.put(\"app/person/components/name-editor/name-editor.html\",\"<div layout=column> <div layout=row> <md-input-container flex=10> <label>title</label> <input type=text ng-model=name.title> </md-input-container> <md-input-container flex=30> <label>given</label> <input type=text ng-model=name.givenName> </md-input-container> <md-input-container flex=20> <label>middle</label> <input type=text ng-model=name.middleName> </md-input-container> <md-input-container flex=30> <label>family</label> <input type=text ng-model=name.familyName> </md-input-container> <md-input-container flex=10> <label>suffix</label> <input type=text ng-model=name.suffix> </md-input-container> </div> <md-input-container> <label>display label</label> <input type=text ng-model=name.label required> </md-input-container> </div>\");\n$templateCache.put(\"app/task/components/edition-editor/edition-editor.html\",\"<div layout=row> <md-input-container flex> <label>edition name</label> <input type=text ng-model=edition.editionName required> </md-input-container> </div> <section class=publication layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Publication Information</h2> </div> </md-toolbar> <publication-info-editor ng-model=edition.publicationInfo flex></publication-info-editor> </section> <section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.titles.push({})> <md-icon>add</md-icon>  </md-button></div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in edition.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in edition.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=edition.summary flex></summary-editor> </section> <section class=volumes> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Volumes</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createVolume()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=volume layout=column layout-margin ng-repeat=\\\"volume in vm.volumes\\\" ng-class=\\\"{\\'md-whiteframe-2dp\\': !volume.focused, \\'md-whiteframe-8dp\\': volume.focused}\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"volume.focused = !volume.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>Volume {{volume.model.volumeNumber}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteVolume($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=volume.focused> <volume-editor ng-model=volume.model flex></volume-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=edition.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in edition.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"edition.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/volume-editor/volume-editor.html\",\"<div layout=row> <md-input-container flex> <label>volume number</label> <input type=text ng-model=volume.volumeNumber required> </md-input-container> </div> <section class=publication layout=column> <h2>Publication Information</h2> <publication-info-editor ng-model=volume.publicationInfo></publication-info-editor> </section> <section class=titles layout=column> <h2 layout=row> <span flex>Titles</span> <md-button class=md-icon-button ng-click=volume.titles.push({})> <md-icon>add</md-icon>  </md-button></h2> <div class=title layout=row ng-repeat=\\\"title in volume.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <h2 layout=row> <span flex>Authors</span> <md-button class=md-icon-button ng-click=volume.authors.push({})> <md-icon>add</md-icon> </md-button> </h2> <div class=author layout=row ng-repeat=\\\"author in volume.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <h2>Summary</h2> <summary-editor ng-model=volume.summary flex></summary-editor> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=volume.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in volume.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"volume.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor/work-editor.html\",\"<section class=titles layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Titles</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.titles.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=title layout=row ng-repeat=\\\"title in work.titles\\\"> <title-editor ng-model=title flex></title-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.titles.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </md-input-container> </div> </section> <section class=authors layout=column> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Authors</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.authors.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=author layout=row ng-repeat=\\\"author in work.authors\\\"> <author-ref-editor ng-model=author flex></author-ref-editor> <md-input-container> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.authors.splice($index, 1)\\\"> <md-icon>delete</md-icon>  </md-button></md-input-container> </div> </section> <section class=summary> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Summary</h2> </div> </md-toolbar> <summary-editor ng-model=work.summary flex></summary-editor> </section> <section class=editions> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Editions</h2> <span flex></span> <md-button class=md-icon-button ng-click=vm.createEdition()> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <md-whiteframe class=edition layout=column layout-margin ng-repeat=\\\"edition in vm.editions | orderBy:\\'publicationInfo.date.calendar\\'\\\" ng-class=\\\"{ \\'md-whiteframe-2dp\\': !edition.focused, \\'md-whiteframe-8dp\\': edition.focused }\\\"> <h3 layout=row> <div flex layout=row layout-align=\\\"start center\\\" ng-click=\\\"edition.focused = !edition.focused\\\"> <md-icon>{{ edition.focused ? \\'expand_less\\' : \\'expand_more\\'}}</md-icon> <span>{{edition.model.editionName}}</span> <span flex></span> </div> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=vm.deleteEdition($index)> <md-icon>delete</md-icon> </md-button> </h3> <div class=slide ng-show=edition.focused> <edition-editor ng-model=edition.model flex></edition-editor> </div> </md-whiteframe> </section> <section class=copies> <md-toolbar class=md-hue-3> <div class=md-toolbar-tools> <h2>Digital Copies</h2> <span flex></span> <md-button class=md-icon-button ng-click=work.copies.push({})> <md-icon>add</md-icon> </md-button> </div> </md-toolbar> <div class=copy layout=column ng-repeat=\\\"copy in work.copies\\\"> <div layout=row> <copy-editor ng-model=copy flex></copy-editor> <md-button class=\\\"md-icon-button md-warn\\\" ng-click=\\\"work.copies.splice($index, 1)\\\"> <md-icon>delete</md-icon> </md-button> </div> </div> </section>\");\n$templateCache.put(\"app/task/components/work-editor-item/work-editor-item.html\",\"<div layout=row layout-align=\\\"center center\\\" ng-if=!vm.loaded> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div> <div ng-if=vm.loaded> <work-editor ng-model=vm.work></work-editor> </div>\");\n$templateCache.put(\"app/work/components/author-ref-editor/author-ref-editor.html\",\"<div layout=column> <div layout=row> <md-autocomplete required md-items=\\\"item in vm.authorRoles\\\" md-item-text=role md-min-length=0 md-search-text=ref.role md-selected-item-change=\\\"ref.role = item\\\" md-floating-label=role> <md-item-template> <span md-highlight-text=ref.role>{{item}}</span> </md-item-template> </md-autocomplete> <md-input-container flex> <label>first name</label> <input type=text ng-model=ref.firstName> </md-input-container> <md-input-container flex> <label>last name</label> <input type=text ng-model=ref.lastName> </md-input-container> </div> <div layout=row> <md-autocomplete flex md-items=\\\"person in vm.getResults(vm.linkAuthorSearchText)\\\" md-item-text=\\\"person.label | stripTags\\\" md-search-text=vm.linkAuthorSearchText md-search-text-change=vm.searchPeople(vm.linkAuthorSearchText) md-selected-item-change=vm.setLinkedAuthor(person) md-floating-label=\\\"linked author\\\"> <md-item-template> <span md-highlight-text=vm.linkAuthorSearchText ng-bind-html=person.label></span> </md-item-template> <md-not-found>No matches found.</md-not-found> </md-autocomplete> </div> </div>\");\n$templateCache.put(\"app/work/components/copy-edit-dialog/copy-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Digital Copy Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content> <copy-editor ng-model=vm.copy></copy-editor> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/copy-editor/copy-editor.html\",\"<ng-form name=copyForm layout=column flex> <md-input-container> <label for=title>Title</label> <input type=text name=title id=title ng-model=copy.title> </md-input-container> <div layout=row> <md-input-container> <label for=type>Type</label> <md-select name=type id=type ng-model=copy.type required ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> <md-option ng-repeat=\\\"handler in vm.refHandlers\\\" value={{handler.id}}>{{handler.display}}</md-option> </md-select> </md-input-container> <md-input-container flex> <label for=url>URL</label> <input type=url name=url id=url ng-model=copyUrl ng-change=\\\"vm.setProperties(copy.type, copyUrl)\\\"> </md-input-container> </div> <ul class=\\\"properties properties-inline\\\"> <li ng-repeat=\\\"(key, value) in copy.properties\\\"> <span class=label>{{key}}</span> <span class=value>{{value}}</span> </li> </ul> <md-input-container> <label for=rights>Description of Rights</label> <input type=text name=rights id=rights ng-model=copy.rights> </md-input-container> <h3>Summary</h3> <summary-editor ng-model=copy.summary flex></summary-editor> </ng-form>\");\n$templateCache.put(\"app/work/components/publication-info-editor/publication-info-editor.html\",\"<div layout=row> <md-input-container flex> <label>publisher</label> <input type=text ng-model=pubInfo.publisher> </md-input-container> <md-input-container flex> <label>location</label> <input type=text ng-model=pubInfo.place> </md-input-container> <date-editor ng-model=pubInfo.date flex></date-editor> </div>\");\n$templateCache.put(\"app/work/components/reln-edit-dialog/reln-edit-dialog.html\",\"<md-dialog flex=50> <md-toolbar> <div class=md-toolbar-tools> <h3>Relationship Editor</h3> <span flex></span> <md-button class=md-icon-button ng-click=vm.cancel()> <md-icon>close</md-icon> </md-button> </div> </md-toolbar> <form name=relationship ng-submit=vm.close()> <md-dialog-content> <div class=md-dialog-content layout=column> <md-input-container> <label>type</label> <md-select name=type ng-model=vm.selectedType required> <md-option ng-repeat=\\\"type in vm.types\\\" ng-value=type> {{type.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.type.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <md-autocomplete md-items=\\\"work in vm.search(vm.searchText)\\\" md-search-text=vm.searchText md-selected-item=vm.selectedWork md-selected-item-change=vm.selectWork(work) md-item-text=\\\"work.label | stripTags\\\" md-require-match md-min-length=3 md-delay=300 md-autoselect md-floating-label=\\\"search works\\\" md-select-on-match md-match-case-insensitive> <md-item-template> <span ng-bind-html=work.label></span> </md-item-template> <md-not-found>No matches found</md-not-found> </md-autocomplete> <md-input-container ng-if=\\\"vm.anchors.length > 1\\\"> <label>target</label> <md-select name=target ng-model=vm.selectedAnchor required> <md-option ng-repeat=\\\"anchor in vm.anchors\\\" ng-value=anchor> {{anchor.label}} </md-option> </md-select> <div class=errors ng-messages=relationship.target.$error ng-if=relationship.$dirty> <div ng-message=required>Required</div> </div> </md-input-container> <div class=summary> <h2>Summary</h2> <div ckeditor ng-model=vm.description></div> </div> </div> </md-dialog-content> <md-dialog-actions> <md-button ng-click=vm.cancel()>Cancel</md-button> <md-button class=md-primary type=submit>Done</md-button> </md-dialog-actions> </form> </md-dialog>\");\n$templateCache.put(\"app/work/components/relationships/relationships.html\",\"<div class=toolbar layout=row layout-align=\\\"start center\\\"> <h2 class=content-heading>Relationships</h2> <span flex></span> <md-button class=md-icon-button ng-click=$ctrl.addRelationship($event) ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups\\\"> <md-icon>add</md-icon> </md-button> </div> <div ng-repeat=\\\"type in $ctrl.typeGroups\\\" ng-if=\\\"!$ctrl.loading && $ctrl.typeGroups.length > 0\\\"> <h3 class=content-heading>{{type.label}}</h3> <md-list><!-- TODO: clicking on relationship should open that relationship in an editor; clicking on an anchor should go to the linked item --> <md-list-item ng-repeat=\\\"reln in type.relationships\\\" ng-click=\\\"$ctrl.openRelationship($event, reln)\\\"> <span ng-repeat=\\\"anchor in reln.anchors\\\" ng-bind-html=anchor.label></span> <md-button class=\\\"md-secondary md-warn md-icon-button\\\" ng-click=\\\"$ctrl.deleteRelationship($event, reln)\\\"> <md-icon>delete</md-icon> </md-button> </md-list-item> </md-list> </div> <div ng-if=\\\"$ctrl.typeGroups && $ctrl.typeGroups.length == 0\\\"> No relationships to display. </div> <div layout=row layout-align=\\\"center center\\\" layout-margin ng-if=\\\"!$ctrl.loading && !$ctrl.typeGroups\\\"> <div> <md-icon>warning</md-icon> </div> <div> Unable to load relationships from the server. </div> </div> <div layout=row layout-align=\\\"center center\\\" ng-if=$ctrl.loading> <md-progress-circular md-mode=indeterminate></md-progress-circular> </div>\");\n$templateCache.put(\"app/work/components/title-editor/title-editor.html\",\"<div layout=row> <md-input-container> <label>type</label> <md-select ng-model=title.type required> <md-option value=bibliographic>bibliographic</md-option> <md-option value=canonical>canonical</md-option> <md-option value=short>short</md-option> </md-select> </md-input-container> <md-input-container flex> <label>title</label> <input type=text ng-model=title.title required> <div ng-switch=title.type> <small ng-switch-when=bibliographic>the full title as published on the work</small> <small ng-switch-when=canonical>title by which the work is commonly known in the academic realm</small> <small ng-switch-when=short>shortened title coloquially used by the public</small> </div> </md-input-container> <md-input-container flex> <label>subtitle</label> <input type=text ng-model=title.subtitle> </md-input-container> </div>\");\n$templateCache.put(\"app/admin/editors/articles/components/article-author-editor/article-author-editor.html\",\"<div layout=column layout-gt-sm=row layout-align-gt-sm=\\\"start center\\\"> <div layout=row layout-align=\\\"start center\\\" flex-gt-sm> <md-button class=md-icon-button ng-click=\\\"$ctrl.institution = !$ctrl.institution\\\"> <md-icon>{{$ctrl.institution ? \\'person\\' : \\'domain\\'}}</md-icon> </md-button> <div layout=row flex ng-show=$ctrl.institution> <md-input-container class=no-space flex> <label>name</label> <input type=text ng-model=$ctrl.author.name> </md-input-container> </div> <div layout=row flex ng-hide=$ctrl.institution> <md-input-container class=no-space flex> <label>first name</label> <input type=text ng-model=$ctrl.author.firstname> </md-input-container> <md-input-container class=no-space flex> <label>last name</label> <input type=text ng-model=$ctrl.author.lastname> </md-input-container> </div> </div> <div layout=row flex-gt-sm> <md-input-container class=no-space flex> <label>affiliation</label> <input type=text ng-model=$ctrl.author.properties.affiliation> </md-input-container> <md-input-container class=no-space flex> <label>email</label> <input type=text ng-model=$ctrl.author.properties.email> </md-input-container> </div> </div>\");\n$templateCache.put(\"app/admin/editors/articles/components/article-type-search/article-type-search.html\",\"<div layout=column> <div layout=row flex=none> <md-input-container flex> <label>search</label> <md-icon>search</md-icon> <input type=search ng-model=$ctrl.query ng-model-options=\\\"{debounce: 300}\\\" ng-change=$ctrl.search($ctrl.query)> </md-input-container> </div> <md-list layout=column> <md-list-item ng-repeat=\\\"article in $ctrl.results.articles\\\" ui-sref=\\\"article.edit({id: article.id})\\\"> <span class=md-list-item-text>{{article.title}}</span> </md-list-item> </md-list> </div>\");}]);"],"sourceRoot":"/source/"}