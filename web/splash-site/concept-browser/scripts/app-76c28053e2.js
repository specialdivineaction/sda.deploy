!function(){"use strict";angular.module("trcGraph",["ngResource"])}(),function(){"use strict";function e(){function e(e){function n(e){return r.get({type:e})}var r=e(t.url+"/:type"),o={};return o.get=n,o}e.$inject=["$resource"];var t={};return t.url="/api/graph",t.$get=e,t}angular.module("trcGraph").provider("graphRepo",e)}(),function(){"use strict";angular.module("trcBio",["ngResource"])}(),function(){"use strict";function e(){function e(e,n){function r(){var e=new h;return m(e)}function o(){var e={};return f(e)}function i(){var e={};return p(e)}function a(){var e={};return g(e)}function l(){var e={};return e}function c(e){return h.get({id:e})}function d(e){return h.get({q:e})}function u(e){var t;return t=e.id?h.update({id:e.id},e):h.save(null,e),t.$promise.then(function(t){return e.id=t.id,e})}function s(e){var t=h["delete"]({id:e});return t.$promise}function m(e){return e.meta?f(e.meta):e.meta=o(),e.name?p(e.name):e.name=i(),e.altNames?e.altNames.forEach(p):e.altNames=[],e.birth?g(e.birth):e.birth=a(),e.death?g(e.death):e.death=a(),e}function f(e){return e.links||(e.links={}),e}function p(e){return e}function g(e){return e.date||(e.date=l()),e}var h=n(t.url+"/:id",null,{update:{method:"PUT"}}),v={};return v.create=r,v.createName=i,v.createEvent=a,v.get=c,v.search=d,v.save=u,v["delete"]=s,v}e.$inject=["$q","$resource"];var t={};return t.url="/api/people",t.$get=e,t}angular.module("trcBio").provider("peopleRepo",e)}(),function(){"use strict";function e(){function e(e,t){function n(){var n=t.createName();e.person.altNames.push(n)}function r(t){e.person.altNames.splice(t,1)}function o(n){var r=t.createEvent();e.person[n]=r}function i(t){e.person[t]=null}var a=this;a.addName=n,a.removeName=r,a.addEvent=o,a.removeEvent=i}e.$inject=["$scope","peopleRepo"];var t={restrict:"E",templateUrl:"app/trc-bio/person-editor.html",scope:{person:"=ngModel"},controller:e,controllerAs:"personEditor"};return t}angular.module("trcBio").directive("trcPersonEditor",e)}(),function(){"use strict";function e(){function e(){var e=this;e.roles=[{value:"canonical",label:"Canonical Name"},{value:"pseudonym",label:"Pseudonym"},{value:"maiden",label:"Maiden Name"},{value:"designation",label:"Honorary Designation"},{value:"nickname",label:"Nickname"},{value:"phonetic",label:"Phonetic Name"}]}var t={restrict:"E",templateUrl:"app/trc-bio/name-editor.html",scope:{name:"=ngModel"},controller:e,controllerAs:"nameEditor"};return t}angular.module("trcBio").directive("trcNameEditor",e)}(),function(){"use strict";function e(){var e={restrict:"E",templateUrl:"app/trc-bio/event-editor.html",scope:{event:"=ngModel"}};return e}angular.module("trcBio").directive("trcEventEditor",e)}(),function(){"use strict";angular.module("sda.concept-browser",["ngAnimate","ngCookies","ngSanitize","ngMessages","ngAria","ngResource","ui.router","ngMaterial","trcBiblio","trcBio","trcGraph"])}(),function(){"use strict";function e(e,n,r,o,i,a,l,c,d,u,s,m,f,p){function g(){v(),b();var e="people",t=c.type||e;$.graphLoading=!0,M(t)["catch"](function(){return o.showSimple('Unable to load the "'+t+'"graph type. Falling back to "'+e+'".'),M(e)}).then(function(e){$.graphLoading=!1,$.graph=e.graph},function(){$.graphLoading=!1,o.showSimple("Unable to load graph data.")}),n.$watch("main.activeNode",function(e){e?($.sidebarLoading=!0,E(e).then(function(){$.sidebarLoading=!1},function(){$.sidebarLoading=!1,o.showSimple("Unable to load node data")})):$.person=null}),n.$watch("searchQuery",function(e){$.highlightedNodes=e?d("filter")($.graph.nodes,{label:e}):[]})}function h(e){var t=$.relnTypeFilter.indexOf(e);0>t?$.relnTypeFilter.push(e):$.relnTypeFilter.splice(t,1)}function v(){$.selectModes.push({label:"Neighbors",strategy:function(e){if(!e)return[];var t=e.outEdges.filter(k).map(function(e){return e.target}),n=e.inEdges.filter(k).map(function(e){return e.source});return[e].concat(t,n)}}),$.selectModes.push({label:"Trace",strategy:function(e){if(!e)return[];for(var t=[e],n=[];t.length>0;){var r=t.pop();n.push(r),r.outEdges.forEach(function(e){n.indexOf(e.target)<0&&t.push(e.target)})}return n}}),$.selectModes.push({label:"Inbound",strategy:function(e){return e?[e].concat(e.inEdges.filter(k).map(function(e){return e.source})):[]}}),$.selectModes.push({label:"Outbound",strategy:function(e){return e?[e].concat(e.outEdges.filter(k).map(function(e){return e.target})):[]}}),$.selectMode=$.selectModes[0]}function b(){$.sizeMetrics.push({label:"PageRank",strategy:function(e){return e.metadata.pagerank}}),$.sizeMetrics.push({label:"Uniform",strategy:function(){return 1}}),$.sizeMetrics.push({label:"HITS",disabled:!0,strategy:function(){return 1}}),$.sizeMetric=$.sizeMetrics[0]}function y(){$.showSearchForm=!$.showSearchForm,$.showSearchForm?u(function(){angular.element('.search-form > input[type="search"]').focus()}):n.searchQuery=""}function w(){n.searchQuery="",u(function(){$.showSearchForm=!1})}function x(e){var t={targetEvent:e,fullscreen:a("sm")||a("xs"),templateUrl:"app/main/help.html",controller:"HelpDialogController",clickOutsideToClose:!0};i.show(t)}function k(e){return 0===$.relnTypeFilter.length||$.relnTypeFilter.indexOf(e.relation)>=0}function E(e){function n(e){var t={id:e.id,directed:e.directed};return e.directed?(t.out={label:e.title,nodes:[]},t["in"]={label:e.reverseTitle,nodes:[]}):t.none={label:e.title,nodes:[]},t}function o(e){return l.hasOwnProperty(e.id)||(l[e.id]=n(e)),l[e.id]}$.person=m.get(e.id);var i=f.searchByAuthor(e.id),a=i.$promise.then(function(){if(!i.items)throw new Error("unable to load items");return $.works=i.items,$.works}),l={};e.outEdges.map(function(e){var n=t[e.relation];if(n){var r=o(n);r[n.directed?"out":"none"].nodes.push(e.target)}}),e.inEdges.map(function(e){var n=t[e.relation];if(n){var r=o(n);r[n.directed?"in":"none"].nodes.push(e.source)}}),$.related=[];for(var c in l)l.hasOwnProperty(c)&&$.related.push(l[c]);return r.all([$.person.$promise,a])}function M(e){var t=p.get(e);return t.$promise.then(function(){var e={};return t.graph.nodes.forEach(function(t){t.inEdges=[],t.outEdges=[],e[t.id]=t}),t.graph.edges.forEach(function(t){var n=e[t.source],r=e[t.target];t.source=r,r.outEdges.push(t),t.target=n,n.inEdges.push(t)}),t})}var $=this;$.toggleSearchForm=y,$.clearSearchForm=w,$.showSearchForm=!1,$.searchQuery="",$.showHelp=x,$.graph=null,$.activeNode=null,$.person=null,$.works=null,$.related=null,$.sidebarLoading=!1,$.graphLoading=!1,$.relnTypes=t,$.relnTypeFilter=[],$.toggleRelnTypeFilter=h,$.selectMode=null,$.selectModes=[],$.sizeMetric=null,$.sizeMetrics=[],$.highlightedNodes=[],g()}e.$inject=["$http","$scope","$q","$mdToast","$mdDialog","$mdMedia","$location","$stateParams","$filter","$timeout","$document","peopleRepo","worksRepo","graphRepo"];var t={"uk.ac.ox.bodleian.sda.relationships.influence":{id:"uk.ac.ox.bodleian.sda.relationships.influence",title:"Influenced",reverseTitle:"Influenced By",directed:!0},"uk.ac.ox.bodleian.sda.relationships.provoked":{id:"uk.ac.ox.bodleian.sda.relationships.provoked",title:"Provoked",reverseTitle:"Provoked By",directed:!0},"uk.ac.ox.bodleian.sda.relationships.patternmatch":{id:"uk.ac.ox.bodleian.sda.relationships.patternmatch",title:"Possible Pattern Match",directed:!1}};angular.module("sda.concept-browser").controller("MainController",e)}(),function(){"use strict";function e(e,t){function n(){t.hide()}e.close=n}e.$inject=["$scope","$mdDialog"],angular.module("sda.concept-browser").controller("HelpDialogController",e)}(),function(){"use strict";angular.module("trcBiblio",["ngResource"])}(),function(){"use strict";function e(){function e(e){function n(){return r("")}function r(e){return x.get({q:e,max:50})}function o(e){return x.get({aid:e,max:50})}function i(e){if(angular.isUndefined(e))throw new TypeError("Invalid ID provided to getWork");var t=x.get({workId:e});return t.$promise.then(v),t}function a(e,t){if(angular.isUndefined(e)||angular.isUndefined(t))throw new TypeError("Invalid IDs provided to getEdition");var n=k.get({workId:e,editionId:t});return n.$promise.then(b),n}function l(e,t,n){if(angular.isUndefined(e)||angular.isUndefined(t)||angular.isUndefined(n))throw new TypeError("Invalid IDs provided to getVolume");var r=E.get({workId:e,editionId:t,volumeId:n});return r.$promise.then(y),r}function c(){var e=new x;return v(e),e.titles.push({}),e.authors.push({}),e}function d(){var e=new k;return b(e)}function u(){var e=new E;return y(e)}function s(){switch(arguments.length){case 1:return m.apply(null,arguments);case 2:return f.apply(null,arguments);case 3:return p.apply(null,arguments)}throw new TypeError("Unexpected arguments to worksRepo#save")}function m(e){if(!(e instanceof x))throw new Error("work was not created by this repo");return e.id?e.$update():e.$save()}function f(e,t){if(!e)throw new Error("no work id provided");if(!(t instanceof k))throw new Error("edition was not created by this repo");return t.id?t.$update({workId:e}):t.$save({workId:e})}function p(e,t,n){if(!e)throw new Error("no work id provided");if(!t)throw new Error("no edition id provided");if(!(n instanceof E))throw new Error("volume was not created by this repo");return n.id?n.$update({workId:e,editionId:t}):n.$save({workId:e,editionId:t})}function g(e){var t=x["delete"]({id:e});return t.$promise}function h(e){return e.titles?e.titles.forEach(function(e){e.type=e.type.toLowerCase()}):e.titles=[],e.authors?e.authors.forEach(function(e){e.role=e.role.toLowerCase()}):e.authors=[],e.otherAuthors?e.otherAuthors.forEach(function(e){e.role=e.role.toLowerCase()}):e.otherAuthors=[],e.copies||(e.copies=[]),e}function v(e){return h(e),e.editions?e.editions.forEach(b):e.editions=[],e}function b(e){return h(e),e.volumes?e.volumes.forEach(y):e.volumes=[],e}function y(e){return h(e),e}function w(e,t){return angular.isArray(t)||(t=[t]),t.reduce(function(t,n){if(t)return t;for(var r=0;r<e.length;r++)if(e[r].type===n)return e[r];return null},null)}var x=e(t.url+"/:workId",{workId:"@id"},{update:{method:"PUT"}}),k=e(t.url+"/:workId/editions/:editionId",{editionId:"@id"},{update:{method:"PUT"}}),E=e(t.url+"/:workId/editions/:editionId/volumes/:volumeId",{volumeId:"@id"},{update:{method:"PUT"}}),M={};return M.getAll=n,M.search=r,M.searchByAuthor=o,M.get=i,M.getWork=i,M.getEdition=a,M.getVolume=l,M.create=c,M.createWork=c,M.createEdition=d,M.createVolume=u,M.save=s,M.saveWork=m,M.saveEdition=f,M.saveVolume=p,M["delete"]=g,M.getTitle=w,M}e.$inject=["$resource"];var t={};return t.url="/api/works",t.$get=e,t}angular.module("trcBiblio").provider("worksRepo",e)}(),function(){"use strict";function e(e,t){function n(n,r){var o=n.width,i=!1,a=n.height,l=!1,c=n.layout,d=r.get(0);t(function(){o||(o=r.width(),i=!0),a||(a=r.height(),l=!0);var t=ConceptBrowser(d,c).size([o,a]).edgeFilter(function(e){return 0===n.relnTypes.length||n.relnTypes.indexOf(e.relation)>=0});n.sizeMetric&&t.nodeCentralityMetric(n.sizeMetric),n.selectMode&&t.selectMode(n.selectMode),n.graph&&(t.data(n.graph.nodes,n.graph.edges),t.refresh()),angular.element(e).on("resize",function(){if(i||l){var e=o,n=a;i&&(o=r.width()),l&&(a=r.height()),(e!==o||n!==a)&&(t.size([o,a]),t.refresh())}});var u=!1;t.on("activate",function(e){u||n.$apply(function(){n.activeNode=e.node})}),n.$watchGroup(["width","height","graph","activeNode","sizeMetric","selectMode"],function(e,n){var r=!1;if(e[0]&&e[0]!==n[0]&&(o=e[0],t.size([o,a]),e[2]&&(r=!0)),e[1]&&e[1]!==n[1]&&(a=e[1],t.size([o,a]),e[2]&&(r=!0)),e[2]&&e[2]!==n[2]){var i=angular.copy(e[2]);t.data(i.nodes,i.edges),r=!0}e[3]!==n[3]&&(u=!0,t.activate(e[3]),u=!1),e[4]&&e[4]!==n[4]&&(t.nodeCentralityMetric(e[4]),r=!0),e[5]&&e[5]!==n[5]&&t.selectMode(e[5]),r&&t.refresh()}),n.$watchCollection("highlightedNodes",function(e){e&&t.highlight(e)}),n.$watchCollection("relnTypes",function(e){e&&t.updateGraphSelections()})})}var r={restrict:"E",scope:{graph:"=ngModel",width:"=",height:"=",padding:"=",layout:"@",activeNode:"=",sizeMetric:"=",selectMode:"=",highlightedNodes:"=",relnTypes:"="},link:n};return r}e.$inject=["$window","$timeout"],angular.module("sda.concept-browser").directive("conceptBrowser",e)}(),function(){"use strict";function e(e){e.debug("runBlock end")}e.$inject=["$log"],angular.module("sda.concept-browser").run(e)}(),function(){"use strict";function e(e,t){e.state("home",{url:"/{type}",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}),t.otherwise("/")}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("sda.concept-browser").config(e)}(),function(){"use strict";angular.module("sda.concept-browser").constant("d3",d3).constant("moment",moment)}(),function(){"use strict";function e(e,t,n,r,o){e.debugEnabled(!0),t.definePalette("darkBrown",{50:"#595c59",100:"#4c4f4c",200:"#404240",300:"#333533",400:"#272827",500:"#1a1b1a",600:"#0d0e0d",700:"#010101",800:"#000000",900:"#000000",A100:"#e0f0e0",A200:"#565956",A400:"#7e837e",A700:"#000000",contrastDefaultColor:"light",contrastDarkColors:["A100"]}),t.definePalette("copper",{50:"#d4b190",100:"#cca47e",200:"#c5976b",300:"#be8a59",400:"#b67e47",500:"#a47140",600:"#926439",700:"#7f5832",800:"#6d4b2b",900:"#5b3e23",A100:"#dcc3ab",A200:"#a47140",A400:"#48321c",A700:"#272927",contrastDefaultColor:"light",contrastDarkColors:["50","100","200","A100"]}),t.theme("default").primaryPalette("darkBrown").accentPalette("copper"),t.theme("sda-dark").primaryPalette("darkBrown").dark(),n.url="/api/catalog/people",r.url="/api/catalog/works",o.url="/api/catalog/graph"}e.$inject=["$logProvider","$mdThemingProvider","peopleRepoProvider","worksRepoProvider","graphRepoProvider"],angular.module("sda.concept-browser").config(e)}(),function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.EventDispatcher=t()}(this,function(){"use strict";function e(){function e(e,t){o[e]&&o[e].forEach(function(e){try{e(t)}catch(n){console.error(n)}}),i.forEach(function(n){try{n(e,t)}catch(r){console.error(r)}})}function t(e){return i.push(e),function(){var t=i.indexOf(e);t>=0&&i.splice(t,1)}}function n(e,t){return o[e]||(o[e]=[]),o[e].push(t),function(){var n=o[e].indexOf(t);n>=0&&o[e].splice(n,1)}}function r(e,t){var r=n(e,function(e){try{t(e)}catch(n){console.error(n)}finally{r()}});return r}var o={},i=[],a={};return a.all=t,a.on=n,a.once=r,a.trigger=e,a}return e}),function(e,t){"function"==typeof define&&define.amd?define(["d3"],t):"object"==typeof module&&module.exports?module.exports=t(require("d3")):t(d3)}(this,function(e){"use strict";function t(e){e.fixed|=2}function n(e){e.fixed&=-7}function r(e){e.fixed|=4,e.px=e.x,e.py=e.y}function o(e){e.fixed&=-5}function i(e,t,n){var r=0,o=0;if(e.charge=0,!e.leaf)for(var a,l=e.nodes,c=l.length,d=-1;++d<c;)a=l[d],a&&(i(a,t,n),e.charge+=a.charge,r+=a.charge*a.cx,o+=a.charge*a.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var u=t*n[e.point.index];e.charge+=e.pointCharge=u,r+=u*e.point.x,o+=u*e.point.y}e.cx=r/e.charge,e.cy=o/e.charge}function a(e){return"function"==typeof e}function l(e){return"number"==typeof e}var c=20,d=1,u=1/0;e.layout.force.cylindrical=function(){function s(e,t){return 2*Math.abs(e)>t&&(0>e?e+=t:e-=t),e}function m(e){return function(t,n,r,o){if(t.point!==e){var i=x[0],a=s(t.cx-e.x,i),l=t.cy-e.y,c=o-n,d=a*a+l*l,u=0;if(d>c*c/T)return N>d&&(u=t.charge/d,e.px-=a*u,e.py-=l*u),!0;t.point&&d&&N>d&&(u=t.pointCharge/d,e.px-=a*u,e.py-=l*u)}return!t.charge}}function f(t){t.px=e.event.x,t.py=e.event.y,y.resume()}var p,g,h,v,b,y={},w=e.dispatch("start","tick","end"),x=[1,1],k=.9,E=c,M=d,$=-30,N=u,O=.1,T=.64,A=[],I=[];return y.tick=function(){if((g*=.99)<.005)return w.end({type:"end",alpha:g=0}),!0;var t,n,r,o,a,l,c,d,u,f=A.length,p=I.length;for(n=0;p>n;++n)r=I[n],o=r.source,a=r.target,d=s(a.x-o.x,x[0]),u=a.y-o.y,l=d*d+u*u,0!==l&&(l=g*v[n]*((l=Math.sqrt(l))-h[n])/l,d*=l,u*=l,a.x-=d*(c=o.weight/(a.weight+o.weight)),a.y-=u*c,o.x+=d*(c=1-c),o.y+=u*c);if(c=g*O,0!==c&&(d=x[0]/2,u=x[1]/2,n=-1,c))for(;++n<f;)r=A[n],r.y+=(u-r.y)*c;if($)for(i(t=e.geom.quadtree(A),g,b),n=-1;++n<f;)(r=A[n]).fixed||t.visit(m(r));for(n=-1;++n<f;)r=A[n],r.fixed?(r.x=r.px,r.y=r.py):(r.x-=(r.px-(r.px=r.x))*k,r.y-=(r.py-(r.py=r.y))*k);n=-1;for(var y=x[0];++n<f;){r=A[n];var E=r.px-r.x;r.x%=y,r.x<0&&(r.x+=y),r.px=r.x+E}w.tick({type:"tick",alpha:g})},y.nodes=function(e){return arguments.length?(A=e,y):A},y.links=function(e){return arguments.length?(I=e,y):I},y.size=function(e){return arguments.length?(x=e,y):x},y.linkDistance=function(e){return arguments.length?(E=a(e)?e:+e,y):E},y.linkStrength=function(e){return arguments.length?(M=a(e)?e:+e,y):M},y.friction=function(e){return arguments.length?(k=+e,y):k},y.charge=function(e){return arguments.length?($=a(e)?e:+e,y):$},y.chargeDistance=function(e){return arguments.length?(N=e*e,y):Math.sqrt(N)},y.gravity=function(e){return arguments.length?(O=+e,y):O},y.theta=function(e){return arguments.length?(T=e*e,y):Math.sqrt(T)},y.alpha=function(t){return arguments.length?(t=+t,g?g=t>0?t:0:t>0&&(w.start({type:"start",alpha:g=t}),e.timer(y.tick)),y):g},y.start=function(){function e(e,r){if(!n){for(n=new Array(o),d=0;o>d;++d)n[d]=[];for(d=0;i>d;++d){var a=I[d];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var l,c=n[t],d=-1,u=c.length;++d<u;)if(!isNaN(l=c[d][e]))return l;return Math.random()*r}var t,n,r,o=A.length,i=I.length,c=x[0],d=x[1];for(t=0;o>t;++t)(r=A[t]).index=t,r.weight=0;for(t=0;i>t;++t)r=I[t],l(r.source)&&(r.source=A[r.source]),l(r.target)&&(r.target=A[r.target]),++r.source.weight,++r.target.weight;for(t=0;o>t;++t)r=A[t],isNaN(r.x)&&(r.x=e("x",c)),isNaN(r.y)&&(r.y=e("y",d)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(h=[],a(E))for(t=0;i>t;++t)h[t]=+E.call(this,I[t],t);else for(t=0;i>t;++t)h[t]=E;if(v=[],a(M))for(t=0;i>t;++t)v[t]=+M.call(this,I[t],t);else for(t=0;i>t;++t)v[t]=M;if(b=[],a($))for(t=0;o>t;++t)b[t]=+$.call(this,A[t],t);else for(t=0;o>t;++t)b[t]=$;return y.resume()},y.resume=function(){return y.alpha(.1)},y.stop=function(){return y.alpha(0)},y.drag=function(){return p||(p=e.behavior.drag().origin(function(e){return e}).on("dragstart.force",t).on("drag.force",f).on("dragend.force",n)),arguments.length?void this.on("mouseover.force",r).on("mouseout.force",o).call(p):p},y.edgePath=function(){var e=x[0],t=function(e){return e[0][0]},n=function(e){return e[0][1]},r=function(e){return e[1][0]},o=function(e){return e[1][1]},i=function(i){i.attr("d",function(i){var a=t(i),l=n(i),c=r(i),d=o(i);return 2*Math.abs(a-c)<e?"M "+a+" "+l+" L "+c+" "+d:c>a?"M "+a+" "+l+" L "+(c-e)+" "+d+" M "+c+" "+d+" L "+(a+e)+" "+l:"M "+a+" "+l+" L "+(c+e)+" "+d+" M "+c+" "+d+" L "+(a-e)+" "+l})};return i.x1=function(e){return t=e,i},i.y1=function(e){return n=e,i},i.x2=function(e){return r=e,i},i.y2=function(e){return o=e,i},i},e.rebind(y,w,"on")}}),function(e,t){"function"==typeof define&&define.amd?define(["d3","event-dispatcher","d3-force-cylindrical"],t):"object"==typeof module&&module.exports?(require("d3-force-cylindrical"),module.exports=t(require("d3"),require("event-dispatcher"))):e.ConceptBrowser=t(e.d3,e.EventDispatcher)}(this,function(e,t){"use strict";function n(n,d,u){function s(e){return _=e[0],j=e[1],ie&&(q.attr("width",_).attr("height",j),V.range([0,_]),K.size([_,j])),de}function m(t){if(le=t,ie){var n=e.extent(X,le);Y.domain(n[0]===n[1]?[n[0]-1,n[1]+1]:n)}return de}function f(e){return ae=e,de}function p(e,t){return X=e,J=t,X.forEach(function(e){e.x=(e.x||Math.random())*_,e.y=(e.y||Math.random())*j}),de}function g(e){e instanceof Array||(e=[e]);var t=e.every(function(e){return X.indexOf(e)>=0});if(!t)throw new Error("some node(s) to be highlighted are not members of the graph");return $(),M(e),de}function h(e){if(e&&X.indexOf(e)<0)throw new Error("node to be activated is not a member of the graph");return A(),e&&(T(e),z(),I(e)),de}function v(e){return ce=e,de}function b(){return y(),K.nodes(X).links(J).start(),k(),E(),de}function y(){if(!_||!j)throw new Error("No width/height set. Use size([width, height]) to set size before initializing");if(!X||!J)throw new Error("No nodes/edges set. Use data(nodes, edges) to set them before initializing");if(!ie){ie=!0,q=e.select(n).append("svg").attr("width",_).attr("height",j);var t=J.reduce(function(e,t){return e.indexOf(t.relation)<0&&e.push(t.relation),e},[]);S(q,t,["","activated","selected","focused"]);var c=q.append("g").attr("class","concept-browser");G=c.append("g").attr("class","edges"),H=c.append("g").attr("class","nodes"),Q=c.append("rect").attr("class","progress").attr("x",0).attr("y",0).attr("height",2),V=e.scale.linear().domain([Math.log(.1),Math.log(.005)]).range([0,_]);var u=e.extent(X,le);Y=e.scale.linear().domain(u[0]===u[1]?[u[0]-1,u[1]+1]:u).range([0,1]),W=function(e){return o+(i-o)*Y(e)},K=a[d||"planar"]().size([_,j]).on("tick",x),w(K),K.edgePath&&(re=K.edgePath().x1(function(e){return e.source.x}).y1(function(e){return e.source.y}).x2(function(e){return e.target.x}).y2(function(e){return e.target.y})),e.tip&&(oe=e.tip().attr("class",l).direction(R).offset(D).html(function(e){return e.label}),U.on("focus",function(e){L(e.node)}),U.on("blur",function(e){C(e.node)}));var s=r(F,100,!0,!0);U.on("highlight",s),U.on("unhighlight",s),U.on("focus",s),U.on("blur",s),U.on("select",s),U.on("deselect",s),U.on("activate",s),U.on("deactivate",s)}}function w(e){e.gravity(.1).linkDistance(50).linkStrength(function(e){var t=le(e.source);return Y(t)}).charge(function(e){var t=[-50,-300],n=[0,1],r=le(e);return t[0]+(t[1]-t[0])/(n[1]-n[0])*(Y(r)-n[0])}).friction(.9)}function x(e){if(B(),e.alpha>.0051){if(Q.attr("width",V(Math.log(e.alpha))),Math.random()<.95)return}else Q.attr("width",0);H.selectAll(".node").transition().duration(500).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),G.selectAll(".edge").transition().duration(500).call(re)}function k(){if(!X||0===X.length)throw new Error("no nodes provided");var t=H.selectAll(".node").data(X,function(e){return e.id}),n=t.enter().append("g").attr("class","node").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).on("mouseover",N).on("mouseout",O).on("dblclick",T).on("click",function(t){e.event.ctrlKey?te.indexOf(t)<0?I(t):P(t):(z(),I(t))});n.append("circle"),t.select("circle").attr("r",function(e){var t=le(e);return W(t)}),t.exit().remove(),oe&&H.call(oe)}function E(){if(!J||0===J.length)throw new Error("no edges provided");var e=G.selectAll(".edge").data(J,function(e){return e.source.id+","+e.target.id});e.enter().append("path").attr("class",function(e){return"edge "+e.relation}).attr("marker-end",function(e){return"url(#arrowhead-"+e.relation+")"}).call(re),e.exit().remove()}function M(e){e instanceof Array||(e=[e]),e.forEach(function(e){Z.indexOf(e)<0&&Z.push(e),U.trigger("highlight",{node:e,selection:te})})}function $(){Z.forEach(function(e){U.trigger("unhighlight",{node:e,selection:te})}),Z=[]}function N(e){O(),ee=e,U.trigger("focus",{node:ee,selection:te})}function O(e){if(e=e||ee){if(ee!==e)throw new Error("tried to blur a node that was not focused");ee=null,U.trigger("blur",{node:e,selection:te})}}function T(e){ne!==e&&(A(),ne=e,U.trigger("activate",{node:ne,selection:te}))}function A(e){if(e=e||ne){if(ne!==e)throw new Error("tried to deactivate a node that was not activated");ne=null,U.trigger("deactivate",{node:e,selection:te})}}function I(e){if(!e)throw new Error("no node provided");if(!(te.indexOf(e)<0))throw new Error("tried to select a node that is already selected");te.push(e),U.trigger("select",{node:e,selection:te})}function P(e){if(!e)throw new Error("no node provided to deselect");var t=te.indexOf(e);if(0>t)throw new Error("tried to deselect a node that was not selected");te.splice(t,1),U.trigger("deselect",{node:e,selection:te})}function z(){te.forEach(function(e){U.trigger("deselect",{node:e,selection:[]})}),te=[]}function L(e){oe&&oe.attr("class",l).show(e)}function C(e){oe&&oe.attr("class",l).hide(e)}function F(){var e=[ne],t=te.slice(),n=ae(ee);te.forEach(function(e){ae(e).forEach(function(e){n.indexOf(e)<0&&n.push(e)})}),ae(ne).forEach(function(e){n.indexOf(e)<0&&n.push(e)});var r=Z.slice();H.selectAll(".node").classed("activated",function(t){return e.indexOf(t)>=0}).classed("selected",function(e){return t.indexOf(e)>=0}).classed("focused",function(e){return n.indexOf(e)>=0}).classed("highlighted",function(e){return r.indexOf(e)>=0}),G.selectAll(".edge").classed("activated",function(t){return e.indexOf(t.source)>=0&&e.indexOf(t.target)>=0}).classed("selected",function(e){return t.indexOf(e.source)>=0&&t.indexOf(e.target)>=0}).classed("focused",function(e){return n.indexOf(e.source)>=0&&n.indexOf(e.target)>=0}).classed("hidden",function(e){return!ce(e)}).attr("marker-end",function(r){var o="";return e.indexOf(r.source)>=0&&e.indexOf(r.target)>=0?o="-activated":t.indexOf(r.source)>=0&&t.indexOf(r.target)>=0?o="-selected":n.indexOf(r.source)>=0&&n.indexOf(r.target)>=0&&(o="-focused"),"url(#arrowhead-"+r.relation+o+")"})}function B(){X.forEach(function(e){e.x=Math.max(Math.min(e.x,_),0),e.y=Math.max(Math.min(e.y,j),0)})}function R(e){var t="";return e.y>j-c.bottom?t+="n":e.y<c.top&&(t+="s"),e.x>_-c.right?t+="w":e.x<c.left&&(t+="e"),""===t&&(t="n"),t}function D(e){var t=le(e),n=W(t),r=[0,0];return e.y>j-c.bottom?r[0]-=n:e.y<c.top&&(r[0]+=n),e.x>_-c.left_right?r[1]-=n:e.x<c.left_right&&(r[1]+=n),0===r[1]&&0===r[0]&&(r[0]-=n),r}function S(e,t,n){var r=[];t.forEach(function(e){n.forEach(function(t){r.push("arrowhead-"+e+(t?"-"+t:""))})}),e.append("defs").selectAll("marker").data(r).enter().append("marker").attr("id",function(e){return e}).attr("viewBox","0 -4 10 8").attr("refX",25).attr("refY",0).attr("markerWidth",6).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0,-4 L 10,0 L 0,4")}d=d||"planar",u=u||{};var U=t();u.debug&&U.all(function(e,t){console.log(e,t.node?t.node.id:t)});var _,j,q,H,G,Q,V,W,Y,K,X=[],J=[],Z=[],ee=null,te=[],ne=null,re=function(e){e.attr("d",function(e){var t=e.source.x,n=e.source.y,r=e.target.x,o=e.target.y;return"M "+t+" "+n+" L "+r+" "+o})},oe=null,ie=!1,ae=function(e){if(!e)return[];var t=e.outEdges.forEach(function(e){return e.target}),n=e.inEdges.forEach(function(e){return e.source});return[e].concat(t,n)},le=function(){return 1},ce=function(){return!0},de={};return de.size=s,de.nodeCentralityMetric=m,de.selectMode=f,de.data=p,de.highlight=g,de.activate=h,de.edgeFilter=v,de.updateGraphSelections=F,de.refresh=b,de.on=U.on,de}function r(e,t,n,r){var o;return"undefined"==typeof n&&(n=!0),"undefined"==typeof r&&(r=!1),function(){function i(){o=null,r&&e.apply(a,l)}var a=this,l=arguments,c=n&&!o;clearTimeout(o),o=setTimeout(i,t),c&&e.apply(a,l)}}var o=5,i=13,a={planar:e.layout.force,cylindrical:e.layout.force.cylindrical},l="d3-tip",c={left:200,right:200,top:100,bottom:100};return e.tip||console.warn("d3.tip is not available; tooltips will not display properly."),n}),angular.module("sda.concept-browser").run(["$templateCache",function(e){e.put("app/main/help.html",'<md-dialog><md-toolbar><div class=md-toolbar-tools><h2>Help</h2><span flex></span><md-button class=md-icon-button ng-click=close()><md-icon>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content layout=column layout-align="center center"><iframe width=1280 height=720 src=https://www.youtube.com/embed/0PzUCCnlN18 frameborder=0 allowfullscreen></iframe></div></md-dialog-content></md-dialog>'),e.put("app/main/main.html",'<md-sidenav md-component-id=right class=md-sidenav-right md-is-open=main.activeNode md-disable-backdrop md-whiteframe=4 layout=column><md-toolbar><div class=md-toolbar-tools><h2>Node Information</h2><span flex></span><md-button class=md-icon-button ng-click="main.activeNode = null"><md-icon>close</md-icon></md-button></div></md-toolbar><div flex layout=column layout-align="center center" ng-if=main.sidebarLoading><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div class=node-info flex layout=column ng-if=!main.sidebarLoading><h3 class=name><span class=given>{{main.person.name.givenName}}</span> <span class=family>{{main.person.name.familyName}}</span></h3><md-tabs flex><md-tab ng-if=main.person.summary><md-tab-label><md-icon>person</md-icon></md-tab-label><md-tab-body><div class=summary ng-if=main.person.summary ng-bind-html=main.person.summary></div></md-tab-body></md-tab><md-tab ng-if="main.works &amp;&amp; main.works.length &gt; 0"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><div class=books><h4>Books ({{main.works.length}})</h4><md-list><md-list-item ng-repeat="work in main.works" ng-href=../#/library/books/{{work.id}}>{{work.label}}</md-list-item></md-list></div></md-tab-body></md-tab><md-tab ng-if="main.related &amp;&amp; main.related.length &gt; 0"><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body><md-list class=relationships><div ng-repeat="group in main.related"><div ng-if=group.directed><div ng-if="group.out.nodes.length &gt; 0"><md-subheader class=md-no-sticky>{{group.out.label}}</md-subheader><md-list-item ng-repeat="node in group.out.nodes track by node.id" ng-click="main.activeNode = node">{{node.label}}</md-list-item></div><div ng-if="group.in.nodes.length &gt; 0"><md-subheader class=md-no-sticky>{{group.in.label}}</md-subheader><md-list-item ng-repeat="node in group.in.nodes track by node.id" ng-click="main.activeNode = node">{{node.label}}</md-list-item></div></div><div ng-if=!group.directed><div ng-if="group.none.nodes.length &gt; 0"><md-subheader class=md-no-sticky>{{group.none.label}}</md-subheader><md-list-item ng-repeat="node in group.none.nodes track by node.id" ng-click="main.activeNode = node">{{node.label}}</md-list-item></div></div></div></md-list></md-tab-body></md-tab></md-tabs></div></md-sidenav><md-toolbar><div class=md-toolbar-tools><img class=logo src=assets/images/sda-logo-light.png alt=SDA><h1>Concept Browser</h1><span flex></span><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title="Ranking Model"><md-icon>adjust</md-icon></md-button><md-menu-content><md-menu-item ng-repeat="metric in main.sizeMetrics"><md-button ng-click="main.sizeMetric = metric" ng-disabled=metric.disabled><md-icon md-menu-align-target>radio_button_{{main.sizeMetric === metric ? \'\' : \'un\'}}checked</md-icon>{{metric.label}}</md-button></md-menu-item></md-menu-content></md-menu><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title="Selection Mode"><md-icon>device_hub</md-icon></md-button><md-menu-content><md-menu-item ng-repeat="mode in main.selectModes"><md-button ng-click="main.selectMode = mode" ng-disabled=metric.disabled><md-icon md-menu-align-target>radio_button_{{main.selectMode === mode ? \'\' : \'un\'}}checked</md-icon>{{mode.label}}</md-button></md-menu-item></md-menu-content></md-menu><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title="Relationship Types"><md-icon>filter_list</md-icon></md-button><md-menu-content><md-menu-item><md-button ng-click="main.relnTypeFilter = []"><md-icon md-menu-align-target>check_box{{main.relnTypeFilter.length &gt; 0 ? \'_outline_blank\' : \'\'}}</md-icon>All Relationships</md-button></md-menu-item><md-divider></md-divider><md-menu-item ng-repeat="type in main.relnTypes"><md-button ng-click=main.toggleRelnTypeFilter(type.id) md-prevent-menu-close><md-icon md-menu-align-target>check_box{{main.relnTypeFilter.indexOf(type.id) &lt; 0 ? \'_outline_blank\' : \'\'}}</md-icon>{{type.title}}</md-button></md-menu-item></md-menu-content></md-menu><span flex></span><md-button class=md-icon-button ng-click=main.toggleSearchForm($event)><md-icon>search</md-icon></md-button><form name=search class=search-form layout=row ng-style="{ width: main.showSearchForm ? \'20rem\' : \'0\' }"><input type=search name=query ng-model=searchQuery ng-change=main.highlightNodes() flex> <button class=clear ng-click=main.clearSearchForm()><md-icon>clear</md-icon></button></form><md-button class=md-icon-button ng-click=main.showHelp($event)><md-icon>help_outline</md-icon></md-button></div></md-toolbar><div style="overflow: hidden" flex layout=column><concept-browser flex ng-if=main.graph ng-model=main.graph active-node=main.activeNode size-metric=main.sizeMetric.strategy select-mode=main.selectMode.strategy highlighted-nodes=main.highlightedNodes reln-types=main.relnTypeFilter></concept-browser><div ng-if="!main.graph &amp;&amp; main.graphLoading" flex layout=column layout-align="center center" layout-padding><md-progress-circular md-mode=indeterminate></md-progress-circular><div class="text-center md-headline md-secondary">Loading graph data&hellip;<br>This may take a while.</div></div></div>'),
e.put("app/trc-bio/event-editor.html",'<div class=form-group><label class=control-label for=event-title>Title</label><input type=text id=event-title name=event-title class="form-control event-title" ng-model=event.title></div><div class=form-group><label class=control-label for=event-description>Description</label><textarea id=event-description name=event-description class="form-control event-description" ng-model=event.description></textarea></div><div class=form-group><label class=control-label for=event-location>Location</label><input type=text id=event-location name=event-location class="form-control event-location" ng-model=event.location></div><div class=form-group><label class=control-label for=event-date>Date</label><input type=text id=event-date name=event-date class="form-control event-date" ng-model=event.date.description><!-- TODO add datepicker --></div>'),e.put("app/trc-bio/name-editor.html",'<div class=form-group class=name-role><label class=control-label for=name-role>Role</label><select id=name-role name=name-role class="form-control name-role" ng-model=name.role><option ng-repeat="role in nameEditor.roles" value={{role.value}}>{{role.label}}</option></select></div><div class=form-group class=name-structure><label class=control-label>Structured Name</label><input type=text class=name-title placeholder=title ng-model=name.title> <input type=text class=name-given placeholder=given ng-model=name.givenName> <input type=text class=name-middle placeholder=middle ng-model=name.middleName> <input type=text class=name-family placeholder=family ng-model=name.familyName> <input type=text class=name-suffix placeholder=suffix ng-model=name.suffix></div><div class=form-group class=name-label><label for=label>Display Label</label><input type=text placeholder=label ng-model=name.label></div>'),e.put("app/trc-bio/person-editor.html",'<div class=form-group><label for=person-name>Primary Name</label><trc-name-editor id=person-name ng-model=person.name></trc-name-editor></div><div class=form-group><label for=person-altnames>Alternate Names</label><div ng-repeat="name in person.altNames"><trc-name-editor id=person-altnames ng-model=name></trc-name-editor><button ng-click=personEditor.removeName($index)>&minus;</button></div><button ng-click=personEditor.addName()>+</button></div><div class=form-group><label for=person-birth>Birth</label><div ng-if=person.birth><trc-event-editor id=person-birth ng-model=person.birth></trc-event-editor><button ng-click="personEditor.removeEvent(\'birth\')">&minus;</button></div><div ng-if=!person.birth><button ng-click="personEditor.addEvent(\'birth\')">+</button></div></div><div class=form-group><label for=person-death>Death</label><div ng-if=person.death><trc-event-editor id=person-death ng-model=person.death></trc-event-editor><button ng-click="personEditor.removeEvent(\'death\')">&minus;</button></div><div ng-if=!person.death><button ng-click="personEditor.addEvent(\'death\')">+</button></div></div><div class=form-group><label class=control-label for=person-summary>Summary</label><textarea id=person-summary name=person-summary class="form-control person-summary" ng-model=person.summary></textarea></div>')}]);
//# sourceMappingURL=../maps/scripts/app-76c28053e2.js.map
