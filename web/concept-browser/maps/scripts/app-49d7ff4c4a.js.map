{"version":3,"sources":["scripts/app.js"],"names":["angular","module","graphRepoProvider","graphRepoFactory","$resource","getGraph","type","restResource","get","provider","url","repo","$inject","$get","MainController","$http","$scope","$q","$mdToast","$mdDialog","$mdMedia","$location","$stateParams","$filter","$timeout","$document","peopleRepo","worksRepo","graphRepo","activate","loadSelectModes","loadSizeMetrics","defaultGraphType","graphType","vm","graphLoading","getGraphData","showSimple","then","data","graph","$watch","node","sidebarLoading","loadNodeData","person","searchQuery","highlightedNodes","nodes","label","toggleRelnTypeFilter","typeId","ix","relnTypeFilter","indexOf","push","splice","selectModes","strategy","selected","adjacent","outEdges","filter","edgeFilter","map","edge","target","incident","inEdges","source","concat","worklist","visited","length","pop","forEach","selectMode","sizeMetrics","metadata","pagerank","disabled","sizeMetric","toggleSearchForm","showSearchForm","element","focus","clearSearchForm","showHelp","$event","config","targetEvent","fullscreen","templateUrl","controller","clickOutsideToClose","show","relation","makeTypeGroup","group","id","directed","out","title","reverseTitle","none","ensureTypeGroup","related","hasOwnProperty","works","searchByAuthor","worksP","$promise","items","Error","TYPES","key","all","nodesById","edges","this","activeNode","relnTypes","uk.ac.ox.bodleian.sda.relationships.influence","uk.ac.ox.bodleian.sda.relationships.provoked","uk.ac.ox.bodleian.sda.relationships.patternmatch","HelpDialogController","closeDialog","hide","close","conceptBrowserDirective","$window","linkFunc","scope","el","width","autoWidth","height","autoHeight","layout","rootEl","ConceptBrowser","size","nodeCentralityMetric","refresh","on","oldWidth","oldHeight","preventActivate","evt","$apply","$watchGroup","newValues","oldValues","queueRefresh","graphData","copy","$watchCollection","highlight","updateGraphSelections","directive","restrict","padding","link","runBlock","$log","debug","run","routerConfig","$stateProvider","$urlRouterProvider","state","controllerAs","otherwise","constant","d3","$logProvider","$mdThemingProvider","peopleRepoProvider","worksRepoProvider","debugEnabled","definePalette","50","100","200","300","400","500","600","700","800","900","A100","A200","A400","A700","contrastDefaultColor","contrastDarkColors","theme","primaryPalette","accentPalette","root","factory","define","amd","exports","EventDispatcher","trigger","eventName","context","eventHandlers","handler","e","console","error","globalHandlers","addGlobalListener","addListener","addOnceListener","deregister","API","once","require","dragstart","d","fixed","dragend","mouseover","px","x","py","y","mouseout","accumulate","quad","alpha","charges","cx","cy","charge","leaf","c","n","i","point","Math","random","k","index","pointCharge","isFunction","o","isNumber","LINK_DISTANCE","LINK_STRENGTH","CHARGE_DISTANCE_2","Infinity","force","cylindrical","wrapDx","dx","abs","repulse","x1","_","x2","dy","dw","dn","theta2","chargeDistance2","dragmove","event","resume","drag","distances","strengths","dispatch","friction","linkDistance","linkStrength","gravity","links","tick","end","q","s","t","l","m","sqrt","weight","geom","quadtree","visit","arguments","chargeDistance","theta","start","timer","position","dimension","neighbors","Array","j","candidates","cs","isNaN","w","h","call","stop","behavior","origin","edgePath","getX1","getY1","getX2","getY2","drawLine","selection","attr","y1","y2","fn","rebind","options","setSize","dims","isInitialized","svg","progressScale","range","setNodeCentralityMetric","centralityMetric","centralityExtent","extent","centralityMetricScale","domain","setSelectMode","_selectMode","setData","_nodes","_edges","setHighlighted","allNodesInGraph","every","unhighlightAll","setActivated","deactivate","deselectAll","select","setEdgeFilter","initialize","bindNodes","bindEdges","append","edgeTypes","reduce","types","defineArrowheads","baseGroup","edgeLayer","nodeLayer","progressBar","scale","linear","log","nodeRadiusScale","NODE_MIN_SIZE","NODE_MAX_SIZE","GRAPH_LAYOUT_CTORS","configureGraph","drawEdge","tip","tooltip","TIP_CSS_CLASS","direction","tooltipDirection","offset","tooltipOffset","html","events","showTooltip","hideTooltip","debounce","applyStyleClasses","sz","chargeRange","influenceRange","updatePositions","selectAll","transition","duration","nodeSelect","nodeEnter","enter","blur","ctrlKey","deselect","exit","remove","edgeSelect","ns","highlighted","focused","activated","activatedSet","selectedSet","slice","focusedSet","p","highlightedSet","classed","cls","max","min","dir","TIP_POSITION_MARGIN","bottom","top","right","left","radius","left_right","classTypes","arrowTypes","wait","leading","trailing","timeout","later","apply","ctx","args","callNow","clearTimeout","setTimeout","planar","warn","$templateCache","put"],"mappings":"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","file":"scripts/app-49d7ff4c4a.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular\n    .module('trcGraph', [\n      'ngResource'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('trcGraph')\n    .provider('graphRepo', graphRepoProvider);\n\n  function graphRepoProvider() {\n    var provider = {};\n    provider.url = '/api/graph';\n    provider.$get = graphRepoFactory;\n    return provider;\n\n    /** @ngInject */\n    function graphRepoFactory($resource) {\n      var restResource = $resource(provider.url + '/:type');\n\n      var repo = {};\n      repo.get = getGraph;\n      return repo;\n\n      /**\n       * Retrieves a graph by type identifier\n       *\n       * @param  {string} type\n       * @return {Graph}\n       */\n      function getGraph(type) {\n        return restResource.get({ type: type });\n      }\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser', [\n      'ngAnimate',\n      'ngCookies',\n      'ngSanitize',\n      'ngMessages',\n      'ngAria',\n      'ngResource',\n      'ui.router',\n      'ngMaterial',\n      'trcBiblio',\n      'trcBio',\n      'trcGraph'\n    ]);\n\n})();\n\n(function () {\n  'use strict';\n\n  // HACK types should be loaded from reln repo\n  var TYPES = {\n    'uk.ac.ox.bodleian.sda.relationships.influence': {\n      id: 'uk.ac.ox.bodleian.sda.relationships.influence',\n      title: 'Influenced',\n      reverseTitle: 'Influenced By',\n      directed: true\n    },\n    'uk.ac.ox.bodleian.sda.relationships.provoked': {\n      id: 'uk.ac.ox.bodleian.sda.relationships.provoked',\n      title: 'Provoked',\n      reverseTitle: 'Provoked By',\n      directed: true\n    },\n    'uk.ac.ox.bodleian.sda.relationships.patternmatch': {\n      id: 'uk.ac.ox.bodleian.sda.relationships.patternmatch',\n      title: 'Possible Pattern Match',\n      directed: false\n    }\n  };\n\n  angular\n    .module('sdaConceptBrowser')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($http, $scope, $q, $mdToast, $mdDialog, $mdMedia, $location, $stateParams, $filter, $timeout, $document, peopleRepo, worksRepo, graphRepo) {\n    var vm = this;\n\n    vm.toggleSearchForm = toggleSearchForm;\n    vm.clearSearchForm = clearSearchForm;\n    vm.showSearchForm = false;\n    vm.searchQuery = '';\n\n    vm.showHelp = showHelp;\n\n    vm.graph = null;\n    vm.activeNode = null;\n    vm.person = null;\n    vm.works = null;\n    vm.related = null;\n    vm.sidebarLoading = false;\n    vm.graphLoading = false;\n\n    vm.relnTypes = TYPES;\n    vm.relnTypeFilter = [];\n    vm.toggleRelnTypeFilter = toggleRelnTypeFilter;\n\n    vm.selectMode = null;\n    vm.selectModes = [];\n\n    vm.sizeMetric = null;\n    vm.sizeMetrics = [];\n\n    vm.highlightedNodes = [];\n\n    activate();\n\n    function activate() {\n      loadSelectModes();\n      loadSizeMetrics();\n\n      var defaultGraphType = 'people';\n      var graphType = $stateParams.type || defaultGraphType;\n      vm.graphLoading = true;\n      getGraphData(graphType).catch(function () {\n        $mdToast.showSimple('Unable to load the \"' + graphType + '\"graph type. Falling back to \"' + defaultGraphType + '\".');\n        return getGraphData(defaultGraphType);\n      }).then(function (data) {\n        vm.graphLoading = false;\n        vm.graph = data.graph;\n      }, function () {\n        vm.graphLoading = false;\n        $mdToast.showSimple('Unable to load graph data.');\n      });\n\n      $scope.$watch('main.activeNode', function (node) {\n        if (node) {\n          vm.sidebarLoading = true;\n          loadNodeData(node).then(function () {\n            vm.sidebarLoading = false;\n          }, function () {\n            vm.sidebarLoading = false;\n            $mdToast.showSimple('Unable to load node data');\n          });\n        } else {\n          vm.person = null;\n        }\n      });\n\n      $scope.$watch('searchQuery', function (searchQuery) {\n        vm.highlightedNodes = searchQuery ? $filter('filter')(vm.graph.nodes, { label: searchQuery }) : [];\n      });\n    }\n\n    function toggleRelnTypeFilter(typeId) {\n      var ix = vm.relnTypeFilter.indexOf(typeId);\n      if (ix < 0) {\n        vm.relnTypeFilter.push(typeId);\n      } else {\n        vm.relnTypeFilter.splice(ix, 1);\n      }\n    }\n\n    function loadSelectModes() {\n      vm.selectModes.push({\n        label: 'Neighbors',\n        strategy: function (selected) {\n          if (!selected) {\n            return [];\n          }\n\n          var adjacent = selected.outEdges.filter(edgeFilter).map(function (edge) {\n            return edge.target;\n          });\n          var incident = selected.inEdges.filter(edgeFilter).map(function (edge) {\n            return edge.source;\n          });\n          return [selected].concat(adjacent, incident);\n        }\n      });\n\n      vm.selectModes.push({\n        label: 'Trace',\n        strategy: function (selected) {\n          if (!selected) {\n            return [];\n          }\n\n          var worklist = [selected];\n          var visited = [];\n\n          while (worklist.length > 0) {\n            var node = worklist.pop();\n            visited.push(node);\n            node.outEdges.forEach(function (edge) {\n              if (visited.indexOf(edge.target) < 0) {\n                worklist.push(edge.target);\n              }\n            });\n          }\n\n          return visited;\n        }\n      });\n\n      vm.selectModes.push({\n        label: 'Inbound',\n        strategy: function (selected) {\n          return selected ? [selected].concat(selected.inEdges.filter(edgeFilter).map(function (edge) {\n            return edge.source;\n          })) : [];\n        }\n      });\n\n      vm.selectModes.push({\n        label: 'Outbound',\n        strategy: function (selected) {\n          return selected ? [selected].concat(selected.outEdges.filter(edgeFilter).map(function (edge) {\n            return edge.target;\n          })) : [];\n        }\n      });\n\n      vm.selectMode = vm.selectModes[0];\n    }\n\n    function loadSizeMetrics() {\n      vm.sizeMetrics.push({\n        label: 'PageRank',\n        strategy: function (node) {\n          return node.metadata.pagerank;\n        }\n      });\n\n      vm.sizeMetrics.push({\n        label: 'Uniform',\n        strategy: function () {\n          return 1;\n        }\n      });\n\n      vm.sizeMetrics.push({\n        label: 'HITS',\n        disabled: true,\n        strategy: function () {\n          return 1;\n        }\n      });\n\n      vm.sizeMetric = vm.sizeMetrics[0];\n    }\n\n    function toggleSearchForm() {\n      vm.showSearchForm = !vm.showSearchForm;\n\n      if (vm.showSearchForm) {\n        $timeout(function () {\n          angular.element('.search-form > input[type=\"search\"]').focus();\n        });\n      } else {\n        $scope.searchQuery = '';\n      }\n    }\n\n    function clearSearchForm() {\n      $scope.searchQuery = '';\n      $timeout(function () {\n        vm.showSearchForm = false;\n      });\n    }\n\n    function showHelp($event) {\n      var config = {\n        targetEvent: $event,\n        fullscreen: $mdMedia('sm') || $mdMedia('xs'),\n        templateUrl: 'app/main/help.html',\n        controller: 'HelpDialogController',\n        clickOutsideToClose: true\n      };\n\n      $mdDialog.show(config)\n    }\n\n    // HACK: this function is duplicated in the concept browser directive...\n    //       need a way to tell the graph to update from outside the directive...\n    function edgeFilter(edge) {\n      return vm.relnTypeFilter.length === 0 || vm.relnTypeFilter.indexOf(edge.relation) >= 0;\n    }\n\n    function loadNodeData(node) {\n      // HACK only works for people; should probably refactor to a directive with parallel one for works,\n      //      but how should we determine which directive to display?\n      vm.person = peopleRepo.get(node.id);\n\n      var works = worksRepo.searchByAuthor(node.id);\n      var worksP = works.$promise.then(function () {\n        if (!works.items) {\n          throw new Error('unable to load items');\n        }\n\n        vm.works = works.items;\n        return vm.works;\n      });\n\n      var related = {};\n\n      function makeTypeGroup(type) {\n        var group = { id: type.id, directed: type.directed };\n\n        if (type.directed) {\n          group.out = { label: type.title, nodes: [] };\n          group.in = { label: type.reverseTitle, nodes: [] };\n        } else {\n          group.none = { label: type.title, nodes: [] };\n        }\n\n        return group;\n      }\n\n      function ensureTypeGroup(type) {\n        if (!related.hasOwnProperty(type.id)) {\n          related[type.id] = makeTypeGroup(type);\n        }\n\n        return related[type.id];\n      }\n\n      node.outEdges.map(function (edge) {\n        var type = TYPES[edge.relation];\n        if (!type) return;\n\n        var group = ensureTypeGroup(type);\n        group[type.directed ? 'out' : 'none'].nodes.push(edge.target);\n      });\n\n      node.inEdges.map(function (edge) {\n        var type = TYPES[edge.relation];\n        if (!type) return;\n\n        var group = ensureTypeGroup(type);\n        group[type.directed ? 'in' : 'none'].nodes.push(edge.source);\n      });\n\n      vm.related = [];\n      for (var key in related) if (related.hasOwnProperty(key)) {\n        vm.related.push(related[key]);\n      }\n\n      return $q.all([vm.person.$promise, worksP]);\n    }\n\n    function getGraphData(type) {\n      var graph = graphRepo.get(type);\n\n      return graph.$promise.then(function () {\n        var nodesById = {};\n\n        // index nodes by ID; prepare structure for dereferencing\n        graph.graph.nodes.forEach(function (node) {\n          node.inEdges = [];\n          node.outEdges = [];\n\n          nodesById[node.id] = node;\n        });\n\n        // dereference edges\n        // edge direction plays an opposite role in the view than it does in the server data:\n        //    suppose A provoked B, C, and D\n        //    we would like to draw arrows from A to B, C, and D (A->B, A->C, A->D)\n        //    but for analytical purposes, the data treats provocation as references from B, C, and D back to A (B->A, C->A, D->A)\n        graph.graph.edges.forEach(function (edge) {\n          var target = nodesById[edge.source];\n          var source = nodesById[edge.target];\n\n          edge.source = source;\n          source.outEdges.push(edge);\n\n          edge.target = target;\n          target.inEdges.push(edge);\n        });\n\n        return graph;\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser')\n    .controller('HelpDialogController', HelpDialogController);\n\n  /** @ngInject */\n  function HelpDialogController($scope, $mdDialog) {\n    $scope.close = closeDialog;\n\n    function closeDialog() {\n      $mdDialog.hide();\n    }\n  }\n\n})();\n\n/*global ConceptBrowser:false*/\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser')\n    .directive('conceptBrowser', conceptBrowserDirective);\n\n  /** @ngInject */\n  function conceptBrowserDirective($window, $timeout) {\n    var directive = {\n      restrict: 'E',\n      scope: {\n        graph: '=ngModel',\n        width: '=',\n        height: '=',\n        padding: '=',\n        layout: '@',\n        activeNode: '=',\n        sizeMetric: '=',\n        selectMode: '=',\n        highlightedNodes: '=',\n        relnTypes: '='\n      },\n      link: linkFunc\n    };\n\n    return directive;\n\n    function linkFunc(scope, el) {\n      var width = scope.width;\n      var autoWidth = false;\n      var height = scope.height;\n      var autoHeight = false;\n      var layout = scope.layout;\n      var rootEl = el.get(0);\n\n      // HACK: delay initialization until flex elements have a width/height\n      $timeout(function () {\n        if (!width) {\n          width = el.width();\n          autoWidth = true;\n        }\n\n        if (!height) {\n          height = el.height();\n          autoHeight = true;\n        }\n\n        var graph = ConceptBrowser(rootEl, layout)\n          .size([width, height])\n          .edgeFilter(function (edge) {\n            return scope.relnTypes.length === 0 || scope.relnTypes.indexOf(edge.relation) >= 0;\n          });\n\n        if (scope.sizeMetric) {\n          graph.nodeCentralityMetric(scope.sizeMetric);\n        }\n\n        if (scope.selectMode) {\n          graph.selectMode(scope.selectMode);\n        }\n\n        if (scope.graph) {\n          graph.data(scope.graph.nodes, scope.graph.edges);\n          graph.refresh();\n        }\n\n        angular.element($window).on('resize', function () {\n          if (!autoWidth && !autoHeight) {\n            return;\n          }\n\n          var oldWidth = width;\n          var oldHeight = height;\n\n          if (autoWidth) {\n            width = el.width();\n          }\n\n          if (autoHeight) {\n            height = el.height();\n          }\n\n          if (oldWidth !== width || oldHeight !== height) {\n            graph.size([width, height]);\n            graph.refresh();\n          }\n        });\n\n        // listen for graph events\n\n        // HACK if digest is already in progress, do not try to set active node (probably because it was set from the parent scope)\n        var preventActivate = false;\n        graph.on('activate', function (evt) {\n          if (preventActivate) {\n            return;\n          }\n\n          scope.$apply(function () {\n            scope.activeNode = evt.node;\n          });\n        });\n\n        // listen for data updates\n        scope.$watchGroup(['width', 'height', 'graph', 'activeNode', 'sizeMetric', 'selectMode'], function (newValues, oldValues) {\n          var queueRefresh = false;\n\n          if (newValues[0] && newValues[0] !== oldValues[0]) {\n            width = newValues[0];\n            graph.size([width, height]);\n            if (newValues[2]) {\n              queueRefresh = true;\n            }\n          }\n\n          if (newValues[1] && newValues[1] !== oldValues[1]) {\n            height = newValues[1];\n            graph.size([width, height]);\n            if (newValues[2]) {\n              queueRefresh = true;\n            }\n          }\n\n          if (newValues[2] && newValues[2] !== oldValues[2]) {\n            // make a copy of the data so changes within this directive don't get leaked out\n            var graphData = angular.copy(newValues[2]);\n            graph.data(graphData.nodes, graphData.edges);\n            queueRefresh = true;\n          }\n\n          if (newValues[3] !== oldValues[3]) {\n            preventActivate = true;\n            graph.activate(newValues[3]);\n            preventActivate = false;\n          }\n\n          if (newValues[4] && newValues[4] !== oldValues[4]) {\n            graph.nodeCentralityMetric(newValues[4]);\n            queueRefresh = true;\n          }\n\n          if (newValues[5] && newValues[5] !== oldValues[5]) {\n            graph.selectMode(newValues[5]);\n          }\n\n          if (queueRefresh) {\n            graph.refresh();\n          }\n        });\n\n        scope.$watchCollection('highlightedNodes', function (newValues) {\n          if (newValues) {\n            graph.highlight(newValues);\n          }\n        });\n\n        scope.$watchCollection('relnTypes', function (newValues) {\n          if (newValues) {\n            graph.updateGraphSelections();\n          }\n        });\n      });\n    }\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider) {\n    $stateProvider\n      .state('home', {\n        url: '/',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        controllerAs: 'main'\n      });\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n/* global d3: false */\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser')\n    .constant('d3', d3);\n\n})();\n\n(function () {\n  'use strict';\n\n  angular\n    .module('sdaConceptBrowser')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider, $mdThemingProvider, peopleRepoProvider, worksRepoProvider, graphRepoProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n    peopleRepoProvider.url = '/api/catalog/people';\n    worksRepoProvider.url = '/api/catalog/works';\n    graphRepoProvider.url = '/api/catalog/graph';\n\n    $mdThemingProvider.definePalette('darkBrown', {\n      '50': '#595c59',\n      '100': '#4c4f4c',\n      '200': '#404240',\n      '300': '#333533',\n      '400': '#272827',\n      '500': '#1a1b1a',\n      '600': '#0d0e0d',\n      '700': '#010101',\n      '800': '#000000',\n      '900': '#000000',\n      'A100': '#e0f0e0',\n      'A200': '#565956',\n      'A400': '#7e837e',\n      'A700': '#000000',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['A100']\n    });\n\n    $mdThemingProvider.definePalette('copper', {\n      '50': '#d4b190',\n      '100': '#cca47e',\n      '200': '#c5976b',\n      '300': '#be8a59',\n      '400': '#b67e47',\n      '500': '#a47140',\n      '600': '#926439',\n      '700': '#7f5832',\n      '800': '#6d4b2b',\n      '900': '#5b3e23',\n      'A100': '#dcc3ab',\n      'A200': '#a47140',\n      'A400': '#48321c',\n      'A700': '#272927',\n\n      contrastDefaultColor: 'light',\n      contrastDarkColors: ['50', '100', '200', 'A100']\n    });\n\n    $mdThemingProvider.theme('default')\n      .primaryPalette('darkBrown')\n      .accentPalette('copper');\n  }\n\n})();\n\n/*eslint-env amd,browser,node*/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory();\n  } else {\n    root.EventDispatcher = factory();\n  }\n})(this, function () {\n  'use strict';\n\n  /**\n   * Creates a new simple event dispatcher object that handles listener registration and event triggering.\n   */\n  function EventDispatcher() {\n    /**\n     * Map of event name to registered event handlers\n     * @type {object.<string,function[]>}\n     */\n    var eventHandlers = {};\n\n    /**\n     * List of registered global event handlers\n     * @type {function[]}\n     */\n    var globalHandlers = [];\n\n    ////////////////////////////////////////////////////////////\n\n    var API = {};\n    API.all = addGlobalListener;\n    API.on = addListener;\n    API.once = addOnceListener;\n    API.trigger = trigger;\n    return API;\n\n    ////////////////////////////////////////////////////////////\n\n    /**\n     * Trigger the named event, passing the given context to all registered event handlers\n     * @param {string} eventName\n     * @param {object} context\n     */\n    function trigger(eventName, context) {\n      if (eventHandlers[eventName]) {\n        eventHandlers[eventName].forEach(function (handler) {\n          try {\n            handler(context);\n          } catch (e) {\n            // eslint-disable-next-line no-console\n            console.error(e);\n          }\n        });\n      }\n\n      globalHandlers.forEach(function (handler) {\n        try {\n          handler(eventName, context);\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.error(e);\n        }\n      });\n    }\n\n    /**\n     * Attach an event handler that will be triggered for all events\n     * @param {function} handler\n     * @return {function} deregistration function\n     */\n    function addGlobalListener(handler) {\n      globalHandlers.push(handler);\n\n      return function () {\n        var ix = globalHandlers.indexOf(handler);\n        if (ix >= 0) {\n          globalHandlers.splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Attach an event handler to the given event name.\n     * @param {string} eventName\n     * @param {function} handler\n     * @return {function} deregistration function\n     */\n    function addListener(eventName, handler) {\n      if (!eventHandlers[eventName]) {\n        eventHandlers[eventName] = [];\n      }\n\n      eventHandlers[eventName].push(handler);\n\n      return function () {\n        var ix = eventHandlers[eventName].indexOf(handler);\n        if (ix >= 0) {\n          eventHandlers[eventName].splice(ix, 1);\n        }\n      }\n    }\n\n    /**\n     * Attach an event listener to the given event name that will automatically deregister after it has been fired.\n     * @param {string} eventName\n     * @param {function} handler\n     * @return {function} deregistration function\n     */\n    function addOnceListener(eventName, handler) {\n      var deregister = addListener(eventName, function (context) {\n        try {\n          handler(context);\n        } catch (e) {\n          // eslint-disable-next-line no-console\n          console.error(e);\n        } finally {\n          deregister();\n        }\n      });\n\n      return deregister;\n    }\n  }\n\n  return EventDispatcher;\n\n});\n\n/*global d3:false*/\n/*eslint-env amd,browser,node*/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['d3'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    module.exports = factory(require('d3'));\n  } else {\n    factory(d3);\n  }\n})(this, function (d3) {\n  'use strict';\n\n  var LINK_DISTANCE = 20,\n      LINK_STRENGTH = 1,\n      CHARGE_DISTANCE_2 = Infinity;\n\n  /**\n   * force layout based on d3.layout.force(), but with horizontal wrapping\n   *\n   * @return {object}\n   */\n  d3.layout.force.cylindrical = function () {\n    var force = {},\n        event = d3.dispatch(\"start\", \"tick\", \"end\"),\n        size = [1, 1],\n        drag,\n        alpha,\n        friction = 0.9,\n        linkDistance = LINK_DISTANCE,\n        linkStrength = LINK_STRENGTH,\n        charge = -30,\n        chargeDistance2 = CHARGE_DISTANCE_2,\n        gravity = 0.1,\n        theta2 = 0.64,\n        nodes = [],\n        links = [],\n        distances,\n        strengths,\n        charges;\n\n    function wrapDx(dx, width) {\n      if (2 * Math.abs(dx) > width) {\n        // the \"other side\" of the cylinder is closer\n        if (dx < 0) {\n          // quad point is to the left: simulate force as if it were on the right\n          dx += width;\n        } else {\n          // quad point is to the right: simulate force as if it were on the left\n          dx -= width;\n        }\n      }\n\n      return dx;\n    }\n\n    function repulse(node) {\n      return function (quad, x1, _, x2) {\n        if (quad.point !== node) {\n          var width = size[0];\n\n          var dx = wrapDx(quad.cx - node.x, width),\n              dy = quad.cy - node.y,\n              dw = x2 - x1;\n\n\n          var dn = dx * dx + dy * dy;\n          var k = 0;\n\n          /* Barnes-Hut criterion. */\n          if (dw * dw / theta2 < dn) {\n            if (dn < chargeDistance2) {\n              k = quad.charge / dn;\n              node.px -= dx * k;\n              node.py -= dy * k;\n            }\n            return true;\n          }\n\n          if (quad.point && dn && dn < chargeDistance2) {\n            k = quad.pointCharge / dn;\n            node.px -= dx * k;\n            node.py -= dy * k;\n          }\n        }\n        return !quad.charge;\n      };\n    }\n\n    force.tick = function () {\n      // simulated annealing, basically\n      if ((alpha *= 0.99) < 0.005) {\n        event.end({\n          type: \"end\",\n          alpha: alpha = 0\n        });\n        return true;\n      }\n\n      var n = nodes.length,\n        m = links.length,\n        q,\n        i, // current index\n        o, // current object\n        s, // current source\n        t, // current target\n        l, // current distance\n        k, // current force\n        x, // x-distance\n        y; // y-distance\n\n      // gauss-seidel relaxation for links\n      for (i = 0; i < m; ++i) {\n        o = links[i];\n        s = o.source;\n        t = o.target;\n        x = wrapDx(t.x - s.x, size[0]);\n        y = t.y - s.y;\n        l = (x * x + y * y);\n\n        if (l !== 0) {\n          l = alpha * strengths[i] * ((l = Math.sqrt(l)) - distances[i]) / l;\n          x *= l;\n          y *= l;\n\n          t.x -= x * (k = s.weight / (t.weight + s.weight));\n          t.y -= y * k;\n\n          s.x += x * (k = 1 - k);\n          s.y += y * k;\n        }\n      }\n\n      // apply gravity forces\n      k = alpha * gravity;\n      if (k !== 0) {\n        x = size[0] / 2;\n        y = size[1] / 2;\n        i = -1;\n        if (k)\n          while (++i < n) {\n            o = nodes[i];\n            // o.x += (x - o.x) * k;\n            o.y += (y - o.y) * k;\n          }\n      }\n\n      // compute quadtree center of mass and apply charge forces\n      if (charge) {\n        accumulate(q = d3.geom.quadtree(nodes), alpha, charges);\n        i = -1;\n        while (++i < n) {\n          if (!(o = nodes[i]).fixed) {\n            q.visit(repulse(o));\n          }\n        }\n      }\n\n      // position verlet integration\n      i = -1;\n      while (++i < n) {\n        o = nodes[i];\n        if (o.fixed) {\n          o.x = o.px;\n          o.y = o.py;\n        } else {\n          o.x -= (o.px - (o.px = o.x)) * friction;\n          o.y -= (o.py - (o.py = o.y)) * friction;\n        }\n      }\n\n      // update positions if a node gets pushed off the sides of the visualization\n      i = -1;\n      var width = size[0];\n      while (++i < n) {\n        o = nodes[i];\n\n        var dx = o.px - o.x;\n        o.x %= width;\n        // ensure node.x is positive; there's a chance that -width < node.x % width < 0\n        if (o.x < 0) {\n          o.x += width;\n        }\n\n        // ensure that previous x position (used to calculate velocity) is semantically correct after wrapping\n        o.px = o.x + dx;\n\n      }\n\n      event.tick({\n        type: \"tick\",\n        alpha: alpha\n      });\n    };\n\n    force.nodes = function (x) {\n      if (!arguments.length) return nodes;\n      nodes = x;\n      return force;\n    };\n\n    force.links = function (x) {\n      if (!arguments.length) return links;\n      links = x;\n      return force;\n    };\n\n    force.size = function (x) {\n      if (!arguments.length) return size;\n      size = x;\n      return force;\n    };\n\n    force.linkDistance = function (x) {\n      if (!arguments.length) return linkDistance;\n      linkDistance = isFunction(x) ? x : +x;\n      return force;\n    };\n\n    force.linkStrength = function (x) {\n      if (!arguments.length) return linkStrength;\n      linkStrength = isFunction(x) ? x : +x;\n      return force;\n    };\n\n    force.friction = function (x) {\n      if (!arguments.length) return friction;\n      friction = +x;\n      return force;\n    };\n\n    force.charge = function (x) {\n      if (!arguments.length) return charge;\n      charge = isFunction(x) ? x : +x;\n      return force;\n    };\n\n    force.chargeDistance = function (x) {\n      if (!arguments.length) return Math.sqrt(chargeDistance2);\n      chargeDistance2 = x * x;\n      return force;\n    };\n\n    force.gravity = function (x) {\n      if (!arguments.length) return gravity;\n      gravity = +x;\n      return force;\n    };\n\n    force.theta = function (x) {\n      if (!arguments.length) return Math.sqrt(theta2);\n      theta2 = x * x;\n      return force;\n    };\n\n    force.alpha = function (x) {\n      if (!arguments.length) return alpha;\n\n      x = +x;\n      if (alpha) { // if we're already running\n        if (x > 0) alpha = x; // we might keep it hot\n        else alpha = 0; // or, next tick will dispatch \"end\"\n      } else if (x > 0) { // otherwise, fire it up!\n        event.start({\n          type: \"start\",\n          alpha: alpha = x\n        });\n        d3.timer(force.tick);\n      }\n\n      return force;\n    };\n\n    force.start = function () {\n      var i,\n        n = nodes.length,\n        m = links.length,\n        w = size[0],\n        h = size[1],\n        neighbors,\n        o;\n\n      for (i = 0; i < n; ++i) {\n        (o = nodes[i]).index = i;\n        o.weight = 0;\n      }\n\n      for (i = 0; i < m; ++i) {\n        o = links[i];\n        if (isNumber(o.source)) o.source = nodes[o.source];\n        if (isNumber(o.target)) o.target = nodes[o.target];\n        ++o.source.weight;\n        ++o.target.weight;\n      }\n\n      for (i = 0; i < n; ++i) {\n        o = nodes[i];\n        if (isNaN(o.x)) o.x = position(\"x\", w);\n        if (isNaN(o.y)) o.y = position(\"y\", h);\n        if (isNaN(o.px)) o.px = o.x;\n        if (isNaN(o.py)) o.py = o.y;\n      }\n\n      distances = [];\n      if (isFunction(linkDistance))\n        for (i = 0; i < m; ++i) distances[i] = +linkDistance.call(this, links[i], i);\n      else\n        for (i = 0; i < m; ++i) distances[i] = linkDistance;\n\n      strengths = [];\n      if (isFunction(linkStrength))\n        for (i = 0; i < m; ++i) strengths[i] = +linkStrength.call(this, links[i], i);\n      else\n        for (i = 0; i < m; ++i) strengths[i] = linkStrength;\n\n      charges = [];\n      if (isFunction(charge))\n        for (i = 0; i < n; ++i) charges[i] = +charge.call(this, nodes[i], i);\n      else\n        for (i = 0; i < n; ++i) charges[i] = charge;\n\n      // inherit node position from first neighbor with defined position\n      // or if no such neighbors, initialize node position randomly\n      // initialize neighbors lazily to avoid overhead when not needed\n      function position(dimension, size) {\n        if (!neighbors) {\n          neighbors = new Array(n);\n\n          for (j = 0; j < n; ++j)\n            neighbors[j] = [];\n\n          for (j = 0; j < m; ++j) {\n            var o = links[j];\n            neighbors[o.source.index].push(o.target);\n            neighbors[o.target.index].push(o.source);\n          }\n        }\n\n        var candidates = neighbors[i],\n          j = -1,\n          cs = candidates.length,\n          x;\n\n        while (++j < cs)\n          if (!isNaN(x = candidates[j][dimension])) return x;\n\n        return Math.random() * size;\n      }\n\n      return force.resume();\n    };\n\n    force.resume = function () {\n      return force.alpha(0.1);\n    };\n\n    force.stop = function () {\n      return force.alpha(0);\n    };\n\n    // use `node.call(force.drag)` to make nodes draggable\n    force.drag = function () {\n      if (!drag) drag = d3.behavior.drag()\n        .origin(function (o) {\n          return o;\n        })\n        .on(\"dragstart.force\", dragstart)\n        .on(\"drag.force\", dragmove)\n        .on(\"dragend.force\", dragend);\n\n      if (!arguments.length) return drag;\n\n      this.on(\"mouseover.force\", mouseover)\n        .on(\"mouseout.force\", mouseout)\n        .call(drag);\n    };\n\n    function dragmove(d) {\n      d.px = d3.event.x;\n      d.py = d3.event.y;\n      force.resume(); // restart annealing\n    }\n\n    force.edgePath = function () {\n      var width = size[0];\n\n      var getX1 = function (d) { return d[0][0]; }\n      var getY1 = function (d) { return d[0][1]; }\n      var getX2 = function (d) { return d[1][0]; }\n      var getY2 = function (d) { return d[1][1]; }\n\n      var drawLine = function (selection) {\n        selection.attr('d', function (d) {\n          var x1 = getX1(d);\n          var y1 = getY1(d);\n          var x2 = getX2(d);\n          var y2 = getY2(d);\n\n          if (2*Math.abs(x1-x2) < width) {\n            // draw direct from source to target\n            return 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2;\n          } else if (x1 < x2) {\n            // shorter to go around the \"back\" and x1 is on the left\n            return 'M ' + x1 + ' ' + y1 + ' L ' + (x2 - width) + ' ' + y2 + ' ' +\n              'M ' + x2 + ' ' + y2 + ' L ' + (x1 + width) + ' ' + y1;\n          } else {\n            // shorter to go around the \"back\" and x1 is on the right\n            return 'M ' + x1 + ' ' + y1 + ' L ' + (x2 + width) + ' ' + y2 + ' ' +\n              'M ' + x2 + ' ' + y2 + ' L ' + (x1 - width) + ' ' + y1;\n          }\n        });\n      };\n\n      drawLine.x1 = function (fn) { getX1 = fn; return drawLine; }\n      drawLine.y1 = function (fn) { getY1 = fn; return drawLine; }\n      drawLine.x2 = function (fn) { getX2 = fn; return drawLine; }\n      drawLine.y2 = function (fn) { getY2 = fn; return drawLine; }\n\n      return drawLine;\n    };\n\n    return d3.rebind(force, event, \"on\");\n  };\n\n  // The fixed property has three bits:\n  // Bit 1 can be set externally (e.g., d.fixed = true) and show persist.\n  // Bit 2 stores the dragging state, from mousedown to mouseup.\n  // Bit 3 stores the hover state, from mouseover to mouseout.\n  // Dragend is a special case: it also clears the hover state.\n\n  function dragstart(d) {\n    d.fixed |= 2; // set bit 2\n  }\n\n  function dragend(d) {\n    d.fixed &= ~6; // unset bits 2 and 3\n  }\n\n  function mouseover(d) {\n    d.fixed |= 4; // set bit 3\n    d.px = d.x;\n    d.py = d.y; // set velocity to zero\n  }\n\n  function mouseout(d) {\n    d.fixed &= ~4; // unset bit 3\n  }\n\n  function accumulate(quad, alpha, charges) {\n    var cx = 0,\n      cy = 0;\n\n    quad.charge = 0;\n\n    if (!quad.leaf) {\n      var nodes = quad.nodes,\n        n = nodes.length,\n        i = -1,\n        c;\n\n      while (++i < n) {\n        c = nodes[i];\n        if (!c) continue;\n\n        accumulate(c, alpha, charges);\n        quad.charge += c.charge;\n        cx += c.charge * c.cx;\n        cy += c.charge * c.cy;\n      }\n    }\n\n    if (quad.point) {\n      // jitter internal nodes that are coincident\n      if (!quad.leaf) {\n        quad.point.x += Math.random() - 0.5;\n        quad.point.y += Math.random() - 0.5;\n      }\n\n      var k = alpha * charges[quad.point.index];\n\n      quad.charge += quad.pointCharge = k;\n\n      cx += k * quad.point.x;\n      cy += k * quad.point.y;\n    }\n\n    quad.cx = cx / quad.charge;\n    quad.cy = cy / quad.charge;\n  }\n\n  function isFunction(o) {\n    return typeof o === 'function';\n  }\n\n  function isNumber(o) {\n    return typeof o === 'number';\n  }\n\n});\n\n/*eslint-env amd,browser,node*/\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['d3', 'event-dispatcher', 'd3-force-cylindrical'], factory);\n  } else if (typeof module === 'object' && module.exports) {\n    require('d3-force-cylindrical');\n    module.exports = factory(require('d3'), require('event-dispatcher'));\n  } else {\n    root.ConceptBrowser = factory(root.d3, root.EventDispatcher);\n  }\n})(this, function (d3, EventDispatcher) {\n  'use strict';\n\n  /** @type {integer} */\n  var NODE_MIN_SIZE = 5;\n\n  /** @type {integer} */\n  var NODE_MAX_SIZE = 13;\n\n  /** @type {object.<string,functin>} */\n  var GRAPH_LAYOUT_CTORS = {\n    planar: d3.layout.force,\n    cylindrical: d3.layout.force.cylindrical\n  };\n\n  /** @type {string} */\n  var TIP_CSS_CLASS = 'd3-tip';\n\n  /** @type {object.<string,integer>} */\n  var TIP_POSITION_MARGIN = {\n    left: 200,\n    right: 200,\n    top: 100,\n    bottom: 100\n  };\n\n  if (!d3.tip) {\n    // eslint-disable-next-line no-console\n    console.warn('d3.tip is not available; tooltips will not display properly.');\n  }\n\n  /**\n   * SDA Concept Browser Visualization\n   *\n   * @param  {Element} rootEl\n   * @param  {integer} width\n   * @param  {integer} height\n   * @param  {string} [layout=planar] - one of: (planar, cylindrical)\n   */\n  function ConceptBrowser(rootEl, layout, options) {\n    layout = layout || 'planar';\n    options = options || {};\n\n    var events = EventDispatcher();\n\n    if (options.debug) {\n      events.all(function (eventName, context) {\n        // eslint-disable-next-line no-console\n        console.log(eventName, context.node ? context.node.id : context);\n      });\n    }\n\n    /**\n     * visualization width in pixels\n     *\n     * @type {integer}\n     */\n    var width;\n\n    /**\n     * visualization height in pixels\n     *\n     * @type {integer}\n     */\n    var height;\n\n    /**\n     * Nodes in the graph\n     *\n     * @type {Node[]}\n     */\n    var nodes = [];\n\n    /**\n     * Edges connecting nodes in the graph\n     *\n     * @type {Node[]}\n     */\n    var edges = [];\n\n    /**\n     * Collection of nodes that are in the \"highlighted\" state\n     *\n     * @type {Node[]}\n     */\n    var highlighted = [];\n\n    /**\n     * The currently focused node (if there is one)\n     *\n     * @type {?Node}\n     */\n    var focused = null;\n\n    /**\n     * Collection of nodes that are in the \"selected\" state\n     *\n     * @type {Node[]}\n     */\n    var selected = [];\n\n    /**\n     * The currently activated node (if there is one)\n     *\n     * @type {?Node}\n     */\n    var activated = null;\n\n    /**\n     * @type {d3.selection}\n     */\n    var svg;\n\n    /**\n     * @type {d3.selection}\n     */\n    var nodeLayer;\n\n    /**\n     * @type {d3.selection}\n     */\n    var edgeLayer;\n\n    /**\n     * @type {d3.selection}\n     */\n    var progressBar;\n\n    /**\n     * @type {d3.scale}\n     */\n    var progressScale;\n\n    /**\n     * @type {d3.scale}\n     */\n    var nodeRadiusScale;\n\n    /**\n     * @type {d3.scale}\n     */\n    var centralityMetricScale;\n\n    /**\n     * @type {d3.layout.force}\n     */\n    var graph;\n\n    /**\n     * function used in a selection.call() method for drawing edge paths.\n     * by default, it draws a straight line between the edge source and target nodes\n     *\n     * @type {function}\n     */\n    var drawEdge = function (selection) {\n      selection.attr('d', function (edge) {\n        var x1 = edge.source.x;\n        var y1 = edge.source.y;\n        var x2 = edge.target.x;\n        var y2 = edge.target.y;\n\n        return 'M ' + x1 + ' ' + y1 + ' L ' + x2 + ' ' + y2;\n      });\n    }\n\n    /**\n     * @type {?d3.tip}\n     */\n    var tooltip = null;\n\n    /**\n     * @type {boolean}\n     */\n    var isInitialized = false;\n\n    /**\n     * Given a selected node, determines what other nodes should be highlighted.\n     * @type {function}\n     */\n    var selectMode = function (node) {\n      if (!node) {\n        return [];\n      }\n\n      var adjacent = node.outEdges.forEach(function (edge) {\n        return edge.target;\n      });\n\n      var incident = node.inEdges.forEach(function (edge) {\n        return edge.source;\n      });\n\n      return [node].concat(adjacent, incident);\n    };\n\n    /**\n     * Given a node, what is its size metric?\n     * @type {function}\n     */\n    var centralityMetric = function () {\n      return 1;\n    };\n\n    /**\n     * A predicate to determine whether a given edge should display\n     * @type {function}\n     */\n    var edgeFilter = function () {\n      return true;\n    };\n\n    ////////////////////////////////////////////////////////////\n\n    // expose public methods\n    var API = {};\n    API.size = setSize;\n    API.nodeCentralityMetric = setNodeCentralityMetric;\n    API.selectMode = setSelectMode;\n    API.data = setData;\n    API.highlight = setHighlighted;\n    API.activate = setActivated;\n    API.edgeFilter = setEdgeFilter;\n    API.updateGraphSelections = applyStyleClasses;\n    API.refresh = refresh;\n    API.on = events.on;\n    return API;\n\n    ////////////////////////////////////////////////////////////\n\n    /**\n     * Sets graph dimensions. refresh() must be called in order for changes to take effect\n     *\n     * @param {integer[]} dims - dimensions (width, height) of new viewing area\n     */\n    function setSize(dims) {\n      width = dims[0];\n      height = dims[1];\n\n      if (isInitialized) {\n        svg.attr('width', width).attr('height', height);\n        progressScale.range([0, width]);\n        graph.size([width, height]);\n      }\n\n      return API;\n    }\n\n    /**\n     * Sets a node size metric function\n     *\n     * @param {function} nodeCentralityMetric\n     */\n    function setNodeCentralityMetric(nodeCentralityMetric) {\n      centralityMetric = nodeCentralityMetric;\n\n      if (isInitialized) {\n        var centralityExtent = d3.extent(nodes, centralityMetric);\n        centralityMetricScale.domain(centralityExtent[0] === centralityExtent[1] ? [centralityExtent[0] - 1, centralityExtent[1] + 1] : centralityExtent);\n      }\n\n      return API;\n    }\n\n    /**\n     * Sets a node selection mode function\n     *\n     * @param {function} _selectMode\n     */\n    function setSelectMode(_selectMode) {\n      selectMode = _selectMode;\n\n      return API;\n    }\n\n    /**\n     * Sets graph data. refresh() must be called in order for changes to take effect\n     *\n     * @param {Node[]} _nodes\n     * @param {Edge[]} _edges\n     */\n    function setData(_nodes, _edges) {\n      nodes = _nodes;\n      edges = _edges;\n\n      // randomize node positions if not already set\n      nodes.forEach(function (node) {\n        node.x = (node.x || Math.random()) * width;\n        node.y = (node.y || Math.random()) * height;\n      });\n\n      return API;\n    }\n\n    /**\n     * Sets the set of currently highlighted nodes\n     *\n     * @param {Node|Node[]} nodes\n     */\n    function setHighlighted(highlightedNodes) {\n      if (!(highlightedNodes instanceof Array)) {\n        highlightedNodes = [highlightedNodes];\n      }\n\n      // make sure every node is present in the graph\n      var allNodesInGraph = highlightedNodes.every(function (node) {\n        return nodes.indexOf(node) >= 0;\n      });\n\n      if (!allNodesInGraph) {\n        throw new Error('some node(s) to be highlighted are not members of the graph');\n      }\n\n      unhighlightAll();\n      highlight(highlightedNodes);\n\n      return API;\n    }\n\n    /**\n     * Sets the currently active node\n     *\n     * @param {Node} node\n     */\n    function setActivated(node) {\n      if (node && nodes.indexOf(node) < 0) {\n        throw new Error('node to be activated is not a member of the graph');\n      }\n\n      deactivate();\n\n      if (node) {\n        activate(node);\n\n        // also select nodes\n        deselectAll();\n        select(node);\n      }\n\n      return API;\n    }\n\n    /**\n     * Sets an edge predicate that determines whether an edge should be displayed\n     *\n     * @param {function} fn\n     */\n    function setEdgeFilter(fn) {\n      edgeFilter = fn;\n\n      return API;\n    }\n\n    /**\n     * Update node and edge bindings for display and run force-directed graph simulation\n     *\n     * @param {object} data\n     */\n    function refresh() {\n      // ensure visualization is initialized\n      initialize();\n\n      // begin force-directed simulation\n      graph\n        .nodes(nodes)\n        .links(edges)\n        .start();\n\n      bindNodes();\n      bindEdges();\n\n      return API;\n    }\n\n    ////////////////////////////////////////////////////////////\n\n    function initialize() {\n      if (!width || !height) {\n        throw new Error('No width/height set. Use size([width, height]) to set size before initializing');\n      }\n\n      if (!nodes || !edges) {\n        throw new Error('No nodes/edges set. Use data(nodes, edges) to set them before initializing');\n      }\n\n      if (isInitialized) {\n        return;\n      }\n\n      isInitialized = true;\n\n      svg = d3.select(rootEl).append('svg')\n        .attr('width', width)\n        .attr('height', height);\n\n      // extract edge types and create arrowhead styles for them\n      var edgeTypes = edges.reduce(function (types, edge) {\n        if (types.indexOf(edge.relation) < 0) {\n          types.push(edge.relation);\n        }\n        return types;\n      }, []);\n\n      defineArrowheads(svg, edgeTypes, ['', 'activated', 'selected', 'focused']);\n\n      var baseGroup = svg.append('g').attr('class', 'concept-browser');\n      edgeLayer = baseGroup.append('g').attr('class', 'edges');\n      nodeLayer = baseGroup.append('g').attr('class', 'nodes');\n\n      progressBar = baseGroup.append('rect').attr('class', 'progress')\n        .attr('x', 0)\n        .attr('y', 0)\n        .attr('height', 2);\n\n      progressScale = d3.scale.linear()\n        .domain([Math.log(0.1), Math.log(0.005)])\n        .range([0, width]);\n\n      var centralityExtent = d3.extent(nodes, centralityMetric);\n      centralityMetricScale = d3.scale.linear()\n        .domain(centralityExtent[0] === centralityExtent[1] ? [centralityExtent[0] - 1, centralityExtent[1] + 1] : centralityExtent)\n        .range([0, 1]);\n\n      nodeRadiusScale = function (x) {\n        return NODE_MIN_SIZE + (NODE_MAX_SIZE - NODE_MIN_SIZE) * centralityMetricScale(x);\n      }\n\n      graph = GRAPH_LAYOUT_CTORS[layout || 'planar']()\n        .size([width, height])\n        .on('tick', tick);\n      configureGraph(graph);\n\n      if (graph.edgePath) {\n        drawEdge = graph.edgePath()\n          .x1(function (edge) { return edge.source.x; })\n          .y1(function (edge) { return edge.source.y; })\n          .x2(function (edge) { return edge.target.x; })\n          .y2(function (edge) { return edge.target.y; });\n      }\n\n      if (d3.tip) {\n        tooltip = d3.tip()\n            .attr('class', TIP_CSS_CLASS)\n            .direction(tooltipDirection)\n            .offset(tooltipOffset)\n            .html(function (node) { return node.label; });\n\n        events.on('focus', function (evt) { showTooltip(evt.node); });\n        events.on('blur', function (evt) { hideTooltip(evt.node); });\n      }\n\n      var updateGraphSelections = debounce(applyStyleClasses, 100, true, true);\n\n      events.on('highlight', updateGraphSelections);\n      events.on('unhighlight', updateGraphSelections);\n      events.on('focus', updateGraphSelections);\n      events.on('blur', updateGraphSelections);\n      events.on('select', updateGraphSelections);\n      events.on('deselect', updateGraphSelections);\n      events.on('activate', updateGraphSelections);\n      events.on('deactivate', updateGraphSelections);\n    }\n\n    /**\n     * Sets configuration values on a D3 graph instance\n     *\n     * @param  {d3.svg.graph} graph\n     */\n    function configureGraph(graph) {\n      graph\n        .gravity(0.1)\n        // .linkDistance(50)\n        // .chargeDistance(width * 0.25)\n        .linkDistance(50)\n        .linkStrength(function (edge) {\n          // influential nodes pull their supporters closer\n          var sz = centralityMetric(edge.source);\n          return centralityMetricScale(sz)\n          // var targetInfluence = edge.target.stats.in_degree / 10;\n          // return 1 - 1/(1 + targetInfluence);\n        })\n        .charge(function (node) {\n          // HACK experiment with variably-charged nodes\n          var chargeRange = [-50, -300];\n          var influenceRange = [0, 1];\n          var sz = centralityMetric(node);\n\n          return chargeRange[0] + (chargeRange[1] - chargeRange[0])/(influenceRange[1] - influenceRange[0]) * (centralityMetricScale(sz) - influenceRange[0]);\n        })\n        .friction(.9);\n        // .theta(0.08);\n    }\n\n    /**\n     * Update node positions with each tick of a graph's physics simulation\n     *\n     * @param {object} evt\n     */\n    function tick(evt) {\n      updatePositions();\n\n      if (evt.alpha > 0.0051) {\n        progressBar.attr('width', progressScale(Math.log(evt.alpha)));\n        // bail early; do not render nodes\n        if (Math.random() < 0.9) return;\n      } else {\n        progressBar.attr('width', 0);\n      }\n\n      nodeLayer.selectAll('.node').transition().duration(500)\n        .attr('transform', function (node) {\n          return 'translate(' + node.x + ',' + node.y + ')';\n        });\n\n      edgeLayer.selectAll('.edge').transition().duration(500)\n        .call(drawEdge);\n    }\n\n    /**\n     * Update node bindings on the visualization\n     *\n     * @param  {Node[]} nodes\n     */\n    function bindNodes() {\n      if (!nodes || nodes.length === 0) {\n        throw new Error('no nodes provided');\n      }\n\n      // var nodeMetricExtent = d3.extent(nodes, function (node) {\n      //   return (node.metadata && node.metadata.pagerank) || 1;\n      // });\n\n      // nodeRadiusScale.domain(nodeMetricExtent);\n\n      var nodeSelect = nodeLayer.selectAll('.node')\n        .data(nodes, function (node) {\n          return node.id;\n        });\n\n      var nodeEnter = nodeSelect.enter().append('g')\n        .attr('class', 'node')\n        .attr('transform', function (node) {\n          return 'translate(' + node.x + ',' + node.y + ')';\n        })\n        .on('mouseover', focus)\n        .on('mouseout', blur)\n        .on('dblclick', activate)\n        .on('click', function (node) {\n          if (d3.event.ctrlKey) {\n            if (selected.indexOf(node) < 0) {\n              select(node);\n            } else {\n              deselect(node);\n            }\n          } else {\n            deselectAll();\n            select(node);\n          }\n        });\n\n      nodeEnter.append('circle');\n\n      nodeSelect.select('circle')\n        .attr('r', function (node) {\n          var sz = centralityMetric(node);\n          return nodeRadiusScale(sz);\n        });\n\n      nodeSelect.exit().remove();\n\n      if (tooltip) {\n        nodeLayer.call(tooltip);\n      }\n    }\n\n    /**\n     * Update edge bindings on the visualization\n     *\n     * @param  {Edge[]} edges\n     */\n    function bindEdges() {\n      if (!edges || edges.length === 0) {\n        throw new Error('no edges provided');\n      }\n\n      var edgeSelect = edgeLayer.selectAll('.edge')\n        .data(edges, function (edge) {\n          return edge.source.id + ',' + edge.target.id;\n        });\n\n      edgeSelect.enter().append('path')\n        .attr('class', function (edge) {\n          return 'edge ' + edge.relation;\n        })\n        .attr('marker-end', function (edge) {\n          return 'url(#arrowhead-' + edge.relation + ')';\n        })\n        // .style('stroke-width', function (edge) {\n        //   var multiplicity = (edge.metadata && edge.metadata.multiplicity) || 1;\n        //   return multiplicity + 'pt';\n        // })\n        .call(drawEdge);\n\n      edgeSelect.exit().remove();\n    }\n\n    /**\n     * Adds the given node or nodes to the set of highlighted nodes\n     *\n     * @param {Node|Node[]} ns\n     */\n    function highlight(ns) {\n      if (!(ns instanceof Array)) {\n        ns = [ns];\n      }\n\n      ns.forEach(function (n) {\n        if (highlighted.indexOf(n) < 0) {\n          highlighted.push(n);\n        }\n\n        events.trigger('highlight', { node: n, selection: selected });\n      });\n    }\n\n    /**\n     * Unhighlights the given node, nodes, or all currently highlighted nodes\n     * @param  {Node|Node[]} [ns]\n     */\n    function unhighlight(ns) {\n      if (!ns) {\n        return unhighlightAll();\n      } else if (!(ns instanceof Array)) {\n        ns = [ns];\n      }\n\n      ns.forEach(function (n) {\n        var ix = highlighted.indexOf(n);\n        if (ix >= 0) {\n          highlighted.splice(ix, 1);\n        }\n      });\n    }\n\n    /**\n     * Unhighlights all nodes\n     */\n    function unhighlightAll() {\n      highlighted.forEach(function (node) {\n        events.trigger('unhighlight', { node: node, selection: selected });\n      });\n\n      highlighted = [];\n    }\n\n    /**\n     * Focuses the given node\n     *\n     * @param {Node} node\n     */\n    function focus(node) {\n      // ensure that the currently selected node has already been blurred\n      blur();\n\n      focused = node;\n      events.trigger('focus', { node: focused, selection: selected });\n    }\n\n    /**\n     * Blurs the given node or the currently focused node.\n     *\n     * @param {Node} [node]\n     */\n    function blur(node) {\n      node = node || focused;\n\n      if (node) {\n        if (focused === node) {\n          focused = null;\n        } else {\n          throw new Error('tried to blur a node that was not focused');\n        }\n\n        events.trigger('blur', { node: node, selection: selected });\n      }\n    }\n\n    /**\n     * Activates the given node\n     *\n     * @param {Node} node\n     */\n    function activate(node) {\n      // don't do anything if node is already active\n      if (activated === node) {\n        return;\n      }\n\n      // ensure that the active node has been deactivated\n      deactivate()\n\n      activated = node;\n      events.trigger('activate', { node: activated, selection: selected });\n    }\n\n    /**\n     * Deactivates the given node or the currently activated node.\n     *\n     * @param {Node} node\n     */\n    function deactivate(node) {\n      node = node || activated;\n\n      if (node) {\n        if (activated === node) {\n          activated = null;\n        } else {\n          throw new Error('tried to deactivate a node that was not activated');\n        }\n\n        events.trigger('deactivate', { node: node, selection: selected });\n      }\n    }\n\n    /**\n     * Adds the given node to the list of currently selected nodes\n     *\n     * @param {Node} node\n     */\n    function select(node) {\n      if (!node) {\n        throw new Error('no node provided');\n      }\n\n      if (selected.indexOf(node) < 0) {\n        selected.push(node);\n      } else {\n        throw new Error('tried to select a node that is already selected');\n      }\n\n      events.trigger('select', { node: node, selection: selected });\n    }\n\n    /**\n     * Removes the given node from the list of currently selected nodes\n     *\n     * @param {Node} node\n     */\n    function deselect(node) {\n      if (!node) {\n        throw new Error('no node provided to deselect');\n      }\n\n      var ix = selected.indexOf(node);\n      if (ix < 0) {\n        throw new Error('tried to deselect a node that was not selected');\n      } else {\n        selected.splice(ix, 1);\n      }\n\n      events.trigger('deselect', { node: node, selection: selected });\n    }\n\n    /**\n     * Deselects all selected nodes\n     */\n    function deselectAll() {\n      selected.forEach(function (node) {\n        events.trigger('deselect', { node: node, selection: [] });\n      });\n\n      selected = [];\n    }\n\n    /**\n     * Displays a tooltip with a label for the given node.\n     *\n     * @param {Node} node\n     */\n    function showTooltip(node) {\n      if (tooltip) {\n        tooltip.attr('class', TIP_CSS_CLASS)\n          .show(node);\n      }\n    }\n\n    /**\n     * Hides the tooltip for the given node.\n     *\n     * @param {Node} node\n     */\n    function hideTooltip(node) {\n      if (tooltip) {\n        tooltip.attr('class', TIP_CSS_CLASS)\n          .hide(node);\n      }\n    }\n\n    /**\n     * Marks selected nodes and edges as highlighted\n     */\n    function applyStyleClasses() {\n      var activatedSet = [activated];\n\n\n      var selectedSet = selected.slice();\n\n      var focusedSet = selectMode(focused);\n\n      // ego graphs of selected nodes get focused\n      selected.forEach(function (p) {\n        selectMode(p).forEach(function (q) {\n          if (focusedSet.indexOf(q) < 0) {\n            focusedSet.push(q);\n          }\n        });\n      });\n\n      // ego graphs of activated nodes get focused\n      selectMode(activated).forEach(function (q) {\n        if (focusedSet.indexOf(q) < 0) {\n          focusedSet.push(q);\n        }\n      });\n\n      var highlightedSet = highlighted.slice();\n\n      nodeLayer.selectAll('.node')\n        .classed('activated', function (node) {\n          return activatedSet.indexOf(node) >= 0;\n        })\n        .classed('selected', function (node) {\n          return selectedSet.indexOf(node) >= 0;\n        })\n        .classed('focused', function (node) {\n          return focusedSet.indexOf(node) >= 0;\n        })\n        .classed('highlighted', function (node) {\n          return highlightedSet.indexOf(node) >= 0;\n        });\n\n      edgeLayer.selectAll('.edge')\n        .classed('activated', function (edge) {\n          return activatedSet.indexOf(edge.source) >= 0 && activatedSet.indexOf(edge.target) >= 0;\n        })\n        .classed('selected', function (edge) {\n          return selectedSet.indexOf(edge.source) >= 0 && selectedSet.indexOf(edge.target) >= 0;\n        })\n        .classed('focused', function (edge) {\n          return focusedSet.indexOf(edge.source) >= 0 && focusedSet.indexOf(edge.target) >= 0;\n        })\n        .classed('hidden', function (edge) {\n          return !edgeFilter(edge);\n        })\n        .attr('marker-end', function (edge) {\n          var cls = '';\n\n          if (activatedSet.indexOf(edge.source) >= 0 && activatedSet.indexOf(edge.target) >= 0) {\n            cls = '-activated';\n          } else if (selectedSet.indexOf(edge.source) >= 0 && selectedSet.indexOf(edge.target) >= 0) {\n            cls = '-selected'\n          } else if (focusedSet.indexOf(edge.source) >= 0 && focusedSet.indexOf(edge.target) >= 0) {\n            cls = '-focused'\n          }\n\n          return 'url(#arrowhead-' + edge.relation + cls + ')';\n        });\n    }\n\n    /**\n     * Sets positions of each node to within the viewing area, wrapping left and right sides\n     */\n    function updatePositions() {\n      nodes.forEach(function (node) {\n        // constrain x and y positions to within viewing area\n        node.x = Math.max(Math.min(node.x, width), 0);\n        node.y = Math.max(Math.min(node.y, height), 0);\n      });\n    }\n\n    /**\n     * Gets node-relative tooltip positioning information from a node.\n     * Based on how close the node is to the border/sides of the visualization.\n     *\n     * @param {Node} node\n     * @return {string} tooltip direction (one of: n, ne, e, se, s, sw, w, nw)\n     */\n    function tooltipDirection(node) {\n      var dir = '';\n\n      // control top/bottom based on proximity to borders\n      if (node.y > height - TIP_POSITION_MARGIN.bottom) dir += 'n';\n      else if (node.y < TIP_POSITION_MARGIN.top) dir += 's';\n\n      // control side based on proximity to borders\n      if (node.x > width - TIP_POSITION_MARGIN.right) dir += 'w';\n      else if (node.x < TIP_POSITION_MARGIN.left) dir += 'e';\n\n      // fall back to top\n      if (dir === '') dir = 'n';\n\n      return dir;\n    }\n\n     /**\n      * Controls how far to place the tooltip from the point at which the node is located.\n      * Offset coordinates based on how close the node is to the border/sides of the visualization\n      * (i.e. the node's radius)\n      *\n      * @param {Node} node\n      * @return {integer[]} tooltip x/y offset coordinates\n      */\n    function tooltipOffset(node) {\n      var sz = centralityMetric(node);\n      var radius = nodeRadiusScale(sz);\n      var offset = [0, 0];\n\n      if (node.y > height - TIP_POSITION_MARGIN.bottom) offset[0] -= radius;\n      else if (node.y < TIP_POSITION_MARGIN.top) offset[0] += radius;\n\n      if (node.x > width - TIP_POSITION_MARGIN.left_right) offset[1] -= radius;\n      else if (node.x < TIP_POSITION_MARGIN.left_right) offset[1] += radius;\n\n      if (offset[1] === 0 && offset[0] === 0) offset[0] -= radius;\n\n      return offset;\n    }\n\n    /**\n     * Sets arrowhead definitions on the SVG defs element\n     *\n     * @param  {object} svg\n     */\n    function defineArrowheads(svg, edgeTypes, classTypes) {\n      var arrowTypes = [];\n      edgeTypes.forEach(function (type) {\n        classTypes.forEach(function (cls) {\n          arrowTypes.push('arrowhead-' + type + (cls ? '-' + cls : ''));\n        });\n      });\n\n      // arrowhead definitions\n      svg.append('defs').selectAll('marker')\n          .data(arrowTypes)\n        .enter().append('marker')\n          .attr('id', function(id) { return id; })\n          .attr('viewBox', '0 -4 10 8')\n          .attr('refX', 25)\n          .attr('refY', 0)\n          .attr('markerWidth', 6)\n          .attr('markerHeight', 6)\n          .attr('orient', 'auto')\n        .append('path')\n          .attr('d', 'M 0,-4 L 10,0 L 0,4');\n    }\n  }\n\n  return ConceptBrowser;\n\n  function debounce(fn, wait, leading, trailing) {\n    var timeout;\n\n    if (typeof leading === 'undefined') {\n      leading = true;\n    }\n\n    if (typeof trailing === 'undefined') {\n      trailing = false;\n    }\n\n    return function () {\n      var ctx = this;\n      var args = arguments;\n\n      var callNow = leading && !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(later, wait);\n\n      if (callNow) {\n        fn.apply(ctx, args);\n      }\n\n      function later() {\n        timeout = null;\n        if (trailing) {\n          fn.apply(ctx, args);\n        }\n      }\n    };\n  }\n\n});\n\nangular.module(\"sdaConceptBrowser\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/main/help.html\",\"<md-dialog><md-toolbar><div class=md-toolbar-tools><h2>Help</h2><span flex></span><md-button class=md-icon-button ng-click=close()><md-icon>close</md-icon></md-button></div></md-toolbar><md-dialog-content><div class=md-dialog-content layout=column layout-align=\\\"center center\\\"><iframe width=1280 height=720 src=https://www.youtube.com/embed/0PzUCCnlN18 frameborder=0 allowfullscreen></iframe></div></md-dialog-content></md-dialog>\");\n$templateCache.put(\"app/main/main.html\",\"<md-toolbar class=layout-navbar><div class=md-toolbar-tools><a class=logo href=/ ><img src=/assets/images/sda-logo-light.png alt=SDA></a><h1>Concept Browser</h1><span flex></span><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title=\\\"Ranking Model\\\"><md-icon>adjust</md-icon></md-button><md-menu-content><md-menu-item ng-repeat=\\\"metric in main.sizeMetrics\\\"><md-button ng-click=\\\"main.sizeMetric = metric\\\" ng-disabled=metric.disabled><md-icon md-menu-align-target>radio_button_{{main.sizeMetric === metric ? \\'\\' : \\'un\\'}}checked</md-icon>{{metric.label}}</md-button></md-menu-item></md-menu-content></md-menu><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title=\\\"Selection Mode\\\"><md-icon>device_hub</md-icon></md-button><md-menu-content><md-menu-item ng-repeat=\\\"mode in main.selectModes\\\"><md-button ng-click=\\\"main.selectMode = mode\\\" ng-disabled=metric.disabled><md-icon md-menu-align-target>radio_button_{{main.selectMode === mode ? \\'\\' : \\'un\\'}}checked</md-icon>{{mode.label}}</md-button></md-menu-item></md-menu-content></md-menu><md-menu><md-button class=md-icon-button md-menu-origin ng-click=$mdOpenMenu($event) title=\\\"Relationship Types\\\"><md-icon>filter_list</md-icon></md-button><md-menu-content><md-menu-item><md-button ng-click=\\\"main.relnTypeFilter = []\\\"><md-icon md-menu-align-target>check_box{{main.relnTypeFilter.length &gt; 0 ? \\'_outline_blank\\' : \\'\\'}}</md-icon>All Relationships</md-button></md-menu-item><md-divider></md-divider><md-menu-item ng-repeat=\\\"type in main.relnTypes\\\"><md-button ng-click=main.toggleRelnTypeFilter(type.id) md-prevent-menu-close><md-icon md-menu-align-target>check_box{{main.relnTypeFilter.indexOf(type.id) &lt; 0 ? \\'_outline_blank\\' : \\'\\'}}</md-icon>{{type.title}}</md-button></md-menu-item></md-menu-content></md-menu><span flex></span><md-button class=md-icon-button ng-click=main.toggleSearchForm($event)><md-icon>search</md-icon></md-button><form name=search class=search-form layout=row ng-style=\\\"{ width: main.showSearchForm ? \\'20rem\\' : \\'0\\' }\\\"><input type=search name=query ng-model=searchQuery ng-change=main.highlightNodes() flex> <button class=clear ng-click=main.clearSearchForm()><md-icon>clear</md-icon></button></form><md-button class=md-icon-button ng-click=main.showHelp($event)><md-icon>help_outline</md-icon></md-button></div></md-toolbar><main layout=row layout-align=center flex><div layout=column flex><concept-browser flex ng-if=main.graph ng-model=main.graph active-node=main.activeNode size-metric=main.sizeMetric.strategy select-mode=main.selectMode.strategy highlighted-nodes=main.highlightedNodes reln-types=main.relnTypeFilter></concept-browser><div ng-if=\\\"!main.graph && main.graphLoading\\\" flex layout=column layout-align=\\\"center center\\\" layout-padding><md-progress-circular md-mode=indeterminate></md-progress-circular><div class=\\\"text-center md-headline md-secondary\\\">Loading graph data&hellip;<br>This may take a while.</div></div></div><md-sidenav md-component-id=right class=md-sidenav-right md-is-open=main.activeNode md-disable-backdrop md-whiteframe=4 layout=column><md-toolbar><div class=md-toolbar-tools><h2>Node Information</h2><span flex></span><md-button class=md-icon-button ng-click=\\\"main.activeNode = null\\\"><md-icon>close</md-icon></md-button></div></md-toolbar><div flex layout=column layout-align=\\\"center center\\\" ng-if=main.sidebarLoading><md-progress-circular md-mode=indeterminate></md-progress-circular></div><div class=node-info flex layout=column ng-if=!main.sidebarLoading><h3 class=name><span class=given>{{main.person.name.givenName}}</span> <span class=family>{{main.person.name.familyName}}</span></h3><md-tabs flex><md-tab ng-if=main.person.summary><md-tab-label><md-icon>person</md-icon></md-tab-label><md-tab-body><div class=summary ng-if=main.person.summary ng-bind-html=main.person.summary></div></md-tab-body></md-tab><md-tab ng-if=\\\"main.works &amp;&amp; main.works.length &gt; 0\\\"><md-tab-label><md-icon>content_copy</md-icon></md-tab-label><md-tab-body><div class=books><h4>Books ({{main.works.length}})</h4><md-list><md-list-item ng-repeat=\\\"work in main.works\\\" ng-href=../#/library/books/{{work.id}}>{{work.label}}</md-list-item></md-list></div></md-tab-body></md-tab><md-tab ng-if=\\\"main.related &amp;&amp; main.related.length &gt; 0\\\"><md-tab-label><md-icon>link</md-icon></md-tab-label><md-tab-body><md-list class=relationships><div ng-repeat=\\\"group in main.related\\\"><div ng-if=group.directed><div ng-if=\\\"group.out.nodes.length &gt; 0\\\"><md-subheader class=md-no-sticky>{{group.out.label}}</md-subheader><md-list-item ng-repeat=\\\"node in group.out.nodes track by node.id\\\" ng-click=\\\"main.activeNode = node\\\">{{node.label}}</md-list-item></div><div ng-if=\\\"group.in.nodes.length &gt; 0\\\"><md-subheader class=md-no-sticky>{{group.in.label}}</md-subheader><md-list-item ng-repeat=\\\"node in group.in.nodes track by node.id\\\" ng-click=\\\"main.activeNode = node\\\">{{node.label}}</md-list-item></div></div><div ng-if=!group.directed><div ng-if=\\\"group.none.nodes.length &gt; 0\\\"><md-subheader class=md-no-sticky>{{group.none.label}}</md-subheader><md-list-item ng-repeat=\\\"node in group.none.nodes track by node.id\\\" ng-click=\\\"main.activeNode = node\\\">{{node.label}}</md-list-item></div></div></div></md-list></md-tab-body></md-tab></md-tabs></div></md-sidenav></main>\");}]);"],"sourceRoot":"/source/"}